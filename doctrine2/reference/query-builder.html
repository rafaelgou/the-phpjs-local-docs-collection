
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>16. The QueryBuilder &mdash; Doctrine 2 ORM 2 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script src="../_static/bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/doctrine.ico"/>
    <link rel="top" title="Doctrine 2 ORM 2 documentation" href="../index.html" />
    <link rel="next" title="17. Native SQL" href="native-sql.html" />
    <link rel="prev" title="15. Doctrine Query Language" href="dql-doctrine-query-language.html" />
 
<!-- RTD Extra Head -->


<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<link rel="stylesheet" href="//media.readthedocs.org/css/rtd-shim.css" type="text/css" />
<!-- end RTD <extrahead> -->

  </head>
  <body>
    <div id="wrapper">
      <div id="header">
        <h1 id="h1title"></h1>
        <div id="logo">
          <a href="http://www.doctrine-project.org/">Doctrine - PHP Database Libraries</a>
        </div>
      </div>
      <div id="nav" class="cls">
        <div class="tl cls">
          <ul>
            <li><a target="_top" href="/">home</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/about">about</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects.html">projects</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/orm">orm</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/dbal">dbal</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/blog">blog</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/jira">development</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/contribute">contribute</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/community">community</a></li>
          </ul>
        </div>
      </div>
      <div id="content" class="cls">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="native-sql.html" title="17. Native SQL"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dql-doctrine-query-language.html" title="15. Doctrine Query Language"
             accesskey="P">previous</a> |</li>
        <li><a href="/">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine 2 ORM 2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">

              <div class="body" >
                
  <div class="section" id="the-querybuilder">
<h1>16. The QueryBuilder<a class="headerlink" href="#the-querybuilder" title="Permalink to this headline">¶</a></h1>
<p>A <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> provides an API that is designed for
conditionally constructing a DQL query in several steps.</p>
<p>It provides a set of classes and methods that is able to
programmatically build queries, and also provides a fluent API.
This means that you can change between one methodology to the other
as you want, and also pick one if you prefer.</p>
<div class="section" id="constructing-a-new-querybuilder-object">
<h2>16.1. Constructing a new QueryBuilder object<a class="headerlink" href="#constructing-a-new-querybuilder-object" title="Permalink to this headline">¶</a></h2>
<p>The same way you build a normal Query, you build a <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt>
object, just providing the correct method name. Here is an example
how to build a <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $em instanceof EntityManager</span>

<span class="c1">// example1: creating a QueryBuilder instance</span>
<span class="nv">$qb</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">();</span>
</pre></div>
</div>
<p>Once you have created an instance of QueryBuilder, it provides a
set of useful informative functions that you can use. One good
example is to inspect what type of object the <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> is.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// example2: retrieving type of QueryBuilder</span>
<span class="k">echo</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getType</span><span class="p">();</span> <span class="c1">// Prints: 0</span>
</pre></div>
</div>
<p>There&#8217;re currently 3 possible return values for <tt class="docutils literal"><span class="pre">getType()</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">QueryBuilder::SELECT</span></tt>, which returns value 0</li>
<li><tt class="docutils literal"><span class="pre">QueryBuilder::DELETE</span></tt>, returning value 1</li>
<li><tt class="docutils literal"><span class="pre">QueryBuilder::UPDATE</span></tt>, which returns value 2</li>
</ul>
<p>It is possible to retrieve the associated <tt class="docutils literal"><span class="pre">EntityManager</span></tt> of the
current <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt>, its DQL and also a <tt class="docutils literal"><span class="pre">Query</span></tt> object when
you finish building your DQL.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// example3: retrieve the associated EntityManager</span>
<span class="nv">$em</span> <span class="o">=</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">();</span>

<span class="c1">// example4: retrieve the DQL string of what was defined in QueryBuilder</span>
<span class="nv">$dql</span> <span class="o">=</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getDql</span><span class="p">();</span>

<span class="c1">// example5: retrieve the associated Query object with the processed DQL</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">();</span>
</pre></div>
</div>
<p>Internally, <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> works with a DQL cache to increase
performance. Any changes that may affect the generated DQL actually
modifies the state of <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> to a stage we call
STATE_DIRTY. One <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> can be in two different states:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">QueryBuilder::STATE_CLEAN</span></tt>, which means DQL haven&#8217;t been
altered since last retrieval or nothing were added since its
instantiation</li>
<li><tt class="docutils literal"><span class="pre">QueryBuilder::STATE_DIRTY</span></tt>, means DQL query must (and will)
be processed on next retrieval</li>
</ul>
</div>
<div class="section" id="working-with-querybuilder">
<h2>16.2. Working with QueryBuilder<a class="headerlink" href="#working-with-querybuilder" title="Permalink to this headline">¶</a></h2>
<div class="section" id="high-level-api-methods">
<h3>16.2.1. High level API methods<a class="headerlink" href="#high-level-api-methods" title="Permalink to this headline">¶</a></h3>
<p>To simplify even more the way you build a query in Doctrine, we can take
advantage of what we call Helper methods. For all base code, there
is a set of useful methods to simplify a programmer&#8217;s life. To
illustrate how to work with them, here is the same example 6
re-written using <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> helper methods:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = ?1&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.name&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> helper methods are considered the standard way to
build DQL queries. Although it is supported, it should be avoided
to use string based queries and greatly encouraged to use
<tt class="docutils literal"><span class="pre">$qb-&gt;expr()-&gt;*</span></tt> methods. Here is a converted example 8 to
suggested standard way to build queries:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">))</span> <span class="c1">// string &#39;u&#39; is converted to array internally</span>
   <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orX</span><span class="p">(</span>
       <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">,</span> <span class="s1">&#39;?1&#39;</span><span class="p">),</span>
       <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">like</span><span class="p">(</span><span class="s1">&#39;u.nickname&#39;</span><span class="p">,</span> <span class="s1">&#39;?2&#39;</span><span class="p">)</span>
   <span class="p">))</span>
   <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.surname&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Here is a complete list of helper methods available in <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">QueryBuilder</span>
<span class="p">{</span>
    <span class="c1">// Example - $qb-&gt;select(&#39;u&#39;)</span>
    <span class="c1">// Example - $qb-&gt;select(array(&#39;u&#39;, &#39;p&#39;))</span>
    <span class="c1">// Example - $qb-&gt;select($qb-&gt;expr()-&gt;select(&#39;u&#39;, &#39;p&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">select</span><span class="p">(</span><span class="nv">$select</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;delete(&#39;User&#39;, &#39;u&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$delete</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$alias</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;update(&#39;Group&#39;, &#39;g&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$update</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$alias</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;set(&#39;u.firstName&#39;, $qb-&gt;expr()-&gt;literal(&#39;Arnold&#39;))</span>
    <span class="c1">// Example - $qb-&gt;set(&#39;u.numChilds&#39;, &#39;u.numChilds + ?1&#39;)</span>
    <span class="c1">// Example - $qb-&gt;set(&#39;u.numChilds&#39;, $qb-&gt;expr()-&gt;sum(&#39;u.numChilds&#39;, &#39;?1&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;from(&#39;Phonenumber&#39;, &#39;p&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">from</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="nv">$alias</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;innerJoin(&#39;u.Group&#39;, &#39;g&#39;, Expr\Join::WITH, $qb-&gt;expr()-&gt;eq(&#39;u.status_id&#39;, &#39;?1&#39;))</span>
    <span class="c1">// Example - $qb-&gt;innerJoin(&#39;u.Group&#39;, &#39;g&#39;, &#39;WITH&#39;, &#39;u.status = ?1&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">innerJoin</span><span class="p">(</span><span class="nv">$join</span><span class="p">,</span> <span class="nv">$alias</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$conditionType</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$condition</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;leftJoin(&#39;u.Phonenumbers&#39;, &#39;p&#39;, Expr\Join::WITH, $qb-&gt;expr()-&gt;eq(&#39;p.area_code&#39;, 55))</span>
    <span class="c1">// Example - $qb-&gt;leftJoin(&#39;u.Phonenumbers&#39;, &#39;p&#39;, &#39;WITH&#39;, &#39;p.area_code = 55&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">leftJoin</span><span class="p">(</span><span class="nv">$join</span><span class="p">,</span> <span class="nv">$alias</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$conditionType</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$condition</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// NOTE: -&gt;where() overrides all previously set conditions</span>
    <span class="c1">//</span>
    <span class="c1">// Example - $qb-&gt;where(&#39;u.firstName = ?1&#39;, $qb-&gt;expr()-&gt;eq(&#39;u.surname&#39;, &#39;?2&#39;))</span>
    <span class="c1">// Example - $qb-&gt;where($qb-&gt;expr()-&gt;andX($qb-&gt;expr()-&gt;eq(&#39;u.firstName&#39;, &#39;?1&#39;), $qb-&gt;expr()-&gt;eq(&#39;u.surname&#39;, &#39;?2&#39;)))</span>
    <span class="c1">// Example - $qb-&gt;where(&#39;u.firstName = ?1 AND u.surname = ?2&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">where</span><span class="p">(</span><span class="nv">$where</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;andWhere($qb-&gt;expr()-&gt;orX($qb-&gt;expr()-&gt;lte(&#39;u.age&#39;, 40), &#39;u.numChild = 0&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">andWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;orWhere($qb-&gt;expr()-&gt;between(&#39;u.id&#39;, 1, 10));</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">);</span>

    <span class="c1">// NOTE: -&gt; groupBy() overrides all previously set grouping conditions</span>
    <span class="c1">//</span>
    <span class="c1">// Example - $qb-&gt;groupBy(&#39;u.id&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">groupBy</span><span class="p">(</span><span class="nv">$groupBy</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;addGroupBy(&#39;g.name&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addGroupBy</span><span class="p">(</span><span class="nv">$groupBy</span><span class="p">);</span>

    <span class="c1">// NOTE: -&gt; having() overrides all previously set having conditions</span>
    <span class="c1">//</span>
    <span class="c1">// Example - $qb-&gt;having(&#39;u.salary &gt;= ?1&#39;)</span>
    <span class="c1">// Example - $qb-&gt;having($qb-&gt;expr()-&gt;gte(&#39;u.salary&#39;, &#39;?1&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">having</span><span class="p">(</span><span class="nv">$having</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;andHaving($qb-&gt;expr()-&gt;gt($qb-&gt;expr()-&gt;count(&#39;u.numChild&#39;), 0))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">andHaving</span><span class="p">(</span><span class="nv">$having</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;orHaving($qb-&gt;expr()-&gt;lte(&#39;g.managerLevel&#39;, &#39;100&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orHaving</span><span class="p">(</span><span class="nv">$having</span><span class="p">);</span>

    <span class="c1">// NOTE: -&gt; orderBy() overrides all previously set ordering conditions</span>
    <span class="c1">//</span>
    <span class="c1">// Example - $qb-&gt;orderBy(&#39;u.surname&#39;, &#39;DESC&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orderBy</span><span class="p">(</span><span class="nv">$sort</span><span class="p">,</span> <span class="nv">$order</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>

    <span class="c1">// Example - $qb-&gt;addOrderBy(&#39;u.firstName&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addOrderBy</span><span class="p">(</span><span class="nv">$sort</span><span class="p">,</span> <span class="nv">$order</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span> <span class="c1">// Default $order = &#39;ASC&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-parameters-to-your-query">
<h3>16.2.2. Binding parameters to your query<a class="headerlink" href="#binding-parameters-to-your-query" title="Permalink to this headline">¶</a></h3>
<p>Doctrine supports dynamic binding of parameters to your query,
similar to preparing queries. You can use both strings and numbers
as placeholders, although both have a slightly different syntax.
Additionally, you must make your choice: Mixing both styles is not
allowed. Binding parameters can simply be achieved as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = ?1&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.name&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// Sets ?1 to 100, and thus we will fetch a user with u.id = 100</span>
</pre></div>
</div>
<p>You are not forced to enumerate your placeholders as the
alternative syntax is available:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;User u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.id = :identifier&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;u.name&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;identifier&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// Sets :identifier to 100, and thus we will fetch a user with u.id = 100</span>
</pre></div>
</div>
<p>Note that numeric placeholders start with a ? followed by a number
while the named placeholders start with a : followed by a string.</p>
<p>Calling <tt class="docutils literal"><span class="pre">setParameter()</span></tt> automatically infers which type you are setting as
value. This works for integers, arrays of strings/integers, DateTime instances
and for managed entities. If you want to set a type explicitly you can call
the third argument to <tt class="docutils literal"><span class="pre">setParameter()</span></tt> explicitly. It accepts either a PDO
type or a DBAL Type name for conversion.</p>
<p>If you&#8217;ve got several parameters to bind to your query, you can
also use setParameters() instead of setParameter() with the
following syntax:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// Query here...</span>
<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">setParameters</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;value for ?1&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">&#39;value for ?2&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Getting already bound parameters is easy - simply use the above
mentioned syntax with &#8220;getParameter()&#8221; or &#8220;getParameters()&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// See example above</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getParameters</span><span class="p">();</span>
<span class="c1">// $params instanceof \Doctrine\Common\Collections\ArrayCollection</span>

<span class="c1">// Equivalent to</span>
<span class="nv">$param</span> <span class="o">=</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">// $param instanceof \Doctrine\ORM\Query\Parameter</span>
</pre></div>
</div>
<p>Note: If you try to get a parameter that was not bound yet,
getParameter() simply returns NULL.</p>
<p>The API of a Query Parameter is:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">namespace Doctrine\ORM\Query;</span>

<span class="x">class Parameter</span>
<span class="x">{</span>
<span class="x">    public function getName();</span>
<span class="x">    public function getValue();</span>
<span class="x">    public function getType();</span>
<span class="x">    public function setValue($value, $type = null);</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="section" id="limiting-the-result">
<h3>16.2.3. Limiting the Result<a class="headerlink" href="#limiting-the-result" title="Permalink to this headline">¶</a></h3>
<p>To limit a result the query builder has some methods in common with
the Query object which can be retrieved from <tt class="docutils literal"><span class="pre">EntityManager#createQuery()</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>
<span class="nv">$offset</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">];</span>
<span class="nv">$limit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">];</span>

<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;User u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;orderBy&#39;</span><span class="p">,</span> <span class="s1">&#39;u.name ASC&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">setFirstResult</span><span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">setMaxResults</span><span class="p">(</span> <span class="nv">$limit</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="executing-a-query">
<h3>16.2.4. Executing a Query<a class="headerlink" href="#executing-a-query" title="Permalink to this headline">¶</a></h3>
<p>The QueryBuilder is a builder object only, it has no means of actually
executing the Query. Additionally a set of parameters such as query hints
cannot be set on the QueryBuilder itself. This is why you always have to convert
a querybuilder instance into a Query object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">();</span>

<span class="c1">// Set additional Query options</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setQueryHint</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">useResultCache</span><span class="p">(</span><span class="s1">&#39;my_cache_id&#39;</span><span class="p">);</span>

<span class="c1">// Execute Query</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
<span class="nv">$single</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getSingleResult</span><span class="p">();</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getArrayResult</span><span class="p">();</span>
<span class="nv">$scalar</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getScalarResult</span><span class="p">();</span>
<span class="nv">$singleScalar</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getSingleScalarResult</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="the-expr-class">
<h3>16.2.5. The Expr class<a class="headerlink" href="#the-expr-class" title="Permalink to this headline">¶</a></h3>
<p>To workaround some of the issues that <tt class="docutils literal"><span class="pre">add()</span></tt> method may cause,
Doctrine created a class that can be considered as a helper for
building expressions. This class is called <tt class="docutils literal"><span class="pre">Expr</span></tt>, which provides a
set of useful methods to help build expressions:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// example8: QueryBuilder port of: &quot;SELECT u FROM User u WHERE u.id = ? OR u.nickname LIKE ? ORDER BY u.surname DESC&quot; using Expr class</span>
<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\Select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)))</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\From</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">))</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orX</span><span class="p">(</span>
       <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">,</span> <span class="s1">&#39;?1&#39;</span><span class="p">),</span>
       <span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">expr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">like</span><span class="p">(</span><span class="s1">&#39;u.nickname&#39;</span><span class="p">,</span> <span class="s1">&#39;?2&#39;</span><span class="p">)</span>
   <span class="p">))</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;orderBy&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\OrderBy</span><span class="p">(</span><span class="s1">&#39;u.name&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Although it still sounds complex, the ability to programmatically
create conditions are the main feature of <tt class="docutils literal"><span class="pre">Expr</span></tt>. Here it is a
complete list of supported helper methods available:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">Expr</span>
<span class="p">{</span>
    <span class="sd">/** Conditional objects **/</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;andX($cond1 [, $condN])-&gt;add(...)-&gt;...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">andX</span><span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span> <span class="c1">// Returns Expr\AndX instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;orX($cond1 [, $condN])-&gt;add(...)-&gt;...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orX</span><span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span> <span class="c1">// Returns Expr\OrX instance</span>


    <span class="sd">/** Comparison objects **/</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;eq(&#39;u.id&#39;, &#39;?1&#39;) =&gt; u.id = ?1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">eq</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;neq(&#39;u.id&#39;, &#39;?1&#39;) =&gt; u.id &lt;&gt; ?1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">neq</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;lt(&#39;u.id&#39;, &#39;?1&#39;) =&gt; u.id &lt; ?1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">lt</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;lte(&#39;u.id&#39;, &#39;?1&#39;) =&gt; u.id &lt;= ?1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">lte</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;gt(&#39;u.id&#39;, &#39;?1&#39;) =&gt; u.id &gt; ?1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">gt</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;gte(&#39;u.id&#39;, &#39;?1&#39;) =&gt; u.id &gt;= ?1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">gte</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;isNull(&#39;u.id&#39;) =&gt; u.id IS NULL</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isNull</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns string</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;isNotNull(&#39;u.id&#39;) =&gt; u.id IS NOT NULL</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isNotNull</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns string</span>


    <span class="sd">/** Arithmetic objects **/</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;prod(&#39;u.id&#39;, &#39;2&#39;) =&gt; u.id * 2</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">prod</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Math instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;diff(&#39;u.id&#39;, &#39;2&#39;) =&gt; u.id - 2</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">diff</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Math instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;sum(&#39;u.id&#39;, &#39;2&#39;) =&gt; u.id + 2</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sum</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Math instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;quot(&#39;u.id&#39;, &#39;2&#39;) =&gt; u.id / 2</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">quot</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Math instance</span>


    <span class="sd">/** Pseudo-function objects **/</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;exists($qb2-&gt;getDql())</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">exists</span><span class="p">(</span><span class="nv">$subquery</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;all($qb2-&gt;getDql())</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">all</span><span class="p">(</span><span class="nv">$subquery</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;some($qb2-&gt;getDql())</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">some</span><span class="p">(</span><span class="nv">$subquery</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;any($qb2-&gt;getDql())</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">any</span><span class="p">(</span><span class="nv">$subquery</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;not($qb-&gt;expr()-&gt;eq(&#39;u.id&#39;, &#39;?1&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">not</span><span class="p">(</span><span class="nv">$restriction</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;in(&#39;u.id&#39;, array(1, 2, 3))</span>
    <span class="c1">// Make sure that you do NOT use something similar to $qb-&gt;expr()-&gt;in(&#39;value&#39;, array(&#39;stringvalue&#39;)) as this will cause Doctrine to throw an Exception.</span>
    <span class="c1">// Instead, use $qb-&gt;expr()-&gt;in(&#39;value&#39;, array(&#39;?1&#39;)) and bind your parameter to ?1 (see section above)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">in</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;notIn(&#39;u.id&#39;, &#39;2&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">notIn</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Func instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;like(&#39;u.firstname&#39;, $qb-&gt;expr()-&gt;literal(&#39;Gui%&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">like</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;notLike(&#39;u.firstname&#39;, $qb-&gt;expr()-&gt;literal(&#39;Gui%&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">notLike</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Comparison instance</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;between(&#39;u.id&#39;, &#39;1&#39;, &#39;10&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">between</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>


    <span class="sd">/** Function objects **/</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;trim(&#39;u.firstname&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">trim</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;concat(&#39;u.firstname&#39;, $qb-&gt;expr()-&gt;concat($qb-&gt;expr()-&gt;literal(&#39; &#39;), &#39;u.lastname&#39;))</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">concat</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;substring(&#39;u.firstname&#39;, 0, 1)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">substring</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$from</span><span class="p">,</span> <span class="nv">$len</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;lower(&#39;u.firstname&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">lower</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;upper(&#39;u.firstname&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">upper</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;length(&#39;u.firstname&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">length</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;avg(&#39;u.age&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">avg</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;max(&#39;u.age&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">max</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;min(&#39;u.age&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">min</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;abs(&#39;u.currentBalance&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">abs</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;sqrt(&#39;u.currentBalance&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;count(&#39;u.firstname&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>

    <span class="c1">// Example - $qb-&gt;expr()-&gt;countDistinct(&#39;u.surname&#39;)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">countDistinct</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// Returns Expr\Func</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="low-level-api">
<h3>16.2.6. Low Level API<a class="headerlink" href="#low-level-api" title="Permalink to this headline">¶</a></h3>
<p>Now we have describe the low level (thought of as the
hardcore method) of creating queries. It may be useful to work at
this level for optimization purposes, but most of the time it is
preferred to work at a higher level of abstraction.</p>
<p>All helper methods in <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> actually rely on a single
one: <tt class="docutils literal"><span class="pre">add()</span></tt>. This method is responsible of building every piece
of DQL. It takes 3 parameters: <tt class="docutils literal"><span class="pre">$dqlPartName</span></tt>, <tt class="docutils literal"><span class="pre">$dqlPart</span></tt> and
<tt class="docutils literal"><span class="pre">$append</span></tt> (default=false)</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">$dqlPartName</span></tt>: Where the <tt class="docutils literal"><span class="pre">$dqlPart</span></tt> should be placed.
Possible values: select, from, where, groupBy, having, orderBy</li>
<li><tt class="docutils literal"><span class="pre">$dqlPart</span></tt>: What should be placed in <tt class="docutils literal"><span class="pre">$dqlPartName</span></tt>. Accepts
a string or any instance of <tt class="docutils literal"><span class="pre">Doctrine\ORM\Query\Expr\*</span></tt></li>
<li><tt class="docutils literal"><span class="pre">$append</span></tt>: Optional flag (default=false) if the <tt class="docutils literal"><span class="pre">$dqlPart</span></tt>
should override all previously defined items in <tt class="docutils literal"><span class="pre">$dqlPartName</span></tt> or
not (no effect on the <tt class="docutils literal"><span class="pre">where</span></tt> and <tt class="docutils literal"><span class="pre">having</span></tt> DQL query parts,
which always override all previously defined items)</li>
<li></li>
</ul>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// example6: how to define: &quot;SELECT u FROM User u WHERE u.id = ? ORDER BY u.name ASC&quot; using QueryBuilder string support</span>
<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;User u&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="s1">&#39;u.id = ?1&#39;</span><span class="p">)</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;orderBy&#39;</span><span class="p">,</span> <span class="s1">&#39;u.name ASC&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="expr-classes">
<h3>16.2.7. Expr* classes<a class="headerlink" href="#expr-classes" title="Permalink to this headline">¶</a></h3>
<p>When you call <tt class="docutils literal"><span class="pre">add()</span></tt> with string, it internally evaluates to an
instance of <tt class="docutils literal"><span class="pre">Doctrine\ORM\Query\Expr\Expr\*</span></tt> class. Here is the
same query of example 6 written using
<tt class="docutils literal"><span class="pre">Doctrine\ORM\Query\Expr\Expr\*</span></tt> classes:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $qb instanceof QueryBuilder</span>

<span class="c1">// example7: how to define: &quot;SELECT u FROM User u WHERE u.id = ? ORDER BY u.name ASC&quot; using QueryBuilder using Expr\* instances</span>
<span class="nv">$qb</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\Select</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)))</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\From</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">))</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\Comparison</span><span class="p">(</span><span class="s1">&#39;u.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;?1&#39;</span><span class="p">))</span>
   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;orderBy&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Expr\OrderBy</span><span class="p">(</span><span class="s1">&#39;u.name&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Of course this is the hardest way to build a DQL query in Doctrine.
To simplify some of these efforts, we introduce what we call as
<tt class="docutils literal"><span class="pre">Expr</span></tt> helper class.</p>
</div>
</div>
</div>


              </div>
                </div>

            </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">



             
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:Doctrine ORM">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">16. The QueryBuilder</a><ul>
<li><a class="reference internal" href="#constructing-a-new-querybuilder-object">16.1. Constructing a new QueryBuilder object</a></li>
<li><a class="reference internal" href="#working-with-querybuilder">16.2. Working with QueryBuilder</a><ul>
<li><a class="reference internal" href="#high-level-api-methods">16.2.1. High level API methods</a></li>
<li><a class="reference internal" href="#binding-parameters-to-your-query">16.2.2. Binding parameters to your query</a></li>
<li><a class="reference internal" href="#limiting-the-result">16.2.3. Limiting the Result</a></li>
<li><a class="reference internal" href="#executing-a-query">16.2.4. Executing a Query</a></li>
<li><a class="reference internal" href="#the-expr-class">16.2.5. The Expr class</a></li>
<li><a class="reference internal" href="#low-level-api">16.2.6. Low Level API</a></li>
<li><a class="reference internal" href="#expr-classes">16.2.7. Expr* classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="dql-doctrine-query-language.html"
                                  title="previous chapter">15. Doctrine Query Language</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="native-sql.html"
                                  title="next chapter">17. Native SQL</a></p>
  
    <h3>This Page</h3>
    <ul class="this-page-menu">
      
        <li><a href="../_sources/reference/query-builder.txt"
               rel="nofollow">Show Source</a></li>
      
      
        <li><a href="https://github.com/doctrine/doctrine2/blob/master/docs/en/reference/query-builder.rst">
          Show on GitHub</a></li>
        <li><a href="https://github.com/doctrine/doctrine2/edit/master/docs/en/reference/query-builder.rst">
          Edit on GitHub</a></li>
      
    </ul>
  

        </div>
      </div>
          <div class="clearer"></div>
        </div>

          <div class="footer">
              &copy; Copyright 2010-12, Doctrine Project Team.
              Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
            <br/>
            <a target="_BLANK" href="http://www.servergrove.com"><img src="http://www.doctrine-project.org/images/servergrove.jpg" /></a>      <br/><br/>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick" />
              <input type="hidden" name="hosted_button_id" value="BAE2E3XANQ77Y" />
              <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" />
              <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
            </form>
          </div>
 <!-- End original user content -->


<br/>
<br/>
<br/>


<style type="text/css">
  #version_menu, .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0.75s;
    transition: all 0.25s 0.75s;
  }
  .footer_popout:hover #version_menu, .footer_popout:hover .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0s;
    transition: all 0.25s 0s;
  }
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    visibility: hidden;
    opacity: 0;
    bottom: 11px;
    right: 47px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    visibility: visible;
    opacity: 1;
    right: 166px;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(//media.readthedocs.org//images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll top left no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/doctrine-orm/?fromdocs=doctrine-orm" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




      </div>

      <div id="bot-rcnr">
        <div class="tl"><!-- corner --></div>
      </div>
    </div>

  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
  </script>
  <script type="text/javascript">
  _uacct = "UA-288343-7";
  urchinTracker();
  </script>
  <a class="githublink" href="http://github.com/doctrine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>