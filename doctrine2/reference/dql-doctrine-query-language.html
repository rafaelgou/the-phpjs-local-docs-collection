
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>15. Doctrine Query Language &mdash; Doctrine 2 ORM 2 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script src="../_static/bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/doctrine.ico"/>
    <link rel="top" title="Doctrine 2 ORM 2 documentation" href="../index.html" />
    <link rel="next" title="16. The QueryBuilder" href="query-builder.html" />
    <link rel="prev" title="14. Batch Processing" href="batch-processing.html" />
 
<!-- RTD Extra Head -->


<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<link rel="stylesheet" href="//media.readthedocs.org/css/rtd-shim.css" type="text/css" />
<!-- end RTD <extrahead> -->

  </head>
  <body>
    <div id="wrapper">
      <div id="header">
        <h1 id="h1title"></h1>
        <div id="logo">
          <a href="http://www.doctrine-project.org/">Doctrine - PHP Database Libraries</a>
        </div>
      </div>
      <div id="nav" class="cls">
        <div class="tl cls">
          <ul>
            <li><a target="_top" href="/">home</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/about">about</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects.html">projects</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/orm">orm</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/projects/dbal">dbal</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/blog">blog</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/jira">development</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/contribute">contribute</a></li>
            <li><a class="" target="_top" href="http://www.doctrine-project.org/community">community</a></li>
          </ul>
        </div>
      </div>
      <div id="content" class="cls">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="query-builder.html" title="16. The QueryBuilder"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="batch-processing.html" title="14. Batch Processing"
             accesskey="P">previous</a> |</li>
        <li><a href="/">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine 2 ORM 2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">

              <div class="body" >
                
  <div class="section" id="doctrine-query-language">
<h1>15. Doctrine Query Language<a class="headerlink" href="#doctrine-query-language" title="Permalink to this headline">¶</a></h1>
<p>DQL stands for Doctrine Query Language and is an Object
Query Language derivate that is very similar to the Hibernate
Query Language (HQL) or the Java Persistence Query Language (JPQL).</p>
<p>In essence, DQL provides powerful querying capabilities over your
object model. Imagine all your objects lying around in some storage
(like an object database). When writing DQL queries, think about
querying that storage to pick a certain subset of your objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A common mistake for beginners is to mistake DQL for
being just some form of SQL and therefore trying to use table names
and column names or join arbitrary tables together in a query. You
need to think about DQL as a query language for your object model,
not for your relational schema.</p>
</div>
<p>DQL is case in-sensitive, except for namespace, class and field
names, which are case sensitive.</p>
<div class="section" id="types-of-dql-queries">
<h2>15.1. Types of DQL queries<a class="headerlink" href="#types-of-dql-queries" title="Permalink to this headline">¶</a></h2>
<p>DQL as a query language has SELECT, UPDATE and DELETE constructs
that map to their corresponding SQL statement types. INSERT
statements are not allowed in DQL, because entities and their
relations have to be introduced into the persistence context
through <tt class="docutils literal"><span class="pre">EntityManager#persist()</span></tt> to ensure consistency of your
object model.</p>
<p>DQL SELECT statements are a very powerful way of retrieving parts
of your domain model that are not accessible via associations.
Additionally they allow to retrieve entities and their associations
in one single SQL select statement which can make a huge difference
in performance in contrast to using several queries.</p>
<p>DQL UPDATE and DELETE statements offer a way to execute bulk
changes on the entities of your domain model. This is often
necessary when you cannot load all the affected entities of a bulk
update into memory.</p>
</div>
<div class="section" id="select-queries">
<h2>15.2. SELECT queries<a class="headerlink" href="#select-queries" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dql-select-clause">
<h3>15.2.1. DQL SELECT clause<a class="headerlink" href="#dql-select-clause" title="Permalink to this headline">¶</a></h3>
<p>The select clause of a DQL query specifies what appears in the
query result. The composition of all the expressions in the select
clause also influences the nature of the query result.</p>
<p>Here is an example that selects all users with an age &gt; 20:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM MyProject\Model\User u WHERE u.age &gt; 20&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Lets examine the query:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">u</span></tt> is a so called identification variable or alias that
refers to the <tt class="docutils literal"><span class="pre">MyProject\Model\User</span></tt> class. By placing this alias
in the SELECT clause we specify that we want all instances of the
User class that are matched by this query to appear in the query
result.</li>
<li>The FROM keyword is always followed by a fully-qualified class
name which in turn is followed by an identification variable or
alias for that class name. This class designates a root of our
query from which we can navigate further via joins (explained
later) and path expressions.</li>
<li>The expression <tt class="docutils literal"><span class="pre">u.age</span></tt> in the WHERE clause is a path
expression. Path expressions in DQL are easily identified by the
use of the &#8216;.&#8217; operator that is used for constructing paths. The
path expression <tt class="docutils literal"><span class="pre">u.age</span></tt> refers to the <tt class="docutils literal"><span class="pre">age</span></tt> field on the User
class.</li>
</ul>
<p>The result of this query would be a list of User objects where all
users are older than 20.</p>
<p>The SELECT clause allows to specify both class identification
variables that signal the hydration of a complete entity class or
just fields of the entity using the syntax <tt class="docutils literal"><span class="pre">u.name</span></tt>. Combinations
of both are also allowed and it is possible to wrap both fields and
identification values into aggregation and DQL functions. Numerical
fields can be part of computations using mathematical operations.
See the sub-section on <a class="reference internal" href="#functions-operators-aggregates">Functions, Operators, Aggregates</a> for
more information.</p>
</div>
<div class="section" id="joins">
<h3>15.2.2. Joins<a class="headerlink" href="#joins" title="Permalink to this headline">¶</a></h3>
<p>A SELECT query can contain joins. There are 2 types of JOINs:
&#8220;Regular&#8221; Joins and &#8220;Fetch&#8221; Joins.</p>
<p><strong>Regular Joins</strong>: Used to limit the results and/or compute
aggregate values.</p>
<p><strong>Fetch Joins</strong>: In addition to the uses of regular joins: Used to
fetch related entities and include them in the hydrated result of a
query.</p>
<p>There is no special DQL keyword that distinguishes a regular join
from a fetch join. A join (be it an inner or outer join) becomes a
&#8220;fetch join&#8221; as soon as fields of the joined entity appear in the
SELECT part of the DQL query outside of an aggregate function.
Otherwise its a &#8220;regular join&#8221;.</p>
<p>Example:</p>
<p>Regular join of the address:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s2">&quot;SELECT u FROM User u JOIN u.address a WHERE a.city = &#39;Berlin&#39;&quot;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Fetch join of the address:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s2">&quot;SELECT u, a FROM User u JOIN u.address a WHERE a.city = &#39;Berlin&#39;&quot;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>When Doctrine hydrates a query with fetch-join it returns the class
in the FROM clause on the root level of the result array. In the
previous example an array of User instances is returned and the
address of each user is fetched and hydrated into the
<tt class="docutils literal"><span class="pre">User#address</span></tt> variable. If you access the address Doctrine does
not need to lazy load the association with another query.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Doctrine allows you to walk all the associations between
all the objects in your domain model. Objects that were not already
loaded from the database are replaced with lazy load proxy
instances. Non-loaded Collections are also replaced by lazy-load
instances that fetch all the contained objects upon first access.
However relying on the lazy-load mechanism leads to many small
queries executed against the database, which can significantly
affect the performance of your application. <strong>Fetch Joins</strong> are the
solution to hydrate most or all of the entities that you need in a
single SELECT query.</p>
</div>
</div>
<div class="section" id="named-and-positional-parameters">
<h3>15.2.3. Named and Positional Parameters<a class="headerlink" href="#named-and-positional-parameters" title="Permalink to this headline">¶</a></h3>
<p>DQL supports both named and positional parameters, however in
contrast to many SQL dialects positional parameters are specified
with numbers, for example &#8221;?1&#8221;, &#8221;?2&#8221; and so on. Named parameters
are specified with &#8221;:name1&#8221;, &#8221;:name2&#8221; and so on.</p>
<p>When referencing the parameters in <tt class="docutils literal"><span class="pre">Query#setParameter($param,</span> <span class="pre">$value)</span></tt>
both named and positional parameters are used <strong>without</strong> their prefixes.</p>
</div>
<div class="section" id="dql-select-examples">
<h3>15.2.4. DQL SELECT Examples<a class="headerlink" href="#dql-select-examples" title="Permalink to this headline">¶</a></h3>
<p>This section contains a large set of DQL queries and some
explanations of what is happening. The actual result also depends
on the hydration mode.</p>
<p>Hydrate all User entities:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM MyProject\Model\User u&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of User objects</span>
</pre></div>
</div>
<p>Retrieve the IDs of all CmsUsers:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.id FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CmsUser ids</span>
</pre></div>
</div>
<p>Retrieve the IDs of all users that have written an article:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT DISTINCT u.id FROM CmsArticle a JOIN a.user u&#39;</span><span class="p">);</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CmsUser ids</span>
</pre></div>
</div>
<p>Retrieve all articles and sort them by the name of the articles
users instance:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT a FROM CmsArticle a JOIN a.user u ORDER BY u.name ASC&#39;</span><span class="p">);</span>
<span class="nv">$articles</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CmsArticle objects</span>
</pre></div>
</div>
<p>Retrieve the Username and Name of a CmsUser:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.username, u.name FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CmsUser username and name values</span>
<span class="k">echo</span> <span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>Retrieve a ForumUser and his single associated entity:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u, a FROM ForumUser u JOIN u.avatar a&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects with the avatar association loaded</span>
<span class="k">echo</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">());</span>
</pre></div>
</div>
<p>Retrieve a CmsUser and fetch join all the phonenumbers he has:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u, p FROM CmsUser u JOIN u.phonenumbers p&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CmsUser objects with the phonenumbers association loaded</span>
<span class="nv">$phonenumbers</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getPhonenumbers</span><span class="p">();</span>
</pre></div>
</div>
<p>Hydrate a result in Ascending:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM ForumUser u ORDER BY u.id ASC&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>Or in Descending Order:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM ForumUser u ORDER BY u.id DESC&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>Using Aggregate Functions:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(u.id) FROM Entities\User u&#39;</span><span class="p">);</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getSingleScalarResult</span><span class="p">();</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u, count(g.id) FROM Entities\User u JOIN u.groups g GROUP BY u.id&#39;</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>With WHERE Clause and Positional Parameter:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM ForumUser u WHERE u.id = ?1&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">321</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>With WHERE Clause and Named Parameter:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM ForumUser u WHERE u.username = :name&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>With Nested Conditions in WHERE Clause:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u from ForumUser u WHERE (u.username = :name OR u.username = :name2) AND u.id = :id&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameters</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">321</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>With COUNT DISTINCT:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(DISTINCT u.name) FROM CmsUser&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>With Arithmetic Expression in WHERE clause:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u WHERE ((u.id + 5000) * u.id + 3) &lt; 10000000&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of ForumUser objects</span>
</pre></div>
</div>
<p>Using a LEFT JOIN to hydrate all user-ids and optionally associated
article-ids:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.id, a.id as article_id FROM CmsUser u LEFT JOIN u.articles a&#39;</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of user ids and every article_id for each user</span>
</pre></div>
</div>
<p>Restricting a JOIN clause by additional conditions:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s2">&quot;SELECT u FROM CmsUser u LEFT JOIN u.articles a WITH a.topic LIKE :foo&quot;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;%foo%&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Using several Fetch JOINs:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u, a, p, c FROM CmsUser u JOIN u.articles a JOIN u.phonenumbers p JOIN a.comments c&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>BETWEEN in WHERE clause:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.name FROM CmsUser u WHERE u.id BETWEEN ?1 AND ?2&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">123</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">321</span><span class="p">);</span>
<span class="nv">$usernames</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>DQL Functions in WHERE clause:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s2">&quot;SELECT u.name FROM CmsUser u WHERE TRIM(u.name) = &#39;someone&#39;&quot;</span><span class="p">);</span>
<span class="nv">$usernames</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>IN() Expression:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.name FROM CmsUser u WHERE u.id IN(46)&#39;</span><span class="p">);</span>
<span class="nv">$usernames</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u WHERE u.id IN (1, 2)&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u WHERE u.id NOT IN (1)&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>CONCAT() DQL Function:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s2">&quot;SELECT u.id FROM CmsUser u WHERE CONCAT(u.name, &#39;s&#39;) = ?1&quot;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Jess&#39;</span><span class="p">);</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT CONCAT(u.id, u.name) FROM CmsUser u WHERE u.id = ?1&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">321</span><span class="p">);</span>
<span class="nv">$idUsernames</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>EXISTS in WHERE clause with correlated Subquery</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.id FROM CmsUser u WHERE EXISTS (SELECT p.phonenumber FROM CmsPhonenumber p WHERE p.user = u.id)&#39;</span><span class="p">);</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Get all users who are members of $group.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u.id FROM CmsUser u WHERE :groupId MEMBER OF u.groups&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;groupId&#39;</span><span class="p">,</span> <span class="nv">$group</span><span class="p">);</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Get all users that have more than 1 phonenumber</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u WHERE SIZE(u.phonenumbers) &gt; 1&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Get all users that have no phonenumber</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u WHERE u.phonenumbers IS EMPTY&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
</pre></div>
</div>
<p>Get all instances of a specific type, for use with inheritance
hierarchies:</p>
<p class="versionadded">
<span class="versionmodified">New in version 2.1.</span></p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM Doctrine\Tests\Models\Company\CompanyPerson u WHERE u INSTANCE OF Doctrine\Tests\Models\Company\CompanyEmployee&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM Doctrine\Tests\Models\Company\CompanyPerson u WHERE u INSTANCE OF ?1&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM Doctrine\Tests\Models\Company\CompanyPerson u WHERE u NOT INSTANCE OF ?1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Get all users visible on a given website that have chosen certain gender:</p>
<p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM User u WHERE u.gender IN (SELECT IDENTITY(agl.gender) FROM Site s JOIN s.activeGenderList agl WHERE s.id = ?1)&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p class="versionadded">
<span class="versionmodified">New in version 2.4.</span></p>
<p>Starting with 2.4, the IDENTITY() DQL function also works for composite primary keys:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT IDENTITY(c.location, &#39;</span><span class="nx">latitude</span><span class="s1">&#39;) AS latitude, IDENTITY(c.location, &#39;</span><span class="nx">longitude</span><span class="s1">&#39;) AS longitude FROM Checkpoint c WHERE c.user = ?1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Joins between entities without associations were not possible until version
2.4, where you can generate an arbitrary join with the following syntax:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM User u JOIN Blacklist b WITH u.email = b.email&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="partial-object-syntax">
<h4>15.2.4.1. Partial Object Syntax<a class="headerlink" href="#partial-object-syntax" title="Permalink to this headline">¶</a></h4>
<p>By default when you run a DQL query in Doctrine and select only a
subset of the fields for a given entity, you do not receive objects
back. Instead, you receive only arrays as a flat rectangular result
set, similar to how you would if you were just using SQL directly
and joining some data.</p>
<p>If you want to select partial objects you can use the <tt class="docutils literal"><span class="pre">partial</span></tt>
DQL keyword:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT partial u.{id, username} FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of partially loaded CmsUser objects</span>
</pre></div>
</div>
<p>You use the partial syntax when joining as well:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT partial u.{id, username}, partial a.{id, name} FROM CmsUser u JOIN u.articles a&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of partially loaded CmsUser objects</span>
</pre></div>
</div>
</div>
<div class="section" id="new-operator-syntax">
<h4>15.2.4.2. &#8220;NEW&#8221; Operator Syntax<a class="headerlink" href="#new-operator-syntax" title="Permalink to this headline">¶</a></h4>
<p class="versionadded">
<span class="versionmodified">New in version 2.4.</span></p>
<p>Using the <tt class="docutils literal"><span class="pre">NEW</span></tt> operator you can construct Data Transfer Objects (DTOs) directly from DQL queries.</p>
<ul class="simple">
<li>When using <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">NEW</span></tt> you don&#8217;t need to specify a mapped entity.</li>
<li>You can specify any PHP class, it&#8217;s only require that the constructor of this class matches the <tt class="docutils literal"><span class="pre">NEW</span></tt> statement.</li>
<li>This approach involves determining exactly which columns you really need,
and instantiating data-transfer object that containing a constructor with those arguments.</li>
</ul>
<p>If you want to select data-transfer objects you should create a class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">CustomerDTO</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$email</span><span class="p">,</span> <span class="nv">$city</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Bind values to the object properties.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And then use the <tt class="docutils literal"><span class="pre">NEW</span></tt> DQL keyword :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT NEW CustomerDTO(c.name, e.email, a.city) FROM Customer c JOIN c.email e JOIN c.address a&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CustomerDTO</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT NEW CustomerDTO(c.name, e.email, a.city, SUM(o.value)) FROM Customer c JOIN c.email e JOIN c.address a JOIN c.orders o GROUP BY c&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// array of CustomerDTO</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-index-by">
<h3>15.2.5. Using INDEX BY<a class="headerlink" href="#using-index-by" title="Permalink to this headline">¶</a></h3>
<p>The INDEX BY construct is nothing that directly translates into SQL
but that affects object and array hydration. After each FROM and
JOIN clause you specify by which field this class should be indexed
in the result. By default a result is incremented by numerical keys
starting with 0. However with INDEX BY you can specify any other
column to be the key of your result, it really only makes sense
with primary or unique fields though:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">status</span><span class="p">,</span> <span class="k">upper</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="n">nameUpper</span> <span class="k">FROM</span> <span class="k">User</span> <span class="n">u</span> <span class="k">INDEX</span> <span class="k">BY</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
<span class="k">JOIN</span> <span class="n">u</span><span class="p">.</span><span class="n">phonenumbers</span> <span class="n">p</span> <span class="k">INDEX</span> <span class="k">BY</span> <span class="n">p</span><span class="p">.</span><span class="n">phonenumber</span>
</pre></div>
</div>
<p>Returns an array of the following kind, indexed by both user-id
then phonenumber-id:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">array</span>
<span class="x">  0 =&gt;</span>
<span class="x">    array</span>
<span class="x">      1 =&gt;</span>
<span class="x">        object(stdClass)[299]</span>
<span class="x">          public &#39;__CLASS__&#39; =&gt; string &#39;Doctrine\Tests\Models\CMS\CmsUser&#39; (length=33)</span>
<span class="x">          public &#39;id&#39; =&gt; int 1</span>
<span class="x">          ..</span>
<span class="x">      &#39;nameUpper&#39; =&gt; string &#39;ROMANB&#39; (length=6)</span>
<span class="x">  1 =&gt;</span>
<span class="x">    array</span>
<span class="x">      2 =&gt;</span>
<span class="x">        object(stdClass)[298]</span>
<span class="x">          public &#39;__CLASS__&#39; =&gt; string &#39;Doctrine\Tests\Models\CMS\CmsUser&#39; (length=33)</span>
<span class="x">          public &#39;id&#39; =&gt; int 2</span>
<span class="x">          ...</span>
<span class="x">      &#39;nameUpper&#39; =&gt; string &#39;JWAGE&#39; (length=5)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-queries">
<h2>15.3. UPDATE queries<a class="headerlink" href="#update-queries" title="Permalink to this headline">¶</a></h2>
<p>DQL not only allows to select your Entities using field names, you
can also execute bulk updates on a set of entities using an
DQL-UPDATE query. The Syntax of an UPDATE query works as expected,
as the following example shows:</p>
<div class="highlight-sql"><pre>UPDATE MyProject\Model\User u SET u.password = 'new' WHERE u.id IN (1, 2, 3)</pre>
</div>
<p>References to related entities are only possible in the WHERE
clause and using sub-selects.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">DQL UPDATE statements are ported directly into a
Database UPDATE statement and therefore bypass any locking scheme, events
and do not increment the version column. Entities that are already
loaded into the persistence context will <em>NOT</em> be synced with the
updated database state. It is recommended to call
<tt class="docutils literal"><span class="pre">EntityManager#clear()</span></tt> and retrieve new instances of any
affected entity.</p>
</div>
</div>
<div class="section" id="delete-queries">
<h2>15.4. DELETE queries<a class="headerlink" href="#delete-queries" title="Permalink to this headline">¶</a></h2>
<p>DELETE queries can also be specified using DQL and their syntax is
as simple as the UPDATE syntax:</p>
<div class="highlight-sql"><pre>DELETE MyProject\Model\User u WHERE u.id = 4</pre>
</div>
<p>The same restrictions apply for the reference of related entities.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">DQL DELETE statements are ported directly into a
Database DELETE statement and therefore bypass any events and checks for the
version column if they are not explicitly added to the WHERE clause
of the query. Additionally Deletes of specifies entities are <em>NOT</em>
cascaded to related entities even if specified in the metadata.</p>
</div>
</div>
<div class="section" id="functions-operators-aggregates">
<h2>15.5. Functions, Operators, Aggregates<a class="headerlink" href="#functions-operators-aggregates" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dql-functions">
<h3>15.5.1. DQL Functions<a class="headerlink" href="#dql-functions" title="Permalink to this headline">¶</a></h3>
<p>The following functions are supported in SELECT, WHERE and HAVING
clauses:</p>
<ul class="simple">
<li>IDENTITY(single_association_path_expression [, fieldMapping]) - Retrieve the foreign key column of association of the owning side</li>
<li>ABS(arithmetic_expression)</li>
<li>CONCAT(str1, str2)</li>
<li>CURRENT_DATE() - Return the current date</li>
<li>CURRENT_TIME() - Returns the current time</li>
<li>CURRENT_TIMESTAMP() - Returns a timestamp of the current date
and time.</li>
<li>LENGTH(str) - Returns the length of the given string</li>
<li>LOCATE(needle, haystack [, offset]) - Locate the first
occurrence of the substring in the string.</li>
<li>LOWER(str) - returns the string lowercased.</li>
<li>MOD(a, b) - Return a MOD b.</li>
<li>SIZE(collection) - Return the number of elements in the
specified collection</li>
<li>SQRT(q) - Return the square-root of q.</li>
<li>SUBSTRING(str, start [, length]) - Return substring of given
string.</li>
<li>TRIM([LEADING | TRAILING | BOTH] [&#8216;trchar&#8217; FROM] str) - Trim
the string by the given trim char, defaults to whitespaces.</li>
<li>UPPER(str) - Return the upper-case of the given string.</li>
<li>DATE_ADD(date, days, unit) - Add the number of days to a given date. (Supported units are DAY, MONTH)</li>
<li>DATE_SUB(date, days, unit) - Substract the number of days from a given date. (Supported units are DAY, MONTH)</li>
<li>DATE_DIFF(date1, date2) - Calculate the difference in days between date1-date2.</li>
</ul>
</div>
<div class="section" id="arithmetic-operators">
<h3>15.5.2. Arithmetic operators<a class="headerlink" href="#arithmetic-operators" title="Permalink to this headline">¶</a></h3>
<p>You can do math in DQL using numeric values, for example:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">person</span><span class="p">.</span><span class="n">salary</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span> <span class="k">FROM</span> <span class="n">CompanyPerson</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">person</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">100000</span>
</pre></div>
</div>
</div>
<div class="section" id="aggregate-functions">
<h3>15.5.3. Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Permalink to this headline">¶</a></h3>
<p>The following aggregate functions are allowed in SELECT and GROUP
BY clauses: AVG, COUNT, MIN, MAX, SUM</p>
</div>
<div class="section" id="other-expressions">
<h3>15.5.4. Other Expressions<a class="headerlink" href="#other-expressions" title="Permalink to this headline">¶</a></h3>
<p>DQL offers a wide-range of additional expressions that are known
from SQL, here is a list of all the supported constructs:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ALL/ANY/SOME</span></tt> - Used in a WHERE clause followed by a
sub-select this works like the equivalent constructs in SQL.</li>
<li><tt class="docutils literal"><span class="pre">BETWEEN</span> <span class="pre">a</span> <span class="pre">AND</span> <span class="pre">b</span></tt> and <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">BETWEEN</span> <span class="pre">a</span> <span class="pre">AND</span> <span class="pre">b</span></tt> can be used to
match ranges of arithmetic values.</li>
<li><tt class="docutils literal"><span class="pre">IN</span> <span class="pre">(x1,</span> <span class="pre">x2,</span> <span class="pre">...)</span></tt> and <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">IN</span> <span class="pre">(x1,</span> <span class="pre">x2,</span> <span class="pre">..)</span></tt> can be used to
match a set of given values.</li>
<li><tt class="docutils literal"><span class="pre">LIKE</span> <span class="pre">..</span></tt> and <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">LIKE</span> <span class="pre">..</span></tt> match parts of a string or text
using % as a wildcard.</li>
<li><tt class="docutils literal"><span class="pre">IS</span> <span class="pre">NULL</span></tt> and <tt class="docutils literal"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></tt> to check for null values</li>
<li><tt class="docutils literal"><span class="pre">EXISTS</span></tt> and <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">EXISTS</span></tt> in combination with a sub-select</li>
</ul>
</div>
<div class="section" id="adding-your-own-functions-to-the-dql-language">
<h3>15.5.5. Adding your own functions to the DQL language<a class="headerlink" href="#adding-your-own-functions-to-the-dql-language" title="Permalink to this headline">¶</a></h3>
<p>By default DQL comes with functions that are part of a large basis
of underlying databases. However you will most likely choose a
database platform at the beginning of your project and most likely
never change it. For this cases you can easily extend the DQL
parser with own specialized platform functions.</p>
<p>You can register custom DQL functions in your ORM Configuration:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Doctrine\ORM\Configuration</span><span class="p">();</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">addCustomStringFunction</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$class</span><span class="p">);</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">addCustomNumericFunction</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$class</span><span class="p">);</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">addCustomDatetimeFunction</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$class</span><span class="p">);</span>

<span class="nv">$em</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$dbParams</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>
</pre></div>
</div>
<p>The functions have to return either a string, numeric or datetime
value depending on the registered function type. As an example we
will add a MySQL specific FLOOR() functionality. All the given
classes have to implement the base class :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">MyProject\Query\AST</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">\Doctrine\ORM\Query\AST\Functions\FunctionNode</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Doctrine\ORM\Query\Lexer</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MysqlFloor</span> <span class="k">extends</span> <span class="nx">FunctionNode</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$simpleArithmeticExpression</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSql</span><span class="p">(</span><span class="nx">\Doctrine\ORM\Query\SqlWalker</span> <span class="nv">$sqlWalker</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;FLOOR(&#39;</span> <span class="o">.</span> <span class="nv">$sqlWalker</span><span class="o">-&gt;</span><span class="na">walkSimpleArithmeticExpression</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">simpleArithmeticExpression</span>
        <span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">parse</span><span class="p">(</span><span class="nx">\Doctrine\ORM\Query\Parser</span> <span class="nv">$parser</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$lexer</span> <span class="o">=</span> <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">getLexer</span><span class="p">();</span>

        <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="nx">Lexer</span><span class="o">::</span><span class="na">T_IDENTIFIER</span><span class="p">);</span>
        <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="nx">Lexer</span><span class="o">::</span><span class="na">T_OPEN_PARENTHESIS</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">simpleArithmeticExpression</span> <span class="o">=</span> <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">SimpleArithmeticExpression</span><span class="p">();</span>

        <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="nx">Lexer</span><span class="o">::</span><span class="na">T_CLOSE_PARENTHESIS</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We will register the function by calling and can then use it:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getConfiguration</span><span class="p">();</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">registerNumericFunction</span><span class="p">(</span><span class="s1">&#39;FLOOR&#39;</span><span class="p">,</span> <span class="s1">&#39;MyProject\Query\MysqlFloor&#39;</span><span class="p">);</span>

<span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT FLOOR(person.salary * 1.75) FROM CompanyPerson person&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="querying-inherited-classes">
<h2>15.6. Querying Inherited Classes<a class="headerlink" href="#querying-inherited-classes" title="Permalink to this headline">¶</a></h2>
<p>This section demonstrates how you can query inherited classes and
what type of results to expect.</p>
<div class="section" id="single-table">
<h3>15.6.1. Single Table<a class="headerlink" href="#single-table" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://martinfowler.com/eaaCatalog/singleTableInheritance.html">Single Table Inheritance</a>
is an inheritance mapping strategy where all classes of a hierarchy
are mapped to a single database table. In order to distinguish
which row represents which type in the hierarchy a so-called
discriminator column is used.</p>
<p>First we need to setup an example set of entities to use. In this
scenario it is a generic Person and Employee example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Entities</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Entity</span>
<span class="sd"> * @InheritanceType(&quot;SINGLE_TABLE&quot;)</span>
<span class="sd"> * @DiscriminatorColumn(name=&quot;discr&quot;, type=&quot;string&quot;)</span>
<span class="sd"> * @DiscriminatorMap({&quot;person&quot; = &quot;Person&quot;, &quot;employee&quot; = &quot;Employee&quot;})</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id @Column(type=&quot;integer&quot;)</span>
<span class="sd">     * @GeneratedValue</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=50)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * @Entity</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Employee</span> <span class="k">extends</span> <span class="nx">Person</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;, length=50)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$department</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>First notice that the generated SQL to create the tables for these
entities looks like the following:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTOINCREMENT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">discr</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">department</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now when persist a new <tt class="docutils literal"><span class="pre">Employee</span></tt> instance it will set the
discriminator value for us automatically:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$employee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Entities\Employee</span><span class="p">();</span>
<span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">setDepartment</span><span class="p">(</span><span class="s1">&#39;testing&#39;</span><span class="p">);</span>
<span class="nv">$em</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$employee</span><span class="p">);</span>
<span class="nv">$em</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
<p>Now lets run a simple query to retrieve the <tt class="docutils literal"><span class="pre">Employee</span></tt> we just
created:</p>
<div class="highlight-sql"><pre>SELECT e FROM Entities\Employee e WHERE e.name = 'test'</pre>
</div>
<p>If we check the generated SQL you will notice it has some special
conditions added to ensure that we will only get back <tt class="docutils literal"><span class="pre">Employee</span></tt>
entities:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">p0_</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">id0</span><span class="p">,</span> <span class="n">p0_</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">name1</span><span class="p">,</span> <span class="n">p0_</span><span class="p">.</span><span class="n">department</span> <span class="k">AS</span> <span class="n">department2</span><span class="p">,</span>
       <span class="n">p0_</span><span class="p">.</span><span class="n">discr</span> <span class="k">AS</span> <span class="n">discr3</span> <span class="k">FROM</span> <span class="n">Person</span> <span class="n">p0_</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="n">p0_</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="o">?</span><span class="p">)</span> <span class="k">AND</span> <span class="n">p0_</span><span class="p">.</span><span class="n">discr</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;employee&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="class-table-inheritance">
<h3>15.6.2. Class Table Inheritance<a class="headerlink" href="#class-table-inheritance" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://martinfowler.com/eaaCatalog/classTableInheritance.html">Class Table Inheritance</a>
is an inheritance mapping strategy where each class in a hierarchy
is mapped to several tables: its own table and the tables of all
parent classes. The table of a child class is linked to the table
of a parent class through a foreign key constraint. Doctrine 2
implements this strategy through the use of a discriminator column
in the topmost table of the hierarchy because this is the easiest
way to achieve polymorphic queries with Class Table Inheritance.</p>
<p>The example for class table inheritance is the same as single
table, you just need to change the inheritance type from
<tt class="docutils literal"><span class="pre">SINGLE_TABLE</span></tt> to <tt class="docutils literal"><span class="pre">JOINED</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity</span>
<span class="sd"> * @InheritanceType(&quot;JOINED&quot;)</span>
<span class="sd"> * @DiscriminatorColumn(name=&quot;discr&quot;, type=&quot;string&quot;)</span>
<span class="sd"> * @DiscriminatorMap({&quot;person&quot; = &quot;Person&quot;, &quot;employee&quot; = &quot;Employee&quot;})</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now take a look at the SQL which is generated to create the table,
you&#8217;ll notice some differences:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">discr</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Employee</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">department</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Employee</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
</pre></div>
</div>
<ul class="simple">
<li>The data is split between two tables</li>
<li>A foreign key exists between the two tables</li>
</ul>
<p>Now if were to insert the same <tt class="docutils literal"><span class="pre">Employee</span></tt> as we did in the
<tt class="docutils literal"><span class="pre">SINGLE_TABLE</span></tt> example and run the same example query it will
generate different SQL joining the <tt class="docutils literal"><span class="pre">Person</span></tt> information
automatically for you:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">p0_</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">id0</span><span class="p">,</span> <span class="n">p0_</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">name1</span><span class="p">,</span> <span class="n">e1_</span><span class="p">.</span><span class="n">department</span> <span class="k">AS</span> <span class="n">department2</span><span class="p">,</span>
       <span class="n">p0_</span><span class="p">.</span><span class="n">discr</span> <span class="k">AS</span> <span class="n">discr3</span>
<span class="k">FROM</span> <span class="n">Employee</span> <span class="n">e1_</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Person</span> <span class="n">p0_</span> <span class="k">ON</span> <span class="n">e1_</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p0_</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span> <span class="n">p0_</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-query-class">
<h2>15.7. The Query class<a class="headerlink" href="#the-query-class" title="Permalink to this headline">¶</a></h2>
<p>An instance of the <tt class="docutils literal"><span class="pre">Doctrine\ORM\Query</span></tt> class represents a DQL
query. You create a Query instance be calling
<tt class="docutils literal"><span class="pre">EntityManager#createQuery($dql)</span></tt>, passing the DQL query string.
Alternatively you can create an empty <tt class="docutils literal"><span class="pre">Query</span></tt> instance and invoke
<tt class="docutils literal"><span class="pre">Query#setDql($dql)</span></tt> afterwards. Here are some examples:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// $em instanceof EntityManager</span>

<span class="c1">// example1: passing a DQL string</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;select u from MyProject\Model\User u&#39;</span><span class="p">);</span>

<span class="c1">// example2: using setDql</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">();</span>
<span class="nv">$q</span><span class="o">-&gt;</span><span class="na">setDql</span><span class="p">(</span><span class="s1">&#39;select u from MyProject\Model\User u&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="query-result-formats">
<h3>15.7.1. Query Result Formats<a class="headerlink" href="#query-result-formats" title="Permalink to this headline">¶</a></h3>
<p>The format in which the result of a DQL SELECT query is returned
can be influenced by a so-called <tt class="docutils literal"><span class="pre">hydration</span> <span class="pre">mode</span></tt>. A hydration
mode specifies a particular way in which a SQL result set is
transformed. Each hydration mode has its own dedicated method on
the Query class. Here they are:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">Query#getResult()</span></tt>: Retrieves a collection of objects. The
result is either a plain collection of objects (pure) or an array
where the objects are nested in the result rows (mixed).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Query#getSingleResult()</span></tt>: Retrieves a single object. If the
result contains more than one or no object, an exception is thrown. The
pure/mixed distinction does not apply.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Query#getOneOrNullResult()</span></tt>: Retrieve a single object. If no
object is found null will be returned.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Query#getArrayResult()</span></tt>: Retrieves an array graph (a nested
array) that is largely interchangeable with the object graph
generated by <tt class="docutils literal"><span class="pre">Query#getResult()</span></tt> for read-only purposes.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An array graph can differ from the corresponding object
graph in certain scenarios due to the difference of the identity
semantics between arrays and objects.</p>
</div>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Query#getScalarResult()</span></tt>: Retrieves a flat/rectangular result
set of scalar values that can contain duplicate data. The
pure/mixed distinction does not apply.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Query#getSingleScalarResult()</span></tt>: Retrieves a single scalar
value from the result returned by the dbms. If the result contains
more than a single scalar value, an exception is thrown. The
pure/mixed distinction does not apply.</p>
</li>
</ul>
<p>Instead of using these methods, you can alternatively use the
general-purpose method
<tt class="docutils literal"><span class="pre">Query#execute(array</span> <span class="pre">$params</span> <span class="pre">=</span> <span class="pre">array(),</span> <span class="pre">$hydrationMode</span> <span class="pre">=</span> <span class="pre">Query::HYDRATE_OBJECT)</span></tt>.
Using this method you can directly supply the hydration mode as the
second parameter via one of the Query constants. In fact, the
methods mentioned earlier are just convenient shortcuts for the
execute method. For example, the method <tt class="docutils literal"><span class="pre">Query#getResult()</span></tt>
internally invokes execute, passing in <tt class="docutils literal"><span class="pre">Query::HYDRATE_OBJECT</span></tt> as
the hydration mode.</p>
<p>The use of the methods mentioned earlier is generally preferred as
it leads to more concise code.</p>
</div>
<div class="section" id="pure-and-mixed-results">
<h3>15.7.2. Pure and Mixed Results<a class="headerlink" href="#pure-and-mixed-results" title="Permalink to this headline">¶</a></h3>
<p>The nature of a result returned by a DQL SELECT query retrieved
through <tt class="docutils literal"><span class="pre">Query#getResult()</span></tt> or <tt class="docutils literal"><span class="pre">Query#getArrayResult()</span></tt> can be
of 2 forms: <strong>pure</strong> and <strong>mixed</strong>. In the previous simple
examples, you already saw a &#8220;pure&#8221; query result, with only objects.
By default, the result type is <strong>pure</strong> but
<strong>as soon as scalar values, such as aggregate values or other scalar values that do not belong to an entity, appear in the SELECT part of the DQL query, the result becomes mixed</strong>.
A mixed result has a different structure than a pure result in
order to accommodate for the scalar values.</p>
<p>A pure result usually looks like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$dql = &quot;SELECT u FROM User u&quot;;</span>

<span class="x">array</span>
<span class="x">    [0] =&gt; Object</span>
<span class="x">    [1] =&gt; Object</span>
<span class="x">    [2] =&gt; Object</span>
<span class="x">    ...</span>
</pre></div>
</div>
<p>A mixed result on the other hand has the following general
structure:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$dql = &quot;SELECT u, &#39;some scalar string&#39;, count(u.groups) AS num FROM User u JOIN u.groups g GROUP BY u.id&quot;;</span>

<span class="x">array</span>
<span class="x">    [0]</span>
<span class="x">        [0] =&gt; Object</span>
<span class="x">        [1] =&gt; &quot;some scalar string&quot;</span>
<span class="x">        [&#39;num&#39;] =&gt; 42</span>
<span class="x">        // ... more scalar values, either indexed numerically or with a name</span>
<span class="x">    [1]</span>
<span class="x">        [0] =&gt; Object</span>
<span class="x">        [1] =&gt; &quot;some scalar string&quot;</span>
<span class="x">        [&#39;num&#39;] =&gt; 42</span>
<span class="x">        // ... more scalar values, either indexed numerically or with a name</span>
</pre></div>
</div>
<p>To better understand mixed results, consider the following DQL
query:</p>
<div class="highlight-sql"><pre>SELECT u, UPPER(u.name) nameUpper FROM MyProject\Model\User u</pre>
</div>
<p>This query makes use of the <tt class="docutils literal"><span class="pre">UPPER</span></tt> DQL function that returns a
scalar value and because there is now a scalar value in the SELECT
clause, we get a mixed result.</p>
<p>Conventions for mixed results are as follows:</p>
<ul class="simple">
<li>The object fetched in the FROM clause is always positioned with the key &#8216;0&#8217;.</li>
<li>Every scalar without a name is numbered in the order given in the query, starting with 1.</li>
<li>Every aliased scalar is given with its alias-name as the key. The case of the name is kept.</li>
<li>If several objects are fetched from the FROM clause they alternate every row.</li>
</ul>
<p>Here is how the result could look like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">array</span>
<span class="x">    array</span>
<span class="x">        [0] =&gt; User (Object)</span>
<span class="x">        [&#39;nameUpper&#39;] =&gt; &quot;ROMAN&quot;</span>
<span class="x">    array</span>
<span class="x">        [0] =&gt; User (Object)</span>
<span class="x">        [&#39;nameUpper&#39;] =&gt; &quot;JONATHAN&quot;</span>
<span class="x">    ...</span>
</pre></div>
</div>
<p>And here is how you would access it in PHP code:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$results</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Name: &quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>
    <span class="k">echo</span> <span class="s2">&quot;Name UPPER: &quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;nameUpper&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="fetching-multiple-from-entities">
<h3>15.7.3. Fetching Multiple FROM Entities<a class="headerlink" href="#fetching-multiple-from-entities" title="Permalink to this headline">¶</a></h3>
<p>If you fetch multiple entities that are listed in the FROM clause then the hydration
will return the rows iterating the different top-level entities.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$dql = &quot;SELECT u, g FROM User u, Group g&quot;;</span>

<span class="x">array</span>
<span class="x">    [0] =&gt; Object (User)</span>
<span class="x">    [1] =&gt; Object (Group)</span>
<span class="x">    [2] =&gt; Object (User)</span>
<span class="x">    [3] =&gt; Object (Group)</span>
</pre></div>
</div>
</div>
<div class="section" id="hydration-modes">
<h3>15.7.4. Hydration Modes<a class="headerlink" href="#hydration-modes" title="Permalink to this headline">¶</a></h3>
<p>Each of the Hydration Modes makes assumptions about how the result
is returned to user land. You should know about all the details to
make best use of the different result formats:</p>
<p>The constants for the different hydration modes are:</p>
<ul class="simple">
<li>Query::HYDRATE_OBJECT</li>
<li>Query::HYDRATE_ARRAY</li>
<li>Query::HYDRATE_SCALAR</li>
<li>Query::HYDRATE_SINGLE_SCALAR</li>
</ul>
<div class="section" id="object-hydration">
<h4>15.7.4.1. Object Hydration<a class="headerlink" href="#object-hydration" title="Permalink to this headline">¶</a></h4>
<p>Object hydration hydrates the result set into the object graph:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">(</span><span class="nx">Query</span><span class="o">::</span><span class="na">HYDRATE_OBJECT</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="array-hydration">
<h4>15.7.4.2. Array Hydration<a class="headerlink" href="#array-hydration" title="Permalink to this headline">¶</a></h4>
<p>You can run the same query with array hydration and the result set
is hydrated into an array that represents the object graph:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">(</span><span class="nx">Query</span><span class="o">::</span><span class="na">HYDRATE_ARRAY</span><span class="p">);</span>
</pre></div>
</div>
<p>You can use the <tt class="docutils literal"><span class="pre">getArrayResult()</span></tt> shortcut as well:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getArrayResult</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="scalar-hydration">
<h4>15.7.4.3. Scalar Hydration<a class="headerlink" href="#scalar-hydration" title="Permalink to this headline">¶</a></h4>
<p>If you want to return a flat rectangular result set instead of an
object graph you can use scalar hydration:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">(</span><span class="nx">Query</span><span class="o">::</span><span class="na">HYDRATE_SCALAR</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$users</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;u_id&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>The following assumptions are made about selected fields using
Scalar Hydration:</p>
<ol class="arabic simple">
<li>Fields from classes are prefixed by the DQL alias in the result.
A query of the kind &#8216;SELECT u.name ..&#8217; returns a key &#8216;u_name&#8217; in
the result rows.</li>
</ol>
</div>
<div class="section" id="single-scalar-hydration">
<h4>15.7.4.4. Single Scalar Hydration<a class="headerlink" href="#single-scalar-hydration" title="Permalink to this headline">¶</a></h4>
<p>If you a query which returns just a single scalar value you can use
single scalar hydration:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(a.id) FROM CmsUser u LEFT JOIN u.articles a WHERE u.username = ?1 GROUP BY u.id&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;jwage&#39;</span><span class="p">);</span>
<span class="nv">$numArticles</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">(</span><span class="nx">Query</span><span class="o">::</span><span class="na">HYDRATE_SINGLE_SCALAR</span><span class="p">);</span>
</pre></div>
</div>
<p>You can use the <tt class="docutils literal"><span class="pre">getSingleScalarResult()</span></tt> shortcut as well:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$numArticles</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getSingleScalarResult</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-hydration-modes">
<h4>15.7.4.5. Custom Hydration Modes<a class="headerlink" href="#custom-hydration-modes" title="Permalink to this headline">¶</a></h4>
<p>You can easily add your own custom hydration modes by first
creating a class which extends <tt class="docutils literal"><span class="pre">AbstractHydrator</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">MyProject\Hydrators</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Internal\Hydration\AbstractHydrator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CustomHydrator</span> <span class="k">extends</span> <span class="nx">AbstractHydrator</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_hydrateAll</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next you just need to add the class to the ORM configuration:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$em</span><span class="o">-&gt;</span><span class="na">getConfiguration</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addCustomHydrationMode</span><span class="p">(</span><span class="s1">&#39;CustomHydrator&#39;</span><span class="p">,</span> <span class="s1">&#39;MyProject\Hydrators\CustomHydrator&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now the hydrator is ready to be used in your queries:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM CmsUser u&#39;</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">(</span><span class="s1">&#39;CustomHydrator&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="iterating-large-result-sets">
<h3>15.7.5. Iterating Large Result Sets<a class="headerlink" href="#iterating-large-result-sets" title="Permalink to this headline">¶</a></h3>
<p>There are situations when a query you want to execute returns a
very large result-set that needs to be processed. All the
previously described hydration modes completely load a result-set
into memory which might not be feasible with large result sets. See
the <a class="reference external" href="batch-processing.html">Batch Processing</a> section on details how
to iterate large result sets.</p>
</div>
<div class="section" id="functions">
<h3>15.7.6. Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>The following methods exist on the <tt class="docutils literal"><span class="pre">AbstractQuery</span></tt> which both
<tt class="docutils literal"><span class="pre">Query</span></tt> and <tt class="docutils literal"><span class="pre">NativeQuery</span></tt> extend from.</p>
<div class="section" id="parameters">
<h4>15.7.6.1. Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h4>
<p>Prepared Statements that use numerical or named wildcards require
additional parameters to be executable against the database. To
pass parameters to the query the following methods can be used:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">AbstractQuery::setParameter($param,</span> <span class="pre">$value)</span></tt> - Set the
numerical or named wildcard to the given value.</li>
<li><tt class="docutils literal"><span class="pre">AbstractQuery::setParameters(array</span> <span class="pre">$params)</span></tt> - Set an array
of parameter key-value pairs.</li>
<li><tt class="docutils literal"><span class="pre">AbstractQuery::getParameter($param)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">AbstractQuery::getParameters()</span></tt></li>
</ul>
<p>Both named and positional parameters are passed to these methods without their ? or : prefix.</p>
</div>
<div class="section" id="cache-related-api">
<h4>15.7.6.2. Cache related API<a class="headerlink" href="#cache-related-api" title="Permalink to this headline">¶</a></h4>
<p>You can cache query results based either on all variables that
define the result (SQL, Hydration Mode, Parameters and Hints) or on
user-defined cache keys. However by default query results are not
cached at all. You have to enable the result cache on a per query
basis. The following example shows a complete workflow using the
Result Cache API:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT u FROM MyProject\Model\User u WHERE u.id = ?1&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setResultCacheDriver</span><span class="p">(</span><span class="k">new</span> <span class="nx">ApcCache</span><span class="p">());</span>

<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">useResultCache</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="na">setResultCacheLifeTime</span><span class="p">(</span><span class="nv">$seconds</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// cache miss</span>

<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">expireResultCache</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// forced expire, cache miss</span>

<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setResultCacheId</span><span class="p">(</span><span class="s1">&#39;my_query_result&#39;</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// saved in given result cache id.</span>

<span class="c1">// or call useResultCache() with all parameters:</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">useResultCache</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="nv">$seconds</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;my_query_result&#39;</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span> <span class="c1">// cache hit!</span>

<span class="c1">// Introspection</span>
<span class="nv">$queryCacheProfile</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getQueryCacheProfile</span><span class="p">();</span>
<span class="nv">$cacheDriver</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResultCacheDriver</span><span class="p">();</span>
<span class="nv">$lifetime</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getLifetime</span><span class="p">();</span>
<span class="nv">$key</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getCacheKey</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can set the Result Cache Driver globally on the
<tt class="docutils literal"><span class="pre">Doctrine\ORM\Configuration</span></tt> instance so that it is passed to
every <tt class="docutils literal"><span class="pre">Query</span></tt> and <tt class="docutils literal"><span class="pre">NativeQuery</span></tt> instance.</p>
</div>
</div>
<div class="section" id="query-hints">
<h4>15.7.6.3. Query Hints<a class="headerlink" href="#query-hints" title="Permalink to this headline">¶</a></h4>
<p>You can pass hints to the query parser and hydrators by using the
<tt class="docutils literal"><span class="pre">AbstractQuery::setHint($name,</span> <span class="pre">$value)</span></tt> method. Currently there
exist mostly internal query hints that are not be consumed in
userland. However the following few hints are to be used in
userland:</p>
<ul class="simple">
<li>Query::HINT_FORCE_PARTIAL_LOAD - Allows to hydrate objects
although not all their columns are fetched. This query hint can be
used to handle memory consumption problems with large result-sets
that contain char or binary data. Doctrine has no way of implicitly
reloading this data. Partially loaded objects have to be passed to
<tt class="docutils literal"><span class="pre">EntityManager::refresh()</span></tt> if they are to be reloaded fully from
the database.</li>
<li>Query::HINT_REFRESH - This query is used internally by
<tt class="docutils literal"><span class="pre">EntityManager::refresh()</span></tt> and can be used in userland as well.
If you specify this hint and a query returns the data for an entity
that is already managed by the UnitOfWork, the fields of the
existing entity will be refreshed. In normal operation a result-set
that loads data of an already existing entity is discarded in favor
of the already existing entity.</li>
<li>Query::HINT_CUSTOM_TREE_WALKERS - An array of additional
<tt class="docutils literal"><span class="pre">Doctrine\ORM\Query\TreeWalker</span></tt> instances that are attached to
the DQL query parsing process.</li>
</ul>
</div>
<div class="section" id="query-cache-dql-query-only">
<h4>15.7.6.4. Query Cache (DQL Query Only)<a class="headerlink" href="#query-cache-dql-query-only" title="Permalink to this headline">¶</a></h4>
<p>Parsing a DQL query and converting it into a SQL query against the
underlying database platform obviously has some overhead in
contrast to directly executing Native SQL queries. That is why
there is a dedicated Query Cache for caching the DQL parser
results. In combination with the use of wildcards you can reduce
the number of parsed queries in production to zero.</p>
<p>The Query Cache Driver is passed from the
<tt class="docutils literal"><span class="pre">Doctrine\ORM\Configuration</span></tt> instance to each
<tt class="docutils literal"><span class="pre">Doctrine\ORM\Query</span></tt> instance by default and is also enabled by
default. This also means you don&#8217;t regularly need to fiddle with
the parameters of the Query Cache, however if you do there are
several methods to interact with it:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Query::setQueryCacheDriver($driver)</span></tt> - Allows to set a Cache
instance</li>
<li><tt class="docutils literal"><span class="pre">Query::setQueryCacheLifeTime($seconds</span> <span class="pre">=</span> <span class="pre">3600)</span></tt> - Set lifetime
of the query caching.</li>
<li><tt class="docutils literal"><span class="pre">Query::expireQueryCache($bool)</span></tt> - Enforce the expiring of the
query cache if set to true.</li>
<li><tt class="docutils literal"><span class="pre">Query::getExpireQueryCache()</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Query::getQueryCacheDriver()</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Query::getQueryCacheLifeTime()</span></tt></li>
</ul>
</div>
<div class="section" id="first-and-max-result-items-dql-query-only">
<h4>15.7.6.5. First and Max Result Items (DQL Query Only)<a class="headerlink" href="#first-and-max-result-items-dql-query-only" title="Permalink to this headline">¶</a></h4>
<p>You can limit the number of results returned from a DQL query as
well as specify the starting offset, Doctrine then uses a strategy
of manipulating the select query to return only the requested
number of results:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Query::setMaxResults($maxResults)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Query::setFirstResult($offset)</span></tt></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your query contains a fetch-joined collection
specifying the result limit methods are not working as you would
expect. Set Max Results restricts the number of database result
rows, however in the case of fetch-joined collections one root
entity might appear in many rows, effectively hydrating less than
the specified number of results.</p>
</div>
</div>
<div class="section" id="temporarily-change-fetch-mode-in-dql">
<span id="dql-temporarily-change-fetch-mode"></span><h4>15.7.6.6. Temporarily change fetch mode in DQL<a class="headerlink" href="#temporarily-change-fetch-mode-in-dql" title="Permalink to this headline">¶</a></h4>
<p>While normally all your associations are marked as lazy or extra lazy you will have cases where you are using DQL and don&#8217;t want to
fetch join a second, third or fourth level of entities into your result, because of the increased cost of the SQL JOIN. You
can mark a many-to-one or one-to-one association as fetched temporarily to batch fetch these entities using a WHERE .. IN query.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$em</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s2">&quot;SELECT u FROM MyProject\User u&quot;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setFetchMode</span><span class="p">(</span><span class="s2">&quot;MyProject\User&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;EAGER&quot;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Given that there are 10 users and corresponding addresses in the database the executed queries will look something like:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">address</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ebnf">
<h2>15.8. EBNF<a class="headerlink" href="#ebnf" title="Permalink to this headline">¶</a></h2>
<p>The following context-free grammar, written in an EBNF variant,
describes the Doctrine Query Language. You can consult this grammar
whenever you are unsure about what is possible with DQL or what the
correct syntax for a particular query should be.</p>
<div class="section" id="document-syntax">
<h3>15.8.1. Document syntax:<a class="headerlink" href="#document-syntax" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>non-terminals begin with an upper case character</li>
<li>terminals begin with a lower case character</li>
<li>parentheses (...) are used for grouping</li>
<li>square brackets [...] are used for defining an optional part,
e.g. zero or one time</li>
<li>curly brackets {...} are used for repetition, e.g. zero or more
times</li>
<li>double quotation marks &#8221;...&#8221; define a terminal string a vertical
bar | represents an alternative</li>
</ul>
</div>
<div class="section" id="terminals">
<h3>15.8.2. Terminals<a class="headerlink" href="#terminals" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>identifier (name, email, ...)</li>
<li>string (&#8216;foo&#8217;, &#8216;bar&#8217;&#8217;s house&#8217;, &#8216;%ninja%&#8217;, ...)</li>
<li>char (&#8216;/&#8217;, &#8216;\&#8217;, &#8216; &#8216;, ...)</li>
<li>integer (-1, 0, 1, 34, ...)</li>
<li>float (-0.23, 0.007, 1.245342E+8, ...)</li>
<li>boolean (false, true)</li>
</ul>
</div>
<div class="section" id="query-language">
<h3>15.8.3. Query Language<a class="headerlink" href="#query-language" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">QueryLanguage ::= SelectStatement | UpdateStatement | DeleteStatement</span>
</pre></div>
</div>
</div>
<div class="section" id="statements">
<h3>15.8.4. Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">SelectStatement ::= SelectClause FromClause [WhereClause] [GroupByClause] [HavingClause] [OrderByClause]</span>
<span class="x">UpdateStatement ::= UpdateClause [WhereClause]</span>
<span class="x">DeleteStatement ::= DeleteClause [WhereClause]</span>
</pre></div>
</div>
</div>
<div class="section" id="identifiers">
<h3>15.8.5. Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">/* Alias Identification usage (the &quot;u&quot; of &quot;u.name&quot;) */</span>
<span class="x">IdentificationVariable ::= identifier</span>

<span class="x">/* Alias Identification declaration (the &quot;u&quot; of &quot;FROM User u&quot;) */</span>
<span class="x">AliasIdentificationVariable :: = identifier</span>

<span class="x">/* identifier that must be a class name (the &quot;User&quot; of &quot;FROM User u&quot;) */</span>
<span class="x">AbstractSchemaName ::= identifier</span>

<span class="x">/* identifier that must be a field (the &quot;name&quot; of &quot;u.name&quot;) */</span>
<span class="x">/* This is responsible to know if the field exists in Object, no matter if it&#39;s a relation or a simple field */</span>
<span class="x">FieldIdentificationVariable ::= identifier</span>

<span class="x">/* identifier that must be a collection-valued association field (to-many) (the &quot;Phonenumbers&quot; of &quot;u.Phonenumbers&quot;) */</span>
<span class="x">CollectionValuedAssociationField ::= FieldIdentificationVariable</span>

<span class="x">/* identifier that must be a single-valued association field (to-one) (the &quot;Group&quot; of &quot;u.Group&quot;) */</span>
<span class="x">SingleValuedAssociationField ::= FieldIdentificationVariable</span>

<span class="x">/* identifier that must be an embedded class state field (for the future) */</span>
<span class="x">EmbeddedClassStateField ::= FieldIdentificationVariable</span>

<span class="x">/* identifier that must be a simple state field (name, email, ...) (the &quot;name&quot; of &quot;u.name&quot;) */</span>
<span class="x">/* The difference between this and FieldIdentificationVariable is only semantical, because it points to a single field (not mapping to a relation) */</span>
<span class="x">SimpleStateField ::= FieldIdentificationVariable</span>

<span class="x">/* Alias ResultVariable declaration (the &quot;total&quot; of &quot;COUNT(*) AS total&quot;) */</span>
<span class="x">AliasResultVariable = identifier</span>

<span class="x">/* ResultVariable identifier usage of mapped field aliases (the &quot;total&quot; of &quot;COUNT(*) AS total&quot;) */</span>
<span class="x">ResultVariable = identifier</span>
</pre></div>
</div>
</div>
<div class="section" id="path-expressions">
<h3>15.8.6. Path Expressions<a class="headerlink" href="#path-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">/* &quot;u.Group&quot; or &quot;u.Phonenumbers&quot; declarations */</span>
<span class="x">JoinAssociationPathExpression             ::= IdentificationVariable &quot;.&quot; (CollectionValuedAssociationField | SingleValuedAssociationField)</span>

<span class="x">/* &quot;u.Group&quot; or &quot;u.Phonenumbers&quot; usages */</span>
<span class="x">AssociationPathExpression                 ::= CollectionValuedPathExpression | SingleValuedAssociationPathExpression</span>

<span class="x">/* &quot;u.name&quot; or &quot;u.Group&quot; */</span>
<span class="x">SingleValuedPathExpression                ::= StateFieldPathExpression | SingleValuedAssociationPathExpression</span>

<span class="x">/* &quot;u.name&quot; or &quot;u.Group.name&quot; */</span>
<span class="x">StateFieldPathExpression                  ::= IdentificationVariable &quot;.&quot; StateField</span>

<span class="x">/* &quot;u.Group&quot; */</span>
<span class="x">SingleValuedAssociationPathExpression     ::= IdentificationVariable &quot;.&quot; SingleValuedAssociationField</span>

<span class="x">/* &quot;u.Group.Permissions&quot; */</span>
<span class="x">CollectionValuedPathExpression            ::= IdentificationVariable &quot;.&quot; CollectionValuedAssociationField</span>

<span class="x">/* &quot;name&quot; */</span>
<span class="x">StateField                                ::= {EmbeddedClassStateField &quot;.&quot;}* SimpleStateField</span>
</pre></div>
</div>
</div>
<div class="section" id="clauses">
<h3>15.8.7. Clauses<a class="headerlink" href="#clauses" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">SelectClause        ::= &quot;SELECT&quot; [&quot;DISTINCT&quot;] SelectExpression {&quot;,&quot; SelectExpression}*</span>
<span class="x">SimpleSelectClause  ::= &quot;SELECT&quot; [&quot;DISTINCT&quot;] SimpleSelectExpression</span>
<span class="x">UpdateClause        ::= &quot;UPDATE&quot; AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable &quot;SET&quot; UpdateItem {&quot;,&quot; UpdateItem}*</span>
<span class="x">DeleteClause        ::= &quot;DELETE&quot; [&quot;FROM&quot;] AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable</span>
<span class="x">FromClause          ::= &quot;FROM&quot; IdentificationVariableDeclaration {&quot;,&quot; IdentificationVariableDeclaration}*</span>
<span class="x">SubselectFromClause ::= &quot;FROM&quot; SubselectIdentificationVariableDeclaration {&quot;,&quot; SubselectIdentificationVariableDeclaration}*</span>
<span class="x">WhereClause         ::= &quot;WHERE&quot; ConditionalExpression</span>
<span class="x">HavingClause        ::= &quot;HAVING&quot; ConditionalExpression</span>
<span class="x">GroupByClause       ::= &quot;GROUP&quot; &quot;BY&quot; GroupByItem {&quot;,&quot; GroupByItem}*</span>
<span class="x">OrderByClause       ::= &quot;ORDER&quot; &quot;BY&quot; OrderByItem {&quot;,&quot; OrderByItem}*</span>
<span class="x">Subselect           ::= SimpleSelectClause SubselectFromClause [WhereClause] [GroupByClause] [HavingClause] [OrderByClause]</span>
</pre></div>
</div>
</div>
<div class="section" id="items">
<h3>15.8.8. Items<a class="headerlink" href="#items" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">UpdateItem  ::= SingleValuedPathExpression &quot;=&quot; NewValue</span>
<span class="x">OrderByItem ::= (SimpleArithmeticExpression | SingleValuedPathExpression | ScalarExpression | ResultVariable) [&quot;ASC&quot; | &quot;DESC&quot;]</span>
<span class="x">GroupByItem ::= IdentificationVariable | ResultVariable | SingleValuedPathExpression</span>
<span class="x">NewValue    ::= SimpleArithmeticExpression | &quot;NULL&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="from-join-and-index-by">
<h3>15.8.9. From, Join and Index by<a class="headerlink" href="#from-join-and-index-by" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">IdentificationVariableDeclaration          ::= RangeVariableDeclaration [IndexBy] {JoinVariableDeclaration}*</span>
<span class="x">SubselectIdentificationVariableDeclaration ::= IdentificationVariableDeclaration | (AssociationPathExpression [&quot;AS&quot;] AliasIdentificationVariable)</span>
<span class="x">JoinVariableDeclaration                    ::= Join [IndexBy]</span>
<span class="x">RangeVariableDeclaration                   ::= AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable</span>
<span class="x">Join                                       ::= [&quot;LEFT&quot; [&quot;OUTER&quot;] | &quot;INNER&quot;] &quot;JOIN&quot; JoinAssociationPathExpression [&quot;AS&quot;] AliasIdentificationVariable [&quot;WITH&quot; ConditionalExpression]</span>
<span class="x">IndexBy                                    ::= &quot;INDEX&quot; &quot;BY&quot; StateFieldPathExpression</span>
</pre></div>
</div>
</div>
<div class="section" id="select-expressions">
<h3>15.8.10. Select Expressions<a class="headerlink" href="#select-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">SelectExpression        ::= (IdentificationVariable | ScalarExpression | AggregateExpression | FunctionDeclaration | PartialObjectExpression | &quot;(&quot; Subselect &quot;)&quot; | CaseExpression) [[&quot;AS&quot;] [&quot;HIDDEN&quot;] AliasResultVariable]</span>
<span class="x">SimpleSelectExpression  ::= (StateFieldPathExpression | IdentificationVariable | FunctionDeclaration | AggregateExpression | &quot;(&quot; Subselect &quot;)&quot; | ScalarExpression) [[&quot;AS&quot;] AliasResultVariable]</span>
<span class="x">PartialObjectExpression ::= &quot;PARTIAL&quot; IdentificationVariable &quot;.&quot; PartialFieldSet</span>
<span class="x">PartialFieldSet         ::= &quot;{&quot; SimpleStateField {&quot;,&quot; SimpleStateField}* &quot;}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="conditional-expressions">
<h3>15.8.11. Conditional Expressions<a class="headerlink" href="#conditional-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">ConditionalExpression       ::= ConditionalTerm {&quot;OR&quot; ConditionalTerm}*</span>
<span class="x">ConditionalTerm             ::= ConditionalFactor {&quot;AND&quot; ConditionalFactor}*</span>
<span class="x">ConditionalFactor           ::= [&quot;NOT&quot;] ConditionalPrimary</span>
<span class="x">ConditionalPrimary          ::= SimpleConditionalExpression | &quot;(&quot; ConditionalExpression &quot;)&quot;</span>
<span class="x">SimpleConditionalExpression ::= ComparisonExpression | BetweenExpression | LikeExpression |</span>
<span class="x">                                InExpression | NullComparisonExpression | ExistsExpression |</span>
<span class="x">                                EmptyCollectionComparisonExpression | CollectionMemberExpression |</span>
<span class="x">                                InstanceOfExpression</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-expressions">
<h3>15.8.12. Collection Expressions<a class="headerlink" href="#collection-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">EmptyCollectionComparisonExpression ::= CollectionValuedPathExpression &quot;IS&quot; [&quot;NOT&quot;] &quot;EMPTY&quot;</span>
<span class="x">CollectionMemberExpression          ::= EntityExpression [&quot;NOT&quot;] &quot;MEMBER&quot; [&quot;OF&quot;] CollectionValuedPathExpression</span>
</pre></div>
</div>
</div>
<div class="section" id="literal-values">
<h3>15.8.13. Literal Values<a class="headerlink" href="#literal-values" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">Literal     ::= string | char | integer | float | boolean</span>
<span class="x">InParameter ::= Literal | InputParameter</span>
</pre></div>
</div>
</div>
<div class="section" id="input-parameter">
<h3>15.8.14. Input Parameter<a class="headerlink" href="#input-parameter" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">InputParameter      ::= PositionalParameter | NamedParameter</span>
<span class="x">PositionalParameter ::= &quot;?&quot; integer</span>
<span class="x">NamedParameter      ::= &quot;:&quot; string</span>
</pre></div>
</div>
</div>
<div class="section" id="arithmetic-expressions">
<h3>15.8.15. Arithmetic Expressions<a class="headerlink" href="#arithmetic-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">ArithmeticExpression       ::= SimpleArithmeticExpression | &quot;(&quot; Subselect &quot;)&quot;</span>
<span class="x">SimpleArithmeticExpression ::= ArithmeticTerm {(&quot;+&quot; | &quot;-&quot;) ArithmeticTerm}*</span>
<span class="x">ArithmeticTerm             ::= ArithmeticFactor {(&quot;*&quot; | &quot;/&quot;) ArithmeticFactor}*</span>
<span class="x">ArithmeticFactor           ::= [(&quot;+&quot; | &quot;-&quot;)] ArithmeticPrimary</span>
<span class="x">ArithmeticPrimary          ::= SingleValuedPathExpression | Literal | &quot;(&quot; SimpleArithmeticExpression &quot;)&quot;</span>
<span class="x">                               | FunctionsReturningNumerics | AggregateExpression | FunctionsReturningStrings</span>
<span class="x">                               | FunctionsReturningDatetime | IdentificationVariable | ResultVariable</span>
<span class="x">                               | InputParameter | CaseExpression</span>
</pre></div>
</div>
</div>
<div class="section" id="scalar-and-type-expressions">
<h3>15.8.16. Scalar and Type Expressions<a class="headerlink" href="#scalar-and-type-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">ScalarExpression       ::= SimpleArithmeticExpression | StringPrimary | DateTimePrimary | StateFieldPathExpression | BooleanPrimary | CaseExpression | InstanceOfExpression</span>
<span class="x">StringExpression       ::= StringPrimary | ResultVariable | &quot;(&quot; Subselect &quot;)&quot;</span>
<span class="x">StringPrimary          ::= StateFieldPathExpression | string | InputParameter | FunctionsReturningStrings | AggregateExpression | CaseExpression</span>
<span class="x">BooleanExpression      ::= BooleanPrimary | &quot;(&quot; Subselect &quot;)&quot;</span>
<span class="x">BooleanPrimary         ::= StateFieldPathExpression | boolean | InputParameter</span>
<span class="x">EntityExpression       ::= SingleValuedAssociationPathExpression | SimpleEntityExpression</span>
<span class="x">SimpleEntityExpression ::= IdentificationVariable | InputParameter</span>
<span class="x">DatetimeExpression     ::= DatetimePrimary | &quot;(&quot; Subselect &quot;)&quot;</span>
<span class="x">DatetimePrimary        ::= StateFieldPathExpression | InputParameter | FunctionsReturningDatetime | AggregateExpression</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Parts of CASE expressions are not yet implemented.</p>
</div>
</div>
<div class="section" id="aggregate-expressions">
<h3>15.8.17. Aggregate Expressions<a class="headerlink" href="#aggregate-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">AggregateExpression ::= (&quot;AVG&quot; | &quot;MAX&quot; | &quot;MIN&quot; | &quot;SUM&quot;) &quot;(&quot; [&quot;DISTINCT&quot;] StateFieldPathExpression &quot;)&quot; |</span>
<span class="x">                        &quot;COUNT&quot; &quot;(&quot; [&quot;DISTINCT&quot;] (IdentificationVariable | SingleValuedPathExpression) &quot;)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="case-expressions">
<h3>15.8.18. Case Expressions<a class="headerlink" href="#case-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">CaseExpression        ::= GeneralCaseExpression | SimpleCaseExpression | CoalesceExpression | NullifExpression</span>
<span class="x">GeneralCaseExpression ::= &quot;CASE&quot; WhenClause {WhenClause}* &quot;ELSE&quot; ScalarExpression &quot;END&quot;</span>
<span class="x">WhenClause            ::= &quot;WHEN&quot; ConditionalExpression &quot;THEN&quot; ScalarExpression</span>
<span class="x">SimpleCaseExpression  ::= &quot;CASE&quot; CaseOperand SimpleWhenClause {SimpleWhenClause}* &quot;ELSE&quot; ScalarExpression &quot;END&quot;</span>
<span class="x">CaseOperand           ::= StateFieldPathExpression | TypeDiscriminator</span>
<span class="x">SimpleWhenClause      ::= &quot;WHEN&quot; ScalarExpression &quot;THEN&quot; ScalarExpression</span>
<span class="x">CoalesceExpression    ::= &quot;COALESCE&quot; &quot;(&quot; ScalarExpression {&quot;,&quot; ScalarExpression}* &quot;)&quot;</span>
<span class="x">NullifExpression      ::= &quot;NULLIF&quot; &quot;(&quot; ScalarExpression &quot;,&quot; ScalarExpression &quot;)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>15.8.19. Other Expressions<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>QUANTIFIED/BETWEEN/COMPARISON/LIKE/NULL/EXISTS</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">QuantifiedExpression     ::= (&quot;ALL&quot; | &quot;ANY&quot; | &quot;SOME&quot;) &quot;(&quot; Subselect &quot;)&quot;</span>
<span class="x">BetweenExpression        ::= ArithmeticExpression [&quot;NOT&quot;] &quot;BETWEEN&quot; ArithmeticExpression &quot;AND&quot; ArithmeticExpression</span>
<span class="x">ComparisonExpression     ::= ArithmeticExpression ComparisonOperator ( QuantifiedExpression | ArithmeticExpression )</span>
<span class="x">InExpression             ::= SingleValuedPathExpression [&quot;NOT&quot;] &quot;IN&quot; &quot;(&quot; (InParameter {&quot;,&quot; InParameter}* | Subselect) &quot;)&quot;</span>
<span class="x">InstanceOfExpression     ::= IdentificationVariable [&quot;NOT&quot;] &quot;INSTANCE&quot; [&quot;OF&quot;] (InstanceOfParameter | &quot;(&quot; InstanceOfParameter {&quot;,&quot; InstanceOfParameter}* &quot;)&quot;)</span>
<span class="x">InstanceOfParameter      ::= AbstractSchemaName | InputParameter</span>
<span class="x">LikeExpression           ::= StringExpression [&quot;NOT&quot;] &quot;LIKE&quot; StringPrimary [&quot;ESCAPE&quot; char]</span>
<span class="x">NullComparisonExpression ::= (InputParameter | NullIfExpression | CoalesceExpression | SingleValuedPathExpression | ResultVariable) &quot;IS&quot; [&quot;NOT&quot;] &quot;NULL&quot;</span>
<span class="x">ExistsExpression         ::= [&quot;NOT&quot;] &quot;EXISTS&quot; &quot;(&quot; Subselect &quot;)&quot;</span>
<span class="x">ComparisonOperator       ::= &quot;=&quot; | &quot;&lt;&quot; | &quot;&lt;=&quot; | &quot;&lt;&gt;&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot; | &quot;!=&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>15.8.20. Functions<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">FunctionDeclaration ::= FunctionsReturningStrings | FunctionsReturningNumerics | FunctionsReturningDateTime</span>

<span class="x">FunctionsReturningNumerics ::=</span>
<span class="x">        &quot;LENGTH&quot; &quot;(&quot; StringPrimary &quot;)&quot; |</span>
<span class="x">        &quot;LOCATE&quot; &quot;(&quot; StringPrimary &quot;,&quot; StringPrimary [&quot;,&quot; SimpleArithmeticExpression]&quot;)&quot; |</span>
<span class="x">        &quot;ABS&quot; &quot;(&quot; SimpleArithmeticExpression &quot;)&quot; |</span>
<span class="x">        &quot;SQRT&quot; &quot;(&quot; SimpleArithmeticExpression &quot;)&quot; |</span>
<span class="x">        &quot;MOD&quot; &quot;(&quot; SimpleArithmeticExpression &quot;,&quot; SimpleArithmeticExpression &quot;)&quot; |</span>
<span class="x">        &quot;SIZE&quot; &quot;(&quot; CollectionValuedPathExpression &quot;)&quot; |</span>
<span class="x">        &quot;DATE_DIFF&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;)&quot; |</span>
<span class="x">        &quot;BIT_AND&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;)&quot; |</span>
<span class="x">        &quot;BIT_OR&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;)&quot;</span>

<span class="x">FunctionsReturningDateTime ::=</span>
<span class="x">        &quot;CURRENT_DATE&quot; |</span>
<span class="x">        &quot;CURRENT_TIME&quot; |</span>
<span class="x">        &quot;CURRENT_TIMESTAMP&quot; |</span>
<span class="x">        &quot;DATE_ADD&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;,&quot; StringPrimary &quot;)&quot; |</span>
<span class="x">        &quot;DATE_SUB&quot; &quot;(&quot; ArithmeticPrimary &quot;,&quot; ArithmeticPrimary &quot;,&quot; StringPrimary &quot;)&quot;</span>

<span class="x">FunctionsReturningStrings ::=</span>
<span class="x">        &quot;CONCAT&quot; &quot;(&quot; StringPrimary &quot;,&quot; StringPrimary &quot;)&quot; |</span>
<span class="x">        &quot;SUBSTRING&quot; &quot;(&quot; StringPrimary &quot;,&quot; SimpleArithmeticExpression &quot;,&quot; SimpleArithmeticExpression &quot;)&quot; |</span>
<span class="x">        &quot;TRIM&quot; &quot;(&quot; [[&quot;LEADING&quot; | &quot;TRAILING&quot; | &quot;BOTH&quot;] [char] &quot;FROM&quot;] StringPrimary &quot;)&quot; |</span>
<span class="x">        &quot;LOWER&quot; &quot;(&quot; StringPrimary &quot;)&quot; |</span>
<span class="x">        &quot;UPPER&quot; &quot;(&quot; StringPrimary &quot;)&quot; |</span>
<span class="x">        &quot;IDENTITY&quot; &quot;(&quot; SingleValuedAssociationPathExpression &quot;)&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
                </div>

            </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">



             
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:Doctrine ORM">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">15. Doctrine Query Language</a><ul>
<li><a class="reference internal" href="#types-of-dql-queries">15.1. Types of DQL queries</a></li>
<li><a class="reference internal" href="#select-queries">15.2. SELECT queries</a><ul>
<li><a class="reference internal" href="#dql-select-clause">15.2.1. DQL SELECT clause</a></li>
<li><a class="reference internal" href="#joins">15.2.2. Joins</a></li>
<li><a class="reference internal" href="#named-and-positional-parameters">15.2.3. Named and Positional Parameters</a></li>
<li><a class="reference internal" href="#dql-select-examples">15.2.4. DQL SELECT Examples</a><ul>
<li><a class="reference internal" href="#partial-object-syntax">15.2.4.1. Partial Object Syntax</a></li>
<li><a class="reference internal" href="#new-operator-syntax">15.2.4.2. &#8220;NEW&#8221; Operator Syntax</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-index-by">15.2.5. Using INDEX BY</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-queries">15.3. UPDATE queries</a></li>
<li><a class="reference internal" href="#delete-queries">15.4. DELETE queries</a></li>
<li><a class="reference internal" href="#functions-operators-aggregates">15.5. Functions, Operators, Aggregates</a><ul>
<li><a class="reference internal" href="#dql-functions">15.5.1. DQL Functions</a></li>
<li><a class="reference internal" href="#arithmetic-operators">15.5.2. Arithmetic operators</a></li>
<li><a class="reference internal" href="#aggregate-functions">15.5.3. Aggregate Functions</a></li>
<li><a class="reference internal" href="#other-expressions">15.5.4. Other Expressions</a></li>
<li><a class="reference internal" href="#adding-your-own-functions-to-the-dql-language">15.5.5. Adding your own functions to the DQL language</a></li>
</ul>
</li>
<li><a class="reference internal" href="#querying-inherited-classes">15.6. Querying Inherited Classes</a><ul>
<li><a class="reference internal" href="#single-table">15.6.1. Single Table</a></li>
<li><a class="reference internal" href="#class-table-inheritance">15.6.2. Class Table Inheritance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-query-class">15.7. The Query class</a><ul>
<li><a class="reference internal" href="#query-result-formats">15.7.1. Query Result Formats</a></li>
<li><a class="reference internal" href="#pure-and-mixed-results">15.7.2. Pure and Mixed Results</a></li>
<li><a class="reference internal" href="#fetching-multiple-from-entities">15.7.3. Fetching Multiple FROM Entities</a></li>
<li><a class="reference internal" href="#hydration-modes">15.7.4. Hydration Modes</a><ul>
<li><a class="reference internal" href="#object-hydration">15.7.4.1. Object Hydration</a></li>
<li><a class="reference internal" href="#array-hydration">15.7.4.2. Array Hydration</a></li>
<li><a class="reference internal" href="#scalar-hydration">15.7.4.3. Scalar Hydration</a></li>
<li><a class="reference internal" href="#single-scalar-hydration">15.7.4.4. Single Scalar Hydration</a></li>
<li><a class="reference internal" href="#custom-hydration-modes">15.7.4.5. Custom Hydration Modes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iterating-large-result-sets">15.7.5. Iterating Large Result Sets</a></li>
<li><a class="reference internal" href="#functions">15.7.6. Functions</a><ul>
<li><a class="reference internal" href="#parameters">15.7.6.1. Parameters</a></li>
<li><a class="reference internal" href="#cache-related-api">15.7.6.2. Cache related API</a></li>
<li><a class="reference internal" href="#query-hints">15.7.6.3. Query Hints</a></li>
<li><a class="reference internal" href="#query-cache-dql-query-only">15.7.6.4. Query Cache (DQL Query Only)</a></li>
<li><a class="reference internal" href="#first-and-max-result-items-dql-query-only">15.7.6.5. First and Max Result Items (DQL Query Only)</a></li>
<li><a class="reference internal" href="#temporarily-change-fetch-mode-in-dql">15.7.6.6. Temporarily change fetch mode in DQL</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ebnf">15.8. EBNF</a><ul>
<li><a class="reference internal" href="#document-syntax">15.8.1. Document syntax:</a></li>
<li><a class="reference internal" href="#terminals">15.8.2. Terminals</a></li>
<li><a class="reference internal" href="#query-language">15.8.3. Query Language</a></li>
<li><a class="reference internal" href="#statements">15.8.4. Statements</a></li>
<li><a class="reference internal" href="#identifiers">15.8.5. Identifiers</a></li>
<li><a class="reference internal" href="#path-expressions">15.8.6. Path Expressions</a></li>
<li><a class="reference internal" href="#clauses">15.8.7. Clauses</a></li>
<li><a class="reference internal" href="#items">15.8.8. Items</a></li>
<li><a class="reference internal" href="#from-join-and-index-by">15.8.9. From, Join and Index by</a></li>
<li><a class="reference internal" href="#select-expressions">15.8.10. Select Expressions</a></li>
<li><a class="reference internal" href="#conditional-expressions">15.8.11. Conditional Expressions</a></li>
<li><a class="reference internal" href="#collection-expressions">15.8.12. Collection Expressions</a></li>
<li><a class="reference internal" href="#literal-values">15.8.13. Literal Values</a></li>
<li><a class="reference internal" href="#input-parameter">15.8.14. Input Parameter</a></li>
<li><a class="reference internal" href="#arithmetic-expressions">15.8.15. Arithmetic Expressions</a></li>
<li><a class="reference internal" href="#scalar-and-type-expressions">15.8.16. Scalar and Type Expressions</a></li>
<li><a class="reference internal" href="#aggregate-expressions">15.8.17. Aggregate Expressions</a></li>
<li><a class="reference internal" href="#case-expressions">15.8.18. Case Expressions</a></li>
<li><a class="reference internal" href="#id2">15.8.19. Other Expressions</a></li>
<li><a class="reference internal" href="#id3">15.8.20. Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="batch-processing.html"
                                  title="previous chapter">14. Batch Processing</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="query-builder.html"
                                  title="next chapter">16. The QueryBuilder</a></p>
  
    <h3>This Page</h3>
    <ul class="this-page-menu">
      
        <li><a href="../_sources/reference/dql-doctrine-query-language.txt"
               rel="nofollow">Show Source</a></li>
      
      
        <li><a href="https://github.com/doctrine/doctrine2/blob/master/docs/en/reference/dql-doctrine-query-language.rst">
          Show on GitHub</a></li>
        <li><a href="https://github.com/doctrine/doctrine2/edit/master/docs/en/reference/dql-doctrine-query-language.rst">
          Edit on GitHub</a></li>
      
    </ul>
  

        </div>
      </div>
          <div class="clearer"></div>
        </div>

          <div class="footer">
              &copy; Copyright 2010-12, Doctrine Project Team.
              Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
            <br/>
            <a target="_BLANK" href="http://www.servergrove.com"><img src="http://www.doctrine-project.org/images/servergrove.jpg" /></a>      <br/><br/>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick" />
              <input type="hidden" name="hosted_button_id" value="BAE2E3XANQ77Y" />
              <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" />
              <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
            </form>
          </div>
 <!-- End original user content -->


<br/>
<br/>
<br/>


<style type="text/css">
  #version_menu, .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0.75s;
    transition: all 0.25s 0.75s;
  }
  .footer_popout:hover #version_menu, .footer_popout:hover .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0s;
    transition: all 0.25s 0s;
  }
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    visibility: hidden;
    opacity: 0;
    bottom: 11px;
    right: 47px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    visibility: visible;
    opacity: 1;
    right: 166px;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(//media.readthedocs.org//images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll top left no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/doctrine-orm/?fromdocs=doctrine-orm" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




      </div>

      <div id="bot-rcnr">
        <div class="tl"><!-- corner --></div>
      </div>
    </div>

  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
  </script>
  <script type="text/javascript">
  _uacct = "UA-288343-7";
  urchinTracker();
  </script>
  <a class="githublink" href="http://github.com/doctrine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>