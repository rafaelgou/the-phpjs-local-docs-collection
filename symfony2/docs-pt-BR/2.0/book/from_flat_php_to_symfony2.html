

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Symfony2 versus o PHP puro &mdash; Symfony2Docs 2.0.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Symfony2Docs 2.0.x documentation" href="../index.html" />
    <link rel="up" title="Livro" href="index.html" />
    <link rel="next" title="Instalando e Configurando o Symfony" href="installation.html" />
    <link rel="prev" title="Fundamentos de Symfony e HTTP" href="http_fundamentals.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="installation.html" title="Instalando e Configurando o Symfony"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="http_fundamentals.html" title="Fundamentos de Symfony e HTTP"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs 2.0.x documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Livro</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="symfony2-versus-o-php-puro">
<h1>Symfony2 versus o PHP puro<a class="headerlink" href="#symfony2-versus-o-php-puro" title="Permalink to this headline">¶</a></h1>
<p><strong>Por que usar o Symfony2 é melhor do que abrir um arquivo e sair escrevendo PHP puro?</strong></p>
<p>Se você nunca utilizou um framework PHP, não está familiarizado com a filosofia
MVC ou está apenas interessado em entender todo esse <em>hype</em> sobre o Symfony2, este
capítulo é para você. Em vez de <em>dizer</em> que o Symfony2 permite que você
desenvolva mais rápido e melhor do que com PHP puro, você vai ver por si mesmo.</p>
<p>Nesse capítulo, você irá escrever uma simples aplicação em PHP puro, e, então,
refatora-la para deixa-la mais organizada. Você vai viajar no tempo, vendo as
decisões sobre o porquê o desenvolvimento web evoluiu com o passar dos tempos
para onde ele está agora.</p>
<p>Ao final, você verá como o Symfony2 pode resgata-lo das tarefas simples e coloca-lo
de volta no controle do seu código.</p>
<div class="section" id="um-simples-blog-em-php-puro">
<h2>Um simples Blog em PHP puro<a class="headerlink" href="#um-simples-blog-em-php-puro" title="Permalink to this headline">¶</a></h2>
<p>Nesse capítulo, você vai construir uma aplicação para um blog utilizando apenas o
PHP puro. Para começar, crie uma única página que exibe as postagens armazenadas
no banco de dados. Escrever isso em PHP puro é rápido e simples:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;blog_db&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, title FROM post&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>List of Posts<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/show.php?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">endwhile</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">&lt;?php</span>
<span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</div>
<p>Simples de escrever, rápido de executar e, conforme sua aplicação crescer, impossível
de manter. Existem diversos problemas que precisam ser tratados:</p>
<ul class="simple">
<li><strong>Sem verificações de erros</strong>: E se a conexão com o banco de dados falhar?</li>
<li><strong>Organização pobre</strong>: Se a aplicação crescer, esse arquivo também irá crescer
e ficará impossível de dar manutenção. Onde você deve colocar o código que cuida
de tratar os envios de formulários? Como você valida os dados? Onde você deve
colocar o código que envia emails?</li>
<li><strong>Dificuldade para reutilizar código</strong>: Uma vez que tudo está em um único arquivo,
não há como reutilizar qualquer parte dele em outras &#8220;páginas&#8221; do blog.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Um outro problema não mencionado aqui é o fato do banco de dados estar amarrado
ao MySQL. Apesar de não ser tratado aqui, o Symfony2 integra-se totalmente com
o <a class="reference external" href="http://www.doctrine-project.org">Doctrine</a>, uma biblioteca dedicada a abstração de banco de dados e mapeamento.</p>
</div>
<p>Vamos ao trabalho de resolver esses problemas e mais ainda.</p>
<div class="section" id="isolando-a-apresentacao">
<h3>Isolando a Apresentação<a class="headerlink" href="#isolando-a-apresentacao" title="Permalink to this headline">¶</a></h3>
<p>O código pode ter ganhos imediatos ao separar a &#8220;lógica&#8221; da aplicação do código
que prepara o HTML para &#8220;apresentação&#8221;:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;blog_db&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, title FROM post&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

<span class="nv">$posts</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$posts</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

<span class="c1">// include the HTML presentation code</span>
<span class="k">require</span> <span class="s1">&#39;templates/list.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Agora o código HTML está armazenado em um arquivo separado (<tt class="docutils literal"><span class="pre">templates/list.php</span></tt>),
que é um arquivo HTML que utiliza um sintaxe PHP parecida com a de templates:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>List of Posts<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/read?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Por convenção, o arquivo que contém toda a lógica da aplicação - <tt class="docutils literal"><span class="pre">index.php</span></tt> -
é conhecido como &#8220;controller&#8221;. O termo <em class="xref std std-term">controller</em> é uma palavra que você
vai escutar bastante, independente da linguagem ou framework você utilize. Ela
refere-se a área do <em>seu</em> código que processa as entradas do usuário e prepara uma
resposta.</p>
<p>Nesse caso, nosso controller prepara os dados do banco de dados e então inclui um
template para apresenta-los. Com o controller isolado, você pode facilmente mudar
<em>apenas</em> o arquivo de template caso precise renderizar os posts de blog em algum
outro formato (por exemplo, <tt class="docutils literal"><span class="pre">list.json.php</span></tt> para o formato JSON).</p>
</div>
<div class="section" id="isolando-a-logica-dominio-da-aplicacao">
<h3>Isolando a Lógica (Domínio) da Aplicacão<a class="headerlink" href="#isolando-a-logica-dominio-da-aplicacao" title="Permalink to this headline">¶</a></h3>
<p>Por enquanto a aplicação tem apenas uma página. Mas e se uma segunda página
precisar utilizar a mesma conexão com o banco de dados, ou até o mesmo array de
posts do blog? Refatore o código de forma que o comportamento principal e as
funções de acesso aos dados da aplicação fiquem isolados em um novo arquivo chamado
<tt class="docutils literal"><span class="pre">model.php</span></tt>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// model.php</span>

<span class="k">function</span> <span class="nf">open_database_connection</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
    <span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;blog_db&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$link</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">close_database_connection</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_all_posts</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$link</span> <span class="o">=</span> <span class="nx">open_database_connection</span><span class="p">();</span>

    <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, title FROM post&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
    <span class="nv">$posts</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$posts</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">close_database_connection</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$posts</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">O nome <tt class="docutils literal"><span class="pre">model.php</span></tt> foi utilizado porque a lógica e o acesso aos dados de
uma aplicação são tradicionalmente conhecidos como a camada de &#8220;modelo&#8221;. Em
uma aplicação bem organizada, a maioria do código representando as suas
&#8220;regras de negócio&#8221; devem estar apenas no model (em vez de estar em um controller).
Ao contrário desse exemplo, somente uma parte do model (ou nenhuma) está realmente
relacionada ao banco de dados.</p>
</div>
<p>Agora o controller (<tt class="docutils literal"><span class="pre">index.php</span></tt>) ficou bem simples:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>

<span class="nv">$posts</span> <span class="o">=</span> <span class="nx">get_all_posts</span><span class="p">();</span>

<span class="k">require</span> <span class="s1">&#39;templates/list.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Agora, a única tarefa do controller é recuperar os dados da camada de modelo da
sua aplicação (o model) e chamar o template para renderiza-los. Esse é um exemplo
bem simples do padrão model-view-controller.</p>
</div>
<div class="section" id="isolando-o-layout">
<h3>Isolando o Layout<a class="headerlink" href="#isolando-o-layout" title="Permalink to this headline">¶</a></h3>
<p>Até esse ponto a aplicação foi refatorada em três partes distintas, oferecendo
várias vantagens e a oportunidade de reutilizar quase qualquer coisa em outras
páginas.</p>
<p>A única parte do código que <em>não pode</em> ser reutilizada é o layout da página.
Conserte isso criando um novo arquivo chamado <tt class="docutils literal"><span class="pre">layout.php</span></tt>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- templates/layout.php --&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$title</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$content</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Assim o template (<tt class="docutils literal"><span class="pre">templates/list.php</span></tt>) pode ficar mais simples &#8220;extendendo&#8221; o
layout:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$title</span> <span class="o">=</span> <span class="s1">&#39;List of Posts&#39;</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nb">ob_start</span><span class="p">()</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/read?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$content</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;layout.php&#39;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Agora você foi apresentado a uma metodologia que permite a reutilização do layout.
Infelizmente, para fazer isso, você é forçado a utilizar no template algumas funções
feias do PHP (<tt class="docutils literal"><span class="pre">ob_start()</span></tt>, <tt class="docutils literal"><span class="pre">ob_get_clean()</span></tt>). O Symfony2 utiliza o componente
<tt class="docutils literal"><span class="pre">Templating</span></tt> que permite realizar isso de uma maneira limpa e fácil. Logo você
verá esse componente em ação.</p>
</div>
</div>
<div class="section" id="adicionando-a-pagina-show-ao-blog">
<h2>Adicionando a página &#8220;show&#8221; ao Blog<a class="headerlink" href="#adicionando-a-pagina-show-ao-blog" title="Permalink to this headline">¶</a></h2>
<p>A página &#8220;list&#8221; foi refatorada para que o código fique mais organizado e reutilizável.
Para provar isso, adicione ao blog uma página chamada &#8220;show&#8221;, que exibe um único post
identificado pelo parâmetro <tt class="docutils literal"><span class="pre">id</span></tt>.</p>
<p>Para começar, crie uma nova função no arquivo <tt class="docutils literal"><span class="pre">model.php</span></tt> que recupera o post
com base no id informado:</p>
<div class="highlight-python"><pre>// model.php
function get_post_by_id($id)
{
    $link = open_database_connection();

    $id = mysql_real_escape_string($id);
    $query = 'SELECT date, title, body FROM post WHERE id = '.$id;
    $result = mysql_query($query);
    $row = mysql_fetch_assoc($result);

    close_database_connection($link);

    return $row;
}</pre>
</div>
<p>Em seguida, crie um novo arquivo chamado <tt class="docutils literal"><span class="pre">show.php</span></tt> - o controller para essa nova
página:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>

<span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post_by_id</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>

<span class="k">require</span> <span class="s1">&#39;templates/show.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Por fim, crie um novo arquivo de template - <tt class="docutils literal"><span class="pre">templates/show.php</span></tt> - para renderizar
individualmente o post do blog:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nb">ob_start</span><span class="p">()</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;date&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;body&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$content</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;layout.php&#39;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Criar a segunda página foi bastante fácil e nenhum código foi duplicado. Ainda
assim, essa página criou mais alguns problemas persistentes que um framework pode
resolver para você. Por exemplo, se o parâmetro <tt class="docutils literal"><span class="pre">id</span></tt> não for informado, ou for
inválido, a página irá quebrar. Seria mais interessante exibir uma página de erro
404, mas isso ainda não pode ser feito de uma maneira fácil. Pior ainda, caso
você esqueça de tratar o <tt class="docutils literal"><span class="pre">id</span></tt> utilizando a função <tt class="docutils literal"><span class="pre">mysql_real_escape_string()</span></tt>,
todo o seu banco de dados estará correndo o risco de sofrer ataques de SQL injection.</p>
<p>Um problema ainda maior é que cada controller deve incluir o arquivo <tt class="docutils literal"><span class="pre">model.php</span></tt>
individualmente. O que acontece se cada controller, de repente, precisar incluir
um arquivo adicional para executar alguma outra tarefa global (impor segurança,
por exemplo)? Da maneira como está agora, esse código teria que ser adicionado em
cada arquivo controller. Se você esquecer de incluir algo em algum arquivo
espero que não seja algo relacionado a segurança...</p>
</div>
<div class="section" id="um-front-controller-para-a-salvacao">
<h2>Um &#8220;Front Controller&#8221; para a salvação<a class="headerlink" href="#um-front-controller-para-a-salvacao" title="Permalink to this headline">¶</a></h2>
<p>A solução é utilizar um <em class="xref std std-term">front controller</em>: um único arquivo PHP que irá
processar <em>todas</em> as requisições. Com um front controller, as URIs vão mudar um
pouco, mas começam a ficar mais flexíveis:</p>
<div class="highlight-text"><div class="highlight"><pre>Without a front controller
/index.php          =&gt; Blog post list page (index.php executed)
/show.php           =&gt; Blog post show page (show.php executed)

With index.php as the front controller
/index.php          =&gt; Blog post list page (index.php executed)
/index.php/show     =&gt; Blog post show page (index.php executed)
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">O <tt class="docutils literal"><span class="pre">index.php</span></tt> pode ser removido da URI se você estiver utilizando regras
de rewrite no Apache (ou algo equivalente). Nesse caso, a URI resultante para
a página show será simplesmente <tt class="docutils literal"><span class="pre">/show</span></tt>.</p>
</div>
<p>Ao utilizar um front controller, um único arquivo PHP (nesse caso o <tt class="docutils literal"><span class="pre">index.php</span></tt>)
irá renderizar <em>todas</em> as requisições. Para a página show do blog, o endereço <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>
irá, na verdade, executar o arquivo <tt class="docutils literal"><span class="pre">index.php</span></tt>, que agora é responsável por
redirecionar as requisições internamente baseado na URI completa. Como você pode ver,
um front controller é uma ferramente bastante poderosa.</p>
<div class="section" id="criando-o-front-controller">
<h3>Criando o Front Controller<a class="headerlink" href="#criando-o-front-controller" title="Permalink to this headline">¶</a></h3>
<p>Você está prestes a dar um <strong>grande</strong> passo com a sua aplicação. Com um arquivo
para gerenciar todas as suas requisições, você pode centralizar coisas como segurança,
configurações e roteamento. Nessa aplicação, o arquivo <tt class="docutils literal"><span class="pre">index.php</span></tt> deve ser esperto
o suficiente para renderizar a página com a lista de posts <em>ou</em> a página com um único
post baseado na URI da requisição:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="c1">// load and initialize any global libraries</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;controllers.php&#39;</span><span class="p">;</span>

<span class="c1">// route the request internally</span>
<span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/index.php&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">list_action</span><span class="p">();</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/index.php/show&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nx">show_action</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Status: 404 Not Found&#39;</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Page Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Por questão de organização, ambos os controllers (os antigos arquivos <tt class="docutils literal"><span class="pre">index.php</span></tt>
e <tt class="docutils literal"><span class="pre">show.php</span></tt>) agora são funções e cada uma foi movida para um arquivo separado,
chamado <tt class="docutils literal"><span class="pre">controllers.php</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">function</span> <span class="nf">list_action</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">get_all_posts</span><span class="p">();</span>
    <span class="k">require</span> <span class="s1">&#39;templates/list.php&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">show_action</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post_by_id</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="k">require</span> <span class="s1">&#39;templates/show.php&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sendo um front controller, <tt class="docutils literal"><span class="pre">index.php</span></tt> agora tem um papel inteiramente novo, que
inclui carregar as bibliotecas principais e rotear a aplicação de forma que um dos
controllers (as funções <tt class="docutils literal"><span class="pre">list_action()</span></tt> e <tt class="docutils literal"><span class="pre">show_action()</span></tt>) seja chamado. Na
verdade, o front controller está começando a ficar bastante parecido com o mecanismo
do Symfony2 utilizado para tratar e redirecionar as requisições:</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Uma outra vantagem do front controller é ter URLs flexíveis. Note que a URL para
a página que exibe um post no blog pode mudar de <tt class="docutils literal"><span class="pre">/show</span></tt> para <tt class="docutils literal"><span class="pre">/read</span></tt>
alterando o código apenas em um único lugar. Antes, um arquivo teria que ser
renomeado. No Symfony2 as URLs podem ser ainda mais flexíveis.</p>
</div>
<p>Até agora, a aplicação evoluiu de um único arquivo PHP para para uma estrutura
organizada que permite a reutilização de código. Você deve estar mais feliz, mas
longe de estar satisfeito. Por exemplo, o sistema de &#8220;roteamento&#8221; ainda não é
consistente e não reconhece que a página de listagem (<tt class="docutils literal"><span class="pre">index.php</span></tt>) também pode
ser acessada via <tt class="docutils literal"><span class="pre">/</span></tt> (se as regras de rewrite foram adicionadas no Apache). Além
disso, em vez de desenvolver o blog, boa parte do tempo foi gasto trabalhando na
&#8220;arquitetura&#8221; do código (por exemplo, roteamento, execução de controllers, templates
etc). Mais tempo ainda será necessário para tratar o envio de formulários, validação
das entradas, logs e segurança. Por que você tem que reinventar soluções para todos
esses problemas?</p>
</div>
<div class="section" id="adicione-um-toque-de-symfony2">
<h3>Adicione um toque de Symfony2<a class="headerlink" href="#adicione-um-toque-de-symfony2" title="Permalink to this headline">¶</a></h3>
<p>Symfony2 para a salvação. Antes de realmente utilizar o Symfony2, você precisa
ter certeza que o PHP sabe onde encontrar as classes do framework. Isso pode ser
feito com o autoloader fornecido pelo Symfony. Um autoloader é uma ferramenta que
permite a utilização de classes PHP sem a necessidade de incluir os seus arquivos
explicitamente.</p>
<p>Primeiro, <a class="reference external" href="http://symfony.com/download">faça o download do symfony</a> e o coloque no diretório <tt class="docutils literal"><span class="pre">vendor/symfony/</span></tt>.
A seguir, crie um o arquivo <tt class="docutils literal"><span class="pre">app/bootstrap.php</span></tt>. Utilize-o para dar <tt class="docutils literal"><span class="pre">require</span></tt>
dos dois arquivos da aplicação e para configurar o autoloader:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// bootstrap.php</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;controllers.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;vendor/symfony/src/Symfony/Component/ClassLoader/UniversalClassLoader.php&#39;</span><span class="p">;</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Symfony\Component\ClassLoader\UniversalClassLoader</span><span class="p">();</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerNamespaces</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;Symfony&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/vendor/symfony/src&#39;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</pre></div>
</div>
<p>Esse código diz ao autoloader onde estão as classes do <tt class="docutils literal"><span class="pre">Symfony</span></tt>. Com isso, você
pode começar a utilizar as classes sem precisar de um <tt class="docutils literal"><span class="pre">require</span></tt> para os arquivos
que as contém.</p>
<p>Dentro da filosofia do Symfony está a idéia de que a principal tarefa de uma aplicação
é interpretar cada requisição e retornar uma resposta. Para essa finalidade, o
Symfony2 fornece as classes <tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html" title="Symfony\Component\HttpFoundation\Request"><span class="pre">Request</span></a></tt> e
<tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html" title="Symfony\Component\HttpFoundation\Response"><span class="pre">Response</span></a></tt>. Elas são representações
orientadas a objetos da requisição HTTP pura sendo processada e da resposta HTTP
sendo retornada. Utilize-as para melhorar o blog:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>
<span class="k">require_once</span> <span class="s1">&#39;app/bootstrap.php&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>

<span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPathInfo</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">list_action</span><span class="p">();</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/show&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">show_action</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Page Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// echo the headers and send the response</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>Agora os controller são responsáveis por retornar um objeto <tt class="docutils literal"><span class="pre">Response</span></tt>. Para
tornar isso mais fácil, você pode adicionar uma nova função chamada <tt class="docutils literal"><span class="pre">render_template()</span></tt>,
que, a propósito, funciona de forma um pouco parecida com o mecanismo de template
do Symfony2:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// controllers.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">list_action</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">get_all_posts</span><span class="p">();</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nx">render_template</span><span class="p">(</span><span class="s1">&#39;templates/list.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="o">=&gt;</span> <span class="nv">$posts</span><span class="p">));</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">show_action</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post_by_id</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nx">render_template</span><span class="p">(</span><span class="s1">&#39;templates/show.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="p">));</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// helper function to render templates</span>
<span class="k">function</span> <span class="nf">render_template</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">extract</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
    <span class="nb">ob_start</span><span class="p">();</span>
    <span class="k">require</span> <span class="nv">$path</span><span class="p">;</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$html</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ao adicionar uma pequena parte do Symfony2, a aplicação ficou mais flexível e
confiável. A classe <tt class="docutils literal"><span class="pre">Request</span></tt> fornece uma maneira segura para acessar informações
sobre a requisição HTTP. Especificamente, o método <tt class="docutils literal"><span class="pre">getPathInfo()</span></tt> retorna a URI
limpa (sempre retornando <tt class="docutils literal"><span class="pre">/show</span></tt> e nunca <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>). Assim, mesmo que
o usuário utilize <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>, a aplicação é inteligente o suficiente para
direcionar a requisição para <tt class="docutils literal"><span class="pre">show_action()</span></tt>.</p>
<p>O objeto <tt class="docutils literal"><span class="pre">Response</span></tt> dá flexibilidade ao construir a resposta HTTP, permitindo a
adição de cabeçalhos HTTP e conteúdo através de um interface orientada a objetos.
Apesar das respostas nessa aplicação ainda serem simples, essa flexibilidade será
útil conforme a aplicação crescer.</p>
</div>
<div class="section" id="a-aplicacao-de-exemplo-no-symfony2">
<h3>A aplicação de exemplo no Symfony2<a class="headerlink" href="#a-aplicacao-de-exemplo-no-symfony2" title="Permalink to this headline">¶</a></h3>
<p>O blog já passou por um <em>longo</em> caminho, mas ele ainda tem muito código para uma aplicação
tão simples. Por esse caminho, nós também inventamos um simples sistema de roteamento
e um método utilizando <tt class="docutils literal"><span class="pre">ob_start()</span></tt> e <tt class="docutils literal"><span class="pre">ob_get_clean()</span></tt> para renderiar templates.
Se, por alguma razão, você precisasse continuar a construir esse &#8220;framework&#8221; do zero,
você poderia pelo menos utilizar isoladamente os components <a class="reference external" href="https://github.com/symfony/Routing">Routing</a> e <a class="reference external" href="https://github.com/symfony/Templating">Templating</a>
do Symfony, que já resolveriam esses problemas.</p>
<p>Em vez de re-resolver problemas comuns, você pode deixar que o Symfony2 cuide deles
pra você. Aqui está um exemplo da mesma aplicação, agora feito com o Symfony2:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/Acme/BlogBundle/Controller/BlogController.php</span>

<span class="k">namespace</span> <span class="nx">Acme\BlogBundle\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$posts</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT p FROM AcmeBlogBundle:Post p&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post:list.html.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="o">=&gt;</span> <span class="nv">$posts</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// cause the 404 page not found to be displayed</span>
            <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createNotFoundException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post:show.html.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Os dois controller ainda estão bastante leves. Cada um utiliza a biblioteca de ORM
Doctrine para recuperar objetos do banco de dados e o componente <tt class="docutils literal"><span class="pre">Templating</span></tt>
para renderizar e retornar um objeto <cite>Response</cite>. O template list ficou um pouco
mais simples:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/views/Blog/list.html.php --&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;::layout.html.php&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;List of Posts&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;blog_show&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()))</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">()</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<p>O layout está praticamente idêntico:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- app/Resources/views/layout.html.php --&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Default title&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">&#39;_content&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Vamos deixar o template da página show como um exercício para você, uma vez
que é trivial cria-lo com base no template da página list</p>
</div>
<p>Quando o mecanismo do Symfony2 (chamado de <tt class="docutils literal"><span class="pre">Kernel</span></tt>) é iniciado, ele precisa de
um mapa que indique quais controllers devem ser executados de acordo com a requisição.
A configuração de roteamento contém essa informação em um formato legível:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/routing.yml</span>
<span class="l-Scalar-Plain">blog_list</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">/blog</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">AcmeBlogBundle</span><span class="p-Indicator">:</span><span class="nv">Blog</span><span class="p-Indicator">:</span><span class="nv">list</span> <span class="p-Indicator">}</span>

<span class="l-Scalar-Plain">blog_show</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">/blog/show/{id}</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">AcmeBlogBundle</span><span class="p-Indicator">:</span><span class="nv">Blog</span><span class="p-Indicator">:</span><span class="nv">show</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
<p>Agora que o Symfony2 está cuidando dessas tarefas simples, o front controller
ficou extremamente simples. Uma vez que ele faz tão pouco, você nunca mais terá
que mexer nele depois de criado (e se você estiver utilizando uma distribuição do
Symfony2, você nem mesmo precisará cria-lo!):</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// web/app.php</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../app/bootstrap.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../app/AppKernel.php&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$kernel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppKernel</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nv">$kernel</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>A única tarefa do front controller é iniciar o mecanismo (<tt class="docutils literal"><span class="pre">Kernel</span></tt>) do Symfony2
e passar para ele o objeto <tt class="docutils literal"><span class="pre">Request</span></tt> que deve ser manuseado. Então o Symfony
utiliza o mapa de rotas para determinar qual controller chamar. Assim como antes,
o método controller é responsável por retornar o objeto <tt class="docutils literal"><span class="pre">Response</span></tt>. Não há muito
mais que ele precise fazer.</p>
<p>Para uma representação visual de como o Symfony2 trata cada requisição, veja o
<a class="reference internal" href="http_fundamentals.html#request-flow-figure"><em>diagrama de fluxo da requisição</em></a>.</p>
</div>
<div class="section" id="onde-e-vantagem-utilizar-o-symfony2">
<h3>Onde é vantagem utilizar o Symfony2<a class="headerlink" href="#onde-e-vantagem-utilizar-o-symfony2" title="Permalink to this headline">¶</a></h3>
<p>Nos próximos capítulos você irá aprender mais sobre cada parte do Symfony funciona
e a organização recomendada para um projeto. Por enquanto, vamos ver como a
migração do PHP puro para o Symfony2 facilitou a sua vida:</p>
<ul class="simple">
<li>A sua aplicação agora tem um <strong>código limpo e organizado de forma consistente</strong>
apesar do Symfony não te forçar a isso). Isso aumenta a <strong>usabilidade</strong> e permite
que novos desenvolvedores sejam produtivos no seu projeto de uma maneira mais rápida.</li>
<li>100% do código que você escreveu é para a <em>sua</em> aplicação. Você <strong>não precisa
desenvolver ou manter ferramentas de baixo nível</strong> como <em class="xref std std-ref">autoloading</em>,
<a class="reference internal" href="routing.html"><em>roteamento</em></a>, ou renderização nos <a class="reference internal" href="controller.html"><em>controllers</em></a>.</li>
<li>O Symfony2 te dá <strong>acesso a ferramentas open source</strong> como Doctrine e os
componentes Templating, Security, Form, Validation e Translation (só para citar
alguns).</li>
<li>A aplicação agora faz uso de <strong>URLs totalmente flexíveis</strong> graças ao componente
<tt class="docutils literal"><span class="pre">Routing</span></tt>.</li>
<li>A arquitetura do Symfony2 centrada no HTTP te dá acesso a poderosas ferramentas
como <strong>HTTP caching</strong> feito pelo <strong>cache interno de HTTP do Symfony2</strong> ou por
ferramentas ainda mais poderosas como o <a href="#id1"><span class="problematic" id="id2">``</span></a>Varnish`_. Esse assunto será tratado
em um próximo capítulo sobre <a class="reference internal" href="http_cache.html"><em>caching</em></a>.</li>
</ul>
<p>E talvez o melhor de tudo, ao utilizar o Symfony2, você tem acesso a todo um conjunto
de <strong>ferramentas open source de alta qualidade desenvolvidas pela comunidade do
Symfony2</strong>! Para mais informações, visite o site <a class="reference external" href="http://symfony2bundles.org">Symfony2Bundles.org</a></p>
</div>
</div>
<div class="section" id="melhores-templates">
<h2>Melhores templates<a class="headerlink" href="#melhores-templates" title="Permalink to this headline">¶</a></h2>
<p>Se você optar por utiliza-lo, o Symfony2 vem com um sistema de template padrão
chamado <a class="reference external" href="http://twig.sensiolabs.org">Twig</a> que torna mais fácil a tarefa de escrever templates e os deixa
mais fácil de ler. Isso significa que a aplicação de exemplo pode ter ainda menos
código! Pegue como exemplo o template list escrito com o Twig:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# src/Acme/BlogBundle/Resources/views/Blog/list.html.twig #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;::layout.html.twig&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>List of Posts<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
    <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">path</span><span class="o">(</span><span class="s1">&#39;blog_show&#39;</span><span class="o">,</span> <span class="o">{</span> <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nv">post.id</span> <span class="o">})</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span>
            <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>O template <tt class="docutils literal"><span class="pre">layout.html.twig</span></tt> correspondente também fica mais fácil de escrever:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# app/Resources/views/layout.html.twig #}</span>

<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Default title<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>O Twig é bem suportado no Symfony2. E, mesmo que os templates em PHP sempre serão
suportados pelo framework, continuaremos a discutir sobre as muitas vantagens do
Twig. Para mais informações, veja o <a class="reference internal" href="templating.html"><em>capítulo sobre templates</em></a>.</p>
</div>
<div class="section" id="aprenda-mais-no-cookbook">
<h2>Aprenda mais no Cookbook<a class="headerlink" href="#aprenda-mais-no-cookbook" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><tt class="xref doc docutils literal"><span class="pre">/cookbook/templating/PHP</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">/cookbook/controller/service</span></tt></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Symfony2 versus o PHP puro</a><ul>
<li><a class="reference internal" href="#um-simples-blog-em-php-puro">Um simples Blog em PHP puro</a><ul>
<li><a class="reference internal" href="#isolando-a-apresentacao">Isolando a Apresentação</a></li>
<li><a class="reference internal" href="#isolando-a-logica-dominio-da-aplicacao">Isolando a Lógica (Domínio) da Aplicacão</a></li>
<li><a class="reference internal" href="#isolando-o-layout">Isolando o Layout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adicionando-a-pagina-show-ao-blog">Adicionando a página &#8220;show&#8221; ao Blog</a></li>
<li><a class="reference internal" href="#um-front-controller-para-a-salvacao">Um &#8220;Front Controller&#8221; para a salvação</a><ul>
<li><a class="reference internal" href="#criando-o-front-controller">Criando o Front Controller</a></li>
<li><a class="reference internal" href="#adicione-um-toque-de-symfony2">Adicione um toque de Symfony2</a></li>
<li><a class="reference internal" href="#a-aplicacao-de-exemplo-no-symfony2">A aplicação de exemplo no Symfony2</a></li>
<li><a class="reference internal" href="#onde-e-vantagem-utilizar-o-symfony2">Onde é vantagem utilizar o Symfony2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#melhores-templates">Melhores templates</a></li>
<li><a class="reference internal" href="#aprenda-mais-no-cookbook">Aprenda mais no Cookbook</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="http_fundamentals.html"
                        title="previous chapter">Fundamentos de Symfony e HTTP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="installation.html"
                        title="next chapter">Instalando e Configurando o Symfony</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/from_flat_php_to_symfony2.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="installation.html" title="Instalando e Configurando o Symfony"
             >next</a> |</li>
        <li class="right" >
          <a href="http_fundamentals.html" title="Fundamentos de Symfony e HTTP"
             >previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs 2.0.x documentation</a> &raquo;</li>
          <li><a href="index.html" >Livro</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Symfony Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>