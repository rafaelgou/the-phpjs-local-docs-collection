<!DOCTYPE html>
<!-- saved from url=(0034) -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>Symfony2 cheat sheet</title>
<script pagespeed_no_defer="">(function(){var d=window,e=document,f="getItem",j="getData",k="indexOf",l="length",m="prototype",o="localStorage",p="substring",r="",t=" ",u=",",w="; expires=",x="=",y="_GPSLSC=",z="img",A="link",B="load",C="on",D="pagespeed_lsc_expiry",E="pagespeed_lsc_hash",F="pagespeed_lsc_url",G="pagespeed_lsc_url:",H="script",I="style",J="stylesheet",K="text/css";d.pagespeed=d.pagespeed||{};var L=d.pagespeed,M=function(){this.a=!0};M[m].b=function(a){a=a[p](0,a[k](t));return a!=r&&a>=Date.now()};M[m].hasExpired=M[m].b;
M[m].getData=function(a){return a[p](a[k](t,a[k](t)+1)+1)};M[m].getData=M[m][j];M[m].c=function(a){var b=e.getElementsByTagName(H),b=b[b[l]-1];b.parentNode.replaceChild(a,b)};M[m].replaceLastScript=M[m].c;M[m].h=function(a){var b=d[o][f](a),c=e.createElement(b?I:A);b&&!this.b(b)?(c.type=K,c.appendChild(e.createTextNode(this[j](b)))):(c.rel=J,c.href=a,this.a=!0);this.c(c)};M[m].inlineCss=M[m].h;
M[m].i=function(a){var b=d[o][f](a),c=e.createElement(z);b&&!this.b(b)?c.src=this[j](b):(c.src=a,this.a=!0);for(var b=1,g=arguments[l];b<g;++b){var h=arguments[b][k](x);c[arguments[b][p](0,h)]=arguments[b][p](h+1)}this.c(c)};M[m].inlineImg=M[m].i;M[m].e=function(a,b){for(var c=e.getElementsByTagName(a),g=0,h=c[l];g<h;++g){var i=c[g],q=i.getAttribute(E);if(q){var n=i.getAttribute(F),s=i.getAttribute(D);(i=b(i))||(i=this[j](d[o][f](n)));d[o].setItem(G+n,s+t+q+t+i);this.a=!0}}};
M[m].g=function(){this.e(z,function(a){return a.src});this.e(I,function(a){return a.firstChild?a.firstChild.nodeValue:null})};M[m].f=function(){if(this.a){for(var a=[],b=[],c=0,g=(new Date).getTime(),h=0,i=d[o][l];h<i;++h){var q=d[o].key(h);if(!q[k](G)){var n=d[o][f](q),s=n[k](t),v=n[p](0,s);if(v)if(v>=g){a.push(q);continue}else if(v<c||0==c)c=v;b.push(n[p](s+1,n[k](t,s+1)))}}g=r;c&&(g=w+(new Date(c)).toUTCString());e.cookie=y+b.join(u)+g;h=0;for(i=a[l];h<i;++h)d[o].removeItem(a[h]);this.a=!1}};
L.d=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent(C+b,c);else{var g=a[C+b];a[C+b]=function(){c.call(this);g&&g.call(this)}}};L.j=function(){if(d[o]){var a=new M;L.localStorageCache=a;L.d(d,B,function(){a.g()});L.d(d,B,function(){a.f()})}};L.localStorageCacheInit=L.j;})();
pagespeed.localStorageCacheInit();</script><link rel="stylesheet" type="text/css" href="./symfony2-cheatsheet_files/stylesheet.css" media="all">
<link rel="stylesheet" type="text/css" href="./symfony2-cheatsheet_files/W.pygment_trac.css.pagespeed.cf.SBrhoYRjSr.css" media="all">
<link rel="stylesheet" type="text/css" href="./symfony2-cheatsheet_files/bootstrap.min.css" media="all">
<link rel="stylesheet" type="text/css" href="./symfony2-cheatsheet_files/vendor,_contactable,_contactable.css+css,_custom.css+vendor,_uItoTop,_css,_ui.totop.css.pagespeed.cc.REYm68j9ez.css" media="all" pagespeed_lsc_url="vendor/contactable/contactable.css">


<link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body id="top">

<a id="blogLink" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;Blog&#39;]);" href="http://blog.symfony2cheatsheet.com/">Blog</a>
<ul id="social">
<li><a href="https://twitter.com/davidpvicens" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;Twitter&#39;]);" target="_blank"><img src="./symfony2-cheatsheet_files/xTwitter.png.pagespeed.ic.O65GsO-DIG.png" alt="davidpvicens twitter" width="48" height="48"></a></li>
<li><a href="http://www.linkedin.com/in/davidperezvicens" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;Linkedin&#39;]);" target="_blank"><img src="./symfony2-cheatsheet_files/xLinkedin.png.pagespeed.ic.g8MbRrBiqK.png" alt="david perez linkedin" width="48" height="48"></a></li>
</ul>
<div id="contactable"><div id="contactable_inner"></div><form id="contactForm" method="" action=""><div id="loading"></div><div id="callback"></div><div class="holder"><p><label for="name">Name<span class="red"> * </span></label><br><input id="name" class="contact" name="name"></p><p><label for="email">Email <span class="red"> * </span></label><br><input id="email" class="contact" name="email"></p><p><label for="message">Message <span class="red"> * </span></label><br><textarea id="message" name="message" class="message" rows="4" cols="30"></textarea></p><p><input class="submit" type="submit" value="SEND"></p><p class="disclaimer">Please feel free to get in touch, I value your feedback</p></div></form></div>
<div id="ribbon" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;Donate ribbon&#39;]);">
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" id="donate">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHNwYJKoZIhvcNAQcEoIIHKDCCByQCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAKFjJBG5GYwesiLzInqmtLSYGckpTJEreMW24pxnWkPbvFvcFVhuQBfSbeomvRW0DJPa+1LQRN7/eCD6FlDIK0dkl8Q04U/WFtNQC20puvlPNMDKfgMmPibYbpIoNsFb//2dDSuwDm2VBXxNB85b+ixKvDf7cZ5mVN1ErznMprfjELMAkGBSsOAwIaBQAwgbQGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIrRCj0/2aFkmAgZBY6GKGc94cdkEkQsxk4oM7iSSQ0/3VvEr8/wbw3werjK5JbKVJo1zUB3KH4dWV0d0CZwjpaFTYYCcRVnQTOrr7/ZKOzg6zLjeutpD/zLtntJapPa6H8Rk5XD9CmiCprVAjTxuSWR6GMtTOQVZcdCyLnr7Y14VDPqkEOoMNA77vVxHd/+hEGH9d7m5eSvfh/1qgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xMjExMDYxNzMwMjBaMCMGCSqGSIb3DQEJBDEWBBS7O039R8EKtUCxyWcSObuiHdhPHDANBgkqhkiG9w0BAQEFAASBgCiPt1TxkYk61oejmX011OUMR3HFbiM9Z5Ez2jzMVJPOr1ZR06j7FIODmtooRjUfPJ0kPV6s7yb68haXgHXADE/qoQDhVWa5gtgaek1sf1eA9oGm3dbt2bkjz4tkVuPhsaH22gHYK8HAgN8UfzlTv1HxZe4EPDo9hcipO6V7WONM-----END PKCS7-----">
<input type="image" src="./symfony2-cheatsheet_files/xribbon.png.pagespeed.ic.MxR8Dgwlm2.png" border="0" name="submit" alt="PayPal. La forma rápida y segura de pagar en Internet." width="132" height="132">
<img alt="" border="0" src="./symfony2-cheatsheet_files/pixel.gif" width="1" height="1">
</form>
</div>
<div id="container" class="container">
<div class="inner">
<div id="controller">
<header>
<div id="title">Symfony2cheatsheet</div>
<h1>Finally, a Symfony2 guide to make your work easier.</h1>
<span class="version">v 2.1.*</span>
</header>
<div class="nav-container">
<nav>
<ul class="nav nav-pills">
<li>
<a href="#controller" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Controller&#39;]);">Controller</a>
</li>
<li><a href="#routing" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Routing&#39;]);">Routing</a></li>
<li>
<a href="#templating" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Templating&#39;]);">Templating</a>
</li>
<li><a href="#doctrine" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Doctrine&#39;]);">Doctrine</a>
</li>
<li><a href="#testing" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Testing&#39;]);">Testing</a></li>
<li>
<a href="#validation" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Validation&#39;]);">Validation</a>
</li>
<li><a href="#forms" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Forms&#39;]);">Forms</a></li>
<li><a href="#security" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Security&#39;]);">Security</a>
</li>
<li><a href="#cache" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Cache&#39;]);">Cache</a></li>
<li>
<a href="#translations" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Translations&#39;]);">Translations</a>
</li>
<li><a href="#services" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Menu&#39;, &#39;Services&#39;]);">Services</a>
</li>
</ul>
</nav>
</div>
</div>
<div id="scroll">
<section id="main_content">
<hr>
<h2 id="controller">CONTROLLER <a href="#top" class="small">back to top</a></h2>
<p>Here are some useful shortcuts and functions regarding the request object in Symfony 2 controllers.</p>
<h4>REQUEST and RESPONSE objects</h4>
<div class="row">
<div class="span6">
<pre><code>$request-&gt;query-&gt;get('foo'); //gets foo GET var.
$request-&gt;request-&gt;get('bar'); //gets POST var.
$request-&gt;getMethod();

$request-&gt;server-&gt;get('HTTP_HOST'); //server variables.
$request-&gt;getPathInfo(); //gets the URI.
$request-&gt;files-&gt;get('file'); //files posted in a form.

$request-&gt;headers-&gt;get('content-type');
$request-&gt;cookies-&gt;get('PHPSESSID'); //cookies

$request-&gt;getLanguages();
$request-&gt;getPreferedLanguage(array('es','fr'));
$request-&gt;isXmlHttpRequest();
</code></pre>
</div>
<div class="span6">
<p>Redirecting in a controller:</p>
<pre><code>$this-&gt;redirect($this-&gt;generateUrl("homepage"));
</code></pre>
<p>Rendering text from a controller:</p>
<pre><code>return new Response('&lt;html&gt;…&lt;/html&gt;');
</code></pre>
<p>Forwarding:</p>
<pre><code>return $this-&gt;forward('Bundle:Controller:Action');
</code></pre>
<p>Redirect to 404 not found:</p>
<pre><code>throw $this-&gt;createNotFoundException(message);
</code></pre>
</div>
</div>
<div class="row">
<div class="span6">
<h4>Working with the session</h4>
<p>You can manage session attributes with:</p>
<pre><code>$session = $this-&gt;getRequest()-&gt;getSession();
</code></pre>
<p>or the shortcut version</p>
<pre><code>$this-&gt;get('session');
</code></pre>
<p>and to work with the data:</p>
<pre><code>$session-&gt;get('foo','default value');
$session-&gt;set('foo','bar');
</code></pre>
</div>
<div class="span6">
<h4>Flash messages</h4>
<p>Flash messages only last one request and they are stored in a FlashBag:</p>
<pre><code>$this-&gt;get('session')-&gt;getFlashBag()-&gt;add('notice','message');
</code></pre>
<p>To iterate trough all flash messages in a template you can use:</p>
<pre><code>{% for flashMessage in app.session.flashbag.get('notice') %}
    &lt;div class="flash notice"&gt;
        {{ flashMessage }}
    &lt;/div&gt;
{% endfor %}
</code></pre>
</div>
</div>
<p>Finally, here is an example of a controller class with Request and Response object in use.</p>
<pre><code>namespace Symfony\CheatSheetBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;

class DefaultController extends Controller
{
    public function indexAction()
    {
        return $this-&gt;render('SymfonyCheatSheetBundle:Default:index.html.twig');
    }

    public function contactAction(Request $request)
    {
        //get request variables.
        //do something, call service, go to database, create form, send emails, etc...
        return $this-&gt;render('SymfonyCheatSheetBundle:Default:feedback.html.twig', array([template vars]));
    }
}
</code></pre>
<hr>
<h2 id="routing">ROUTING <a href="#top" class="small">back to top</a></h2>
<p>Routing in Symfony 2 is even easier than in Symfony 1.x. Here is an example of the most complex routing you can get in Symfony 2.</p>
<pre><code>article_show:
    pattern: /{_locale}/article-details/{page}.{_format}
    defaults: {_controller:Bundle:Controller:Action, _format: html, page:1}
    requirements:
        _locale: en|fr
        _format: html|rss
        page: \d+
        _scheme: http|https
</code></pre>
<p>Also you can prefix imported routes and give a group of routes a prepend text:</p>
<pre><code>#app/config/routing.yml
    acme_hello:
    resource: "@AcmeHelloBundle/Resources/config/routing.yml"
    prefix: /admin
</code></pre>
<h4>Working with annotations</h4>
<p>You can use <strong>annotations</strong> in your controller by enabling annotations in your <strong>routing.yml</strong> and in your <strong>config.yml</strong></p>
<pre><code>#config.yml
sensio_framework_extra:
    router:  { annotations: true }
    request: { converters: true }
    view:    { annotations: true }
    cache:   { annotations: true }
</code></pre>
<pre><code>#routing.yml
acmedemo_main:
    resource: "@AcmeDemoWebBundle/Controller"
    prefix:   /
    type: annotation
</code></pre>
<p>In your controller:</p>
<pre><code>/**
* @Route("/{_locale}/", name="localizedHomepage")
* @Method("POST")
* @param $name
* @Template("AcmeDemoWebBundle:Web:index.html.twig")
* @Cache(expires="+30 days")
*/
public function localizedHomepageAction($name)
{
    return array('name' =&gt; $name);
}
</code></pre>
<hr>
<h2 id="templating">TEMPLATING and TWIG <a href="#top" class="small">back to top</a></h2>
<div class="row">
<div class="span6">
<h3>Including partials and components</h3>
<pre><code>{% include "Bundle:Controller:action" %}
<strong>in Symfony 2.1:</strong>
{% render "Bundle:Controller:action" with {"max" : 3} %}
<strong>in Symfony 2.2:</strong>
{{ render(controller("Bundle:Controller:action", {max :3})) }}
</code></pre>
<h3>Links</h3>
<pre><code>&lt;a href="{{ path('homepage') }}"&gt;Home&lt;a/&gt; //relative
&lt;a href="{{ url('homepage') }}"&gt;Home&lt;a/&gt; //absolute
&lt;a href="{{ path('show', {'id':article.id}) }}"&gt;Home&lt;/a&gt;
</code></pre>
<h3>Assets</h3>
<pre><code>&lt;img src="{{ 'uploads/'~foto.url }}"/&gt;
</code></pre>
</div>
<div class="span6">
<h3>Debug variables in a template</h3>
<pre><code>{{ dump(article) }}
            </code></pre>
<h3>Global TWIG variables</h3>
<pre><code>app.security
app.user
app.request
app.request.get('foo') //get
app.request.request.get('foo') //post
app.session
app.environment
app.debug
</code></pre>
</div>
</div>
<h3>TWIG TAGS</h3>
<div class="row">
<div class="span6">
<h4>block</h4>
<p>When a template uses inheritance and if you want to print a block multiple times, use the block function:</p>
<pre><code>&lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;h1&gt;{{ block('title') }}&lt;/h1&gt;
{% block body %}{% endblock %}
</code></pre>
<h4>parent</h4>
<p>When a template uses inheritance, it's possible to render the contents of the parent block when overriding a block by using the parent function:</p>
<pre><code>{% extends "base.html" %}

{% block sidebar %}
&lt;h3&gt;Table Of Contents&lt;/h3&gt;
...
{{ parent() }}
{% endblock %}
</code></pre>
<h4>for</h4>
<p>Loop over each item in a sequence. For example, to display a list of users provided in a variable called users:</p>
<pre><code>&lt;h1&gt;Members&lt;/h1&gt;
&lt;ul&gt;
{% for user in users %}
&lt;li&gt;{{ user.username|e }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</code></pre>
<h6>The loop variable</h6>
<p>Inside of a for loop block you can access some special variables:</p>
<pre><code>Variable Description
loop.index The current iteration of the loop. (1 indexed)
loop.index0 The current iteration of the loop. (0 indexed)
loop.revindex The number of iterations from the end of the loop (1 indexed)
loop.revindex0 The number of iterations from the end of the loop (0 indexed)
loop.first True if first iteration
loop.last True if last iteration
loop.length The number of items in the sequence
loop.parent The parent context
</code></pre>
<pre><code>{% for user in users %}
{{ loop.index }} - {{ user.username }}
{% endfor %}
</code></pre>
<h4>if</h4>
<p>The if statement in Twig is comparable with the if statements of PHP.</p>
<p>In the simplest form you can use it to test if an expression evaluates to true:</p>
<pre><code>{% if online == false %}
&lt;p&gt;Our website is in maintenance mode. Please, come back later.&lt;/p&gt;
{% endif %}
</code></pre>
<h4>raw</h4>
<p>Everything inside raw tags won't be parsed.</p>
<pre><code>{% raw %}
This variable {{foo}} won't be parsed as twig var.
{% endraw. %}</code></pre>
</div>
<div class="span6">
<h4>set</h4>
<p>Inside code blocks you can also assign values to variables. Assignments use the set tag and can have multiple targets:</p>
<pre><code>{% set foo = 'foo' %}
{% set foo = [1, 2] %}
{% set foo = {'foo': 'bar'} %}
{% set foo = 'foo' ~ 'bar' %}
{% set foo, bar = 'foo', 'bar' %}
</code></pre>
<h4>filter</h4>
<p>Filter sections allow you to apply regular Twig filters on a block of template data. Just wrap the code in the special filter section:</p>
<pre><code>{% filter upper %}
This text becomes uppercase
{% endfilter %}
</code></pre>
<p>You can also chain filters:</p>
<pre><code>{% filter lower|escape %}
&lt;strong&gt;SOME TEXT&lt;/strong&gt;
{% endfilter %}
</code></pre>
<h4>macro</h4>
<p>Macros are comparable with functions in regular programming languages. They are useful to put often used HTML idioms into reusable elements to not repeat yourself.</p>
<p>Here is a small example of a macro that renders a form element:</p>
<pre><code>{% macro input(name, value, type, size) %}
&lt;input type="{{ type|default('text') }}" name="{{ name }}" value="{{ value|e }}" size="{{ size|default(20) }}" /&gt;
{% endmacro %}
</code></pre>
<p>Macros differs from native PHP functions in a few ways:</p>
<ul>
<li>Default argument values are defined by using the default filter in the macro body;</li>
<li>Arguments of a macro are always optional.</li>
</ul>
<p>But as PHP functions, macros don't have access to the current template variables.</p>
<p>Macros can be defined in any template, and need to be "imported" before being used (see the documentation for the import tag for more information):</p>
<pre><code>{% import "forms.html" as forms %}
</code></pre>
<p>The above import call imports the "forms.html" file (which can contain only macros, or a template and some macros), and import the functions as items of the forms variable.</p>
<p>The macro can then be called at will:</p>
<pre><code>&lt;p&gt;{{ forms.input('username') }}&lt;/p&gt;
&lt;p&gt;{{ forms.input('password', null, 'password') }}&lt;/p&gt;
</code></pre>
<p>If macros are defined and used in the same template, you can use the special _self variable to import them:</p>
<pre><code>{% import _self as forms %}
&lt;p&gt;{{ forms.input('username') }}&lt;/p&gt;
</code></pre>
</div>
</div>
<h3>TWIG FILTERS</h3>
<div class="row">
<div class="span6">
<h4>date</h4>
<pre><code>{{ post.published_at|date("m/d/Y") }}
{{ post.published_at|date("m/d/Y", "Europe/Paris") }}
</code></pre>
<h4>date_modify</h4>
<pre><code>{{ post.published_at|date_modify("+1 day")|date("m/d/Y") }}
</code></pre>
<h4>format</h4>
<pre><code>{{ "I like %s and %s."|format(foo, "bar") }}
</code></pre>
<h4>replace</h4>
<pre><code>{{ "I like %this% and %that%."|replace({'%this%': foo, '%that%': "bar"}
</code></pre>
<h4>number_format</h4>
<pre><code>{{ 200.35|number_format }}
{{ 9800.333|number_format(2, '.', ',') }}
</code></pre>
<h4>url_encode</h4>
<pre><code>{{ data|url_encode() }}
</code></pre>
<h4>json_encode</h4>
<pre><code>{{ data|json_encode() }}
</code></pre>
<h4>convert_encoding</h4>
<pre><code>{{ data|convert_encoding('UTF-8', 'iso-2022-jp') }}
</code></pre>
<h4>title</h4>
<pre><code>{{ 'my first car'|title }}
{# outputs 'My First Car' #}
</code></pre>
<h4>capitalize</h4>
<pre><code>{{ 'my first car'|capitalize }}
</code></pre>
<h4>nl2br</h4>
<pre><code>{{ "I like Twig.\nYou will like it too."|nl2br }}
    {# outputs

    I like Twig.&lt;br /&gt;
    You will like it too.

    #}
</code></pre>
<h4>raw</h4>
<pre><code>{{ var|raw }} {# var won't be escaped #}
</code></pre>
<h4>trim</h4>
<pre><code>{{ ' I like Twig.'|trim('.') }}
</code></pre>
</div>
<div class="span6">
<h4>upper</h4>
<pre><code>{{ 'welcome'|upper }}
</code></pre>
<h4>lower</h4>
<pre><code>{{ 'WELCOME'|lower }}
</code></pre>
<h4>striptags</h4>
<pre><code>{% some_html|striptags %}
</code></pre>
<h4>join</h4>
<pre><code>{{ [1, 2, 3]|join('|') }}
{# returns 1|2|3 #}
</code></pre>
<h4>split</h4>
<pre><code>{{ "one,two,three"|split(',') }}
{# returns ['one', 'two', 'three'] #}
</code></pre>
<h4>reverse</h4>
<pre><code>{% for use in users|reverse %}
    ...
{% endfor %}
</code></pre>
<h4>abs</h4>
<pre><code>{{ number|abs }}
</code></pre>
<h4>length</h4>
<pre><code>{% if users|length &gt; 10 %}
    ...
{% endif %}
</code></pre>
<h4>sort</h4>
<pre><code>{% for use in users|sort %}
    ...
{% endfor %}
</code></pre>
<h4>default</h4>
<pre><code>{{ var|default('var is not defined') }}
</code></pre>
<h4>keys</h4>
<pre><code>{% for key in array|keys %}
    ...
{% endfor %}
</code></pre>
<h4>escape</h4>
<pre><code>{{ user.username|e }}
{# is equivalent to #}
{{ user.username|e('html') }}
{{ user.username|e('css') }}
{{ user.username|e('js') }}
</code></pre>
</div>
</div>
<hr>
<h2 id="doctrine">DOCTRINE <a href="#top" class="small">back to top</a></h2>
<h4>ORM DESIGNER &amp; Doctrine ORM</h4>
<p>Symfony comes with Doctrine ORM framework. Doctrine has <a href="http://www.doctrine-project.org/" target="_blank" onclick="recordOutboundLink(this, &#39;Others&#39;, &#39;http://www.doctrine-project.org&#39;);return false;">extensive documentation</a>, but you can start using it right away without a need to dive too deep. <a href="http://www.orm-designer.com/" target="_blank" onclick="recordOutboundLink(this, &#39;Others&#39;, &#39;http://www.orm-designer.com&#39;);return false;">ORM Designer</a> can make your life with Doctrine and other ORM frameworks much easier.</p>
<p>ORM Designer is a tool for modeling ORM in a very comfortable way. You can continuously export your model and even edit exported classes without losing the changes on consequent exports. What’s also great about ORM Designer is that it can construct a model from an existing project. And it can do so in a very colourful and well-arranged way :-).</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/790x552wormd_main.jpg.pagespeed.ic.7nK2enlF1o.webp" width="790" height="552"></div>
<p>Start by <a href="http://www.orm-designer.com/" target="_blank" onclick="recordOutboundLink(this, &#39;Others&#39;, &#39;http://www.orm-designer.com&#39;);return false;">downloading ORM Designer</a> and installing on your computer. ORM Designer works natively on Mac OS X, Windows and Linux.</p>
<ul class="indent">
<li>
<h4>1. Create a new ORM Designer project</h4>
<p>Pick your project name and select <strong>MVC Framework Symfony2, ORM Framework Doctrine2 and set a Project Path</strong>. Project Path should be the Symfony2 project root.</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/616x410wormd_create.jpg.pagespeed.ic.YFXEu_4Y5C.webp" width="616" height="410"></div>
</li>
<li>
<h4>1a. Import existing project (Optional)</h4>
<p>Insert existing project name and select <strong>MVC Framework Symfony2, ORM Framework Doctrine2 and set a Project Path</strong>. Project Path should be the Symfony2 project root.</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/616x410wormd_import_wizard.jpg.pagespeed.ic.7J4-jkRsKD.webp" width="616" height="410"></div>
<p>Select all the entities you want to import:</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/550x335wormd_import.jpg.pagespeed.ic.puvrk0zcCV.webp" width="550" height="335"></div>
</li>
<li>
<h4>2. Set export format</h4>
<p>When creating a new project you need to set the export format. Double click on the module title as shown by the red arrow. Module editor will be opened and you can set export format (<strong>Doctrine2PHP for Doctrine2 annotations, Doctrine2XML/Doctrine2YML for XML/YML format</strong>). You should also set relative path, so the class are exported correctly to your project structure.</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/671x397wormd_module_editor.jpg.pagespeed.ic.vyo2QYFpWF.webp" width="671" height="397"></div>
</li>
<li>
<h4>3. Export project</h4>
<p>Press <em>“Export to ORM”</em> and a table summarizing exported changes to the model will be displayed.</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/790x455wormd_export.jpg.pagespeed.ic.CjvfJdI07O.webp" width="790" height="455"></div>
</li>
</ul>
<h3>Working with the model</h3>
<p>Your first model is now exported. Click Export to ORM button whenever you want to update your schema definitions.</p>
<h4>Create new Entities</h4>
<p>Select tool Entity from the top ribbon (or press <em>Ctrl + T</em>) and click in your model to place the new entity. Add required fields. You can navigate with keyboard shortcuts:</p><p>
</p><ul>
<li><em>Insert</em>: to add a new field</li>
<li><em>Ctrl+Up arrow</em>: to move field up</li>
<li><em>Ctrl+Down arrow</em>: to move field down</li>
<li><em>Tab</em>: to skip to the next edit value</li>
<li><em>Ctrl+Insert</em>: to insert a field above currently highlighted row</li>
</ul>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/790x459wormd_entity.jpg.pagespeed.ic.7yNWRWiEkG.webp" width="790" height="459"></div>
<h4>Create new Association</h4>
<p>Select tool Association from the top ribbon (or press Ctrl + R) and select the entities you want to create association between. By filling either one or both aliases you can set the Association as an unidirectional or bidirectional.</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/463x513wormd_association.jpg.pagespeed.ic.DfRWo7kRj7.webp" width="463" height="513"></div>
<h4>Create new Many-Many Association</h4>
<p>Select tool ManyToMany from the top ribbon (or press Ctrl + M) and select the entities you want to create association between. Again you need to fill aliases and additionally also the MN Entity name. If you don’t want to type it manually, you can use the naming tool (red arrow) which follows the usual naming conventions.</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/459x537wormd_many2many.jpg.pagespeed.ic.susxrhiNB7.webp" width="459" height="537"></div>
<h4>Set Doctrine ORM properties</h4>
<p>You can set ORM properties using the property window in the lower bottom corner of ORM Designer. Property window shows you available properties based on the object type (Entity/Relation/Field).</p>
<div class="ormd-image"><img src="./symfony2-cheatsheet_files/276x387wormd_properties.jpg.pagespeed.ic.7T2-TsuXRY.webp" width="276" height="387"></div>
<h4>Generate doctrine schema</h4>
<p>If you have selected XML or YML format you need to generate the PHP classes <strong>generate:doctrine:entities [bundleNamespace]</strong>. This will automatically create all entity and repository classes for us. Easy, isn’t it? If you have been exporting to PHP annotations you’re ready to go.</p>
<!-- ORM Designer code end -->
<h4>Persistint object into the database</h4>
<p>Now that you have a mapped Product entity and corresponding product table, you're ready to persist
data to the database. From inside a controller, this is pretty easy. Add the following method to the
DefaultController of the bundle:</p>
<pre><code>// src/Acme/StoreBundle/Controller/DefaultController.php

        use Acme\StoreBundle\Entity\Product;
        use Symfony\Component\HttpFoundation\Response;

        public function createAction()
        {
        $product = new Product();
        $product-&gt;setName('A Foo Bar');
        $product-&gt;setPrice('19.99');
        $product-&gt;setDescription('Lorem ipsum dolor');

        $em = $this-&gt;getDoctrine()-&gt;getManager();
        $em-&gt;persist($product); //marks object to be saved in the next transaction.
        $em-&gt;flush(); //performs all saves and transactions.

        return new Response('Created product id '.$product-&gt;getId());
        }
    </code></pre>
<h4>Fetching object form database</h4>
<pre><code>$product = $this-&gt;getDoctrine()
        -&gt;getRepository('AcmeStoreBundle:Product')
        -&gt;find($id);
    </code></pre>
<p>Once you have your repository, you have access to all sorts of helpful methods:</p>
<pre><code>// query by the primary key (usually "id")
        $product = $repository-&gt;find($id);

        // dynamic method names to find based on a column value
        $product = $repository-&gt;findOneById($id);
        $product = $repository-&gt;findOneByName('foo');

        // find *all* products
        $products = $repository-&gt;findAll();

        // find a group of products based on an arbitrary column value
        $products = $repository-&gt;findByPrice(19.99);

        // query for one product matching be name and price
        $product = $repository-&gt;findOneBy(array('name' =&gt; 'foo', 'price' =&gt; 19.99));
    </code></pre>
<h4>Querying for Objects with DQL</h4>
<pre><code>$em = $this-&gt;getDoctrine()-&gt;getManager();
        $query = $em-&gt;createQuery(
        'SELECT p FROM AcmeStoreBundle:Product p WHERE p.price &gt; :price ORDER BY p.price ASC'
        )-&gt;setParameter('price', '19.99');
        $products = $query-&gt;getResult();
    </code></pre>
<p>If you need to fetch only one result.
$product = $query-&gt;getSingleResult();</p>
<p>The getSingleResult() method throws a Doctrine\ORM\NoResultException exception if no
results are returned and a Doctrine\ORM\NonUniqueResultException if more than one result is
returned. If you use this method, you may need to wrap it in a try-catch block and ensure that only
one result is returned (if you're querying on something that could feasibly return more than one
result):</p>
<pre><code>$query = $em-&gt;createQuery('SELECT ...')
        -&gt;setMaxResults(1);
        try {
        $product = $query-&gt;getSingleResult();
        } catch (\Doctrine\Orm\NoResultException $e) {
        $product = null;
        }
        // ...
    </code></pre>
<h4>Using Doctrine's Query Builder</h4>
<pre><code>$repository = $this-&gt;getDoctrine()-&gt;getRepository('AcmeStoreBundle:Product');
        $query = $repository-&gt;createQueryBuilder('p')
        -&gt;where('p.price &gt; :price')
        -&gt;setParameter('price', '19.99')
        -&gt;orderBy('p.price', 'ASC')
        -&gt;getQuery();
        $products = $query-&gt;getResult();
    </code></pre>
<h4>Custom Repository Classes</h4>
<p>In the previous sections, you began constructing and using more complex queries from inside a
controller. In order to isolate, test and reuse these queries, it's a good idea to create a custom repository
class for your entity and add methods with your query logic there.
To do this, add the name of the repository class to your mapping definition.</p>
<pre><code>// src/Acme/StoreBundle/Entity/Product.php
        namespace Acme\StoreBundle\Entity;

        use Doctrine\ORM\Mapping as ORM;

        /**
        * @ORM\Entity(repositoryClass="Acme\StoreBundle\Entity\ProductRepository")
        */
        class Product
        {
        //...
        }
    </code></pre>
<p>Or you can use CLI command:</p>
<pre><code>$ php app/console doctrine:generate:entities Acme
    </code></pre>
<p>Now let's create a custom method inside our Repository class:</p>
<pre><code>// src/Acme/StoreBundle/Entity/ProductRepository.php
        namespace Acme\StoreBundle\Entity;

        use Doctrine\ORM\EntityRepository;

        class ProductRepository extends EntityRepository
        {
        public function findAllOrderedByName()
        {
        return $this-&gt;getEntityManager()
        -&gt;createQuery('SELECT p FROM AcmeStoreBundle:Product p ORDER BY p.name ASC')
        -&gt;getResult();
        }
        }
    </code></pre>
<p>You can use this new method just like the default finder methods of the repository:</p>
<pre><code>$em = $this-&gt;getDoctrine()-&gt;getManager();
        $products = $em-&gt;getRepository('AcmeStoreBundle:Product')
        -&gt;findAllOrderedByName();
    </code></pre>
<h4>Saving Related Entities</h4>
<p>Now, let's see the code in action. Imagine you're inside a controller:</p>
<pre><code>// ...
        use Acme\StoreBundle\Entity\Category;
        use Acme\StoreBundle\Entity\Product;
        use Symfony\Component\HttpFoundation\Response;

        class DefaultController extends Controller
        {
        public function createProductAction()
        {
        $category = new Category();
        $category-&gt;setName('Main Products');

        $product = new Product();
        $product-&gt;setName('Foo');
        $product-&gt;setPrice(19.99);
        // relate this product to the category
        $product-&gt;setCategory($category);

        $em = $this-&gt;getDoctrine()-&gt;getManager();
        $em-&gt;persist($category);
        $em-&gt;persist($product);
        $em-&gt;flush();

        return new Response(
        'Created product id: '.$product-&gt;getId().' and category id:'.$category-&gt;getId()
        );
        }
        }
    </code></pre>
<div class="row">
<div class="span6">
<h4>Lifecycle Callbacks</h4>
<p>Sometimes, you need to perform an action right before or after an entity is inserted, updated, or deleted.
These types of actions are known as "lifecycle" callbacks, as they're callback methods that you need to
execute during different stages of the lifecycle of an entity (e.g. the entity is inserted, updated, deleted,
etc).</p>
<pre><code>/**
                * @ORM\Entity()
                * @ORM\HasLifecycleCallbacks()
                */
                class Product
                {
                // ...
                }

                /**
                * @ORM\PrePersist
                */
                public function setCreatedValue()
                {
                $this-&gt;created = new \DateTime();
                }
            </code></pre>
<p>This can be repeated for any of the other lifecycle events, which include:</p>
<ul class="left">
<li>preRemove</li>
<li>postRemove</li>
<li>prePersist</li>
<li>postPersist</li>
<li>preUpdate</li>
<li>postUpdate</li>
<li>postLoad</li>
<li>loadClassMetadata</li>
</ul>
</div>
<div class="span6">
<h4>Doctrine Field Types Reference</h4>
<p>Doctrine comes with a large number of field types available. Each of these maps a PHP data type to a
specific column type in whatever database you're using. The following types are supported in Doctrine:</p>
<ul>
<li><strong>Strings</strong>
<ul>
<li>string (used for shorter strings)</li>
<li>text (used for larger strings)</li>
</ul>
</li>
<li><strong>Numbers</strong>
<ul>
<li>integer</li>
<li>smallint</li>
<li>bigint</li>
<li>decimal</li>
<li>float</li>
</ul>
</li>
<li><strong>Dates and Times (use a DateTime object for these fields in PHP)</strong>
<ul>
<li>date</li>
<li>time</li>
<li>datetime</li>
</ul>
</li>
<li><strong>Other Types</strong>
<ul>
<li>boolean</li>
<li>object (serialized and stored in a CLOB field)</li>
<li>array (serialized and stored in a CLOB field)</li>
</ul>
</li>
</ul>
</div>
</div>
<h4>Persistint object into the database</h4>
<p>Now that you have a mapped Product entity and corresponding product table, you're ready to persist
data to the database. From inside a controller, this is pretty easy. Add the following method to the
DefaultController of the bundle:</p>
<pre><code>// src/Acme/StoreBundle/Controller/DefaultController.php

        use Acme\StoreBundle\Entity\Product;
        use Symfony\Component\HttpFoundation\Response;

        public function createAction()
        {
        $product = new Product();
        $product-&gt;setName('A Foo Bar');
        $product-&gt;setPrice('19.99');
        $product-&gt;setDescription('Lorem ipsum dolor');

        $em = $this-&gt;getDoctrine()-&gt;getManager();
        $em-&gt;persist($product); //marks object to be saved in the next transaction.
        $em-&gt;flush(); //performs all saves and transactions.

        return new Response('Created product id '.$product-&gt;getId());
        }
    </code></pre>
<hr>
<h2 id="testing">PHP UNIT TESTING <a href="#top" class="small">back to top</a></h2>
<p>Symfony2 works with PHPUnit 3.5.11 or later, though version 3.6.4 is needed to test the Symfony
core code itself.</p>
<pre><code># specify the configuration directory on the command line
    $ phpunit -c app/
</code></pre>
<h3>Unit tests</h3>
<p>Writing Symfony2 unit tests is no different than writing standard PHPUnit unit tests. Suppose, for
example, that you have an incredibly simple class called Calculator in the Utility/ directory of your
bundle:</p>
<pre><code>// src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php
namespace Acme\DemoBundle\Tests\Utility;

use Acme\DemoBundle\Utility\Calculator;

class CalculatorTest extends \PHPUnit_Framework_TestCase
{
    public function testAdd()
    {
        $calc = new Calculator();
        $result = $calc-&gt;add(30, 12);

        // assert that our calculator added the numbers correctly!
        $this-&gt;assertEquals(42, $result);
    }
}
</code></pre>
<p>By convention, the Tests/ sub-directory should replicate the directory of your bundle. So, if you're
testing a class in your bundle's Utility/ directory, put the test in the Tests/Utility/ directory.</p>
<p>Running tests for a given file or directory is also very easy:</p>
<pre><code># run all tests in the Utility directory
$ phpunit -c app src/Acme/DemoBundle/Tests/Utility/

# run tests for the Calculator class
$ phpunit -c app src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php

# run all tests for the entire Bundle
$ phpunit -c app src/Acme/DemoBundle/
</code></pre>
<h3>Functional Tests</h3>
<p>They are no different from unit tests as far as PHPUnit is concerned, but they have a very specific
workflow:</p>
<ul>
<li>Make a request;</li>
<li>Test the response;</li>
<li>Click on a link or submit a form;</li>
<li>Test the response;</li>
<li>Rinse and repeat.</li>
</ul>
<p>Symfony 2 provides a simple functional test for its DemoController as follows:</p>
<pre><code>// src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php
namespace Acme\DemoBundle\Tests\Controller;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class DemoControllerTest extends WebTestCase
{
    public function testIndex()
    {
        $client = static::createClient();
        $crawler = $client-&gt;request('GET', '/demo/hello/Fabien');
        $this-&gt;assertGreaterThan(0, $crawler-&gt;filter('html:contains("Hello Fabien")')-&gt;count());
    }
}
</code></pre>
<div class="row">
<div class="span6">
<p>The createClient() method returns a client, which is like a browser that you'll use to crawl your site:</p>
<p>The request() method returns a Crawler object which can be used to select elements in the Response, click on links, and submit forms.</p>
<ul>
<li>
<p>Click on a link:</p>
<pre><code>$link = $crawler-&gt;filter('a:contains("Greet")')-&gt;eq(1)-&gt;link();
$crawler = $client-&gt;click($link);
</code></pre>
</li>
</ul></div>
<div class="span6">
<li>
<p>Submit a form:</p>
<pre><code>$form = $crawler-&gt;selectButton('submit')-&gt;form();

// set some values
$form['name'] = 'Lucas';
$form['form_name[subject]'] = 'Hey there!';

// submit the form
$crawler = $client-&gt;submit($form);
</code></pre>
</li>
<li>
</li></div>
</div>
<p>Assertions:</p>
<div class="row">
<div class="span6">
<p><strong>Assert that the response matches a given CSS selector.</strong></p>
<pre><code> $this-&gt;assertGreaterThan(0, $crawler-&gt;filter('h1')-&gt;count());
</code></pre>
<p><strong>Check content text</strong></p>
<pre><code> $this-&gt;assertRegExp('/Hello Fabien/', $client-&gt;getResponse()-&gt;getContent());
</code></pre>
<p><strong>Assert that there is more than one h2 tag with the class "subtitle"</strong></p>
<pre><code> $this-&gt;assertGreaterThan(0, $crawler-&gt;filter('h2.subtitle')-&gt;count());
</code></pre>
<p><strong>Assert that there are exactly 4 h2 tags on the page</strong></p>
<pre><code> $this-&gt;assertCount(4, $crawler-&gt;filter('h2'));
</code></pre>
<p><strong>Assert that the "Content-Type" header is "application/json</strong></p>
<pre><code> $this-&gt;assertTrue($client-&gt;getResponse()-&gt;headers-&gt;contains('Content-Type','application/json'));
</code></pre>
<p><strong>Assert that the response content matches a regexp</strong></p>
<pre><code>$this-&gt;assertRegExp('/foo/', $client-&gt;getResponse()-&gt;getContent());
</code></pre>
<p><strong>Assert that the response status code is 2xx</strong></p>
<pre><code>$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isSuccessful());
</code></pre>
<p><strong>Assert that the response status code is 404</strong></p>
<pre><code>$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isNotFound());
</code></pre>
<p><strong>Assert a specific 200 status code</strong></p>
<pre><code>$this-&gt;assertEquals(200, $client-&gt;getResponse()-&gt;getStatusCode());
</code></pre>
<p><strong>Assert that the response is a redirect to /demo/contact</strong></p>
<pre><code>$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isRedirect('/demo/contact'));
</code></pre>
<p><strong>or simply check that the response is a redirect to any URL</strong></p>
<pre><code>$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isRedirect());
</code></pre>
<p><strong>Directly submit a form (but using the Crawler is easier!)</strong></p>
<pre><code>$client-&gt;request('POST', '/submit', array('name' =&gt; 'Fabien'));
</code></pre>
</div>
<div class="span6">
<p><strong>Form submission with a file upload</strong></p>
<pre><code>use Symfony\Component\HttpFoundation\File\UploadedFile;

    $photo = new UploadedFile(
    '/path/to/photo.jpg',
    'photo.jpg',
    'image/jpeg',
    123
    );
    // or
    $photo = array(
    'tmp_name' =&gt; '/path/to/photo.jpg',
    'name' =&gt; 'photo.jpg',
    'type' =&gt; 'image/jpeg',
    'size' =&gt; 123,
    'error' =&gt; UPLOAD_ERR_OK
    );
    $client-&gt;request(
    'POST',
    '/submit',
    array('name' =&gt; 'Fabien'),
    array('photo' =&gt; $photo)
    );
</code></pre>
<p><strong>Perform a DELETE requests, and pass HTTP headers</strong></p>
<pre><code>$client-&gt;request(
    'DELETE',
    '/post/12',
    array(),
    array(),
    array('PHP_AUTH_USER' =&gt; 'username', 'PHP_AUTH_PW' =&gt; 'pa$$word')
    );
</code></pre>
<p><strong>browsing</strong></p>
<pre><code>$client-&gt;back();
$client-&gt;forward();
$client-&gt;reload();
</code></pre>
<p><strong>Clears all cookies and the history</strong></p>
<pre><code>$client-&gt;restart();
</code></pre>
<p><strong>redirecting</strong></p>
<pre><code>$crawler = $client-&gt;followRedirect();
$client-&gt;followRedirects();
</code></pre>

</div>
</div>

<h3>The Request() method:</h3>
<div class="row">
<div class="span6">
<pre><code>request(
    $method,
    $uri,
    array $parameters = array(),
    array $files = array(),
    array $server = array(),
    $content = null,
    $changeHistory = true
)
</code></pre>
<p>The server array is the raw values that you'd expect to normally find in the PHP $_SERVER4
superglobal. For example, to set the Content-Type and Referer HTTP headers, you'd pass the
following:</p>
</div>
<div class="span6">
<pre><code>$client-&gt;request(
    'GET',
    '/demo/hello/Fabien',
    array(),
    array(),
    array(
        'CONTENT_TYPE' =&gt; 'application/json',
        'HTTP_REFERER' =&gt; '/foo/bar',
        )
    );
</code></pre>
</div>
</div>
<h3>Accessing Internal Objects</h3>
<p>If you use the client to test your application, you might want to access the client's internal objects:</p>
<pre><code>$history = $client-&gt;getHistory();
$cookieJar = $client-&gt;getCookieJar();
</code></pre>
<p>You can also get the objects related to the latest request:</p>
<pre><code>$request = $client-&gt;getRequest();
$response = $client-&gt;getResponse();
$crawler = $client-&gt;getCrawler();
</code></pre>
<p>If your requests are not insulated, you can also access the Container and the Kernel:</p>
<pre><code>$container = $client-&gt;getContainer();
$kernel = $client-&gt;getKernel();
$profile = $client-&gt;getProfile();
</code></pre>
<h3>The Crawler</h3>
<div class="row">
<div class="span6">
<p>A Crawler instance is returned each time you make a request with the Client. It allows you to traverse
HTML documents, select nodes, find links and forms.</p>
<p>Like jQuery, the Crawler has methods to traverse the DOM of an HTML/XML document.</p>
<pre><code>$newCrawler = $crawler-&gt;filter('input[type=submit]')
    -&gt;last()
    -&gt;parents()
    -&gt;first();
</code></pre>
<p>Many other methods are also available:</p>
<ul>
<li>filter('h1.title') Nodes that match the CSS selector</li>
<li>filterXpath('h1') Nodes that match the XPath expression</li>
<li>eq(1) Node for the specified index</li>
<li>first() First node</li>
<li>last() Last node</li>
<li>siblings() Siblings</li>
<li>nextAll() All following siblings</li>
<li>previousAll() All preceding siblings</li>
<li>parents() Returns the parent nodes</li>
<li>children() Returns children nodes</li>
<li>reduce($lambda) Nodes for which the callable does not return false</li>
</ul>
</div>
<div class="span6">
<h4>Extracting information</h4>
<pre><code>// Returns the attribute value for the first node
$crawler-&gt;attr('class');

// Returns the node value for the first node
$crawler-&gt;text();

// Extracts an array of attributes for all nodes (_text returns the node value)
// returns an array for each element in crawler, each with the value and href
$info = $crawler-&gt;extract(array('_text', 'href'));

// Executes a lambda for each node and return an array of results
$data = $crawler-&gt;each(function ($node, $i)
{
    return $node-&gt;attr('href');
});

//Selecting links
$crawler-&gt;selectLink('Click here');
$link = $crawler-&gt;selectLink('Click here')-&gt;link();
$client-&gt;click($link);
</code></pre>
</div>
</div>
<div class="row">
<div class="span6">
<h3>Forms</h3>
<pre><code>// Selecting buttons.
$buttonCrawlerNode = $crawler-&gt;selectButton('submit');

// You can override values by:

$form = $buttonCrawlerNode-&gt;form(array(
    'name' =&gt; 'Fabien',
    'my_form[subject]' =&gt; 'Symfony rocks!',
));

//Simulate methods
$form = $buttonCrawlerNode-&gt;form(array(), 'DELETE');

//Submit form.
$client-&gt;submit($form);

//Submit with arguments.
$client-&gt;submit($form, array(
    'name' =&gt; 'Fabien',
    'my_form[subject]' =&gt; 'Symfony rocks!',
));

// Using arrays.
$form['name'] = 'Fabien';
$form['my_form[subject]'] = 'Symfony rocks!';

// Select an option or a radio
$form['country']-&gt;select('France');

// Tick a checkbox
$form['like_symfony']-&gt;tick();

// Upload a file
$form['photo']-&gt;upload('/path/to/lucas.jpg');
</code></pre>
</div>
<div class="span6">
<h3>Test environment configuration</h3>
<p>The swiftmailer is configured to not actually deliver emails in the test
environment. You can see this under the swiftmailer configuration option:</p>
<pre><code># app/config/config_test.yml
swiftmailer:
    disable_delivery: true
</code></pre>
<p>You can also use a different environment entirely, or override the default debug mode (true) by passing
each as options to the createClient() method:</p>
<p><strong>custom environment</strong></p>
<pre><code>$client = static::createClient(array(
    'environment' =&gt; 'my_test_env',
    'debug' =&gt; false,
    ));
</code></pre>
<p><strong>custom user agent</strong></p>
<pre><code>$client = static::createClient(array(), array(
    'HTTP_HOST' =&gt; 'en.example.com',
    'HTTP_USER_AGENT' =&gt; 'MySuperBrowser/1.0',
));
</code></pre>
<p><strong>override HTTP headers</strong></p>
<pre><code>$client-&gt;request('GET', '/', array(), array(), array(
    'HTTP_HOST' =&gt; 'en.example.com',
    'HTTP_USER_AGENT' =&gt; 'MySuperBrowser/1.0',
));
</code></pre>
</div>
</div>
<hr>
<h2 id="validation">VALIDATION <a href="#top" class="small">back to top</a></h2>
<p>Symfony2 ships with a Validator component that makes this task easy and transparent.</p>
<pre><code># src/Acme/BlogBundle/Resources/config/validation.yml
Acme\BlogBundle\Entity\Author:
properties:
    name:
        - NotBlank: ~
</code></pre>
<p>Protected and private properties can also be validated, as well as "getter" methods (see validatorconstraint-
targets).</p>
<h3>Using the validator Service</h3>
<pre><code>// ...
use Symfony\Component\HttpFoundation\Response;
use Acme\BlogBundle\Entity\Author;

public function indexAction()
{
    $author = new Author();

    // ... do something to the $author object
    $validator = $this-&gt;get('validator');
    $errors = $validator-&gt;validate($author);

    if (count($errors) &gt; 0) {
        return new Response(print_r($errors, true));
    } else {
        return new Response('The author is valid! Yes!');
    }
}
</code></pre>
<p>Inside the template, you can output the list of errors exactly as needed:</p>
<pre><code>{# src/Acme/BlogBundle/Resources/views/Author/validate.html.twig #}
&lt;h3&gt;The author has the following errors&lt;/h3&gt;
&lt;ul&gt;
{% for error in errors %}
&lt;li&gt;{{ error.message }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</code></pre>
<h3>Validation and Forms</h3>
<p>The Symfony2 validator is enabled by default, but you must explicitly enable annotations if you're using
the annotation method to specify your constraints:</p>
<pre><code># app/config/config.yml
framework:
    validation: { enable_annotations: true }
</code></pre>
<p>The good thing about annotations is that you write down all your entities validation in the entities .php in each entity PHPDOC so everything is in the same place.</p>
<h3>Constraints</h3>
<p>The validator is designed to validate objects against constraints (i.e. rules). In order to validate an
object, simply map one or more constraints to its class and then pass it to the validator service.</p>
<p><strong>Basic</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>NotBlank</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\NotBlank()
</td>
</tr>
<tr>
<td>Blank</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\Blank()
</td>
</tr>
<tr>
<td>NotNull</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\NotNull()
</td>
</tr>
<tr>
<td>Null</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\Null()
</td>
</tr>
<tr>
<td>True</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\True(message = "The token is invalid")
</td>
</tr>
<tr>
<td>False</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\False()
</td>
</tr>
<tr>
<td>Type</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\Type(type="integer", message="The value {{ value }} is not a valid {{ type }}.")
</td>
</tr>
</tbody></table>
<p><strong>String</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>Email</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\Email(message = "The email '{{ value }}' is not a valid email.", checkMX = true, checkHost = true)
</td>
</tr>
<tr>
<td>MinLength</td>
<td align="right">Assert\MinLength(limit=3, message="Your name must have at least {{ limit }} characters.")</td>
</tr>
<tr>
<td>MaxLength</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\MaxLength(100)
</td>
</tr>
<tr>
<td>Length</td>
<td align="right">
<a href="https://github.com/Assert" class="user-mention">@Assert</a>\Length( min = "2",max = "50", minMessage = "msg", maxMessage = "msg" )
</td>
</tr>
<tr>
<td>Url</td>
<td align="right">@Assert\Url(message="msg1", protocolos=array('http','https')</td>
</tr>
<tr>
<td>Regex</td>
<td align="right">@Assert\Regex("/^\w+/") =&gt; options (pattern, match, message)</td>
</tr>
<tr>
<td>Ip</td>
<td align="right">@Assert\Ip</td>
</tr>
</tbody></table>
<p><strong>Number</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>Max</td>
<td align="right">@Assert\Max(limit=5, message="msg1")</td>
</tr>
<tr>
<td>Min</td>
<td align="right">@Assert\Min(limit=5, message="msg1")</td>
</tr>
<tr>
<td>Range</td>
<td align="right">@Assert\Range(min = "120", max = "180",minMessage = "msg",maxMessage = "msg")</td>
</tr>
</tbody></table>
<p><strong>Date</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>Date</td>
<td align="right">@Assert\Date()</td>
</tr>
<tr>
<td>DateTime</td>
<td align="right">@Assert\DateTime()</td>
</tr>
<tr>
<td>Time</td>
<td align="right">@Assert\Time()</td>
</tr>
</tbody></table>
<p><strong>Collection</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>Choice</td>
<td align="right">@Assert\Choice(choices = {"male", "female"}, message = "Choose a valid gender.")</td>
</tr>
<tr>
<td>Collection</td>
<td align="right">
<a href="http://symfony.com/doc/current/reference/constraints/Collection.html">http://symfony.com/doc/current/reference/constraints/Collection.html</a>
</td>
</tr>
<tr>
<td>Count</td>
<td align="right">@Assert\Count(min = "1", max = "5", minMessage = "msg", maxMessage = "msg" )</td>
</tr>
<tr>
<td>UniqueEntity</td>
<td align="right">@ORM\Column(name="email", type="string", length=255, unique=true) (Suppose you have an AcmeUserBundle bundle with a User entity that has an email field. You can use the UniqueEntity constraint to guarantee that the email field remains unique between all of the constraints in your user table)</td>
</tr>
<tr>
<td>Language</td>
<td align="right">@Assert\Language (Validates that it is a valid language code)</td>
</tr>
<tr>
<td>Locale</td>
<td align="right">@Assert\Locale (Validates a valid Locale code (ej : ISO639-1)</td>
</tr>
<tr>
<td>Country</td>
<td align="right">@Assert\Country (Valid two letter country code)</td>
</tr>
</tbody></table>
<p><strong>File</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>File</td>
<td align="right">Assert\File(maxSize = "1024k",mimeTypes = {"application/pdf", "application/x-pdf"},mimeeTypesMessage = "msg")
<a href="http://symfony.com/doc/current/reference/constraints/File.html">http://symfony.com/doc/current/reference/constraints/File.html</a>
</td>
</tr>
<tr>
<td>Image</td>
<td align="right">@Assert\Image(minWidth = 200, maxWidth = 400, minHeight = 200, maxHeight = 400)
<a href="http://symfony.com/doc/current/reference/constraints/Image.html">http://symfony.com/doc/current/reference/constraints/Image.html</a>
</td>
</tr>
</tbody></table>
<p><strong>Other</strong></p>
<table>
<tbody><tr>
<th>YAML</th>
<th align="right">Annotation</th>
</tr>
<tr>
<td>Callback</td>
<td align="right">@Assert\Callback(methods={"isAuthorValid"})</td>
</tr>
<tr>
<td>All</td>
<td align="right">@Assert\All({ @Assert\NotBlank @Assert\MinLength(5),}) (Aplies all constraints to each element of the Transversable object)</td>
</tr>
<tr>
<td>UserPassword</td>
<td align="right">@SecurityAssert\UserPassword(message = "Wrong password") (This validates that an input value is equal to the current authenticated user's password.)</td>
</tr>
<tr>
<td>Valid</td>
<td align="right">This constraint is used to enable validation on objects that are embedded as properties on an object being validated. This allows you to validate an object and all sub-objects associated with it.
<a href="http://symfony.com/doc/current/reference/constraints/Valid.html">http://symfony.com/doc/current/reference/constraints/Valid.html</a>
</td>
</tr>
</tbody></table>
<h4>Callback validations</h4>
<pre><code>// src/Acme/BlogBundle/Entity/Author.php
use Symfony\Component\Validator\Constraints as Assert;

/**
* @Assert\Callback(methods={"isAuthorValid"})
*/
class Author
{
}
</code></pre>
<p>If the name of a method is a simple string (e.g. isAuthorValid), that method will be called on the same object that's being validated and the ExecutionContext will be the only argument (see the above example).</p>
<pre><code>use Symfony\Component\Validator\ExecutionContext;

class Author
{
    // ...
    private $firstName;

    public function isAuthorValid(ExecutionContext $context)
    {
        // somehow you have an array of "fake names"
        $fakeNames = array();

        // check if the name is actually a fake name
        if (in_array($this-&gt;getFirstName(), $fakeNames)) {
            $context-&gt;addViolationAtSubPath('firstname', 'This name sounds totally fake!', array(), null);
        }
    }
}
</code></pre>
<p>You can define more complex validation in the repository class of the entity:</p>
<pre><code>// src/Acme/BlogBundle/Entity/Author.php
use Symfony\Component\Validator\Constraints as Assert;

/**
* @Assert\Callback(methods={
* { "Acme\BlogBundle\MyStaticValidatorClass", "isAuthorValid"}
* })
*/
class Author
{
}
</code></pre>
<p>In this case, the static method isAuthorValid will be called on the Acme\BlogBundle\MyStaticValidatorClass class. It's passed both the original object being validated (e.g. Author) as well as the ExecutionContext:</p>
<pre><code>namespace Acme\BlogBundle;

use Symfony\Component\Validator\ExecutionContext;
use Acme\BlogBundle\Entity\Author;

class MyStaticValidatorClass
{
    static public function isAuthorValid(Author $author, ExecutionContext $context)
    {
    // ...
    }
}
</code></pre>
<h4>Translating constraint messages</h4>
<p>Create a translation file under the validators catalog for the constraint messages, typically in the Resources/translations/ directory of the bundle.</p>
<pre><code> &lt;!-- validators.es.xliff --&gt;
&lt;?xml version="1.0"?&gt;
&lt;xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2"&gt;
&lt;file source-language="en" datatype="plaintext" original="file.ext"&gt;
&lt;body&gt;
&lt;trans-unit id="1"&gt;
&lt;source&gt;author.gender.choice&lt;/source&gt;
&lt;target&gt;Escoge un género válido.&lt;/target&gt;
&lt;/trans-unit&gt;
&lt;/body&gt;
&lt;/file&gt;
&lt;/xliff&gt;
</code></pre>
<h3>Validation groups</h3>
<pre><code># src/Acme/BlogBundle/Resources/config/validation.yml
Acme\BlogBundle\Entity\User:
    properties:
        email:
            - Email: { groups: [registration] }
    password:
        - NotBlank: { groups: [registration] }
        - MinLength: { limit: 7, groups: [registration] }
    city:
        - MinLength: 2
</code></pre>
<p>With this configuration, there are two validation groups:</p>
<ul>
<li>Default - contains the constraints not assigned to any other group;</li>
<li>
<p>registration - contains the constraints on the email and password fields only.</p>
<pre><code>$errors = $validator-&gt;validate($author, array('registration'));
            </code></pre>
</li>
</ul>
<h3>Validating Values and Arrays</h3>
<p>Sometimes, you just want to validate a simple value - like to verify that a string is a valid email address.</p>
<pre><code>// add this to the top of your class
use Symfony\Component\Validator\Constraints\Email;

public function addEmailAction($email)
{
    $emailConstraint = new Email();

    // all constraint "options" can be set this way
    $emailConstraint-&gt;message = 'Invalid email address';

    // use the validator to validate the value
    $errorList = $this-&gt;get('validator')-&gt;validateValue($email, $emailConstraint);

    if (count($errorList) == 0) {
        // this IS a valid email address, do something
    } else {
        // this is *not* a valid email address
        $errorMessage = $errorList[0]-&gt;getMessage()
        // ... do something with the error
    }
    // ...
}
</code></pre>
<hr>
<h2 id="forms">FORMS <a href="#top" class="small">back to top</a></h2>
<h3>Creating simple forms</h3>
<pre><code>// src/Acme/TaskBundle/Controller/DefaultController.php
namespace Acme\TaskBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Acme\TaskBundle\Entity\Task;
use Symfony\Component\HttpFoundation\Request;

class DefaultController extends Controller
{
    public function newAction(Request $request)
    {
    // create a task and give it some dummy data for this example
    $task = $this-&gt;createForm(new Task());
    $task-&gt;setTask('Write a blog post');
    $task-&gt;setDueDate(new \DateTime('tomorrow'));

    $form = $this-&gt;createFormBuilder($task)
        -&gt;add('task', 'text')
        -&gt;add('dueDate', 'date')
        -&gt;getForm();

    return $this-&gt;render('AcmeTaskBundle:Default:new.html.twig', array(
        'form' =&gt; $form-&gt;createView()
    ));

    }
}
</code></pre>
<h3>Creating form classes and embedding subform</h3>
<pre><code>// src/Acme/TaskBundle/Form/Type/TaskType.php
namespace Acme\TaskBundle\Form\Type;

use Symfony\Component\Form\AbstractType;
use Symfony\Component\Form\FormBuilderInterface;
use Symfony\Component\OptionsResolver\OptionsResolverInterface;

class TaskType extends AbstractType
{
    public function buildForm(FormBuilderInterface $builder, array $options)
    {
        $builder-&gt;add('task');
        $builder-&gt;add('dueDate', null, array('widget' =&gt; 'single_text'));

        //Any extra field not mapped to the object must define property_path.
        $builder-&gt;add('agree','checkbox', array('property_path' =&gt; false));

        //Embedding one form, you need to create first the categoryType class as usual.
        $builder-&gt;add('category', new CategoryType());

        //Embedding a collection of TAGS forms. You already have a tagType form.
        $builder-&gt;add('tags', 'collection', array('type' =&gt; new TagType()));

    }

    public function getName()
    {
        return 'task'; //must be unique.
    }

    //Symfony can guess the type but it is a good practice to always set de data_class because embedding forms is necessary.
    public function setDefaultOptions(OptionsResolverInterface $resolver)
    {
        $resolver-&gt;setDefaults(array(
            'data_class' =&gt; 'Acme\TaskBundle\Entity\Task',
            'cascade_validation' =&gt; true, //needed to validate embeed forms.
            'validation_groups' =&gt; array('registration'), //use of validation groups.
            'csrf_protection' =&gt; true,
            'csrf_field_name' =&gt; '_token',
            // a unique key to help generate the secret token
            'intention' =&gt; 'task_item',
        ));
    }

}
</code></pre>
<p>Field Type Options</p>
<pre><code>-&gt;add('dueDate', 'date', array(
    'widget' =&gt; 'single_text',
    'label' =&gt; 'Due Date'
))
</code></pre>
<p>The field data can be accessed in a controller with:</p>
<pre><code>$form-&gt;get('dueDate')-&gt;getData();
</code></pre>
<p>If, for some reason, you don't have access to your original $task object, you can fetch it from the form:</p>
<pre><code>$task = $form-&gt;getData();
</code></pre>
<p>Using form classes in a controller:</p>
<pre><code>$form = $this-&gt;createForm(new TaskType(), new Task());

// process the form on POST
if ($request-&gt;isMethod('POST')) {

//you can access POST variables directly
$this-&gt;get('request')-&gt;request-&gt;get('name');

$form-&gt;bind($request);

if ($form-&gt;isValid()) {
    $em = $this-&gt;getDoctrine()-&gt;getManager();
    $em-&gt;persist($task);
    $em-&gt;flush();
}
}

return $this-&gt;render('AcmeTaskBundle:Task:new.html.twig', array(
    'form' =&gt; $form-&gt;createView()
));
</code></pre>
<h3>Groups based on Submitted Data</h3>
<p>The ability to specify a callback or Closure in validation_groups is new to version 2.1</p>
<pre><code>public function setDefaultOptions(OptionsResolverInterface $resolver)
{
    $resolver-&gt;setDefaults(array(
        'validation_groups' =&gt; array('Acme\\AcmeBundle\\Entity\\Client', 'determineValidationGroups'),
    ));
}
</code></pre>
<p>This will call the static method determineValidationGroups() on the Client class after the form is bound, but before validation is executed.
The Form object is passed as an argument to that method (see next example). You can also define whole logic inline by using a Closure:</p>
<p>You can use inline post validation also:</p>
<pre><code>public function setDefaultOptions(OptionsResolverInterface $resolver)
{
    $resolver-&gt;setDefaults(array(
        'validation_groups' =&gt; function(FormInterface $form) {
            $data = $form-&gt;getData();
            if (Entity\Client::TYPE_PERSON == $data-&gt;getType()) {
                return array('person');
            } else {
                return array('company');
            }
        },
    ));
}
</code></pre>
<h3>Rendering forms in TWIG</h3>
<p>First of all check all Form Type References</p>
<p>
<a href="http://symfony.com/doc/current/reference/forms/types.html">http://symfony.com/doc/current/reference/forms/types.html</a>
</p>
<div class="row">
<div class="span6">
<p><strong>Text field</strong></p>
<table>
<tbody><tr>
<th>Widget</th>
<th>Widget</th>
</tr>
<tr>
<td>text</td>
<td>textarea</td>
</tr>
<tr>
<td>textarea</td>
<td>integer</td>
</tr>
<tr>
<td>email</td>
<td>money</td>
</tr>
<tr>
<td>number</td>
<td>password</td>
</tr>
<tr>
<td>percent</td>
<td>search</td>
</tr>
</tbody></table>
<p><strong>Choice fields</strong></p>
<table>
<tbody><tr>
<th>Widget</th>
<th>Widget</th>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/choice.html">choice</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/entity.html">entity</a></td>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/country.html">country</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/language.html">language</a></td>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/locale.html">locale</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/timezone.html">timezone</a></td>
</tr>
</tbody></table>
</div>
<div class="span6">
<p><strong>Date and datetime fields</strong></p>
<table>
<tbody><tr>
<th>Widget</th>
<th>Widget</th>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/date.html">date</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/datetime.html">datetime</a></td>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/time.html">time</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/birthday.html">birthday</a></td>
</tr>
</tbody></table>
<p><strong>Other fields</strong></p>
<table>
<tbody><tr>
<th>Widget</th>
<th>Widget</th>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/checkbox.html">checkbox</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/file.html">file</a></td>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/radio.html">radio</a></td>
<td></td>
</tr>
</tbody></table>
<p><strong>Field groups</strong></p>
<table>
<tbody><tr>
<th>Widget</th>
<th>Widget</th>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/collection.html">collection</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/repeated.html">repeated</a></td>
</tr>
</tbody></table>
<p><strong>Hidden fields</strong></p>
<table>
<tbody><tr>
<th>Widget</th>
<th>Widget</th>
</tr>
<tr>
<td><a href="http://symfony.com/doc/current/reference/forms/types/hidden.html">hidden</a></td>
<td><a href="http://symfony.com/doc/current/reference/forms/types/csrf.html">csrf</a></td>
</tr>
</tbody></table>
</div>
</div>
<h4>Simple and fast</h4>
<pre><code>&lt;form action="{{ path('task_new') }}" method="post" {{ form_enctype(form) }}&gt;
{{ form_widget(form) }}
&lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
<h4>Rows</h4>
<pre><code>&lt;form action="{{ path('task_new') }}" method="post" {{ form_enctype(form) }}&gt;
{{ form_errors(form) }}

{{ form_row(form.task) }}
{{ form_row(form.dueDate) }}

{{ form_rest(form) }}

&lt;input type="submit" /&gt;
&lt;/form&gt;
</code></pre>
<h4>Manual</h4>
<pre><code>&lt;form action="{{ path('task_new') }}" method="post" {{ form_enctype(form) }}&gt;
{{ form_errors(form) }}
&lt;div&gt;
    {{ form_label(form.task,'custom label') }}
    {{ form_errors(form.task) }}
    {{ form_widget(form.task, { 'attr': {'class': 'span3'} })) }}
&lt;/div&gt;
&lt;div&gt;
    {{ form_label(form.dueDate) }}
    {{ form_errors(form.dueDate) }}
    {{ form_widget(form.dueDate) }}
&lt;/div&gt;

{# Render one embedded form #}
&lt;h3&gt;Category&lt;/h3&gt;
&lt;div class="category"&gt;
    {{ form_row(form.category.name) }}
&lt;/div&gt;

{# Render multiple embedded forms #}
&lt;h3&gt;Tags&lt;/h3&gt;
&lt;ul class="tags"&gt;
    {% for tag in form.tags %}
    &lt;li&gt;{{ form_row(tag.name) }}&lt;/li&gt;
    {% endfor %}
&lt;/ul&gt;

{{ form_rest(form) }}

&lt;/form&gt;
</code></pre>
<h4>Access "name" and "id" attributes</h4>
<pre><code>{{ form.task.vars.id }}
{{ form.task.vars.full_name }}
</code></pre>
<p>You can access current data of your form via:</p>
<pre><code>{{ form.vars.value.task }}
</code></pre>
<h3>Form Theming</h3>
<p>In Twig, each form "fragment" is represented by a Twig block. To customize any part of how a form renders, you just need to override the appropriate block.</p>
<p>To understand how this works, let's customize the form_row fragment and add a class attribute to the div element that surrounds each row. To do this, create a new template file that will store the new markup:</p>
<pre><code>{# src/Acme/TaskBundle/Resources/views/Form/fields.html.twig #}
{% block form_row %}
    {% spaceless %}
    &lt;div class="form_row"&gt;
        {{ form_label(form) }}
        {{ form_errors(form) }}
        {{ form_widget(form) }}
    &lt;/div&gt;
    {% endspaceless %}
{% endblock form_row %}
</code></pre>
<p>To tell the form component to use your new form_row fragment defined above, add the following to the top of the template that renders the form:</p>
<pre><code>{# src/Acme/TaskBundle/Resources/views/Default/new.html.twig #}
{% form_theme form 'AcmeTaskBundle:Form:fields.html.twig' %}
{% form_theme form 'AcmeTaskBundle:Form:fields.html.twig' 'AcmeTaskBundle:Form:fields2.html.twig' %}
&lt;form ...&gt;
</code></pre>
<p>New in version 2.1: An alternate Twig syntax for form_theme has been introduced in 2.1. It accepts any valid Twig expression (the most noticeable difference is using an array when using multiple themes).</p>
<pre><code>{# src/Acme/TaskBundle/Resources/views/Default/new.html.twig #}
{% form_theme form with 'AcmeTaskBundle:Form:fields.html.twig' %}
{% form_theme form with ['AcmeTaskBundle:Form:fields.html.twig', 'AcmeTaskBundle:Form:fields2.html.twig'] %}
</code></pre>
<p>You can see all form fragments from twig followin this link:
<a href="https://github.com/symfony/symfony/tree/master/src/Symfony/Bundle/FrameworkBundle/Resources/views/Form">https://github.com/symfony/symfony/tree/master/src/Symfony/Bundle/FrameworkBundle/Resources/views/Form</a>
</p>
<p>If your form customizations live inside an external template, you can reference the base block by using the parent() Twig function:</p>
<pre><code>{# src/Acme/DemoBundle/Resources/views/Form/fields.html.twig #}
{% extends 'form_div_layout.html.twig' %}

{% block integer_widget %}
&lt;div class="integer_widget"&gt;
    {{ parent() }}
&lt;/div&gt;
{% endblock %}
</code></pre>
<p>If you'd like a certain form customization to be global to your application, you can accomplish this by making the form customizations in an external template and then importing it inside your application configuration:</p>
<pre><code># app/config/config.yml
    twig:
        form:
            resources:
                - 'AcmeDemoBundle:Form:fields.html.twig'
</code></pre>
<p>See more in:
<a href="http://symfony.com/doc/current/cookbook/form/form_customization.html">http://symfony.com/doc/current/cookbook/form/form_customization.html</a>
</p>
<hr>
<h2 id="security">SECURITY <a href="#top" class="small">back to top</a></h2>
<p>Security is a two-step process whose goal is to prevent a user from accessing a resource that he/she should not have access to.</p>
<p><strong>Authentication</strong></p>
<ul>
<li>Login form</li>
<li>HTTP Authentication</li>
<li>HTTP digest</li>
<li>X.509 certs</li>
<li>Custom auth methods</li>
</ul>
<p><strong>Authorization</strong></p>
<ul>
<li>Access control for URL</li>
<li>Secure object and methods</li>
<li>Access control lists (ACLs)</li>
</ul>
<h3>Basic Example: HTTP Authentication</h3>
<pre><code># app/config/security.yml
security:
    firewalls:
        secured_area:
            pattern:    ^/
            anonymous: ~
            http_basic:
                realm: "Secured Demo Area"

    access_control:
        - { path: ^/admin, roles: ROLE_ADMIN }

    providers:
        in_memory:
            memory:
                users:
                    ryan:  { password: ryanpass, roles: 'ROLE_USER' }
                    admin: { password: kitten, roles: 'ROLE_ADMIN' }

    encoders:
        Symfony\Component\Security\Core\User\User: plaintext
</code></pre>
<h3>Using a Traditional Login Form</h3>
<pre><code># app/config/security.yml
security:
    firewalls:
        secured_area:
            pattern:    ^/
            anonymous: ~
            form_login:
                login_path:  /login
                check_path:  /login_check
</code></pre>
<p>If you don't need to customize your login_path or check_path values (the values used here are the default values), you can shorten your configuration:</p>
<pre><code>form_login: ~
</code></pre>
<p>Now we need to create the login routes:</p>
<pre><code># app/config/routing.yml
login:
    pattern: /login
    defaults: { _controller: AcmeSecurityBundle:Security:login }

login_check:
    pattern: /login_check
</code></pre>
<p>Next, create the controller that will display the login form:</p>
<pre><code>// src/Acme/SecurityBundle/Controller/SecurityController.php;
namespace Acme\SecurityBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\Security\Core\SecurityContext;

class SecurityController extends Controller
{
   public function loginAction()
   {
       $request = $this-&gt;getRequest();
       $session = $request-&gt;getSession();

       // get the login error if there is one
       if ($request-&gt;attributes-&gt;has(SecurityContext::AUTHENTICATION_ERROR)) {
           $error = $request-&gt;attributes-&gt;get(SecurityContext::AUTHENTICATION_ERROR);
       } else {
           $error = $session-&gt;get(SecurityContext::AUTHENTICATION_ERROR);
           $session-&gt;remove(SecurityContext::AUTHENTICATION_ERROR);
       }

       return $this-&gt;render('AcmeSecurityBundle:Security:login.html.twig', array(
           // last username entered by the user
           'last_username' =&gt; $session-&gt;get(SecurityContext::LAST_USERNAME),
           'error'         =&gt; $error,
       ));
   }
}
</code></pre>
<p>Finally, create the corresponding template:</p>
<pre><code>{# src/Acme/SecurityBundle/Resources/views/Security/login.html.twig #}
{% if error %}
    &lt;div&gt;{{ error.message }}&lt;/div&gt;
{% endif %}

&lt;form action="{{ path('login_check') }}" method="post"&gt;
    &lt;label for="username"&gt;Username:&lt;/label&gt;
    &lt;input type="text" id="username" name="_username" value="{{ last_username }}" /&gt;

    &lt;label for="password"&gt;Password:&lt;/label&gt;
    &lt;input type="password" id="password" name="_password" /&gt;

    {#If you want to control the URL the user is redirected to on success (more details below) #}
    &lt;input type="hidden" name="_target_path" value="/account" /&gt;

    &lt;button type="submit"&gt;login&lt;/button&gt;
    &lt;/form&gt;
</code></pre>
<h3>Securing Specific URL Patterns</h3>
<p>The most basic way to secure part of your application is to secure an entire URL pattern. You've seen this already in the first example of this chapter, where anything matching the regular expression pattern ^/admin requires the ROLE_ADMIN role.</p>
<pre><code># app/config/security.yml
security:
    # ...
    access_control:
        - { path: ^/admin/users, roles: ROLE_SUPER_ADMIN }
        - { path: ^/admin, roles: ROLE_ADMIN }
</code></pre>
<h3>Securing by IP</h3>
<p>Here is an example of how you might secure this route from outside access:</p>
<pre><code># app/config/security.yml
security:
# ...
access_control:
    - { path: ^/_internal, roles: IS_AUTHENTICATED_ANONYMOUSLY, ip: 127.0.0.1 }
</code></pre>
<h3>Securing by Channel</h3>
<pre><code># app/config/security.yml
security:
# ...
access_control:
    - { path: ^/cart/checkout, roles: IS_AUTHENTICATED_ANONYMOUSLY, requires_channel: https }
</code></pre>
<h3>Securing a Controller</h3>
<pre><code>/ ...
use Symfony\Component\Security\Core\Exception\AccessDeniedException;

public function helloAction($name)
{
    if (false === $this-&gt;get('security.context')-&gt;isGranted('ROLE_ADMIN')) {
        throw new AccessDeniedException();
    }

// ...
}
</code></pre>
<p>You can also choose to install and use the optional JMSSecurityExtraBundle, which can secure your controller using annotations:</p>
<pre><code>// ...
use JMS\SecurityExtraBundle\Annotation\Secure;

/**
* @Secure(roles="ROLE_ADMIN")
*/
public function helloAction($name)
{
// ...
}
</code></pre>
<h3>Users</h3>
<p><strong>User Providers</strong></p>
<pre><code># app/config/security.yml
security:
    # ...
    providers:
        default_provider:
            memory:
                users:
                    ryan: { password: ryanpass, roles: 'ROLE_USER' }
                    admin: { password: kitten, roles: 'ROLE_ADMIN' }
</code></pre>
<p><strong>Loading Users from the Database</strong></p>
<p>Next, configure an entity user provider, and point it to your User class:</p>
<pre><code># app/config/security.yml
security:
providers:
    main:
        entity: { class: Acme\UserBundle\Entity\User, property: username }
</code></pre>
<h3>Encoding the User's Password</h3>
<pre><code># app/config/security.yml
security:
    # ...
    providers:
        in_memory:
            memory:
                users:
                    ryan:  { password: bb87a29949f3a1ee0559f8a57357487151281386, roles: 'ROLE_USER' }
                    admin: { password: 74913f5cd5f61ec0bcfdb775414c2fb3d161b620, roles: 'ROLE_ADMIN' }

    encoders:
        Symfony\Component\Security\Core\User\User:
            algorithm:   sha1
            iterations: 1
            encode_as_base64: false
        Acme\UserBundle\Entity\User: sha512 //user comes from database
</code></pre>
<p>To encode the password you can use some online functions such as
<a href="http://www.functions-online.com/sha1.html">functions-online.com</a></p>
<h3>Determine the hasing password in a controller</h3>
<pre><code>$factory = $this-&gt;get('security.encoder_factory');
$user = new Acme\UserBundle\Entity\User();

$encoder = $factory-&gt;getEncoder($user);
$password = $encoder-&gt;encodePassword('ryanpass', $user-&gt;getSalt());
$user-&gt;setPassword($password);
</code></pre>
<h3>Retrieving the User Object</h3>
<p>After authentication, the User object of the current user can be accessed via the security.context service.</p>
<pre><code>public function indexAction()
{
    $user = $this-&gt;get('security.context')-&gt;getToken()-&gt;getUser();
    //or
    $user = $this-&gt;getUser();
}
</code></pre>
<p>You can also retrieve current user in a twig template by:</p>
<pre><code>&lt;p&gt;Username: {{ app.user.username }}&lt;/p&gt;
</code></pre>
<h3>Using Multiple User Providers</h3>
<pre><code># app/config/security.yml
security:
    providers:
        chain_provider:
            chain:
                providers: [in_memory, user_db]
        in_memory:
            memory:
                users:
                    foo: { password: test }
        user_db:
            entity: { class: Acme\UserBundle\Entity\User, property: username }
</code></pre>
<p>You can also configure the firewall or individual authentication mechanisms to use a specific provider. Again, unless a provider is specified explicitly, the first provider is always used:</p>
<pre><code># app/config/security.yml
security:
    firewalls:
        secured_area:
            # ...
            provider: user_db
            http_basic:
                realm: "Secured Demo Area"
                provider: in_memory
            form_login: ~
</code></pre>
<p>For more information about user provider and firewall configuration, see the
<a href="http://symfony.com/doc/current/reference/configuration/security.html">Security Configuration Reference</a>.
</p>
<h3>Roles</h3>
<pre><code># app/config/security.yml
security:
    role_hierarchy:
        ROLE_ADMIN:       ROLE_USER
        ROLE_SUPER_ADMIN: [ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH]
</code></pre>
<h3>Logging Out</h3>
<pre><code># app/config/security.yml
security:
    firewalls:
        secured_area:
            # ...
            logout:
                path:   /logout
                target: /
</code></pre>
<p>and define the route:</p>
<pre><code># app/config/routing.yml
logout:
    pattern: /logout
</code></pre>
<h3>Access Control in Templates</h3>
<p><strong>Twig</strong></p>
<pre><code>{% if is_granted('ROLE_ADMIN') %}
    &lt;a href="..."&gt;Delete&lt;/a&gt;
{% endif %}
</code></pre>
<h3>Access Control in Controllers</h3>
<pre><code>public function indexAction()
{
    // show different content to admin users
    if ($this-&gt;get('security.context')-&gt;isGranted('ROLE_ADMIN')) {
        // Load admin content here
    }
    // load other regular content here
}
</code></pre>
<h3>Switching users</h3>
<p>Sometimes, it's useful to be able to switch from one user to another without having to logout and login again (for instance when you are debugging or trying to understand a bug a user sees that you can't reproduce). This can be easily done by activating the switch_user firewall listener:</p>
<pre><code># app/config/security.yml
security:
    firewalls:
        main:
            # ...
            switch_user: true
</code></pre>
<p>Switch user by:</p>
<pre><code>http://example.com/somewhere?_switch_user=thomas
</code></pre>
<p>and back to normal user:</p>
<pre><code>http://example.com/somewhere?_switch_user=_exit
</code></pre>
<p>Secure this behaviour:</p>
<pre><code># app/config/security.yml
security:
    firewalls:
        main:
            # ...
            switch_user: { role: ROLE_ADMIN, parameter: _want_to_be_this_user }
</code></pre>
<hr>
<h2 id="cache">HTTP Cache <a href="#top" class="small">back to top</a></h2>
<p>For the purposes of learning how to cache with Symfony2, we'll cover the subject in four steps:</p>
<ul>
<li><strong>Step 1:</strong> A gateway cache, or reverse proxy, is an independent layer that sits in front of your application. The reverse proxy caches responses as they're returned from your application and answers requests with cached responses before they hit your application. Symfony2 provides its own reverse proxy, but any reverse proxy can be used.</li>
<li><strong>Step 2:</strong> HTTP cache headers are used to communicate with the gateway cache and any other caches between your application and the client. Symfony2 provides sensible defaults and a powerful interface for interacting with the cache headers.</li>
<li><strong>Step 3:</strong> HTTP expiration and validation are the two models used for determining whether cached content is fresh (can be reused from the cache) or stale (should be regenerated by the application).</li>
<li><strong>Step 4:</strong> Edge Side Includes (ESI) allow HTTP cache to be used to cache page fragments (even nested fragments) independently. With ESI, you can even cache an entire page for 60 minutes, but an embedded sidebar for only 5 minutes.</li>
</ul>
<h3>Caching with a Gateway Cache</h3>
<p>To enable caching, modify the code of a front controller to use the caching kernel:</p>
<pre><code>// web/app.php
require_once __DIR__.'/../app/bootstrap.php.cache';
require_once __DIR__.'/../app/AppKernel.php';
require_once __DIR__.'/../app/AppCache.php';

use Symfony\Component\HttpFoundation\Request;

$kernel = new AppKernel('prod', false);
$kernel-&gt;loadClassCache();
// wrap the default AppKernel with the AppCache one
$kernel = new AppCache($kernel);
$request = Request::createFromGlobals();
$response = $kernel-&gt;handle($request);
$response-&gt;send();
$kernel-&gt;terminate($request, $response);
</code></pre>
<p>The cache kernel has a special getLog() method that returns a string representation of what happened in the cache layer. In the development environment, use it to debug and validate your cache strategy:</p>
<pre><code>error_log($kernel-&gt;getLog());
</code></pre>
<h3>Introduction to HTTP Caching</h3>
<p>HTTP specifies four response cache headers that we're concerned with:</p>
<ul>
<li>Cache-Control</li>
<li>Expires</li>
<li>ETag</li>
<li>Last-Modified</li>
</ul>
<p><strong>The Cache-Control Header</strong></p>
<p>The Cache-Control header is unique in that it contains not one, but various pieces of information about the cacheability of a response. Each piece of information is separated by a comma:</p>
<pre><code>Cache-Control: private, max-age=0, must-revalidate
Cache-Control: max-age=3600, must-revalidate
</code></pre>
<p>Symfony provides abstraction layer:</p>
<pre><code>$response = new Response();

// mark the response as either public or private
$response-&gt;setPublic();
$response-&gt;setPrivate();

// set the private or shared max age
$response-&gt;setMaxAge(600);
$response-&gt;setSharedMaxAge(600);

// set a custom Cache-Control directive
$response-&gt;headers-&gt;addCacheControlDirective('must-revalidate', true);
</code></pre>
<p><strong>Public vs Private Responses</strong></p>
<p>Both gateway and proxy caches are considered "shared" caches as the cached content is shared by more than one user. If a user-specific response were ever mistakenly stored by a shared cache, it might be returned later to any number of different users. Imagine if your account information were cached and then returned to every subsequent user who asked for their account page!</p>
<pre><code>public: Indicates that the response may be cached by both private and shared caches;
private: Indicates that all or part of the response message is intended for a single user and must not be cached by a shared cache.
</code></pre>
<p>HTTP caching only works for "safe" HTTP methods (like GET and HEAD). Being safe means that you never change the application's state on the server when serving the request (you can of course log information, cache data, etc).</p>
<p><strong>Caching Rules and Defaults</strong></p>
<p>Symfony2 automatically sets a sensible and conservative Cache-Control header when none is set by the developer by following these rules:</p>
<ul>
<li>If no cache header is defined (Cache-Control, Expires, ETag or Last-Modified), Cache-Control is set to no-cache, meaning that the response will not be cached;</li>
<li>If Cache-Control is empty (but one of the other cache headers is present), its value is set to private, must-revalidate;</li>
<li>But if at least one Cache-Control directive is set, and no 'public' or private directives have been explicitly added, Symfony2 adds the private directive automatically (except when s-maxage is set).</li>
</ul>
<p><strong>Expiration with Expires Header</strong></p>
<pre><code>$date = new DateTime();
$date-&gt;modify('+600 seconds');
$response-&gt;setExpires($date);
</code></pre>
<p><strong>Expiration with the Cache-Control Header</strong></p>
<pre><code>/ Sets the number of seconds after which the response
// should no longer be considered fresh
$response-&gt;setMaxAge(600);

// Same as above but only for shared caches
$response-&gt;setSharedMaxAge(600);
</code></pre>
<p><strong>Validation the the ETag Header</strong></p>
<p>The ETag header is a string header (called the "entity-tag") that uniquely identifies one representation of the target resource. It's entirely generated and set by your application so that you can tell, for example, if the /about resource that's stored by the cache is up-to-date with what your application would return. An ETag is like a fingerprint and is used to quickly compare if two different versions of a resource are equivalent. Like fingerprints, each ETag must be unique across all representations of the same resource.</p>
<pre><code>public function indexAction()
{
    $response = $this-&gt;render('MyBundle:Main:index.html.twig');
    $response-&gt;setETag(md5($response-&gt;getContent()));
    $response-&gt;setPublic(); // make sure the response is public/cacheable
    $response-&gt;isNotModified($this-&gt;getRequest());

    return $response;
}
</code></pre>
<p><strong>Validation with the Last-Modified Header</strong></p>
<p>The Last-Modified header is the second form of validation. According to the HTTP specification, "The Last-Modified header field indicates the date and time at which the origin server believes the representation was last modified."</p>
<pre><code>public function showAction($articleSlug)
{
    // ...

    $articleDate = new \DateTime($article-&gt;getUpdatedAt());
    $authorDate = new \DateTime($author-&gt;getUpdatedAt());

    $date = $authorDate &gt; $articleDate ? $authorDate : $articleDate;

    $response-&gt;setLastModified($date);
    // Set response as public. Otherwise it will be private by default.
    $response-&gt;setPublic();

    if ($response-&gt;isNotModified($this-&gt;getRequest())) {
        return $response;
    }

    // do more work to populate the response will the full content

    return $response;
}
</code></pre>
<p>The main goal of any caching strategy is to lighten the load on the application. Put another way, the less you do in your application to return a 304 response, the better. The Response::isNotModified() method does exactly that by exposing a simple and efficient pattern:</p>
<pre><code>public function showAction($articleSlug)
{
    // Get the minimum information to compute
    // the ETag or the Last-Modified value
    // (based on the Request, data is retrieved from
    // a database or a key-value store for instance)
    $article = ...;

    // create a Response with a ETag and/or a Last-Modified header
    $response = new Response();
    $response-&gt;setETag($article-&gt;computeETag());
    $response-&gt;setLastModified($article-&gt;getPublishedAt());

    // Set response as public. Otherwise it will be private by default.
    $response-&gt;setPublic();

    // Check that the Response is not modified for the given Request
    if ($response-&gt;isNotModified($this-&gt;getRequest())) {
    // return the 304 Response immediately
        return $response;
    } else {
        // do more work here - like retrieving more data
        $comments = ...;

        // or render a template with the $response you've already started
        return $this-&gt;render(
            'MyBundle:MyController:article.html.twig',
            array('article' =&gt; $article, 'comments' =&gt; $comments),
            $response
        );
    }
}
</code></pre>
<p><strong>Varying the Response</strong></p>
<p>So far, we've assumed that each URI has exactly one representation of the target resource. By default, HTTP caching is done by using the URI of the resource as the cache key. If two people request the same URI of a cacheable resource, the second person will receive the cached version.
Sometimes this isn't enough and different versions of the same URI need to be cached based on one or more request header values. For instance, if you compress pages when the client supports it, any given URI has two representations: one when the client supports compression, and one when it does not. This determination is done by the value of the Accept-Encoding request header.</p>
<pre><code>// set one vary header
$response-&gt;setVary('Accept-Encoding');

// set multiple vary headers
$response-&gt;setVary(array('Accept-Encoding', 'User-Agent'));

// Marks the Response stale
$response-&gt;expire();

// Force the response to return a proper 304 response with no content
$response-&gt;setNotModified();
</code></pre>
<h3>Using Edge Side Includes</h3>
<p>Gateway caches are a great way to make your website perform better. But they have one limitation: they can only cache whole pages. If you can't cache whole pages or if parts of a page has "more" dynamic parts, you are out of luck. Fortunately, Symfony2 provides a solution for these cases, based on a technology called ESI, or Edge Side Includes. Akamaï wrote this specification almost 10 years ago, and it allows specific parts of a page to have a different caching strategy than the main page.</p>
<pre><code># app/config/config.yml
framework:
    # ...
    esi: { enabled: true }
</code></pre>
<p>Let's suppose that we hace an static page with a dynamic tickets section:</p>
<pre><code>public function indexAction()
{
    $response = $this-&gt;render('MyBundle:MyController:index.html.twig');
    // set the shared max age - which also marks the response as public
    $response-&gt;setSharedMaxAge(600);
    return $response;
}
</code></pre>
<p>Now, let's embedd the ticket content using twig render's tag.</p>
<pre><code>{% render '...:news' with {}, {'standalone': true} %}
</code></pre>
<p>Using the
<strong>standalone</strong> true tells symfony to use ESI tags. The embedded action can now specify its own caching rules, entirely independent of the master page.
</p>
<pre><code>public function newsAction()
{
// ...
$response-&gt;setSharedMaxAge(60);
}
</code></pre>
<p>For the ESI include tag to work properly, you must define the _internal route:</p>
<pre><code># app/config/routing.yml
_internal:
    resource: "@FrameworkBundle/Resources/config/routing/internal.xml"
    prefix: /_internal
</code></pre>
<p>Learn more
<a href="http://symfony.com/doc/current/cookbook/cache/varnish.html">How to use Varnish to speed up my Website</a>
</p>
<hr>
<h2 id="translations">Translation <a href="#top" class="small">back to top</a></h2>
<p>Translations are handled by a Translator service that uses the user's locale to lookup and return translated messages. Before using it, enable the Translator in your configuration:</p>
<pre><code># app/config/config.yml
framework:
    translator: { fallback: en }
    default_locale: en
</code></pre>
<p><strong>Basic translation</strong></p>
<pre><code>$t = $this-&gt;get('translator')-&gt;trans('Symfony2 is great');
$t = $this-&gt;get('translator')-&gt;trans('Hello %name%', array('%name%' =&gt; $name));
</code></pre>
<p>When this code is executed, Symfony2 will attempt to translate the message "Symfony2 is great" based on the locale of the user.</p>
<pre><code>&lt;!-- messages.fr.xliff --&gt;
&lt;?xml version="1.0"?&gt;
&lt;xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2"&gt;
    &lt;file source-language="en" datatype="plaintext" original="file.ext"&gt;
        &lt;body&gt;
            &lt;trans-unit id="1"&gt;
            &lt;source&gt;Symfony2 is great&lt;/source&gt;
            &lt;target&gt;J'aime Symfony2&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id="2"&gt;
            &lt;source&gt;Hello %name%&lt;/source&gt;
            &lt;target&gt;Bonjour %name%&lt;/target&gt;
            &lt;/trans-unit&gt;
        &lt;/body&gt;
    &lt;/file&gt;
&lt;/xliff&gt;
</code></pre>
<p>Each time you create a new translation resource (or install a bundle that includes a translation resource), be sure to clear your cache so that Symfony can discover the new translation resource:</p>
<p><strong>Using Real or Keyword Messages</strong></p>
<pre><code>$t = $translator-&gt;trans('Symfony2 is great');
$t = $translator-&gt;trans('symfony2.great');
</code></pre>
<p>In the first method, messages are written in the language of the default locale (English in this case). That message is then used as the "id" when creating translations.
In the second method, messages are actually "keywords" that convey the idea of the message. The keyword message is then used as the "id" for any translations. In this case, translations must be made for the default locale (i.e. to translate symfony2.great to Symfony2 is great).</p>
<pre><code>symfony2.is.great: Symfony2 is great
symfony2.is.amazing: Symfony2 is amazing
symfony2.has.bundles: Symfony2 has bundles
user.login: Login
</code></pre>
<p><strong>Using Message Domains</strong></p>
<p>When translating strings that are not in the default domain (messages), you must specify the domain as the third argument of trans():</p>
<pre><code>* messages.fr.xliff
* admin.fr.xliff
* navigation.fr.xliff

$this-&gt;get('translator')-&gt;trans('Symfony2 is great', array(), 'admin');
</code></pre>
<p><strong>Pluralization</strong></p>
<p>To translate pluralized messages, use the transChoice() method:</p>
<pre><code>$t = $this-&gt;get('translator')-&gt;transChoice(
    'There is one apple|There are %count% apples',
    10,
    array('%count%' =&gt; 10)
);
</code></pre>
<h3>Translations in Templates</h3>
<p>Translating in Twig templates example:</p>
<pre><code>//you can set de translation domain for entire twig temples
{% trans_default_domain "app" %}

{% trans %}Hello %name%{% endtrans %}

{% transchoice count %}
    {0} There are no apples|{1} There is one apple|]1,Inf] There are %count% apples
{% endtranschoice %}

//variables traduction
{{ message|trans }}

{{ message|transchoice(5) }}

{{ message|trans({'%name%': 'Fabien'}, "app") }}

{{ message|transchoice(5, {'%name%': 'Fabien'}, 'app') }}
</code></pre>
<p>If you need to use the percent character (%) in a string, escape it by doubling it: {% trans %}Percent: %percent%%%{% endtrans %}</p>
<h3>Translating Database Content</h3>
<p>The translation of database content should be handled by Doctrine through the
<a href="https://github.com/l3pp4rd/DoctrineExtensions/blob/master/README.md">Translatable Extension</a></p>
<p><strong>Translating constraint messages</strong></p>
<pre><code># src/Acme/BlogBundle/Resources/config/validation.yml
Acme\BlogBundle\Entity\Author:
    properties:
        name:
            - NotBlank: { message: "author.name.not_blank" }
</code></pre>
<p>Create a translation file under the validators catalog:</p>
<pre><code>&lt;!-- validators.en.xliff --&gt;
&lt;?xml version="1.0"?&gt;
&lt;xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2"&gt;
    &lt;file source-language="en" datatype="plaintext" original="file.ext"&gt;
        &lt;body&gt;
            &lt;trans-unit id="1"&gt;
            &lt;source&gt;author.name.not_blank&lt;/source&gt;
            &lt;target&gt;Please enter an author name.&lt;/target&gt;
            &lt;/trans-unit&gt;
        &lt;/body&gt;
    &lt;/file&gt;
&lt;/xliff&gt;
</code></pre>
<hr>
<h2 id="services">Service Container <a href="#top" class="small">back to top</a></h2>
<p>A Service Container (or dependency injection container) is simply a PHP object that manages the instantiation of services (i.e. objects).</p>
<pre><code># src/Acme/HelloBundle/Resources/config/services.yml
parameters:
    newsletter_manager.class: Acme\HelloBundle\Newsletter\NewsletterManager
    my_mailer.transport: sendmail
    my_mailer.gateways:
        - mail1
        - mail2
        - mail3

services:
    my_mailer:
        class: "%my_mailer.class%"
        arguments: [%my_mailer.transport%]
    newsletter_manager:
        class: "%newsletter_manager.class%"
        arguments: [@my_mailer] //required contructor args. Use @ to refer another service.
        calls:
        - [ setMailer, [ @my_mailer ] ] //Optional dependencies.
        tags:
        - { name: twig.extension } //Twig finds all services tagged with twig.extension and automatically registers them as extensions.
</code></pre>
<p>Now we can set our class to be a real service:</p>
<pre><code>namespace Acme\HelloBundle\Newsletter;

use Symfony\Component\Templating\EngineInterface;

class NewsletterManager
{
    protected $mailer;
    protected $templating;

    public function __construct(\Swift_Mailer $mailer, EngineInterface $templating)
    {
        $this-&gt;mailer = $mailer;
        $this-&gt;templating = $templating;
    }

    // ...
}
</code></pre>
<p>And for this particual service the corresponding services.yml would be:</p>
<pre><code> services:
    newsletter_manager:
        class: "%newsletter_manager.class%"
        arguments: [@mailer, @templating]
</code></pre>
<p>In YAML, the special @my_mailer syntax tells the container to look for a service named my_mailer and to pass that object into the constructor of NewsletterManager. In this case, however, the specified service my_mailer must exist. If it does not, an exception will be thrown. You can mark your dependencies as optional - this will be discussed in the next section</p>
<p><strong>Making References Optional</strong></p>
<pre><code>services:
    newsletter_manager:
        class: "%newsletter_manager.class%"
        arguments: [@?my_mailer]
</code></pre>
<h3>Debugging services</h3>
<p>You can find out what services are registered with the container using the console. To show all services and the class for each service, run:</p>
<pre><code>$ php app/console container:debug
$ php app/console container:debug --show-private
$ php app/console container:debug my_mailer
</code></pre>
<p>See also:</p>
<ul>
<li>
<a href="http://symfony.com/doc/current/components/dependency_injection/parentservices.html">Managing Common Dependencies with Parent Services</a>
</li>
</ul>
</section>
</div>
</div>
<footer>
<div class="row">
<div class="span9">
Symfony2cheatsheet is maintained by
<a href="http://www.linkedin.com/in/davidperezvicens" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;LinkedIn&#39;]);" target="_blank">David Pérez</a><br>
</div>
<div class="span3" style="text-align: right">
<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;Creative Commons&#39;]);"><img alt="Licencia de Creative Commons" style="border-width:0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAblQTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gKCUmKCkoKSkpMDAwMS0uMjExMjMxNTY1Pj8+Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgaGVmcHBwcHJvdXJzdnN0eHV2eXx5fH98fX98fnt8gICAgoWChIGChIWEhIaEh4aHiYyJjIqLj4+PkY+PkZORkZSRk5iTlpmWmpiZnp2dnqCdn5+fn6Oeq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbawsbewsrexsrixs7iytLmztLqztbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIyc3Iyc3Jys3Jy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4+Pj7+/v8fHx////LOkBjgAAAAN0Uk5TAAoO5yEBUwAAA4BJREFUSMe1lotf0lAUx6kjIUGAlQ40oohqvSzRHmS+kh6WZYrZg8gwjVC0VQsbASXZXIpA9y/ubGPIxuCT9PF+2OfCb7vfnfu7556LYT/sSTMYACYmQ+E3sUWGXeXS2Ww69ZVlErG58PTkxPjY3eHBwYH+3TckI3cmMh9nkqkcL2zl81u/+dy3JBNfiMyI5ODw4EBTZAMg913iE5cTLjiN4iSMzovCzxS7HHuN5If3gkNKyD67eNvu0zJ0dQSHkMtmeL95xyBzL59NrsQi05OPHtwrh9xnA6A8HgrA1ldNqKMjODyfYLNCJ/JMbjoapd0m/Nq59CO5vBAOPUEzpJBvHgBXgWAruOBAFaGejuA38U8ZkWuiS0RuAUTblrJsfO751IQUcn+/Ddx4B0C8DbYdgKz3dGl1BMcYjkeuo0AqreTAmPkUE4tgyPdH0QsfuLYVMHFBxU8fHL6G3NYWb1Gli+DFLzk/ckuEqMm9P5OJt88nHz8IDg0M2KHqvQWwK+PtcMjacRzoS3BLpYtgJiWYwbROVK1kArPwjYm9CmFioBdAiaobpIkTCirjqZOnrFart7it1kUwu3YBgCaaFgC4mGPjszPohQj2EMkJ2QvPDhj1z16UvdsqXQSv/nKCCY2IuiiKlrsr+JAJnPxX0YtHY6ONwYQUvW1Wa9dTDZgTjOIEo1IGUyNS5xanbfydWll4MfV4LNjICvz55zrZRj+sHWor0psAGKIDLIWoJeDA9BixBCQvttJMLIwJh+Dy4skBqxYP9S5rWxt4b509qF68TB4gKo6h5aFlu3EG+exHBYzpRvTTDfXi+daWnj816fZP4OoN4qndIJe7tLrKitK6hUYrxE5rRTNburx45VWrLJ4HjAJXWTwkYLFxuD0ObRGqo0vp1gkmUkm3EUrqiAXTbTXx9pmcbs2UTXbNL3mht0Hez04/GZer0O4L/QdpSxcab+lmwFiEbugVIX8uuTiHG08qQs2A4TTHH0NyVRkqSGWTO/dfxzReJ9Ib1YW+RGOhPypkTsP/guFMduOY5mgSvl/VPCnvD5Cval2+CNEBw5k0f6P6MPXzGS0XSPlDal5YVokOGE7g8e9Xjv9eIcfV+qCUzdoXEp3XKWA4cju19kvYzOc3BfzDcqe91jR9IxQb6kWMrb37JZfOZNLcy+52vdWoH3EDj/fiX+G+PeL+BdqiOuiPN5SKAAAAAElFTkSuQmCC" pagespeed_lsc_url="images/cc.png" pagespeed_lsc_hash="KVEmq0JV8W" pagespeed_lsc_expiry="Tue, 14 May 2013 14:33:00 GMT"></a>
<br>
licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Others&#39;, &#39;Creative Commons&#39;]);">Creative Commons NonComercial 3.0 Unported License</a>
</div>
</div>
</footer>
</div>

<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<script src="./symfony2-cheatsheet_files/jquery-1.8.3.js"></script>
<script src="./symfony2-cheatsheet_files/contactable,_jquery.validate.pack.js,Mjm.uBud1mWAj2.js+contactable,_jquery.contactable.min.js,Mjm._4xMk_XezA.js+uItoTop,_js,_easing.js,Mjm.uNRnfmy1sj.js+uItoTop,_js,_jquery.ui.totop.min.js,Mjm.IXbUf44sPn.js+waypoints,_js,_jquery.scrollTo-1.4.2-min.js,M.js"></script><script>eval(mod_pagespeed_hjyXz165Bm);</script>
<script>eval(mod_pagespeed_uFv2CTxxHH);</script>
<script>eval(mod_pagespeed_MNf6r4zICX);</script>
<script>eval(mod_pagespeed_aL70$kLupi);</script>
<script>eval(mod_pagespeed_efc3w8OkJK);</script>
<script>eval(mod_pagespeed_xzz_pv0XVR);</script>
<script>eval(mod_pagespeed_K7cQ3YpW6n);</script> <script type="text/javascript">$(function(){$('#contactable').contactable({url:"feedback",subject:'New Symfony2cheatsheet.com Feeback Message',disclaimer:'Please feel free to get in touch, I value your feedback',});$().UItoTop({easingType:'easeOutQuart'});});</script>


<a href="#" id="toTop" style="display: none;"><span id="toTopHover"></span>To Top</a></body></html>
