<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 8. Optimization</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1 + chunker.py v1.9.1" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="backup-and-recovery.html" title="Chapter 7. Backup and Recovery" />
<link rel="next" href="language-structure.html" title="Chapter 9. Language Structure" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1377579534+*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 8. Optimization</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="backup-and-recovery.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="language-structure.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="optimization"></a>Chapter 8. Optimization</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="optimization.html#optimize-overview">8.1. Optimization Overview</a></span></dt><dt><span class="section"><a href="optimization.html#statement-optimization">8.2. Optimizing SQL Statements</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#select-optimization">8.2.1. Optimizing <code class="literal">SELECT</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#non-select-optimization">8.2.2. Optimizing DML Statements</a></span></dt><dt><span class="section"><a href="optimization.html#permission-optimization">8.2.3. Optimizing Database Privileges</a></span></dt><dt><span class="section"><a href="optimization.html#information-schema-optimization">8.2.4. Optimizing <code class="literal">INFORMATION_SCHEMA</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#miscellaneous-optimization-tips">8.2.5. Other Optimization Tips</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimization-indexes">8.3. Optimization and Indexes</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#mysql-indexes">8.3.1. How MySQL Uses Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-primary-keys">8.3.2. Using Primary Keys</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-foreign-keys">8.3.3. Using Foreign Keys</a></span></dt><dt><span class="section"><a href="optimization.html#column-indexes">8.3.4. Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-column-indexes">8.3.5. Multiple-Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#verifying-index-usage">8.3.6. Verifying Index Usage</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-index-statistics">8.3.7. <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> Index Statistics
Collection</a></span></dt><dt><span class="section"><a href="optimization.html#index-btree-hash">8.3.8. Comparison of B-Tree and Hash Indexes</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-database-structure">8.4. Optimizing Database Structure</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#data-size">8.4.1. Optimizing Data Size</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-data-types">8.4.2. Optimizing MySQL Data Types</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-multi-tables">8.4.3. Optimizing for Many Tables</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-innodb">8.5. Optimizing for <code class="literal">InnoDB</code> Tables</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#optimizing-innodb-storage-layout">8.5.1. Optimizing Storage Layout for <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-transaction-management">8.5.2. Optimizing <code class="literal">InnoDB</code> Transaction Management</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-logging">8.5.3. Optimizing <code class="literal">InnoDB</code> Logging</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-bulk-data-loading">8.5.4. Bulk Data Loading for <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-queries">8.5.5. Optimizing <code class="literal">InnoDB</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-ddl-operations">8.5.6. Optimizing <code class="literal">InnoDB</code> DDL Operations</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-diskio">8.5.7. Optimizing <code class="literal">InnoDB</code> Disk I/O</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-configuration-variables">8.5.8. Optimizing <code class="literal">InnoDB</code> Configuration Variables</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-many-tables">8.5.9. Optimizing <code class="literal">InnoDB</code> for Systems with Many Tables</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-myisam">8.6. Optimizing for <code class="literal">MyISAM</code> Tables</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#optimizing-queries-myisam">8.6.1. Optimizing <code class="literal">MyISAM</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-myisam-bulk-data-loading">8.6.2. Bulk Data Loading for <code class="literal">MyISAM</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#repair-table-speed">8.6.3. Speed of <code class="literal">REPAIR TABLE</code> Statements</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-memory-tables">8.7. Optimizing for <code class="literal">MEMORY</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#execution-plan-information">8.8. Understanding the Query Execution Plan</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#using-explain">8.8.1. Optimizing Queries with <code class="literal">EXPLAIN</code></a></span></dt><dt><span class="section"><a href="optimization.html#explain-output">8.8.2. <code class="literal">EXPLAIN</code> Output Format</a></span></dt><dt><span class="section"><a href="optimization.html#explain-extended">8.8.3. <code class="literal">EXPLAIN EXTENDED</code> Output Format</a></span></dt><dt><span class="section"><a href="optimization.html#estimating-performance">8.8.4. Estimating Query Performance</a></span></dt><dt><span class="section"><a href="optimization.html#controlling-optimizer">8.8.5. Controlling the Query Optimizer</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#buffering-caching">8.9. Buffering and Caching</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#innodb-buffer-pool">8.9.1. The <code class="literal">InnoDB</code> Buffer Pool</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-key-cache">8.9.2. The <code class="literal">MyISAM</code> Key Cache</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache">8.9.3. The MySQL Query Cache</a></span></dt><dt><span class="section"><a href="optimization.html#statement-caching">8.9.4. Caching of Prepared Statements and Stored Programs</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#locking-issues">8.10. Optimizing Locking Operations</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#internal-locking">8.10.1. Internal Locking Methods</a></span></dt><dt><span class="section"><a href="optimization.html#table-locking">8.10.2. Table Locking Issues</a></span></dt><dt><span class="section"><a href="optimization.html#concurrent-inserts">8.10.3. Concurrent Inserts</a></span></dt><dt><span class="section"><a href="optimization.html#metadata-locking">8.10.4. Metadata Locking</a></span></dt><dt><span class="section"><a href="optimization.html#external-locking">8.10.5. External Locking</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimizing-the-server">8.11. Optimizing the MySQL Server</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#system-optimization">8.11.1. System Factors and Startup Parameter Tuning</a></span></dt><dt><span class="section"><a href="optimization.html#server-parameters">8.11.2. Tuning Server Parameters</a></span></dt><dt><span class="section"><a href="optimization.html#disk-issues">8.11.3. Optimizing Disk I/O</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-memory">8.11.4. Optimizing Memory Use</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-network">8.11.5. Optimizing Network Use</a></span></dt><dt><span class="section"><a href="optimization.html#thread-pool-plugin">8.11.6. The Thread Pool Plugin</a></span></dt></dl></dd><dt><span class="section"><a href="optimization.html#optimize-benchmarking">8.12. Measuring Performance (Benchmarking)</a></span></dt><dd><dl><dt><span class="section"><a href="optimization.html#select-benchmarking">8.12.1. Measuring the Speed of Expressions and Functions</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-benchmarks">8.12.2. The MySQL Benchmark Suite</a></span></dt><dt><span class="section"><a href="optimization.html#custom-benchmarks">8.12.3. Using Your Own Benchmarks</a></span></dt><dt><span class="section"><a href="optimization.html#monitoring-performance-schema">8.12.4. Measuring Performance with <code class="literal">performance_schema</code></a></span></dt><dt><span class="section"><a href="optimization.html#thread-information">8.12.5. Examining Thread Information</a></span></dt></dl></dd></dl>
</div>
<a class="indexterm" name="idp47248464"></a><a class="indexterm" name="idp47249536"></a><a class="indexterm" name="idp47250608"></a><p>
    This chapter explains how to optimize MySQL performance and provides
    examples. Optimization involves configuring, tuning, and measuring
    performance, at several levels. Depending on your job role
    (developer, DBA, or a combination of both), you might optimize at
    the level of individual SQL statements, entire applications, a
    single database server, or multiple networked database servers.
    Sometimes you can be proactive and plan in advance for performance,
    while other times you might troubleshoot a configuration or code
    issue after a problem occurs. Optimizing CPU and memory usage can
    also improve scalability, allowing the database to handle more load
    without slowing down.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimize-overview"></a>8.1. Optimization Overview</h2>
</div>
</div>
</div>
<p>
      Database performance depends on several factors at the database
      level, such as tables, queries, and configuration settings. These
      software constructs result in CPU and I/O operations at the
      hardware level, which you must minimize and make as efficient as
      possible. As you work on database performance, you start by
      learning the high-level rules and guidelines for the software
      side, and measuring performance using wall-clock time. As you
      become an expert, you learn more about what happens internally,
      and start measuring things such as CPU cycles and I/O operations.
    </p><p>
      Typical users aim to get the best database performance out of
      their existing software and hardware configurations. Advanced
      users look for opportunities to improve the MySQL software itself,
      or develop their own storage engines and hardware appliances to
      expand the MySQL ecosystem.
</p>
<h3><a name="idp47255488"></a>
      Optimizing at the Database Level
</h3>
<p>
      The most important factor in making a database application fast is
      its basic design:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Are the tables structured properly? In particular, do the
          columns have the right data types, and does each table have
          the appropriate columns for the type of work? For example,
          applications that perform frequent updates often have many
          tables with few columns, while applications that analyze large
          amounts of data often have few tables with many columns.
        </p></li><li class="listitem"><p>
          Are the right
          <a class="link" href="optimization.html#optimization-indexes" title="8.3. Optimization and Indexes">indexes</a> in place
          to make queries efficient?
        </p></li><li class="listitem"><p>
          Are you using the appropriate storage engine for each table,
          and taking advantage of the strengths and features of each
          storage engine you use? In particular, the choice of a
          transactional storage engine such as
          <code class="literal"><a class="link" href="optimization.html#optimizing-innodb" title="8.5. Optimizing for InnoDB Tables">InnoDB</a></code>
          or a nontransactional one such as
          <code class="literal"><a class="link" href="optimization.html#optimizing-myisam" title="8.6. Optimizing for MyISAM Tables">MyISAM</a></code>
          can be very important for performance and scalability.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            In MySQL 5.5 and higher, <code class="literal">InnoDB</code> is the
            default storage engine for new tables. In practice, the
            advanced <code class="literal">InnoDB</code> performance features mean
            that <code class="literal">InnoDB</code> tables often outperform the
            simpler <code class="literal">MyISAM</code> tables, especially for a
            busy database.
</p>
</div>
</li><li class="listitem"><p>
          Does each table use an appropriate row format? This choice
          also depends on the storage engine used for the table. In
          particular, compressed tables use less disk space and so
          require less disk I/O to read and write the data. Compression
          is available for all kinds of workloads with
          <code class="literal">InnoDB</code> tables, and for read-only
          <code class="literal">MyISAM</code> tables.
        </p></li><li class="listitem"><p>
          Does the application use an appropriate
          <a class="link" href="optimization.html#locking-issues" title="8.10. Optimizing Locking Operations">locking strategy</a>? For
          example, by allowing shared access when possible so that
          database operations can run concurrently, and requesting
          exclusive access when appropriate so that critical operations
          get top priority. Again, the choice of storage engine is
          significant. The <code class="literal">InnoDB</code> storage engine
          handles most locking issues without involvement from you,
          allowing for better concurrency in the database and reducing
          the amount of experimentation and tuning for your code.
        </p></li><li class="listitem"><p>
          Are all <a class="link" href="optimization.html#buffering-caching" title="8.9. Buffering and Caching">memory areas used
          for caching</a> sized correctly? That is, large enough to
          hold frequently accessed data, but not so large that they
          overload physical memory and cause paging. The main memory
          areas to configure are the <code class="literal">InnoDB</code> buffer
          pool, the <code class="literal">MyISAM</code> key cache, and the MySQL
          query cache.
</p></li></ul>
</div>
<h3><a name="idp47275472"></a>
      Optimizing at the Hardware Level
</h3>
<p>
      Any database application eventually hits hardware limits as the
      database becomes more and more busy. A DBA must evaluate whether
      it is possible to tune the application or reconfigure the server
      to avoid these <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottlenecks</a>,
      or whether more hardware resources are required. System
      bottlenecks typically arise from these sources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Disk seeks. It takes time for the disk to find a piece of
          data. With modern disks, the mean time for this is usually
          lower than 10ms, so we can in theory do about 100 seeks a
          second. This time improves slowly with new disks and is very
          hard to optimize for a single table. The way to optimize seek
          time is to distribute the data onto more than one disk.
        </p></li><li class="listitem"><p>
          Disk reading and writing. When the disk is at the correct
          position, we need to read or write the data. With modern
          disks, one disk delivers at least 10–20MB/s throughput.
          This is easier to optimize than seeks because you can read in
          parallel from multiple disks.
        </p></li><li class="listitem"><p>
          CPU cycles. When the data is in main memory, we must process
          it to get our result. Having small tables compared to the
          amount of memory is the most common limiting factor. But with
          small tables, speed is usually not the problem.
        </p></li><li class="listitem"><p>
          Memory bandwidth. When the CPU needs more data than can fit in
          the CPU cache, main memory bandwidth becomes a bottleneck.
          This is an uncommon bottleneck for most systems, but one to be
          aware of.
</p></li></ul>
</div>
<h3><a name="portability"></a>
      Balancing Portability and Performance
</h3>
<a class="indexterm" name="idp47283216"></a><p>
      To use performance-oriented SQL extensions in a portable MySQL
      program, you can wrap MySQL-specific keywords in a statement
      within <code class="literal">/*! */</code> comment delimiters. Other SQL
      servers ignore the commented keywords. For information about
      writing comments, see <a class="xref" href="language-structure.html#comments" title="9.6. Comment Syntax">Section 9.6, “Comment Syntax”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="statement-optimization"></a>8.2. Optimizing SQL Statements</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#select-optimization">8.2.1. Optimizing <code class="literal">SELECT</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#non-select-optimization">8.2.2. Optimizing DML Statements</a></span></dt><dt><span class="section"><a href="optimization.html#permission-optimization">8.2.3. Optimizing Database Privileges</a></span></dt><dt><span class="section"><a href="optimization.html#information-schema-optimization">8.2.4. Optimizing <code class="literal">INFORMATION_SCHEMA</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#miscellaneous-optimization-tips">8.2.5. Other Optimization Tips</a></span></dt></dl>
</div>
<a class="indexterm" name="idp47287312"></a><p>
      The core logic of a database application is performed through SQL
      statements, whether issued directly through an interpreter or
      submitted behind the scenes through an API. The tuning guidelines
      in this section help to speed up all kinds of MySQL applications.
      The guidelines cover SQL operations that read and write data, the
      behind-the-scenes overhead for SQL operations in general, and
      operations used in specific scenarios such as database monitoring.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="select-optimization"></a>8.2.1. Optimizing <code class="literal">SELECT</code> Statements</h3>
</div>
</div>
</div>

<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#select-speed">8.2.1.1. Speed of <code class="literal">SELECT</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#where-optimizations">8.2.1.2. How MySQL Optimizes <code class="literal">WHERE</code> Clauses</a></span></dt><dt><span class="section"><a href="optimization.html#range-optimization">8.2.1.3. Range Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-merge-optimization">8.2.1.4. Index Merge Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#condition-pushdown-optimization">8.2.1.5. Engine Condition Pushdown Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-condition-pushdown-optimization">8.2.1.6. Index Condition Pushdown Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#index-extensions">8.2.1.7. Use of Index Extensions</a></span></dt><dt><span class="section"><a href="optimization.html#is-null-optimization">8.2.1.8. <code class="literal">IS NULL</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#left-join-optimization">8.2.1.9. <code class="literal">LEFT JOIN</code> and <code class="literal">RIGHT JOIN</code>
Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#nested-loop-joins">8.2.1.10. Nested-Loop Join Algorithms</a></span></dt><dt><span class="section"><a href="optimization.html#nested-join-optimization">8.2.1.11. Nested Join Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#outer-join-simplification">8.2.1.12. Outer Join Simplification</a></span></dt><dt><span class="section"><a href="optimization.html#mrr-optimization">8.2.1.13. Multi-Range Read Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#bnl-bka-optimization">8.2.1.14. Block Nested-Loop and Batched Key Access Joins</a></span></dt><dt><span class="section"><a href="optimization.html#order-by-optimization">8.2.1.15. <code class="literal">ORDER BY</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#group-by-optimization">8.2.1.16. <code class="literal">GROUP BY</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#distinct-optimization">8.2.1.17. <code class="literal">DISTINCT</code> Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#subquery-optimization">8.2.1.18. Subquery Optimization</a></span></dt><dt><span class="section"><a href="optimization.html#limit-optimization">8.2.1.19. Optimizing <code class="literal">LIMIT</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#how-to-avoid-table-scan">8.2.1.20. How to Avoid Full Table Scans</a></span></dt></dl>
</div>
<a class="indexterm" name="idp47291088"></a><a class="indexterm" name="idp47292576"></a><p>
        Queries, in the form of <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
        statements, perform all the lookup operations in the database.
        Tuning these statements is a top priority, whether to achieve
        sub-second response times for dynamic web pages, or to chop
        hours off the time to generate huge overnight reports.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="select-speed"></a>8.2.1.1. Speed of <code class="literal">SELECT</code> Statements</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp47296992"></a><a class="indexterm" name="idp47298064"></a><p>
          The main considerations for optimizing queries are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To make a slow <code class="literal">SELECT ... WHERE</code> query
              faster, the first thing to check is whether you can add an
              <a class="link" href="glossary.html#glos_index" title="index">index</a>. Set up indexes on
              columns used in the <code class="literal">WHERE</code> clause, to
              speed up evaluation, filtering, and the final retrieval of
              results. To avoid wasted disk space, construct a small set
              of indexes that speed up many related queries used in your
              application.
            </p><p>
              Indexes are especially important for queries that
              reference different tables, using features such as
              <a class="link" href="glossary.html#glos_join" title="join">joins</a> and
              <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a>. You
              can use the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
              statement to determine which indexes are used for a
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>. See
              <a class="xref" href="optimization.html#mysql-indexes" title="8.3.1. How MySQL Uses Indexes">Section 8.3.1, “How MySQL Uses Indexes”</a> and
              <a class="xref" href="optimization.html#using-explain" title="8.8.1. Optimizing Queries with EXPLAIN">Section 8.8.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>.
            </p></li><li class="listitem"><p>
              Isolate and tune any part of the query, such as a function
              call, that takes excessive time. Depending on how the
              query is structured, a function could be called once for
              every row in the result set, or even once for every row in
              the table, greatly magnifying any inefficiency.
            </p></li><li class="listitem"><p>
              Minimize the number of
              <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table
              scans</a> in your queries, particularly for big tables.
            </p></li><li class="listitem"><p>
              Keep table statistics up to date by using the
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> statement
              periodically, so the optimizer has the information needed
              to construct an efficient execution plan.
            </p></li><li class="listitem"><p>
              Learn the tuning techniques, indexing techniques, and
              configuration parameters that are specific to the storage
              engine for each table. Both <code class="literal">InnoDB</code> and
              <code class="literal">MyISAM</code> have sets of guidelines for
              enabling and sustaining high performance in queries. For
              details, see <a class="xref" href="optimization.html#optimizing-innodb-queries" title="8.5.5. Optimizing InnoDB Queries">Section 8.5.5, “Optimizing <code class="literal">InnoDB</code> Queries”</a>
              and <a class="xref" href="optimization.html#optimizing-queries-myisam" title="8.6.1. Optimizing MyISAM Queries">Section 8.6.1, “Optimizing <code class="literal">MyISAM</code> Queries”</a>.
            </p></li><li class="listitem"><p>
              In particular, in MySQL 5.6.4 and higher, you can optimize
              single-query transactions for <code class="literal">InnoDB</code>
              tables, using the technique in
              <a class="xref" href="storage-engines.html#innodb-performance-ro-txn" title="14.2.4.2.3. Optimizations for Read-Only Transactions">Section 14.2.4.2.3, “Optimizations for Read-Only Transactions”</a>.
            </p></li><li class="listitem"><p>
              Avoid transforming the query in ways that make it hard to
              understand, especially if the optimizer does some of the
              same transformations automatically.
            </p></li><li class="listitem"><p>
              If a performance issue is not easily solved by one of the
              basic guidelines, investigate the internal details of the
              specific query by reading the
              <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> plan and adjusting
              your indexes, <code class="literal">WHERE</code> clauses, join
              clauses, and so on. (When you reach a certain level of
              expertise, reading the
              <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> plan might be your
              first step for every query.)
            </p></li><li class="listitem"><p>
              Adjust the size and properties of the memory areas that
              MySQL uses for caching. With efficient use of the
              <code class="literal">InnoDB</code>
              <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>,
              <code class="literal">MyISAM</code> key cache, and the MySQL query
              cache, repeated queries run faster because the results are
              retrieved from memory the second and subsequent times.
            </p></li><li class="listitem"><p>
              Even for a query that runs fast using the cache memory
              areas, you might still optimize further so that they
              require less cache memory, making your application more
              scalable. Scalability means that your application can
              handle more simultaneous users, larger requests, and so on
              without experiencing a big drop in performance.
            </p></li><li class="listitem"><p>
              Deal with locking issues, where the speed of your query
              might be affected by other sessions accessing the tables
              at the same time.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="where-optimizations"></a>8.2.1.2. How MySQL Optimizes <code class="literal">WHERE</code> Clauses</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp47330944"></a><a class="indexterm" name="idp47332016"></a><p>
          This section discusses optimizations that can be made for
          processing <code class="literal">WHERE</code> clauses. The examples use
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements, but the same
          optimizations apply for <code class="literal">WHERE</code> clauses in
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> and
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            Because work on the MySQL optimizer is ongoing, not all of
            the optimizations that MySQL performs are documented here.
</p>
</div>
<p>
          You might be tempted to rewrite your queries to make
          arithmetic operations faster, while sacrificing readability.
          Because MySQL does similar optimizations automatically, you
          can often avoid this work, and leave the query in a more
          understandable and maintainable form. Some of the
          optimizations performed by MySQL follow:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Removal of unnecessary parentheses:
            </p><pre class="programlisting">   ((a AND b) AND c OR (((a AND b) AND (c AND d))))
-&gt; (a AND b AND c) OR (a AND b AND c AND d)</pre></li><li class="listitem"><p>
              Constant folding:
            </p><pre class="programlisting">   (a&lt;b AND b=c) AND a=5
-&gt; b&gt;5 AND b=c AND a=5</pre></li><li class="listitem"><p>
              Constant condition removal (needed because of constant
              folding):
            </p><pre class="programlisting">   (B&gt;=5 AND B=5) OR (B=6 AND 5=5) OR (B=7 AND 5=6)
-&gt; B=5 OR B=6</pre></li><li class="listitem"><p>
              Constant expressions used by indexes are evaluated only
              once.
            </p></li><li class="listitem"><p>
              <a class="link" href="functions.html#function_count"><code class="literal">COUNT(*)</code></a> on a single table
              without a <code class="literal">WHERE</code> is retrieved directly
              from the table information for <code class="literal">MyISAM</code>
              and <code class="literal">MEMORY</code> tables. This is also done
              for any <code class="literal">NOT NULL</code> expression when used
              with only one table.
            </p></li><li class="listitem"><p>
              Early detection of invalid constant expressions. MySQL
              quickly detects that some
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements are
              impossible and returns no rows.
            </p></li><li class="listitem"><p>
              <code class="literal">HAVING</code> is merged with
              <code class="literal">WHERE</code> if you do not use <code class="literal">GROUP
              BY</code> or aggregate functions
              (<a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>,
              <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>, and so on).
            </p></li><li class="listitem"><p>
              For each table in a join, a simpler
              <code class="literal">WHERE</code> is constructed to get a fast
              <code class="literal">WHERE</code> evaluation for the table and also
              to skip rows as soon as possible.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp47359456"></a>

              <a class="indexterm" name="idp47360528"></a>

              All constant tables are read first before any other tables
              in the query. A constant table is any of the following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  An empty table or a table with one row.
                </p></li><li class="listitem"><p>
                  A table that is used with a <code class="literal">WHERE</code>
                  clause on a <code class="literal">PRIMARY KEY</code> or a
                  <code class="literal">UNIQUE</code> index, where all index parts
                  are compared to constant expressions and are defined
                  as <code class="literal">NOT NULL</code>.
</p></li></ul>
</div>
<p>
              All of the following tables are used as constant tables:
            </p><pre class="programlisting">SELECT * FROM t WHERE <em class="replaceable"><code>primary_key</code></em>=1;
SELECT * FROM t1,t2
  WHERE t1.<em class="replaceable"><code>primary_key</code></em>=1 AND t2.<em class="replaceable"><code>primary_key</code></em>=t1.id;
</pre></li><li class="listitem"><p>
              The best join combination for joining the tables is found
              by trying all possibilities. If all columns in
              <code class="literal">ORDER BY</code> and <code class="literal">GROUP
              BY</code> clauses come from the same table, that table
              is preferred first when joining.
            </p></li><li class="listitem"><p>
              If there is an <code class="literal">ORDER BY</code> clause and a
              different <code class="literal">GROUP BY</code> clause, or if the
              <code class="literal">ORDER BY</code> or <code class="literal">GROUP BY</code>
              contains columns from tables other than the first table in
              the join queue, a temporary table is created.
            </p></li><li class="listitem"><p>
              If you use the <code class="literal">SQL_SMALL_RESULT</code> option,
              MySQL uses an in-memory temporary table.
            </p></li><li class="listitem"><p>
              Each table index is queried, and the best index is used
              unless the optimizer believes that it is more efficient to
              use a table scan. At one time, a scan was used based on
              whether the best index spanned more than 30% of the table,
              but a fixed percentage no longer determines the choice
              between using an index or a scan. The optimizer now is
              more complex and bases its estimate on additional factors
              such as table size, number of rows, and I/O block size.
            </p></li><li class="listitem"><p>
              In some cases, MySQL can read rows from the index without
              even consulting the data file. If all columns used from
              the index are numeric, only the index tree is used to
              resolve the query.
            </p></li><li class="listitem"><p>
              Before each row is output, those that do not match the
              <code class="literal">HAVING</code> clause are skipped.
</p></li></ul>
</div>
<p>
          Some examples of queries that are very fast:
        </p><pre class="programlisting">SELECT COUNT(*) FROM <em class="replaceable"><code>tbl_name</code></em>;

SELECT MIN(<em class="replaceable"><code>key_part1</code></em>),MAX(<em class="replaceable"><code>key_part1</code></em>) FROM <em class="replaceable"><code>tbl_name</code></em>;

SELECT MAX(<em class="replaceable"><code>key_part2</code></em>) FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>constant</code></em>;

SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,... LIMIT 10;

SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC, ... LIMIT 10;
</pre><p>
          MySQL resolves the following queries using only the index
          tree, assuming that the indexed columns are numeric:
        </p><pre class="programlisting">SELECT <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em> FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>val</code></em>;

SELECT COUNT(*) FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>val1</code></em> AND <em class="replaceable"><code>key_part2</code></em>=<em class="replaceable"><code>val2</code></em>;

SELECT <em class="replaceable"><code>key_part2</code></em> FROM <em class="replaceable"><code>tbl_name</code></em> GROUP BY <em class="replaceable"><code>key_part1</code></em>;
</pre><p>
          The following queries use indexing to retrieve the rows in
          sorted order without a separate sorting pass:
        </p><pre class="programlisting">SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,... ;

SELECT ... FROM <em class="replaceable"><code>tbl_name</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC, ... ;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="range-optimization"></a>8.2.1.3. Range Optimization</h4>

</div>

</div>

</div>
<p>
          The <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a> access method
          uses a single index to retrieve a subset of table rows that
          are contained within one or several index value intervals. It
          can be used for a single-part or multiple-part index. The
          following sections give a detailed description of how
          intervals are extracted from the <code class="literal">WHERE</code>
          clause.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="range-access-single-part"></a>8.2.1.3.1. The Range Access Method for Single-Part Indexes</h5>
</div>
</div>
</div>
<p>
            For a single-part index, index value intervals can be
            conveniently represented by corresponding conditions in the
            <code class="literal">WHERE</code> clause, so we speak of
            <em class="firstterm">range conditions</em> rather than
            <span class="quote">“<span class="quote">intervals.</span>”</span>
          </p><p>
            The definition of a range condition for a single-part index
            is as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                For both <code class="literal">BTREE</code> and
                <code class="literal">HASH</code> indexes, comparison of a key
                part with a constant value is a range condition when
                using the
                <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
                <a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
                <a class="link" href="functions.html#function_in"><code class="literal">IN()</code></a>,
                <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>, or
                <a class="link" href="functions.html#operator_is-not-null"><code class="literal">IS NOT NULL</code></a> operators.
              </p></li><li class="listitem"><p>
                Additionally, for <code class="literal">BTREE</code> indexes,
                comparison of a key part with a constant value is a
                range condition when using the
                <a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
                <a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
                <a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
                <a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
                <a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>,
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>,
                or
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
                operators, or <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
                comparisons if the argument to
                <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> is a constant string
                that does not start with a wildcard character.
              </p></li><li class="listitem"><p>
                For all types of indexes, multiple range conditions
                combined with <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a> or
                <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a> form a range condition.
</p></li></ul>
</div>
<p>
            <span class="quote">“<span class="quote">Constant value</span>”</span> in the preceding descriptions
            means one of the following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                A constant from the query string
              </p></li><li class="listitem"><p>
                A column of a <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
                or <a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a> table from
                the same join
              </p></li><li class="listitem"><p>
                The result of an uncorrelated subquery
              </p></li><li class="listitem"><p>
                Any expression composed entirely from subexpressions of
                the preceding types
</p></li></ul>
</div>
<p>
            Here are some examples of queries with range conditions in
            the <code class="literal">WHERE</code> clause:
          </p><pre class="programlisting">SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_col</code></em> &gt; 1
  AND <em class="replaceable"><code>key_col</code></em> &lt; 10;

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_col</code></em> = 1
  OR <em class="replaceable"><code>key_col</code></em> IN (15,18,20);

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_col</code></em> LIKE 'ab%'
  OR <em class="replaceable"><code>key_col</code></em> BETWEEN 'bar' AND 'foo';
</pre><p>
            Note that some nonconstant values may be converted to
            constants during the constant propagation phase.
          </p><p>
            MySQL tries to extract range conditions from the
            <code class="literal">WHERE</code> clause for each of the possible
            indexes. During the extraction process, conditions that
            cannot be used for constructing the range condition are
            dropped, conditions that produce overlapping ranges are
            combined, and conditions that produce empty ranges are
            removed.
          </p><p>
            Consider the following statement, where
            <code class="literal">key1</code> is an indexed column and
            <code class="literal">nonkey</code> is not indexed:
          </p><pre class="programlisting">SELECT * FROM t1 WHERE
  (key1 &lt; 'abc' AND (key1 LIKE 'abcde%' OR key1 LIKE '%b')) OR
  (key1 &lt; 'bar' AND nonkey = 4) OR
  (key1 &lt; 'uux' AND key1 &gt; 'z');</pre><p>
            The extraction process for key <code class="literal">key1</code> is as
            follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Start with original <code class="literal">WHERE</code> clause:
              </p><pre class="programlisting">(key1 &lt; 'abc' AND (key1 LIKE 'abcde%' OR key1 LIKE '%b')) OR
(key1 &lt; 'bar' AND nonkey = 4) OR
(key1 &lt; 'uux' AND key1 &gt; 'z')</pre></li><li class="listitem"><p>
                Remove <code class="literal">nonkey = 4</code> and <code class="literal">key1
                LIKE '%b'</code> because they cannot be used for a
                range scan. The correct way to remove them is to replace
                them with <code class="literal">TRUE</code>, so that we do not
                miss any matching rows when doing the range scan. Having
                replaced them with <code class="literal">TRUE</code>, we get:
              </p><pre class="programlisting">(key1 &lt; 'abc' AND (key1 LIKE 'abcde%' OR TRUE)) OR
(key1 &lt; 'bar' AND TRUE) OR
(key1 &lt; 'uux' AND key1 &gt; 'z')</pre></li><li class="listitem"><p>
                Collapse conditions that are always true or false:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <code class="literal">(key1 LIKE 'abcde%' OR TRUE)</code> is
                    always true
                  </p></li><li class="listitem"><p>
                    <code class="literal">(key1 &lt; 'uux' AND key1 &gt;
                    'z')</code> is always false
</p></li></ul>
</div>
<p>
                Replacing these conditions with constants, we get:
              </p><pre class="programlisting">(key1 &lt; 'abc' AND TRUE) OR (key1 &lt; 'bar' AND TRUE) OR (FALSE)</pre><p>
                Removing unnecessary <code class="literal">TRUE</code> and
                <code class="literal">FALSE</code> constants, we obtain:
              </p><pre class="programlisting">(key1 &lt; 'abc') OR (key1 &lt; 'bar')</pre></li><li class="listitem"><p>
                Combining overlapping intervals into one yields the
                final condition to be used for the range scan:
</p><pre class="programlisting">(key1 &lt; 'bar')</pre></li></ol>
</div>
<p>
            In general (and as demonstrated by the preceding example),
            the condition used for a range scan is less restrictive than
            the <code class="literal">WHERE</code> clause. MySQL performs an
            additional check to filter out rows that satisfy the range
            condition but not the full <code class="literal">WHERE</code> clause.
          </p><p>
            The range condition extraction algorithm can handle nested
            <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>/<a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
            constructs of arbitrary depth, and its output does not
            depend on the order in which conditions appear in
            <code class="literal">WHERE</code> clause.
          </p><p>
            Currently, MySQL does not support merging multiple ranges
            for the <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a> access
            method for spatial indexes. To work around this limitation,
            you can use a <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> with
            identical <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements,
            except that you put each spatial predicate in a different
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="range-access-multi-part"></a>8.2.1.3.2. The Range Access Method for Multiple-Part Indexes</h5>

</div>

</div>

</div>
<p>
            Range conditions on a multiple-part index are an extension
            of range conditions for a single-part index. A range
            condition on a multiple-part index restricts index rows to
            lie within one or several key tuple intervals. Key tuple
            intervals are defined over a set of key tuples, using
            ordering from the index.
          </p><p>
            For example, consider a multiple-part index defined as
            <code class="literal">key1(<em class="replaceable"><code>key_part1</code></em>,
            <em class="replaceable"><code>key_part2</code></em>,
            <em class="replaceable"><code>key_part3</code></em>)</code>, and the
            following set of key tuples listed in key order:
          </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em>  <em class="replaceable"><code>key_part2</code></em>  <em class="replaceable"><code>key_part3</code></em>
  NULL       1          'abc'
  NULL       1          'xyz'
  NULL       2          'foo'
   1         1          'abc'
   1         1          'xyz'
   1         2          'abc'
   2         1          'aaa'
</pre><p>
            The condition <code class="literal"><em class="replaceable"><code>key_part1</code></em>
            = 1</code> defines this interval:
          </p><pre class="programlisting">(1,-inf,-inf) &lt;= (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,<em class="replaceable"><code>key_part3</code></em>) &lt; (1,+inf,+inf)
</pre><p>
            The interval covers the 4th, 5th, and 6th tuples in the
            preceding data set and can be used by the range access
            method.
          </p><p>
            By contrast, the condition
            <code class="literal"><em class="replaceable"><code>key_part3</code></em> =
            'abc'</code> does not define a single interval and cannot
            be used by the range access method.
          </p><p>
            The following descriptions indicate how range conditions
            work for multiple-part indexes in greater detail.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                For <code class="literal">HASH</code> indexes, each interval
                containing identical values can be used. This means that
                the interval can be produced only for conditions in the
                following form:
              </p><pre class="programlisting">    <em class="replaceable"><code>key_part1</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const1</code></em>
AND <em class="replaceable"><code>key_part2</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const2</code></em>
AND ...
AND <em class="replaceable"><code>key_partN</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>constN</code></em>;
</pre><p>
                Here, <em class="replaceable"><code>const1</code></em>,
                <em class="replaceable"><code>const2</code></em>, … are
                constants, <em class="replaceable"><code>cmp</code></em> is one of the
                <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
                <a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
                or <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a> comparison
                operators, and the conditions cover all index parts.
                (That is, there are <em class="replaceable"><code>N</code></em>
                conditions, one for each part of an
                <em class="replaceable"><code>N</code></em>-part index.) For example,
                the following is a range condition for a three-part
                <code class="literal">HASH</code> index:
              </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> = 1 AND <em class="replaceable"><code>key_part2</code></em> IS NULL AND <em class="replaceable"><code>key_part3</code></em> = 'foo'
</pre><p>
                For the definition of what is considered to be a
                constant, see
                <a class="xref" href="optimization.html#range-access-single-part" title="8.2.1.3.1. The Range Access Method for Single-Part Indexes">Section 8.2.1.3.1, “The Range Access Method for Single-Part Indexes”</a>.
              </p></li><li class="listitem"><p>
                For a <code class="literal">BTREE</code> index, an interval might
                be usable for conditions combined with
                <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>, where each condition
                compares a key part with a constant value using
                <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
                <a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
                <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>,
                <a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
                <a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
                <a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
                <a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>,
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>,
                <a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>, or
                <a class="link" href="functions.html#operator_like"><code class="literal">LIKE
                '<em class="replaceable"><code>pattern</code></em>'</code></a> (where
                <code class="literal">'<em class="replaceable"><code>pattern</code></em>'</code>
                does not start with a wildcard). An interval can be used
                as long as it is possible to determine a single key
                tuple containing all rows that match the condition (or
                two intervals if
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
                or <a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>
                is used).
              </p><p>
                The optimizer attempts to use additional key parts to
                determine the interval as long as the comparison
                operator is
                <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
                <a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
                or <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>. If the operator
                is
                <a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
                <a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
                <a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
                <a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>,
                <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>,
                <a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>, or
                <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>, the
                optimizer uses it but considers no more key parts. For
                the following expression, the optimizer uses
                <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a> from
                the first comparison. It also uses
                <a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>
                from the second comparison but considers no further key
                parts and does not use the third comparison for interval
                construction:
              </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> = 'foo' AND <em class="replaceable"><code>key_part2</code></em> &gt;= 10 AND <em class="replaceable"><code>key_part3</code></em> &gt; 10
</pre><p>
                The single interval is:
              </p><pre class="programlisting">('foo',10,-inf) &lt; (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,<em class="replaceable"><code>key_part3</code></em>) &lt; ('foo',+inf,+inf)
</pre><p>
                It is possible that the created interval contains more
                rows than the initial condition. For example, the
                preceding interval includes the value <code class="literal">('foo',
                11, 0)</code>, which does not satisfy the original
                condition.
              </p></li><li class="listitem"><p>
                If conditions that cover sets of rows contained within
                intervals are combined with
                <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>, they form a condition
                that covers a set of rows contained within the union of
                their intervals. If the conditions are combined with
                <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>, they form a condition
                that covers a set of rows contained within the
                intersection of their intervals. For example, for this
                condition on a two-part index:
              </p><pre class="programlisting">(<em class="replaceable"><code>key_part1</code></em> = 1 AND <em class="replaceable"><code>key_part2</code></em> &lt; 2) OR (<em class="replaceable"><code>key_part1</code></em> &gt; 5)
</pre><p>
                The intervals are:
              </p><pre class="programlisting">(1,-inf) &lt; (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>) &lt; (1,2)
(5,-inf) &lt; (<em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>)
</pre><p>
                In this example, the interval on the first line uses one
                key part for the left bound and two key parts for the
                right bound. The interval on the second line uses only
                one key part. The <code class="literal">key_len</code> column in
                the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output
                indicates the maximum length of the key prefix used.
              </p><p>
                In some cases, <code class="literal">key_len</code> may indicate
                that a key part was used, but that might be not what you
                would expect. Suppose that
                <em class="replaceable"><code>key_part1</code></em> and
                <em class="replaceable"><code>key_part2</code></em> can be
                <code class="literal">NULL</code>. Then the
                <code class="literal">key_len</code> column displays two key part
                lengths for the following condition:
              </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> &gt;= 1 AND <em class="replaceable"><code>key_part2</code></em> &lt; 2
</pre><p>
                But, in fact, the condition is converted to this:
              </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em> &gt;= 1 AND <em class="replaceable"><code>key_part2</code></em> IS NOT NULL
</pre></li></ul>
</div>
<p>
            <a class="xref" href="optimization.html#range-access-single-part" title="8.2.1.3.1. The Range Access Method for Single-Part Indexes">Section 8.2.1.3.1, “The Range Access Method for Single-Part Indexes”</a>, describes how
            optimizations are performed to combine or eliminate
            intervals for range conditions on a single-part index.
            Analogous steps are performed for range conditions on
            multiple-part indexes.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="equality-range-optimization"></a>8.2.1.3.3. Equality Range Optimization of Many-Valued Comparisons</h5>

</div>

</div>

</div>
<p>
            Consider these expressions, where
            <em class="replaceable"><code>col_name</code></em> is an indexed column:
          </p><pre class="programlisting"><em class="replaceable"><code>col_name</code></em> IN(<em class="replaceable"><code>val1</code></em>, ..., <em class="replaceable"><code>valN</code></em>)
<em class="replaceable"><code>col_name</code></em> = <em class="replaceable"><code>val1</code></em> OR ... OR <em class="replaceable"><code>col_name</code></em> = <em class="replaceable"><code>valN</code></em>
</pre><p>
            Each expression is true if
            <em class="replaceable"><code>col_name</code></em> is equal to any of
            several values. These comparisons are equality range
            comparisons (where the <span class="quote">“<span class="quote">range</span>”</span> is a single
            value). The optimizer estimates the cost of reading
            qualifying rows for equality range comparisons as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                If there is a unique index on
                <em class="replaceable"><code>col_name</code></em>, the row estimate
                for each range is 1 because at most one row can have the
                given value.
              </p></li><li class="listitem"><p>
                Otherwise, the optimizer can estimate the row count for
                each range using dives into the index or index
                statistics.
</p></li></ul>
</div>
<p>
            With index dives, the optimizer makes a dive at each end of
            a range and uses the number of rows in the range as the
            estimate. For example, the expression
            <code class="literal"><em class="replaceable"><code>col_name</code></em> IN (10, 20,
            30)</code> has three equality ranges and the optimizer
            makes two dives per range to generate a row estimate. Each
            pair of dives yields an estimate of the number of rows that
            have the given value.
          </p><p>
            Index dives provide accurate row estimates, but as the
            number of comparison values in the expression increases, the
            optimizer takes longer to generate a row estimate. Use of
            index statistics is less accurate than index dives but
            permits faster row estimation for large value lists.
          </p><p>
            The
            <a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
            system variable enables you to configure the number of
            values at which the optimizer switches from one row
            estimation strategy to the other. To disable use of
            statistics and always use index dives, set
            <a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
            to 0. To permit use of index dives for comparisons of up to
            <em class="replaceable"><code>N</code></em> equality ranges, set
            <a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
            to <em class="replaceable"><code>N</code></em> + 1.
          </p><p>
            <a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
            is available as of MySQL 5.6.5. Before 5.6.5, the optimizer
            uses index dives, which is equivalent to
            <a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit=0</code></a>.
          </p><p>
            To update table index statistics for best estimates, use
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-merge-optimization"></a>8.2.1.4. Index Merge Optimization</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp47572400"></a><a class="indexterm" name="idp47573440"></a><a class="indexterm" name="idp47574528"></a><p>
          The <em class="firstterm">Index Merge</em> method is used to
          retrieve rows with several
          <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a> scans and to merge
          their results into one. The merge can produce unions,
          intersections, or unions-of-intersections of its underlying
          scans. This access method merges index scans from a single
          table; it does not merge scans across multiple tables.
        </p><p>
          In <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, the Index
          Merge method appears as
          <a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a> in the
          <code class="literal">type</code> column. In this case, the
          <code class="literal">key</code> column contains a list of indexes used,
          and <code class="literal">key_len</code> contains a list of the longest
          key parts for those indexes.
        </p><p>
          Examples:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key1</code></em> = 10 OR <em class="replaceable"><code>key2</code></em> = 20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE (<em class="replaceable"><code>key1</code></em> = 10 OR <em class="replaceable"><code>key2</code></em> = 20) AND <em class="replaceable"><code>non_key</code></em>=30;

SELECT * FROM t1, t2
  WHERE (t1.<em class="replaceable"><code>key1</code></em> IN (1,2) OR t1.<em class="replaceable"><code>key2</code></em> LIKE '<em class="replaceable"><code>value</code></em>%')
  AND t2.<em class="replaceable"><code>key1</code></em>=t1.<em class="replaceable"><code>some_col</code></em>;

SELECT * FROM t1, t2
  WHERE t1.<em class="replaceable"><code>key1</code></em>=1
  AND (t2.<em class="replaceable"><code>key1</code></em>=t1.<em class="replaceable"><code>some_col</code></em> OR t2.<em class="replaceable"><code>key2</code></em>=t1.<em class="replaceable"><code>some_col2</code></em>);
</pre><p>
          The Index Merge method has several access algorithms (seen in
          the <code class="literal">Extra</code> field of
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">Using intersect(...)</code>
            </p></li><li class="listitem"><p>
              <code class="literal">Using union(...)</code>
            </p></li><li class="listitem"><p>
              <code class="literal">Using sort_union(...)</code>
</p></li></ul>
</div>
<p>
          The following sections describe these methods in greater
          detail.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            The Index Merge optimization algorithm has the following
            known deficiencies:
</p>
<div xmlns="" class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                If your query has a complex <code class="literal">WHERE</code>
                clause with deep
                <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>/<a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
                nesting and MySQL doesn't choose the optimal plan, try
                distributing terms using the following identity laws:
              </p><pre class="programlisting">(<em class="replaceable"><code>x</code></em> AND <em class="replaceable"><code>y</code></em>) OR <em class="replaceable"><code>z</code></em> = (<em class="replaceable"><code>x</code></em> OR <em class="replaceable"><code>z</code></em>) AND (<em class="replaceable"><code>y</code></em> OR <em class="replaceable"><code>z</code></em>)
(<em class="replaceable"><code>x</code></em> OR <em class="replaceable"><code>y</code></em>) AND <em class="replaceable"><code>z</code></em> = (<em class="replaceable"><code>x</code></em> AND <em class="replaceable"><code>z</code></em>) OR (<em class="replaceable"><code>y</code></em> AND <em class="replaceable"><code>z</code></em>)
</pre></li><li class="listitem"><p>
                Index Merge is not applicable to full-text indexes. We
                plan to extend it to cover these in a future MySQL
                release.
              </p></li><li class="listitem"><p>
                Before MySQL 5.6.6, if a range scan is possible on some
                key, the optimizer will not consider using Index Merge
                Union or Index Merge Sort-Union algorithms. For example,
                consider this query:
              </p><pre class="programlisting">SELECT * FROM t1 WHERE (goodkey1 &lt; 10 OR goodkey2 &lt; 20) AND badkey &lt; 30;</pre><p>
                For this query, two plans are possible:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    An Index Merge scan using the <code class="literal">(goodkey1
                    &lt; 10 OR goodkey2 &lt; 20)</code> condition.
                  </p></li><li class="listitem"><p>
                    A range scan using the <code class="literal">badkey &lt;
                    30</code> condition.
</p></li></ul>
</div>
<p>
                However, the optimizer considers only the second plan.
</p></li></ul>
</div>

</div>
<p>
          The choice between different possible variants of the Index
          Merge access method and other access methods is based on cost
          estimates of various available options.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="index-merge-intersection"></a>8.2.1.4.1. The Index Merge Intersection Access Algorithm</h5>
</div>
</div>
</div>
<p>
            This access algorithm can be employed when a
            <code class="literal">WHERE</code> clause was converted to several
            range conditions on different keys combined with
            <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>, and each condition is one
            of the following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                In this form, where the index has exactly
                <em class="replaceable"><code>N</code></em> parts (that is, all index
                parts are covered):
              </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>const1</code></em> AND <em class="replaceable"><code>key_part2</code></em>=<em class="replaceable"><code>const2</code></em> ... AND <em class="replaceable"><code>key_partN</code></em>=<em class="replaceable"><code>constN</code></em>
</pre></li><li class="listitem"><p>
                Any range condition over a primary key of an
                <code class="literal">InnoDB</code> table.
</p></li></ul>
</div>
<p>
            Examples:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>innodb_table</code></em> WHERE <em class="replaceable"><code>primary_key</code></em> &lt; 10 AND <em class="replaceable"><code>key_col1</code></em>=20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE (<em class="replaceable"><code>key1_part1</code></em>=1 AND <em class="replaceable"><code>key1_part2</code></em>=2) AND <em class="replaceable"><code>key2</code></em>=2;
</pre><p>
            The Index Merge intersection algorithm performs simultaneous
            scans on all used indexes and produces the intersection of
            row sequences that it receives from the merged index scans.
          </p><p>
            If all columns used in the query are covered by the used
            indexes, full table rows are not retrieved
            (<a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output contains
            <code class="literal">Using index</code> in <code class="literal">Extra</code>
            field in this case). Here is an example of such a query:
          </p><pre class="programlisting">SELECT COUNT(*) FROM t1 WHERE key1=1 AND key2=1;</pre><p>
            If the used indexes don't cover all columns used in the
            query, full rows are retrieved only when the range
            conditions for all used keys are satisfied.
          </p><p>
            If one of the merged conditions is a condition over a
            primary key of an <code class="literal">InnoDB</code> table, it is not
            used for row retrieval, but is used to filter out rows
            retrieved using other conditions.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="index-merge-union"></a>8.2.1.4.2. The Index Merge Union Access Algorithm</h5>

</div>

</div>

</div>
<p>
            The applicability criteria for this algorithm are similar to
            those for the Index Merge method intersection algorithm. The
            algorithm can be employed when the table's
            <code class="literal">WHERE</code> clause was converted to several
            range conditions on different keys combined with
            <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>, and each condition is one
            of the following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                In this form, where the index has exactly
                <em class="replaceable"><code>N</code></em> parts (that is, all index
                parts are covered):
              </p><pre class="programlisting"><em class="replaceable"><code>key_part1</code></em>=<em class="replaceable"><code>const1</code></em> AND <em class="replaceable"><code>key_part2</code></em>=<em class="replaceable"><code>const2</code></em> ... AND <em class="replaceable"><code>key_partN</code></em>=<em class="replaceable"><code>constN</code></em>
</pre></li><li class="listitem"><p>
                Any range condition over a primary key of an
                <code class="literal">InnoDB</code> table.
              </p></li><li class="listitem"><p>
                A condition for which the Index Merge method
                intersection algorithm is applicable.
</p></li></ul>
</div>
<p>
            Examples:
          </p><pre class="programlisting">SELECT * FROM t1 WHERE <em class="replaceable"><code>key1</code></em>=1 OR <em class="replaceable"><code>key2</code></em>=2 OR <em class="replaceable"><code>key3</code></em>=3;

SELECT * FROM <em class="replaceable"><code>innodb_table</code></em> WHERE (<em class="replaceable"><code>key1</code></em>=1 AND <em class="replaceable"><code>key2</code></em>=2) OR
  (<em class="replaceable"><code>key3</code></em>='foo' AND <em class="replaceable"><code>key4</code></em>='bar') AND <em class="replaceable"><code>key5</code></em>=5;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="index-merge-sort-union"></a>8.2.1.4.3. The Index Merge Sort-Union Access Algorithm</h5>

</div>

</div>

</div>
<p>
            This access algorithm is employed when the
            <code class="literal">WHERE</code> clause was converted to several
            range conditions combined by
            <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>, but for which the Index
            Merge method union algorithm is not applicable.
          </p><p>
            Examples:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col1</code></em> &lt; 10 OR <em class="replaceable"><code>key_col2</code></em> &lt; 20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE (<em class="replaceable"><code>key_col1</code></em> &gt; 10 OR <em class="replaceable"><code>key_col2</code></em> = 20) AND <em class="replaceable"><code>nonkey_col</code></em>=30;
</pre><p>
            The difference between the sort-union algorithm and the
            union algorithm is that the sort-union algorithm must first
            fetch row IDs for all rows and sort them before returning
            any rows.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="condition-pushdown-optimization"></a>8.2.1.5. Engine Condition Pushdown Optimization</h4>

</div>

</div>

</div>
<p>
          This optimization improves the efficiency of direct
          comparisons between a nonindexed column and a constant. In
          such cases, the condition is <span class="quote">“<span class="quote">pushed down</span>”</span> to the
          storage engine for evaluation. This optimization can be used
          only by the <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a> storage engine.
        </p><p>
          For MySQL Cluster, this optimization can eliminate the need to
          send nonmatching rows over the network between the
          cluster's data nodes and the MySQL Server that issued the
          query, and can speed up queries where it is used by a factor
          of 5 to 10 times over cases where condition pushdown could be
          but is not used.
        </p><p>
          Suppose that a MySQL Cluster table is defined as follows:
        </p><pre class="programlisting">CREATE TABLE t1 (
    a INT,
    b INT,
    KEY(a)
) ENGINE=NDB;</pre><p>
          Condition pushdown can be used with queries such as the one
          shown here, which includes a comparison between a nonindexed
          column and a constant:
        </p><pre class="programlisting">SELECT a, b FROM t1 WHERE b = 10;</pre><p>
          The use of condition pushdown can be seen in the output of
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT a,b FROM t1 WHERE b = 10\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 10
        Extra: Using where with pushed condition
</pre><p>
          However, condition pushdown <span class="emphasis"><em>cannot</em></span> be
          used with either of these two queries:
        </p><pre class="programlisting">SELECT a,b FROM t1 WHERE a = 10;
SELECT a,b FROM t1 WHERE b + 1 = 10;</pre><p>
          Condition pushdown is not applicable to the first query
          because an index exists on column <code class="literal">a</code>. (An
          index access method would be more efficient and so would be
          chosen in preference to condition pushdown.) Condition
          pushdown cannot be employed for the second query because the
          comparison involving the nonindexed column
          <code class="literal">b</code> is indirect. (However, condition pushdown
          could be applied if you were to reduce <code class="literal">b + 1 =
          10</code> to <code class="literal">b = 9</code> in the
          <code class="literal">WHERE</code> clause.)
        </p><p>
          Condition pushdown may also be employed when an indexed column
          is compared with a constant using a <code class="literal">&gt;</code> or
          <code class="literal">&lt;</code> operator:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT a, b FROM t1 WHERE a &lt; 2\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1
         type: range
possible_keys: a
          key: a
      key_len: 5
          ref: NULL
         rows: 2
        Extra: Using where with pushed condition
</pre><p>
          Other supported comparisons for condition pushdown include the
          following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> [NOT] LIKE
              <em class="replaceable"><code>pattern</code></em></code>
            </p><p>
              <em class="replaceable"><code>pattern</code></em> must be a string
              literal containing the pattern to be matched; for syntax,
              see <a class="xref" href="functions.html#string-comparison-functions" title="12.5.1. String Comparison Functions">Section 12.5.1, “String Comparison Functions”</a>.
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> IS [NOT]
              NULL</code>
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> IN
              (<em class="replaceable"><code>value_list</code></em>)</code>
            </p><p>
              Each item in the <em class="replaceable"><code>value_list</code></em>
              must be a constant, literal value.
            </p></li><li class="listitem"><p>
              <code class="literal"><em class="replaceable"><code>column</code></em> BETWEEN
              <em class="replaceable"><code>constant1</code></em> AND
              <em class="replaceable"><code>constant2</code></em></code>
            </p><p>
              <em class="replaceable"><code>constant1</code></em> and
              <em class="replaceable"><code>constant2</code></em> must each be a
              constant, literal value.
</p></li></ul>
</div>
<p>
          In all of the cases in the preceding list, it is possible for
          the condition to be converted into the form of one or more
          direct comparisons between a column and a constant.
        </p><p>
          Engine condition pushdown is enabled by default. To disable it
          at server startup, set the
          <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
          variable. For example, in a <code class="filename">my.cnf</code> file,
          use these lines:
        </p><pre class="programlisting">[mysqld]
optimizer_switch=engine_condition_pushdown=off</pre><p>
          At runtime, enable condition pushdown like this:
        </p><pre class="programlisting">SET optimizer_switch='engine_condition_pushdown=off';</pre><p><b>Limitations. </b>
            Engine condition pushdown is subject to the following
            limitations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Condition pushdown is supported only by the
              <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a> storage engine.
            </p></li><li class="listitem"><p>
              Columns may be compared with constants only; however, this
              includes expressions which evaluate to constant values.
            </p></li><li class="listitem"><p>
              Columns used in comparisons cannot be of any of the
              <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
              <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> types.
            </p></li><li class="listitem"><p>
              A string value to be compared with a column must use the
              same collation as the column.
            </p></li><li class="listitem"><p>
              Joins are not directly supported; conditions involving
              multiple tables are pushed separately where possible. Use
              <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN EXTENDED</code></a> to
              determine which conditions are actually pushed down.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-condition-pushdown-optimization"></a>8.2.1.6. Index Condition Pushdown Optimization</h4>

</div>

</div>

</div>
<p>
          Index Condition Pushdown (ICP) is an optimization for the case
          where MySQL retrieves rows from a table using an index.
          Without ICP, the storage engine traverses the index to locate
          rows in the base table and returns them to the MySQL server
          which evaluates the <code class="literal">WHERE</code> condition for the
          rows. With ICP enabled, and if parts of the
          <code class="literal">WHERE</code> condition can be evaluated by using
          only fields from the index, the MySQL server pushes this part
          of the <code class="literal">WHERE</code> condition down to the storage
          engine. The storage engine then evaluates the pushed index
          condition by using the index entry and only if this is
          satisfied is the row read from the table. ICP can reduce the
          number of times the storage engine must access the base table
          and the number of times the MySQL server must access the
          storage engine.
        </p><p>
          Index Condition Pushdown optimization is used for the
          <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>,
          <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>,
          <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>, and
          <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> access methods
          when there is a need to access full table rows. This strategy
          can be used for <code class="literal">InnoDB</code> and
          <code class="literal">MyISAM</code> tables. For
          <code class="literal">InnoDB</code> tables, however, ICP is only used
          for secondary indexes. The goal of ICP is to reduce the number
          of full-record reads and thereby reduce IO operations. For
          <code class="literal">InnoDB</code> clustered indexes, the complete
          record is already read into the <code class="literal">InnoDB</code>
          buffer. Using ICP in this case does not reduce IO.
        </p><p>
          To see how this optimization works, consider first how an
          index scan proceeds when Index Condition Pushdown is not used:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Get the next row, first by reading the index tuple, and
              then by using the index tuple to locate and read the full
              table row.
            </p></li><li class="listitem"><p>
              Test the part of the <code class="literal">WHERE</code> condition
              that applies to this table. Accept or reject the row based
              on the test result.
</p></li></ol>
</div>
<p>
          When Index Condition Pushdown is used, the scan proceeds like
          this instead:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Get the next row's index tuple (but not the full table
              row).
            </p></li><li class="listitem"><p>
              Test the part of the <code class="literal">WHERE</code> condition
              that applies to this table and can be checked using only
              index columns. If the condition is not satisfied, proceed
              to the index tuple for the next row.
            </p></li><li class="listitem"><p>
              If the condition is satisfied, use the index tuple to
              locate and read the full table row.
            </p></li><li class="listitem"><p>
              Test the remaining part of the <code class="literal">WHERE</code>
              condition that applies to this table. Accept or reject the
              row based on the test result.
</p></li></ol>
</div>
<p>
          When Index Condition Pushdown is used, the
          <code class="literal">Extra</code> column in
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output shows
          <code class="literal">Using index condition</code>. It will not show
          <code class="literal">Index only</code> because that does not apply when
          full table rows must be read.
        </p><p>
          Suppose that we have a table containing information about
          people and their addresses and that the table has an index
          defined as <code class="literal">INDEX (zipcode, lastname,
          firstname)</code>. If we know a person's
          <code class="literal">zipcode</code> value but are not sure about the
          last name, we can search like this:
        </p><pre class="programlisting">SELECT * FROM people
  WHERE zipcode='95054'
  AND lastname LIKE '%etrunia%'
  AND address LIKE '%Main Street%';</pre><p>
          MySQL can use the index to scan through people with
          <code class="literal">zipcode='95054'</code>. The second part
          (<code class="literal">lastname LIKE '%etrunia%'</code>) cannot be used
          to limit the number of rows that must be scanned, so without
          Index Condition Pushdown, this query must retrieve full table
          rows for all the people who have
          <code class="literal">zipcode='95054'</code>.
        </p><p>
          With Index Condition Pushdown, MySQL will check the
          <code class="literal">lastname LIKE '%etrunia%'</code> part before
          reading the full table row. This avoids reading full rows
          corresponding to all index tuples that do not match the
          <code class="literal">lastname</code> condition.
        </p><p>
          Index Condition Pushdown is enabled by default; it can be
          controlled with the
          <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
          variable by setting the
          <code class="literal">index_condition_pushdown</code> flag. See
          <a class="xref" href="optimization.html#switchable-optimizations" title="8.8.5.2. Controlling Switchable Optimizations">Section 8.8.5.2, “Controlling Switchable Optimizations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-extensions"></a>8.2.1.7. Use of Index Extensions</h4>

</div>

</div>

</div>
<p>
          <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> automatically extends each
          secondary index by appending the primary key columns to it.
          Consider this table definition:
        </p><pre class="programlisting">CREATE TABLE t1 (
  i1 INT NOT NULL DEFAULT 0,
  i2 INT NOT NULL DEFAULT 0,
  d DATE DEFAULT NULL,
  PRIMARY KEY (i1, i2),
  INDEX k_d (d)
) ENGINE = InnoDB;</pre><p>
          This table defines the primary key on columns <code class="literal">(i1,
          i2)</code>. It also defines a secondary index
          <code class="literal">k_d</code> on column <code class="literal">(d)</code>, but
          internally <code class="literal">InnoDB</code> extends this index and
          treats it as columns <code class="literal">(d, i1, i2)</code>.
        </p><p>
          Before MySQL 5.6.9, the optimizer does not take into account
          the primary key columns of the extended secondary index when
          determining how and whether to use that index. As of 5.6.9,
          the optimizer takes the primary key columns into account,
          which can result in more efficient query execution plans and
          better performance.
        </p><p>
          The optimizer can use extended secondary indexes for
          <code class="literal">ref</code>, <code class="literal">range</code>, and
          <code class="literal">index_merge</code> index access, for loose index
          scans, for join and sorting optimization, and for
          <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>/<a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
          optimization.
        </p><p>
          The following example shows how execution plans are affected
          by whether the optimizer uses extended secondary indexes.
          Suppose that <code class="literal">t1</code> is populated with these
          rows:
        </p><pre class="programlisting">INSERT INTO t1 VALUES
(1, 1, '1998-01-01'), (1, 2, '1999-01-01'),
(1, 3, '2000-01-01'), (1, 4, '2001-01-01'),
(1, 5, '2002-01-01'), (2, 1, '1998-01-01'),
(2, 2, '1999-01-01'), (2, 3, '2000-01-01'),
(2, 4, '2001-01-01'), (2, 5, '2002-01-01'),
(3, 1, '1998-01-01'), (3, 2, '1999-01-01'),
(3, 3, '2000-01-01'), (3, 4, '2001-01-01'),
(3, 5, '2002-01-01'), (4, 1, '1998-01-01'),
(4, 2, '1999-01-01'), (4, 3, '2000-01-01'),
(4, 4, '2001-01-01'), (4, 5, '2002-01-01'),
(5, 1, '1998-01-01'), (5, 2, '1999-01-01'),
(5, 3, '2000-01-01'), (5, 4, '2001-01-01'),
(5, 5, '2002-01-01');</pre><p>
          Now consider this query:
        </p><pre class="programlisting">EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'</pre><p>
          The optimizer cannot use the primary key in this case because
          that comprises columns <code class="literal">(i1, i2)</code> and the
          query does not refer to <code class="literal">i2</code>. Instead, the
          optimizer can use the secondary index <code class="literal">k_d</code>
          on <code class="literal">(d)</code>, and the execution plan depends on
          whether the extended index is used.
        </p><p>
          When the optimizer does not consider index extensions, it
          treats the index <code class="literal">k_d</code> as only
          <code class="literal">(d)</code>. <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
          for the query produces this result:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1
         type: ref
possible_keys: PRIMARY,k_d
          key: k_d
      key_len: 4
          ref: const
         rows: 5
        Extra: Using where; Using index
</pre><p>
          When the optimizer takes index extensions into account, it
          treats <code class="literal">k_d</code> as <code class="literal">(d, i1,
          i2)</code>. In this case, it can use the leftmost index
          prefix <code class="literal">(d, i1)</code> to produce a better
          execution plan:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: t1
         type: ref
possible_keys: PRIMARY,k_d
          key: k_d
      key_len: 8
          ref: const,const
         rows: 1
        Extra: Using index
</pre><p>
          In both cases, <code class="literal">key</code> indicates that the
          optimizer will use secondary index <code class="literal">k_d</code> but
          the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output shows these
          improvements from using the extended index:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">key_len</code> goes from 4 bytes to 8 bytes,
              indicating that key lookups use columns
              <code class="literal">d</code> and <code class="literal">i1</code>, not just
              <code class="literal">d</code>.
            </p></li><li class="listitem"><p>
              The <code class="literal">ref</code> value changes from
              <code class="literal">const</code> to <code class="literal">const,const</code>
              because the key lookup uses two key parts, not one.
            </p></li><li class="listitem"><p>
              The <code class="literal">rows</code> count decreases from 5 to 1,
              indicating that <code class="literal">InnoDB</code> should need to
              examine fewer rows to produce the result.
            </p></li><li class="listitem"><p>
              The <code class="literal">Extra</code> value changes from
              <code class="literal">Using where; Using index</code> to
              <code class="literal">Using index</code>. This means that rows can
              be read using only the index, without consulting columns
              in the data row.
</p></li></ul>
</div>
<p>
          Differences in optimizer behavior for use of extended indexes
          can also be seen with <a class="link" href="sql-syntax.html#show-status" title="13.7.5.36. SHOW STATUS Syntax"><code class="literal">SHOW
          STATUS</code></a>:
        </p><pre class="programlisting">FLUSH TABLE t1;
FLUSH STATUS;
SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01';
SHOW STATUS LIKE 'handler_read%'</pre><p>
          The preceding statements include
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLE</code></a>
          and <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
          STATUS</code></a> to flush the table cache and clear the status
          counters.
        </p><p>
          Without index extensions, <a class="link" href="sql-syntax.html#show-status" title="13.7.5.36. SHOW STATUS Syntax"><code class="literal">SHOW
          STATUS</code></a> produces this result:
        </p><pre class="programlisting">+-----------------------+-------+
| Variable_name         | Value |
+-----------------------+-------+
| Handler_read_first    | 0     |
| Handler_read_key      | 1     |
| Handler_read_last     | 0     |
| Handler_read_next     | 5     |
| Handler_read_prev     | 0     |
| Handler_read_rnd      | 0     |
| Handler_read_rnd_next | 0     |
+-----------------------+-------+</pre><p>
          With index extensions, <a class="link" href="sql-syntax.html#show-status" title="13.7.5.36. SHOW STATUS Syntax"><code class="literal">SHOW
          STATUS</code></a> produces this result. The
          <a class="link" href="server-administration.html#statvar_Handler_read_next"><code class="literal">Handler_read_next</code></a> value
          decreases from 5 to 1, indicating more efficient use of the
          index:
        </p><pre class="programlisting">+-----------------------+-------+
| Variable_name         | Value |
+-----------------------+-------+
| Handler_read_first    | 0     |
| Handler_read_key      | 1     |
| Handler_read_last     | 0     |
| Handler_read_next     | 1     |
| Handler_read_prev     | 0     |
| Handler_read_rnd      | 0     |
| Handler_read_rnd_next | 0     |
+-----------------------+-------+</pre><p>
          The <code class="literal">use_index_extensions</code> flag of the
          <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
          variable permits control over whether the optimizer takes the
          primary key columns into account when determining how to use
          an <code class="literal">InnoDB</code> table's secondary indexes. By
          default, <code class="literal">use_index_extensions</code> is enabled.
          To check whether disabling use of index extensions will
          improve performance, use this statement:
        </p><pre class="programlisting">SET optimizer_switch = 'use_index_extensions=off';</pre><p>
          Use of index extensions by the optimizer is subject to the
          usual limits on the number of key parts in an index (16) and
          the maximum key length (3072 bytes).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="is-null-optimization"></a>8.2.1.8. <code class="literal">IS NULL</code> Optimization</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp47805776"></a><a class="indexterm" name="idp47806848"></a><p>
          MySQL can perform the same optimization on
          <em class="replaceable"><code>col_name</code></em> <a class="link" href="functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a> that it can use for
          <em class="replaceable"><code>col_name</code></em> <code class="literal">=</code>
          <em class="replaceable"><code>constant_value</code></em>. For example, MySQL
          can use indexes and ranges to search for
          <code class="literal">NULL</code> with <a class="link" href="functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a>.
        </p><p>
          Examples:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> IS NULL;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> &lt;=&gt; NULL;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>const1</code></em> OR <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>const2</code></em> OR <em class="replaceable"><code>key_col</code></em> IS NULL;
</pre><p>
          If a <code class="literal">WHERE</code> clause includes a
          <em class="replaceable"><code>col_name</code></em> <a class="link" href="functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a> condition for a column that is declared as
          <code class="literal">NOT NULL</code>, that expression is optimized
          away. This optimization does not occur in cases when the
          column might produce <code class="literal">NULL</code> anyway; for
          example, if it comes from a table on the right side of a
          <code class="literal">LEFT JOIN</code>.
        </p><p>
          MySQL can also optimize the combination
          <code class="literal"><em class="replaceable"><code>col_name</code></em> =
          <em class="replaceable"><code>expr</code></em> OR
          <em class="replaceable"><code>col_name</code></em> IS NULL</code>, a form
          that is common in resolved subqueries.
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> shows
          <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> when this
          optimization is used.
        </p><p>
          This optimization can handle one <a class="link" href="functions.html#operator_is-null"><code class="literal">IS
          NULL</code></a> for any key part.
        </p><p>
          Some examples of queries that are optimized, assuming that
          there is an index on columns <code class="literal">a</code> and
          <code class="literal">b</code> of table <code class="literal">t2</code>:
        </p><pre class="programlisting">SELECT * FROM t1 WHERE t1.a=<em class="replaceable"><code>expr</code></em> OR t1.a IS NULL;

SELECT * FROM t1, t2 WHERE t1.a=t2.a OR t2.a IS NULL;

SELECT * FROM t1, t2
  WHERE (t1.a=t2.a OR t2.a IS NULL) AND t2.b=t1.b;

SELECT * FROM t1, t2
  WHERE t1.a=t2.a AND (t2.b=t1.b OR t2.b IS NULL);

SELECT * FROM t1, t2
  WHERE (t1.a=t2.a AND t2.a IS NULL AND ...)
  OR (t1.a=t2.a AND t2.a IS NULL AND ...);
</pre><p>
          <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> works by first
          doing a read on the reference key, and then a separate search
          for rows with a <code class="literal">NULL</code> key value.
        </p><p>
          Note that the optimization can handle only one
          <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a> level. In the following
          query, MySQL uses key lookups only on the expression
          <code class="literal">(t1.a=t2.a AND t2.a IS NULL)</code> and is not
          able to use the key part on <code class="literal">b</code>:
        </p><pre class="programlisting">SELECT * FROM t1, t2
  WHERE (t1.a=t2.a AND t2.a IS NULL)
OR (t1.b=t2.b AND t2.b IS NULL);</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="left-join-optimization"></a>8.2.1.9. <code class="literal">LEFT JOIN</code> and <code class="literal">RIGHT JOIN</code>
Optimization</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp47840720"></a><a class="indexterm" name="idp47841792"></a><p>
          MySQL implements an <code class="literal"><em class="replaceable"><code>A</code></em> LEFT
          JOIN <em class="replaceable"><code>B</code></em> join_condition</code> as
          follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Table <em class="replaceable"><code>B</code></em> is set to depend on
              table <em class="replaceable"><code>A</code></em> and all tables on which
              <em class="replaceable"><code>A</code></em> depends.
            </p></li><li class="listitem"><p>
              Table <em class="replaceable"><code>A</code></em> is set to depend on all
              tables (except <em class="replaceable"><code>B</code></em>) that are used
              in the <code class="literal">LEFT JOIN</code> condition.
            </p></li><li class="listitem"><p>
              The <code class="literal">LEFT JOIN</code> condition is used to
              decide how to retrieve rows from table
              <em class="replaceable"><code>B</code></em>. (In other words, any
              condition in the <code class="literal">WHERE</code> clause is not
              used.)
            </p></li><li class="listitem"><p>
              All standard join optimizations are performed, with the
              exception that a table is always read after all tables on
              which it depends. If there is a circular dependence, MySQL
              issues an error.
            </p></li><li class="listitem"><p>
              All standard <code class="literal">WHERE</code> optimizations are
              performed.
            </p></li><li class="listitem"><p>
              If there is a row in <em class="replaceable"><code>A</code></em> that
              matches the <code class="literal">WHERE</code> clause, but there is
              no row in <em class="replaceable"><code>B</code></em> that matches the
              <code class="literal">ON</code> condition, an extra
              <em class="replaceable"><code>B</code></em> row is generated with all
              columns set to <code class="literal">NULL</code>.
            </p></li><li class="listitem"><p>
              If you use <code class="literal">LEFT JOIN</code> to find rows that
              do not exist in some table and you have the following
              test: <code class="literal"><em class="replaceable"><code>col_name</code></em> IS
              NULL</code> in the <code class="literal">WHERE</code> part, where
              <em class="replaceable"><code>col_name</code></em> is a column that is
              declared as <code class="literal">NOT NULL</code>, MySQL stops
              searching for more rows (for a particular key combination)
              after it has found one row that matches the <code class="literal">LEFT
              JOIN</code> condition.
</p></li></ul>
</div>
<p>
          The implementation of <code class="literal">RIGHT JOIN</code> is
          analogous to that of <code class="literal">LEFT JOIN</code> with the
          roles of the tables reversed.
        </p><p>
          <a class="indexterm" name="idp47867392"></a>

          The join optimizer calculates the order in which tables should
          be joined. The table read order forced by <code class="literal">LEFT
          JOIN</code> or <code class="literal">STRAIGHT_JOIN</code> helps the
          join optimizer do its work much more quickly, because there
          are fewer table permutations to check. Note that this means
          that if you do a query of the following type, MySQL does a
          full scan on <code class="literal">b</code> because the <code class="literal">LEFT
          JOIN</code> forces it to be read before
          <code class="literal">d</code>:
        </p><pre class="programlisting">SELECT *
  FROM a JOIN b LEFT JOIN c ON (c.key=a.key)
  LEFT JOIN d ON (d.key=a.key)
  WHERE b.key=d.key;</pre><p>
          The fix in this case is reverse the order in which
          <code class="literal">a</code> and <code class="literal">b</code> are listed in
          the <code class="literal">FROM</code> clause:
        </p><pre class="programlisting">SELECT *
  FROM b JOIN a LEFT JOIN c ON (c.key=a.key)
  LEFT JOIN d ON (d.key=a.key)
  WHERE b.key=d.key;</pre><p>
          For a <code class="literal">LEFT JOIN</code>, if the
          <code class="literal">WHERE</code> condition is always false for the
          generated <code class="literal">NULL</code> row, the <code class="literal">LEFT
          JOIN</code> is changed to a normal join. For example, the
          <code class="literal">WHERE</code> clause would be false in the
          following query if <code class="literal">t2.column1</code> were
          <code class="literal">NULL</code>:
        </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN t2 ON (column1) WHERE t2.column2=5;</pre><p>
          Therefore, it is safe to convert the query to a normal join:
        </p><pre class="programlisting">SELECT * FROM t1, t2 WHERE t2.column2=5 AND t1.column1=t2.column1;</pre><p>
          <a class="indexterm" name="idp47884464"></a>

          This can be made faster because MySQL can use table
          <code class="literal">t2</code> before table <code class="literal">t1</code> if
          doing so would result in a better query plan. To provide a
          hint about the table join order, use
          <code class="literal">STRAIGHT_JOIN</code>. (See
          <a class="xref" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax">Section 13.2.9, “<code class="literal">SELECT</code> Syntax”</a>.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="nested-loop-joins"></a>8.2.1.10. Nested-Loop Join Algorithms</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp47889616"></a><a class="indexterm" name="idp47890704"></a><a class="indexterm" name="idp47892192"></a><a class="indexterm" name="idp47893280"></a><p>
          MySQL executes joins between tables using a nested-loop
          algorithm or variations on it.
        </p><p>
          <span class="bold"><strong>Nested-Loop Join Algorithm</strong></span>
        </p><p>
          A simple nested-loop join (NLJ) algorithm reads rows from the
          first table in a loop one at a time, passing each row to a
          nested loop that processes the next table in the join. This
          process is repeated as many times as there remain tables to be
          joined.
        </p><p>
          Assume that a join between three tables <code class="literal">t1</code>,
          <code class="literal">t2</code>, and <code class="literal">t3</code> is to be
          executed using the following join types:
        </p><pre class="programlisting">Table   Join Type
t1      range
t2      ref
t3      ALL</pre><p>
          If a simple NLJ algorithm is used, the join is processed like
          this:
        </p><pre class="programlisting">for each row in t1 matching range {
  for each row in t2 matching reference key {
    for each row in t3 {
      if row satisfies join conditions,
      send to client
    }
  }
}</pre><p>
          Because the NLJ algorithm passes rows one at a time from outer
          loops to inner loops, it typically reads tables processed in
          the inner loops many times.
        </p><p>
          <span class="bold"><strong>Block Nested-Loop Join
          Algorithm</strong></span>
        </p><p>
          A Block Nested-Loop (BNL) join algorithm uses buffering of
          rows read in outer loops to reduce the number of times that
          tables in inner loops must be read. For example, if 10 rows
          are read into a buffer and the buffer is passed to the next
          inner loop, each row read in the inner loop can be compared
          against all 10 rows in the buffer. The reduces the number of
          times the inner table must be read by an order of magnitude.
        </p><p>
          MySQL uses join buffering under these conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The <a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a>
              system variable determines the size of each join buffer.
            </p></li><li class="listitem"><p>
              Join buffering can be used when the join is of type
              <a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a> or
              <a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a> (in other words,
              when no possible keys can be used, and a full scan is
              done, of either the data or index rows, respectively), or
              <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>. In MySQL
              5.6, use of buffering is extended to be
              applicable to outer joins, as described in
              <a class="xref" href="optimization.html#bnl-bka-optimization" title="8.2.1.14. Block Nested-Loop and Batched Key Access Joins">Section 8.2.1.14, “Block Nested-Loop and Batched Key Access Joins”</a>.
            </p></li><li class="listitem"><p>
              One buffer is allocated for each join that can be
              buffered, so a given query might be processed using
              multiple join buffers.
            </p></li><li class="listitem"><p>
              A join buffer is never allocated for the first nonconst
              table, even if it would be of type
              <a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a> or
              <a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>.
            </p></li><li class="listitem"><p>
              A join buffer is allocated prior to executing the join and
              freed after the query is done.
            </p></li><li class="listitem"><p>
              Only columns of interest to the join are stored in the
              join buffer, not whole rows.
</p></li></ul>
</div>
<p>
          For the example join described previously for the NLJ
          algorithm (without buffering), the join is done as follow
          using join buffering:
        </p><pre class="programlisting">for each row in t1 matching range {
  for each row in t2 matching reference key {
    store used columns from t1, t2 in join buffer
    if buffer is full {
      for each row in t3 {
        for each t1, t2 combination in join buffer {
          if row satisfies join conditions,
          send to client
        }
      }
      empty buffer
    }
  }
}

if buffer is not empty {
  for each row in t3 {
    for each t1, t2 combination in join buffer {
      if row satisfies join conditions,
      send to client
    }
  }
}</pre><p>
          If <em class="replaceable"><code>S</code></em> is the size of each stored
          <code class="literal">t1</code>, <code class="literal">t2</code> combination is
          the join buffer and <em class="replaceable"><code>C</code></em> is the number
          of combinations in the buffer, the number of times table
          <code class="literal">t3</code> is scanned is:
        </p><pre class="programlisting">(<em class="replaceable"><code>S</code></em> * <em class="replaceable"><code>C</code></em>)/join_buffer_size + 1
</pre><p>
          The number of <code class="literal">t3</code> scans decreases as the
          value of <a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a>
          increases, up to the point when
          <a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a> is large
          enough to hold all previous row combinations. At that point,
          there is no speed to be gained by making it larger.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="nested-join-optimization"></a>8.2.1.11. Nested Join Optimization</h4>

</div>

</div>

</div>
<p>
          The syntax for expressing joins permits nested joins. The
          following discussion refers to the join syntax described in
          <a class="xref" href="sql-syntax.html#join" title="13.2.9.2. JOIN Syntax">Section 13.2.9.2, “<code class="literal">JOIN</code> Syntax”</a>.
        </p><p>
          The syntax of <em class="replaceable"><code>table_factor</code></em> is
          extended in comparison with the SQL Standard. The latter
          accepts only <em class="replaceable"><code>table_reference</code></em>, not a
          list of them inside a pair of parentheses. This is a
          conservative extension if we consider each comma in a list of
          <em class="replaceable"><code>table_reference</code></em> items as equivalent
          to an inner join. For example:
        </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN (t2, t3, t4)
                 ON (t2.a=t1.a AND t3.b=t1.b AND t4.c=t1.c)</pre><p>
          is equivalent to:
        </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN (t2 CROSS JOIN t3 CROSS JOIN t4)
                 ON (t2.a=t1.a AND t3.b=t1.b AND t4.c=t1.c)</pre><p>
          In MySQL, <code class="literal">CROSS JOIN</code> is a syntactic
          equivalent to <code class="literal">INNER JOIN</code> (they can replace
          each other). In standard SQL, they are not equivalent.
          <code class="literal">INNER JOIN</code> is used with an
          <code class="literal">ON</code> clause; <code class="literal">CROSS JOIN</code> is
          used otherwise.
        </p><p>
          In general, parentheses can be ignored in join expressions
          containing only inner join operations. After removing
          parentheses and grouping operations to the left, the join
          expression:
        </p><pre class="programlisting">t1 LEFT JOIN (t2 LEFT JOIN t3 ON t2.b=t3.b OR t2.b IS NULL)
   ON t1.a=t2.a</pre><p>
          transforms into the expression:
        </p><pre class="programlisting">(t1 LEFT JOIN t2 ON t1.a=t2.a) LEFT JOIN t3
    ON t2.b=t3.b OR t2.b IS NULL</pre><p>
          Yet, the two expressions are not equivalent. To see this,
          suppose that the tables <code class="literal">t1</code>,
          <code class="literal">t2</code>, and <code class="literal">t3</code> have the
          following state:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Table <code class="literal">t1</code> contains rows
              <code class="literal">(1)</code>, <code class="literal">(2)</code>
            </p></li><li class="listitem"><p>
              Table <code class="literal">t2</code> contains row
              <code class="literal">(1,101)</code>
            </p></li><li class="listitem"><p>
              Table <code class="literal">t3</code> contains row
              <code class="literal">(101)</code>
</p></li></ul>
</div>
<p>
          In this case, the first expression returns a result set
          including the rows <code class="literal">(1,1,101,101)</code>,
          <code class="literal">(2,NULL,NULL,NULL)</code>, whereas the second
          expression returns the rows <code class="literal">(1,1,101,101)</code>,
          <code class="literal">(2,NULL,NULL,101)</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1</code></strong>
    -&gt;      <strong class="userinput"><code>LEFT JOIN</code></strong>
    -&gt;      <strong class="userinput"><code>(t2 LEFT JOIN t3 ON t2.b=t3.b OR t2.b IS NULL)</code></strong>
    -&gt;      <strong class="userinput"><code>ON t1.a=t2.a;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL | NULL |
+------+------+------+------+

mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM (t1 LEFT JOIN t2 ON t1.a=t2.a)</code></strong>
    -&gt;      <strong class="userinput"><code>LEFT JOIN t3</code></strong>
    -&gt;      <strong class="userinput"><code>ON t2.b=t3.b OR t2.b IS NULL;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL |  101 |
+------+------+------+------+
</pre><p>
          In the following example, an outer join operation is used
          together with an inner join operation:
        </p><pre class="programlisting">t1 LEFT JOIN (t2, t3) ON t1.a=t2.a</pre><p>
          That expression cannot be transformed into the following
          expression:
        </p><pre class="programlisting">t1 LEFT JOIN t2 ON t1.a=t2.a, t3.</pre><p>
          For the given table states, the two expressions return
          different sets of rows:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1 LEFT JOIN (t2, t3) ON t1.a=t2.a;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL | NULL |
+------+------+------+------+

mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1 LEFT JOIN t2 ON t1.a=t2.a, t3;</code></strong>
+------+------+------+------+
| a    | a    | b    | b    |
+------+------+------+------+
|    1 |    1 |  101 |  101 |
|    2 | NULL | NULL |  101 |
+------+------+------+------+
</pre><p>
          Therefore, if we omit parentheses in a join expression with
          outer join operators, we might change the result set for the
          original expression.
        </p><p>
          More exactly, we cannot ignore parentheses in the right
          operand of the left outer join operation and in the left
          operand of a right join operation. In other words, we cannot
          ignore parentheses for the inner table expressions of outer
          join operations. Parentheses for the other operand (operand
          for the outer table) can be ignored.
        </p><p>
          The following expression:
        </p><pre class="programlisting">(t1,t2) LEFT JOIN t3 ON P(t2.b,t3.b)</pre><p>
          is equivalent to this expression:
        </p><pre class="programlisting">t1, t2 LEFT JOIN t3 ON P(t2.b,t3.b)</pre><p>
          for any tables <code class="literal">t1,t2,t3</code> and any condition
          <code class="literal">P</code> over attributes <code class="literal">t2.b</code>
          and <code class="literal">t3.b</code>.
        </p><p>
          Whenever the order of execution of the join operations in a
          join expression (<em class="replaceable"><code>join_table</code></em>) is not
          from left to right, we talk about nested joins. Consider the
          following queries:
        </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN (t2 LEFT JOIN t3 ON t2.b=t3.b) ON t1.a=t2.a
  WHERE t1.a &gt; 1

SELECT * FROM t1 LEFT JOIN (t2, t3) ON t1.a=t2.a
  WHERE (t2.b=t3.b OR t2.b IS NULL) AND t1.a &gt; 1</pre><p>
          Those queries are considered to contain these nested joins:
        </p><pre class="programlisting">t2 LEFT JOIN t3 ON t2.b=t3.b
t2, t3</pre><p>
          The nested join is formed in the first query with a left join
          operation, whereas in the second query it is formed with an
          inner join operation.
        </p><p>
          In the first query, the parentheses can be omitted: The
          grammatical structure of the join expression will dictate the
          same order of execution for join operations. For the second
          query, the parentheses cannot be omitted, although the join
          expression here can be interpreted unambiguously without them.
          (In our extended syntax the parentheses in <code class="literal">(t2,
          t3)</code> of the second query are required, although
          theoretically the query could be parsed without them: We still
          would have unambiguous syntactical structure for the query
          because <code class="literal">LEFT JOIN</code> and <code class="literal">ON</code>
          would play the role of the left and right delimiters for the
          expression <code class="literal">(t2,t3)</code>.)
        </p><p>
          The preceding examples demonstrate these points:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              For join expressions involving only inner joins (and not
              outer joins), parentheses can be removed. You can remove
              parentheses and evaluate left to right (or, in fact, you
              can evaluate the tables in any order).
            </p></li><li class="listitem"><p>
              The same is not true, in general, for outer joins or for
              outer joins mixed with inner joins. Removal of parentheses
              may change the result.
</p></li></ul>
</div>
<a class="indexterm" name="idp47985344"></a><a class="indexterm" name="idp47986832"></a><p>
          Queries with nested outer joins are executed in the same
          pipeline manner as queries with inner joins. More exactly, a
          variation of the nested-loop join algorithm is exploited.
          Recall by what algorithmic schema the nested-loop join
          executes a query. Suppose that we have a join query over 3
          tables <code class="literal">T1,T2,T3</code> of the form:
        </p><pre class="programlisting">SELECT * FROM T1 INNER JOIN T2 ON P1(T1,T2)
                 INNER JOIN T3 ON P2(T2,T3)
  WHERE P(T1,T2,T3).</pre><p>
          Here, <code class="literal">P1(T1,T2)</code> and
          <code class="literal">P2(T3,T3)</code> are some join conditions (on
          expressions), whereas <code class="literal">P(t1,t2,t3)</code> is a
          condition over columns of tables <code class="literal">T1,T2,T3</code>.
        </p><p>
          The nested-loop join algorithm would execute this query in the
          following manner:
        </p><pre class="programlisting">FOR each row t1 in T1 {
  FOR each row t2 in T2 such that P1(t1,t2) {
    FOR each row t3 in T3 such that P2(t2,t3) {
      IF P(t1,t2,t3) {
         t:=t1||t2||t3; OUTPUT t;
      }
    }
  }
}</pre><p>
          The notation <code class="literal">t1||t2||t3</code> means <span class="quote">“<span class="quote">a row
          constructed by concatenating the columns of rows
          <code class="literal">t1</code>, <code class="literal">t2</code>, and
          <code class="literal">t3</code>.</span>”</span> In some of the following
          examples, <code class="literal">NULL</code> where a row name appears
          means that <code class="literal">NULL</code> is used for each column of
          that row. For example, <code class="literal">t1||t2||NULL</code> means
          <span class="quote">“<span class="quote">a row constructed by concatenating the columns of rows
          <code class="literal">t1</code> and <code class="literal">t2</code>, and
          <code class="literal">NULL</code> for each column of
          <code class="literal">t3</code>.</span>”</span>
        </p><p>
          Now let's consider a query with nested outer joins:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 LEFT JOIN T3 ON P2(T2,T3))
              ON P1(T1,T2)
  WHERE P(T1,T2,T3).</pre><p>
          For this query, we modify the nested-loop pattern to get:
        </p><pre class="programlisting">FOR each row t1 in T1 {
  BOOL f1:=FALSE;
  FOR each row t2 in T2 such that P1(t1,t2) {
    BOOL f2:=FALSE;
    FOR each row t3 in T3 such that P2(t2,t3) {
      IF P(t1,t2,t3) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f2=TRUE;
      f1=TRUE;
    }
    IF (!f2) {
      IF P(t1,t2,NULL) {
        t:=t1||t2||NULL; OUTPUT t;
      }
      f1=TRUE;
    }
  }
  IF (!f1) {
    IF P(t1,NULL,NULL) {
      t:=t1||NULL||NULL; OUTPUT t;
    }
  }
}</pre><p>
          In general, for any nested loop for the first inner table in
          an outer join operation, a flag is introduced that is turned
          off before the loop and is checked after the loop. The flag is
          turned on when for the current row from the outer table a
          match from the table representing the inner operand is found.
          If at the end of the loop cycle the flag is still off, no
          match has been found for the current row of the outer table.
          In this case, the row is complemented by
          <code class="literal">NULL</code> values for the columns of the inner
          tables. The result row is passed to the final check for the
          output or into the next nested loop, but only if the row
          satisfies the join condition of all embedded outer joins.
        </p><p>
          In our example, the outer join table expressed by the
          following expression is embedded:
        </p><pre class="programlisting">(T2 LEFT JOIN T3 ON P2(T2,T3))</pre><p>
          Note that for the query with inner joins, the optimizer could
          choose a different order of nested loops, such as this one:
        </p><pre class="programlisting">FOR each row t3 in T3 {
  FOR each row t2 in T2 such that P2(t2,t3) {
    FOR each row t1 in T1 such that P1(t1,t2) {
      IF P(t1,t2,t3) {
         t:=t1||t2||t3; OUTPUT t;
      }
    }
  }
}</pre><p>
          For the queries with outer joins, the optimizer can choose
          only such an order where loops for outer tables precede loops
          for inner tables. Thus, for our query with outer joins, only
          one nesting order is possible. For the following query, the
          optimizer will evaluate two different nestings:
        </p><pre class="programlisting">SELECT * T1 LEFT JOIN (T2,T3) ON P1(T1,T2) AND P2(T1,T3)
  WHERE P(T1,T2,T3)</pre><p>
          The nestings are these:
        </p><pre class="programlisting">FOR each row t1 in T1 {
  BOOL f1:=FALSE;
  FOR each row t2 in T2 such that P1(t1,t2) {
    FOR each row t3 in T3 such that P2(t1,t3) {
      IF P(t1,t2,t3) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f1:=TRUE
    }
  }
  IF (!f1) {
    IF P(t1,NULL,NULL) {
      t:=t1||NULL||NULL; OUTPUT t;
    }
  }
}</pre><p>
          and:
        </p><pre class="programlisting">FOR each row t1 in T1 {
  BOOL f1:=FALSE;
  FOR each row t3 in T3 such that P2(t1,t3) {
    FOR each row t2 in T2 such that P1(t1,t2) {
      IF P(t1,t2,t3) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f1:=TRUE
    }
  }
  IF (!f1) {
    IF P(t1,NULL,NULL) {
      t:=t1||NULL||NULL; OUTPUT t;
    }
  }
}</pre><p>
          In both nestings, <code class="literal">T1</code> must be processed in
          the outer loop because it is used in an outer join.
          <code class="literal">T2</code> and <code class="literal">T3</code> are used in an
          inner join, so that join must be processed in the inner loop.
          However, because the join is an inner join,
          <code class="literal">T2</code> and <code class="literal">T3</code> can be
          processed in either order.
        </p><p>
          When discussing the nested-loop algorithm for inner joins, we
          omitted some details whose impact on the performance of query
          execution may be huge. We did not mention so-called
          <span class="quote">“<span class="quote">pushed-down</span>”</span> conditions. Suppose that our
          <code class="literal">WHERE</code> condition
          <code class="literal">P(T1,T2,T3)</code> can be represented by a
          conjunctive formula:
        </p><pre class="programlisting">P(T1,T2,T2) = C1(T1) AND C2(T2) AND C3(T3).</pre><p>
          In this case, MySQL actually uses the following nested-loop
          schema for the execution of the query with inner joins:
        </p><pre class="programlisting">FOR each row t1 in T1 such that C1(t1) {
  FOR each row t2 in T2 such that P1(t1,t2) AND C2(t2)  {
    FOR each row t3 in T3 such that P2(t2,t3) AND C3(t3) {
      IF P(t1,t2,t3) {
         t:=t1||t2||t3; OUTPUT t;
      }
    }
  }
}</pre><p>
          You see that each of the conjuncts <code class="literal">C1(T1)</code>,
          <code class="literal">C2(T2)</code>, <code class="literal">C3(T3)</code> are
          pushed out of the most inner loop to the most outer loop where
          it can be evaluated. If <code class="literal">C1(T1)</code> is a very
          restrictive condition, this condition pushdown may greatly
          reduce the number of rows from table <code class="literal">T1</code>
          passed to the inner loops. As a result, the execution time for
          the query may improve immensely.
        </p><p>
          For a query with outer joins, the <code class="literal">WHERE</code>
          condition is to be checked only after it has been found that
          the current row from the outer table has a match in the inner
          tables. Thus, the optimization of pushing conditions out of
          the inner nested loops cannot be applied directly to queries
          with outer joins. Here we have to introduce conditional
          pushed-down predicates guarded by the flags that are turned on
          when a match has been encountered.
        </p><p>
          For our example with outer joins with:
        </p><pre class="programlisting">P(T1,T2,T3)=C1(T1) AND C(T2) AND C3(T3)</pre><p>
          the nested-loop schema using guarded pushed-down conditions
          looks like this:
        </p><pre class="programlisting">FOR each row t1 in T1 such that C1(t1) {
  BOOL f1:=FALSE;
  FOR each row t2 in T2
      such that P1(t1,t2) AND (f1?C2(t2):TRUE) {
    BOOL f2:=FALSE;
    FOR each row t3 in T3
        such that P2(t2,t3) AND (f1&amp;&amp;f2?C3(t3):TRUE) {
      IF (f1&amp;&amp;f2?TRUE:(C2(t2) AND C3(t3))) {
        t:=t1||t2||t3; OUTPUT t;
      }
      f2=TRUE;
      f1=TRUE;
    }
    IF (!f2) {
      IF (f1?TRUE:C2(t2) &amp;&amp; P(t1,t2,NULL)) {
        t:=t1||t2||NULL; OUTPUT t;
      }
      f1=TRUE;
    }
  }
  IF (!f1 &amp;&amp; P(t1,NULL,NULL)) {
      t:=t1||NULL||NULL; OUTPUT t;
  }
}</pre><p>
          In general, pushed-down predicates can be extracted from join
          conditions such as <code class="literal">P1(T1,T2)</code> and
          <code class="literal">P(T2,T3)</code>. In this case, a pushed-down
          predicate is guarded also by a flag that prevents checking the
          predicate for the <code class="literal">NULL</code>-complemented row
          generated by the corresponding outer join operation.
        </p><p>
          Note that access by key from one inner table to another in the
          same nested join is prohibited if it is induced by a predicate
          from the <code class="literal">WHERE</code> condition. (We could use
          conditional key access in this case, but this technique is not
          employed yet in MySQL 5.6.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="outer-join-simplification"></a>8.2.1.12. Outer Join Simplification</h4>

</div>

</div>

</div>
<p>
          Table expressions in the <code class="literal">FROM</code> clause of a
          query are simplified in many cases.
        </p><p>
          At the parser stage, queries with right outer joins operations
          are converted to equivalent queries containing only left join
          operations. In the general case, the conversion is performed
          according to the following rule:
        </p><pre class="programlisting">(T1, ...) RIGHT JOIN (T2,...) ON P(T1,...,T2,...) =
(T2, ...) LEFT JOIN (T1,...) ON P(T1,...,T2,...)</pre><p>
          All inner join expressions of the form <code class="literal">T1 INNER JOIN
          T2 ON P(T1,T2)</code> are replaced by the list
          <code class="literal">T1,T2</code>, <code class="literal">P(T1,T2)</code> being
          joined as a conjunct to the <code class="literal">WHERE</code> condition
          (or to the join condition of the embedding join, if there is
          any).
        </p><p>
          When the optimizer evaluates plans for join queries with outer
          join operation, it takes into consideration only the plans
          where, for each such operation, the outer tables are accessed
          before the inner tables. The optimizer options are limited
          because only such plans enables us to execute queries with
          outer joins operations by the nested loop schema.
        </p><p>
          Suppose that we have a query of the form:
        </p><pre class="programlisting">SELECT * T1 LEFT JOIN T2 ON P1(T1,T2)
  WHERE P(T1,T2) AND R(T2)</pre><p>
          with <code class="literal">R(T2)</code> narrowing greatly the number of
          matching rows from table <code class="literal">T2</code>. If we executed
          the query as it is, the optimizer would have no other choice
          besides to access table <code class="literal">T1</code> before table
          <code class="literal">T2</code> that may lead to a very inefficient
          execution plan.
        </p><p>
          Fortunately, MySQL converts such a query into a query without
          an outer join operation if the <code class="literal">WHERE</code>
          condition is null-rejected. A condition is called
          null-rejected for an outer join operation if it evaluates to
          <code class="literal">FALSE</code> or to <code class="literal">UNKNOWN</code> for
          any <code class="literal">NULL</code>-complemented row built for the
          operation.
        </p><p>
          Thus, for this outer join:
        </p><pre class="programlisting">T1 LEFT JOIN T2 ON T1.A=T2.A</pre><p>
          Conditions such as these are null-rejected:
        </p><pre class="programlisting">T2.B IS NOT NULL,
T2.B &gt; 3,
T2.C &lt;= T1.C,
T2.B &lt; 2 OR T2.C &gt; 1</pre><p>
          Conditions such as these are not null-rejected:
        </p><pre class="programlisting">T2.B IS NULL,
T1.B &lt; 3 OR T2.B IS NOT NULL,
T1.B &lt; 3 OR T2.B &gt; 3</pre><p>
          The general rules for checking whether a condition is
          null-rejected for an outer join operation are simple. A
          condition is null-rejected in the following cases:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If it is of the form <code class="literal">A IS NOT NULL</code>,
              where <code class="literal">A</code> is an attribute of any of the
              inner tables
            </p></li><li class="listitem"><p>
              If it is a predicate containing a reference to an inner
              table that evaluates to <code class="literal">UNKNOWN</code> when
              one of its arguments is <code class="literal">NULL</code>
            </p></li><li class="listitem"><p>
              If it is a conjunction containing a null-rejected
              condition as a conjunct
            </p></li><li class="listitem"><p>
              If it is a disjunction of null-rejected conditions
</p></li></ul>
</div>
<p>
          A condition can be null-rejected for one outer join operation
          in a query and not null-rejected for another. In the query:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 LEFT JOIN T3 ON T3.B=T1.B
  WHERE T3.C &gt; 0</pre><p>
          the <code class="literal">WHERE</code> condition is null-rejected for
          the second outer join operation but is not null-rejected for
          the first one.
        </p><p>
          If the <code class="literal">WHERE</code> condition is null-rejected for
          an outer join operation in a query, the outer join operation
          is replaced by an inner join operation.
        </p><p>
          For example, the preceding query is replaced with the query:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 INNER JOIN T3 ON T3.B=T1.B
  WHERE T3.C &gt; 0</pre><p>
          For the original query, the optimizer would evaluate plans
          compatible with only one access order
          <code class="literal">T1,T2,T3</code>. For the replacing query, it
          additionally considers the access sequence
          <code class="literal">T3,T1,T2</code>.
        </p><p>
          A conversion of one outer join operation may trigger a
          conversion of another. Thus, the query:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 LEFT JOIN T3 ON T3.B=T2.B
  WHERE T3.C &gt; 0</pre><p>
          will be first converted to the query:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN T2 ON T2.A=T1.A
                 INNER JOIN T3 ON T3.B=T2.B
  WHERE T3.C &gt; 0</pre><p>
          which is equivalent to the query:
        </p><pre class="programlisting">SELECT * FROM (T1 LEFT JOIN T2 ON T2.A=T1.A), T3
  WHERE T3.C &gt; 0 AND T3.B=T2.B</pre><p>
          Now the remaining outer join operation can be replaced by an
          inner join, too, because the condition
          <code class="literal">T3.B=T2.B</code> is null-rejected and we get a
          query without outer joins at all:
        </p><pre class="programlisting">SELECT * FROM (T1 INNER JOIN T2 ON T2.A=T1.A), T3
  WHERE T3.C &gt; 0 AND T3.B=T2.B</pre><p>
          Sometimes we succeed in replacing an embedded outer join
          operation, but cannot convert the embedding outer join. The
          following query:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 LEFT JOIN T3 ON T3.B=T2.B)
              ON T2.A=T1.A
  WHERE T3.C &gt; 0</pre><p>
          is converted to:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 INNER JOIN T3 ON T3.B=T2.B)
              ON T2.A=T1.A
  WHERE T3.C &gt; 0,</pre><p>
          That can be rewritten only to the form still containing the
          embedding outer join operation:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2,T3)
              ON (T2.A=T1.A AND T3.B=T2.B)
  WHERE T3.C &gt; 0.</pre><p>
          When trying to convert an embedded outer join operation in a
          query, we must take into account the join condition for the
          embedding outer join together with the
          <code class="literal">WHERE</code> condition. In the query:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2 LEFT JOIN T3 ON T3.B=T2.B)
              ON T2.A=T1.A AND T3.C=T1.C
  WHERE T3.D &gt; 0 OR T1.D &gt; 0</pre><p>
          the <code class="literal">WHERE</code> condition is not null-rejected
          for the embedded outer join, but the join condition of the
          embedding outer join <code class="literal">T2.A=T1.A AND
          T3.C=T1.C</code> is null-rejected. So the query can be
          converted to:
        </p><pre class="programlisting">SELECT * FROM T1 LEFT JOIN
              (T2, T3)
              ON T2.A=T1.A AND T3.C=T1.C AND T3.B=T2.B
WHERE T3.D &gt; 0 OR T1.D &gt; 0</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mrr-optimization"></a>8.2.1.13. Multi-Range Read Optimization</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48090144"></a><a class="indexterm" name="idp48091632"></a><p>
          Reading rows using a range scan on a secondary index can
          result in many random disk accesses to the base table when the
          table is large and not stored in the storage engine's cache.
          With the Disk-Sweep Multi-Range Read (MRR) optimization, MySQL
          tries to reduce the number of random disk access for range
          scans by first scanning the index only and collecting the keys
          for the relevant rows. Then the keys are sorted and finally
          the rows are retrieved from the base table using the order of
          the primary key. The motivation for Disk-sweep MRR is to
          reduce the number of random disk accesses and instead achieve
          a more sequential scan of the base table data.
        </p><p>
          The Multi-Range Read optimization provides these benefits:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MRR enables data rows to be accessed sequentially rather
              than in random order, based on index tuples. The server
              obtains a set of index tuples that satisfy the query
              conditions, sorts them according to data row ID order, and
              uses the sorted tuples to retrieve data rows in order.
              This makes data access more efficient and less expensive.
            </p></li><li class="listitem"><p>
              MRR enables batch processing of requests for key access
              for operations that require access to data rows through
              index tuples, such as range index scans and equi-joins
              that use an index for the join attribute. MRR iterates
              over a sequence of index ranges to obtain qualifying index
              tuples. As these results accumulate, they are used to
              access the corresponding data rows. It is not necessary to
              acquire all index tuples before starting to read data
              rows.
</p></li></ul>
</div>
<p>
          The following scenarios illustrate when MRR optimization can
          be advantageous:
        </p><p>
          Scenario A: MRR can be used for <code class="literal">InnoDB</code> and
          <code class="literal">MyISAM</code> tables for index range scans and
          equi-join operations.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              A portion of the index tuples are accumulated in a buffer.
            </p></li><li class="listitem"><p>
              The tuples in the buffer are sorted by their data row ID.
            </p></li><li class="listitem"><p>
              Data rows are accessed according to the sorted index tuple
              sequence.
</p></li></ol>
</div>
<p>
          Scenario B: MRR can be used for
          <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a> tables for multiple-range
          index scans or when performing an equi-join by an attribute.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              A portion of ranges, possibly single-key ranges, is
              accumulated in a buffer on the central node where the
              query is submitted.
            </p></li><li class="listitem"><p>
              The ranges are sent to the execution nodes that access
              data rows.
            </p></li><li class="listitem"><p>
              The accessed rows are packed into packages and sent back
              to the central node.
            </p></li><li class="listitem"><p>
              The received packages with data rows are placed in a
              buffer.
            </p></li><li class="listitem"><p>
              Data rows are read from the buffer.
</p></li></ol>
</div>
<p>
          When MRR is used, the <code class="literal">Extra</code> column in
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output shows
          <code class="literal">Using MRR</code>.
        </p><p>
          <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> do not
          use MRR if full table rows need not be accessed to produce the
          query result. This is the case if results can be produced
          entirely on the basis on information in the index tuples
          (through a <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering
          index</a>); MRR provides no benefit.
        </p><p>
          Example query for which MRR can be used, assuming that there
          is an index on <code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
          <em class="replaceable"><code>key_part2</code></em>)</code>:
        </p><pre class="programlisting">SELECT * FROM t
  WHERE <em class="replaceable"><code>key_part1</code></em> &gt;= 1000 AND <em class="replaceable"><code>key_part1</code></em> &lt; 2000
  AND <em class="replaceable"><code>key_part2</code></em> = 10000;
</pre><p>
          The index consists of tuples of
          <code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
          <em class="replaceable"><code>key_part2</code></em>)</code> values,
          ordered first by <em class="replaceable"><code>key_part1</code></em> and then
          by <em class="replaceable"><code>key_part2</code></em>.
        </p><p>
          Without MRR, an index scan covers all index tuples for the
          <em class="replaceable"><code>key_part1</code></em> range from 1000 up to
          2000, regardless of the <em class="replaceable"><code>key_part2</code></em>
          value in these tuples. The scan does extra work to the extent
          that tuples in the range contain
          <em class="replaceable"><code>key_part2</code></em> values other than 10000.
        </p><p>
          With MRR, the scan is broken up into multiple ranges, each for
          a single value of <em class="replaceable"><code>key_part1</code></em> (1000,
          1001, ... , 1999). Each of these scans need look only for
          tuples with <em class="replaceable"><code>key_part2</code></em> = 10000. If
          the index contains many tuples for which
          <em class="replaceable"><code>key_part2</code></em> is not 10000, MRR results
          in many fewer index tuples being read.
        </p><p>
          To express this using interval notation, the non-MRR scan must
          examine the index range <code class="literal">[{1000, 10000}, {2000,
          MIN_INT})</code>, which may include many tuples other than
          those for which <em class="replaceable"><code>key_part2</code></em> = 10000.
          The MRR scan examines multiple single-point intervals
          <code class="literal">[{1000, 10000}]</code>, ..., <code class="literal">[{1999,
          10000}]</code>, which includes only tuples with
          <em class="replaceable"><code>key_part2</code></em> = 10000.
        </p><p>
          Two <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
          variable flags provide an interface to the use of MRR
          optimization. The <code class="literal">mrr</code> flag controls whether
          MRR is enabled. If <code class="literal">mrr</code> is enabled
          (<code class="literal">on</code>), the <code class="literal">mrr_cost_based</code>
          flag controls whether the optimizer attempts to make a
          cost-based choice between using and not using MRR
          (<code class="literal">on</code>) or uses MRR whenever possible
          (<code class="literal">off</code>). By default, <code class="literal">mrr</code>
          is <code class="literal">on</code> and <code class="literal">mrr_cost_based</code>
          is <code class="literal">on</code>. See
          <a class="xref" href="optimization.html#switchable-optimizations" title="8.8.5.2. Controlling Switchable Optimizations">Section 8.8.5.2, “Controlling Switchable Optimizations”</a>.
        </p><p>
          For MRR, a storage engine uses the value of the
          <a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> system
          variable as a guideline for how much memory it can allocate
          for its buffer. The engine uses up to
          <a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> bytes
          and determines the number of ranges to process in a single
          pass.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="bnl-bka-optimization"></a>8.2.1.14. Block Nested-Loop and Batched Key Access Joins</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48143472"></a><a class="indexterm" name="idp48144960"></a><a class="indexterm" name="idp48146448"></a><a class="indexterm" name="idp48147936"></a><p>
          In MySQL 5.6, a Batched Key Access (BKA) Join
          algorithm is available that uses both index access to the
          joined table and a join buffer. The BKA algorithm supports
          inner join, outer join, and semi-join operations, including
          nested outer joins. Benefits of BKA include improved join
          performance due to more efficient table scanning. Also, the
          Block Nested-Loop (BNL) Join algorithm previously used only
          for inner joins is extended and can be employed for outer join
          and semi-join operations, including nested outer joins.
        </p><p>
          The following sections discuss the join buffer management that
          underlies the extension of the original BNL algorithm, the
          extended BNL algorithm, and the BKA algorithm. For information
          about semi-join strategies, see <a class="xref" href="optimization.html#semi-joins" title="8.2.1.18.1. Optimizing Subqueries with Semi-Join Transformations">Section 8.2.1.18.1, “Optimizing Subqueries with Semi-Join Transformations”</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="join-buffer-management"></a>8.2.1.14.1. Join Buffer Management for Block Nested-Loop and Batched Key Access
Algorithms</h5>
</div>
</div>
</div>
<p>
            In MySQL 5.6, MySQL Server can employ join
            buffers to execute not only inner joins without index access
            to the inner table, but also outer joins and semi-joins that
            appear after subquery flattening. Moreover, a join buffer
            can be effectively used when there is an index access to the
            inner table.
          </p><p>
            The join buffer management code slightly more efficiently
            utilizes join buffer space when storing the values of the
            interesting row columns: No additional bytes are allocated
            in buffers for a row column if its value is
            <code class="literal">NULL</code>, and the minimum number of bytes is
            allocated for any value of the
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> type.
          </p><p>
            The code supports two types of buffers, regular and
            incremental. Suppose that join buffer <code class="literal">B1</code>
            is employed to join tables <code class="literal">t1</code> and
            <code class="literal">t2</code> and the result of this operation is
            joined with table <code class="literal">t3</code> using join buffer
            <code class="literal">B2</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                A regular join buffer contains columns from each join
                operand. If <code class="literal">B2</code> is a regular join
                buffer, each row <em class="replaceable"><code>r</code></em> put into
                <code class="literal">B2</code> is composed of the columns of a
                row <em class="replaceable"><code>r1</code></em> from
                <code class="literal">B1</code> and the interesting columns of a
                matching row <em class="replaceable"><code>r2</code></em> from table
                <code class="literal">t2</code>.
              </p></li><li class="listitem"><p>
                An incremental join buffer contains only columns from
                rows of the table produced by the second join operand.
                That is, it is incremental to a row from the first
                operand buffer. If <code class="literal">B2</code> is an
                incremental join buffer, it contains the interesting
                columns of the row <em class="replaceable"><code>r2</code></em>
                together with a link to the row
                <em class="replaceable"><code>r1</code></em> from
                <code class="literal">B1</code>.
</p></li></ul>
</div>
<p>
            Incremental join buffers are always incremental relative to
            a join buffer from an earlier join operation, so the buffer
            from the first join operation is always a regular buffer. In
            the example just given, the buffer <code class="literal">B1</code>
            used to join tables <code class="literal">t1</code> and
            <code class="literal">t2</code> must be a regular buffer.
          </p><p>
            Each row of the incremental buffer used for a join operation
            contains only the interesting columns of a row from the
            table to be joined. These columns are augmented with a
            reference to the interesting columns of the matched row from
            the table produced by the first join operand. Several rows
            in the incremental buffer can refer to the same row
            <em class="replaceable"><code>r</code></em> whose columns are stored in the
            previous join buffers insofar as all these rows match row
            <em class="replaceable"><code>r</code></em>.
          </p><p>
            Incremental buffers enable less frequent copying of columns
            from buffers used for previous join operations. This
            provides a savings in buffer space because in the general
            case a row produced by the first join operand can be matched
            by several rows produced by the second join operand. It is
            unnecessary to make several copies of a row from the first
            operand. Incremental buffers also provide a savings in
            processing time due to the reduction in copying time.
          </p><p>
            As of MySQL 5.6.3, the <code class="literal">block_nested_loop</code>
            and <code class="literal">batched_key_access</code> flags of the
            <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
            variable control how the optimizer uses the Block
            Nested-Loop and Batched Key Access join algorithms. By
            default, <code class="literal">block_nested_loop</code> is
            <code class="literal">on</code> and
            <code class="literal">batched_key_access</code> is
            <code class="literal">off</code>. See
            <a class="xref" href="optimization.html#switchable-optimizations" title="8.8.5.2. Controlling Switchable Optimizations">Section 8.8.5.2, “Controlling Switchable Optimizations”</a>.
          </p><p>
            Before MySQL 5.6.3, the
            <a class="link" href="server-administration.html#sysvar_optimizer_join_cache_level"><code class="literal">optimizer_join_cache_level</code></a>
            system variable controls join buffer management. For the
            possible values of this variable and their meanings, see the
            description in <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
          </p><p>
            For information about semi-join strategies, see
            <a class="xref" href="optimization.html#semi-joins" title="8.2.1.18.1. Optimizing Subqueries with Semi-Join Transformations">Section 8.2.1.18.1, “Optimizing Subqueries with Semi-Join Transformations”</a>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="bnl-optimization"></a>8.2.1.14.2. Block Nested-Loop Algorithm for Outer Joins and Semi-Joins</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp48184592"></a><a class="indexterm" name="idp48186080"></a><p>
            In MySQL 5.6, the original implementation of
            the BNL algorithm is extended to support outer join and
            semi-join operations.
          </p><p>
            When these operations are executed with a join buffer, each
            row put into the buffer is supplied with a match flag.
          </p><p>
            If an outer join operation is executed using a join buffer,
            each row of the table produced by the second operand is
            checked for a match against each row in the join buffer.
            When a match is found, a new extended row is formed (the
            original row plus columns from the second operand) and sent
            for further extensions by the remaining join operations. In
            addition, the match flag of the matched row in the buffer is
            enabled. After all rows of the table to be joined have been
            examined, the join buffer is scanned. Each row from the
            buffer that does not have its match flag enabled is extended
            by <code class="literal">NULL</code> complements
            (<code class="literal">NULL</code> values for each column in the
            second operand) and sent for further extensions by the
            remaining join operations.
          </p><p>
            As of MySQL 5.6.3, the <code class="literal">block_nested_loop</code>
            flag of the
            <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
            variable controls how the optimizer uses the Block
            Nested-Loop algorithm. By default,
            <code class="literal">block_nested_loop</code> is
            <code class="literal">on</code>. See
            <a class="xref" href="optimization.html#switchable-optimizations" title="8.8.5.2. Controlling Switchable Optimizations">Section 8.8.5.2, “Controlling Switchable Optimizations”</a>.
          </p><p>
            Before MySQL 5.6.3, the
            <a class="link" href="server-administration.html#sysvar_optimizer_join_cache_level"><code class="literal">optimizer_join_cache_level</code></a>
            system variable controls join buffer management. For the
            possible values of this variable and their meanings, see the
            description in <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
          </p><p>
            In <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, use of BNL
            for a table is signified when the <code class="literal">Extra</code>
            value contains <code class="literal">Using join buffer (Block Nested
            Loop)</code> and the <code class="literal">type</code> value is
            <a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>,
            <a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>, or
            <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>.
          </p><p>
            For information about semi-join strategies, see
            <a class="xref" href="optimization.html#semi-joins" title="8.2.1.18.1. Optimizing Subqueries with Semi-Join Transformations">Section 8.2.1.18.1, “Optimizing Subqueries with Semi-Join Transformations”</a>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="bka-optimization"></a>8.2.1.14.3. Batched Key Access Joins</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp48205680"></a><a class="indexterm" name="idp48207168"></a><p>
            MySQL 5.6.3 implements a method of joining tables called the
            Batched Key Access (BKA) join algorithm. BKA can be applied
            when there is an index access to the table produced by the
            second join operand. Like the BNL join algorithm, the BKA
            join algorithm employs a join buffer to accumulate the
            interesting columns of the rows produced by the first
            operand of the join operation. Then the BKA algorithm builds
            keys to access the table to be joined for all rows in the
            buffer and submits these keys in a batch to the database
            engine for index lookups. The keys are submitted to the
            engine through the Multi-Range Read (MRR) interface (see
            <a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.13. Multi-Range Read Optimization">Section 8.2.1.13, “Multi-Range Read Optimization”</a>). After submission of the
            keys, the MRR engine functions perform lookups in the index
            in an optimal way, fetching the rows of the joined table
            found by these keys, and starts feeding the BKA join
            algorithm with matching rows. Each matching row is coupled
            with a reference to a row in the join buffer.
          </p><p>
            For BKA to be used, the
            <code class="literal">batched_key_access</code> flag of the
            <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
            variable must be set to <code class="literal">on</code>. BKA uses MRR,
            so the <code class="literal">mrr</code> flag must also be
            <code class="literal">on</code>. Currently, the cost estimation for
            MRR is too pessimistic. Hence, it is also necessary for
            <code class="literal">mrr_cost_based</code> to be
            <code class="literal">off</code> for BKA to be used. The following
            setting enables BKA:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET optimizer_switch='mrr=on,mrr_cost_based=off,batched_key_access=on';</code></strong>
</pre><p>
            There are two scenarios by which MRR functions execute:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The first scenario is used for conventional disk-based
                storage engines such as
                <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> and
                <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>. For these engines,
                usually the keys for all rows from the join buffer are
                submitted to the MRR interface at once. Engine-specific
                MRR functions perform index lookups for the submitted
                keys, get row IDs (or primary keys) from them, and then
                fetch rows for all these selected row IDs one by one by
                request from BKA algorithm. Every row is returned with
                an association reference that enables access to the
                matched row in the join buffer. The rows are fetched by
                the MRR functions in an optimal way: They are fetched in
                the row ID (primary key) order. This improves
                performance because reads are in disk order rather than
                random order.
              </p></li><li class="listitem"><p>
                The second scenario is used for remote storage engines
                such as <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a>. A package of
                keys for a portion of rows from the join buffer,
                together with their associations, is sent by a MySQL
                Server (SQL node) to MySQL Cluster data nodes. In
                return, the SQL node receives a package (or several
                packages) of matching rows coupled with corresponding
                associations. The BKA join algorithm takes these rows
                and builds new joined rows. Then a new set of keys is
                sent to the data nodes and the rows from the returned
                packages are used to build new joined rows. The process
                continues until the last keys from the join buffer are
                sent to the data nodes, and the SQL node has received
                and joined all rows matching these keys. This improves
                performance because fewer key-bearing packages sent by
                the SQL node to the data nodes means fewer round trips
                between it and the data nodes to perform the join
                operation.
</p></li></ul>
</div>
<p>
            With the first scenario, a portion of the join buffer is
            reserved to store row IDs (primary keys) selected by index
            lookups and passed as a parameter to the MRR functions.
          </p><p>
            There is no special buffer to store keys built for rows from
            the join buffer. Instead, a function that builds the key for
            the next row in the buffer is passed as a parameter to the
            MRR functions.
          </p><p>
            In <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, use of BKA
            for a table is signified when the <code class="literal">Extra</code>
            value contains <code class="literal">Using join buffer (Batched Key
            Access)</code> and the <code class="literal">type</code> value is
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> or
            <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="order-by-optimization"></a>8.2.1.15. <code class="literal">ORDER BY</code> Optimization</h4>

</div>

</div>

</div>
<p>
          In some cases, MySQL can use an index to satisfy an
          <code class="literal">ORDER BY</code> clause without doing any extra
          sorting.
        </p><p>
          The index can also be used even if the <code class="literal">ORDER
          BY</code> does not match the index exactly, as long as all
          of the unused portions of the index and all the extra
          <code class="literal">ORDER BY</code> columns are constants in the
          <code class="literal">WHERE</code> clause. The following queries use the
          index to resolve the <code class="literal">ORDER BY</code> part:
        </p><pre class="programlisting">SELECT * FROM t1
  ORDER BY <em class="replaceable"><code>key_part1</code></em>,<em class="replaceable"><code>key_part2</code></em>,... ;

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_part1</code></em> = <em class="replaceable"><code>constant</code></em>
  ORDER BY <em class="replaceable"><code>key_part2</code></em>;

SELECT * FROM t1
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC;

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_part1</code></em> = 1
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> DESC;

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_part1</code></em> &gt; <em class="replaceable"><code>constant</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em> ASC;

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_part1</code></em> &lt; <em class="replaceable"><code>constant</code></em>
  ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC;

SELECT * FROM t1
  WHERE <em class="replaceable"><code>key_part1</code></em> = <em class="replaceable"><code>constant1</code></em> AND <em class="replaceable"><code>key_part2</code></em> &gt; <em class="replaceable"><code>constant2</code></em>
  ORDER BY <em class="replaceable"><code>key_part2</code></em>;
</pre><p>
          In some cases, MySQL <span class="emphasis"><em>cannot</em></span> use indexes
          to resolve the <code class="literal">ORDER BY</code>, although it still
          uses indexes to find the rows that match the
          <code class="literal">WHERE</code> clause. These cases include the
          following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              You use <code class="literal">ORDER BY</code> on different keys:
            </p><pre class="programlisting">SELECT * FROM t1 ORDER BY <em class="replaceable"><code>key1</code></em>, <em class="replaceable"><code>key2</code></em>;
</pre></li><li class="listitem"><p>
              You use <code class="literal">ORDER BY</code> on nonconsecutive
              parts of a key:
            </p><pre class="programlisting">SELECT * FROM t1 WHERE <em class="replaceable"><code>key2</code></em>=<em class="replaceable"><code>constant</code></em> ORDER BY <em class="replaceable"><code>key_part2</code></em>;
</pre></li><li class="listitem"><p>
              You mix <code class="literal">ASC</code> and
              <code class="literal">DESC</code>:
            </p><pre class="programlisting">SELECT * FROM t1 ORDER BY <em class="replaceable"><code>key_part1</code></em> DESC, <em class="replaceable"><code>key_part2</code></em> ASC;
</pre></li><li class="listitem"><p>
              The key used to fetch the rows is not the same as the one
              used in the <code class="literal">ORDER BY</code>:
            </p><pre class="programlisting">SELECT * FROM t1 WHERE <em class="replaceable"><code>key2</code></em>=<em class="replaceable"><code>constant</code></em> ORDER BY <em class="replaceable"><code>key1</code></em>;
</pre></li><li class="listitem"><p>
              You use <code class="literal">ORDER BY</code> with an expression
              that includes terms other than the key column name:
            </p><pre class="programlisting">SELECT * FROM t1 ORDER BY ABS(<em class="replaceable"><code>key</code></em>);
SELECT * FROM t1 ORDER BY -<em class="replaceable"><code>key</code></em>;
</pre></li><li class="listitem"><p>
              You are joining many tables, and the columns in the
              <code class="literal">ORDER BY</code> are not all from the first
              nonconstant table that is used to retrieve rows. (This is
              the first table in the
              <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output that does
              not have a <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a> join
              type.)
            </p></li><li class="listitem"><p>
              You have different <code class="literal">ORDER BY</code> and
              <code class="literal">GROUP BY</code> expressions.
            </p></li><li class="listitem"><p>
              You index only a prefix of a column named in the
              <code class="literal">ORDER BY</code> clause. In this case, the
              index cannot be used to fully resolve the sort order. For
              example, if you have a
              <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR(20)</code></a> column, but index
              only the first 10 bytes, the index cannot distinguish
              values past the 10th byte and a
              <code class="literal">filesort</code> will be needed.
            </p></li><li class="listitem"><p>
              The type of table index used does not store rows in order.
              For example, this is true for a <code class="literal">HASH</code>
              index in a <code class="literal">MEMORY</code> table.
</p></li></ul>
</div>
<p>
          Availability of an index for sorting may be affected by the
          use of column aliases. Suppose that the column
          <code class="literal">t1.a</code> is indexed. In this statement, the
          name of the column in the select list is <code class="literal">a</code>.
          It refers to <code class="literal">t1.a</code>, so for the reference to
          <code class="literal">a</code> in the <code class="literal">ORDER BY</code>, the
          index can be used:
        </p><pre class="programlisting">SELECT a FROM t1 ORDER BY a;</pre><p>
          In this statement, the name of the column in the select list
          is also <code class="literal">a</code>, but it is the alias name. It
          refers to <code class="literal">ABS(a)</code>, so for the reference to
          <code class="literal">a</code> in the <code class="literal">ORDER BY</code>, the
          index cannot be used:
        </p><pre class="programlisting">SELECT ABS(a) AS a FROM t1 ORDER BY a;</pre><p>
          In the following statement, the <code class="literal">ORDER BY</code>
          refers to a name that is not the name of a column in the
          select list. But there is a column in <code class="literal">t1</code>
          named <code class="literal">a</code>, so the <code class="literal">ORDER BY</code>
          uses that, and the index can be used. (The resulting sort
          order may be completely different from the order for
          <code class="literal">ABS(a)</code>, of course.)
        </p><pre class="programlisting">SELECT ABS(a) AS b FROM t1 ORDER BY a;</pre><a class="indexterm" name="idp48294224"></a><a class="indexterm" name="idp48295712"></a><p>
          By default, MySQL sorts all <code class="literal">GROUP BY
          <em class="replaceable"><code>col1</code></em>,
          <em class="replaceable"><code>col2</code></em>, ...</code> queries as if
          you specified <code class="literal">ORDER BY
          <em class="replaceable"><code>col1</code></em>,
          <em class="replaceable"><code>col2</code></em>, ...</code> in the query as
          well. If you include an <code class="literal">ORDER BY</code> clause
          explicitly that contains the same column list, MySQL optimizes
          it away without any speed penalty, although the sorting still
          occurs. If a query includes <code class="literal">GROUP BY</code> but
          you want to avoid the overhead of sorting the result, you can
          suppress sorting by specifying <code class="literal">ORDER BY
          NULL</code>. For example:
        </p><pre class="programlisting">INSERT INTO foo
SELECT a, COUNT(*) FROM bar GROUP BY a ORDER BY NULL;</pre><p>
          Relying on implicit <code class="literal">GROUP BY</code> sorting in
          MySQL 5.6 is deprecated. To achieve a specific
          sort order of grouped results, it is preferable to use an
          explicit <code class="literal">ORDER BY</code> clause. <code class="literal">GROUP
          BY</code> sorting is a MySQL extension that may change in a
          future release; for example, to make it possible for the
          optimizer to order groupings in whatever manner it deems most
          efficient and to avoid the sorting overhead.
        </p><p>
          With <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN SELECT
          ... ORDER BY</code></a>, you can check whether MySQL can use
          indexes to resolve the query. It cannot if you see
          <code class="literal">Using filesort</code> in the
          <code class="literal">Extra</code> column. See
          <a class="xref" href="optimization.html#using-explain" title="8.8.1. Optimizing Queries with EXPLAIN">Section 8.8.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>. Filesort uses a fixed-length
          row-storage format similar to that used by the
          <a class="link" href="storage-engines.html#memory-storage-engine" title="14.4. The MEMORY Storage Engine"><code class="literal">MEMORY</code></a> storage engine.
          Variable-length types such as
          <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> are stored using a
          fixed length.
        </p><a class="indexterm" name="idp48312288"></a><a class="indexterm" name="idp48313360"></a><p>
          MySQL has two <code class="literal">filesort</code> algorithms for
          sorting and retrieving results. The original method uses only
          the <code class="literal">ORDER BY</code> columns. The modified method
          uses not just the <code class="literal">ORDER BY</code> columns, but all
          the columns used in the query.
        </p><p>
          The optimizer selects which <code class="literal">filesort</code>
          algorithm to use. It normally uses the modified algorithm
          except when <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
          <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns are involved, in
          which case it uses the original algorithm.
        </p><p>
          The original <code class="literal">filesort</code> algorithm works as
          follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Read all rows according to key or by table scanning. Rows
              that do not match the <code class="literal">WHERE</code> clause are
              skipped.
            </p></li><li class="listitem"><p>
              For each row, store a pair of values in a buffer (the sort
              key and the row pointer). The size of the buffer is the
              value of the
              <a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a> system
              variable.
            </p></li><li class="listitem"><p>
              When the buffer gets full, run a qsort (quicksort) on it
              and store the result in a temporary file. Save a pointer
              to the sorted block. (If all pairs fit into the sort
              buffer, no temporary file is created.)
            </p></li><li class="listitem"><p>
              Repeat the preceding steps until all rows have been read.
            </p></li><li class="listitem"><p>
              Do a multi-merge of up to <code class="literal">MERGEBUFF</code> (7)
              regions to one block in another temporary file. Repeat
              until all blocks from the first file are in the second
              file.
            </p></li><li class="listitem"><p>
              Repeat the following until there are fewer than
              <code class="literal">MERGEBUFF2</code> (15) blocks left.
            </p></li><li class="listitem"><p>
              On the last multi-merge, only the pointer to the row (the
              last part of the sort key) is written to a result file.
            </p></li><li class="listitem"><p>
              Read the rows in sorted order by using the row pointers in
              the result file. To optimize this, we read in a big block
              of row pointers, sort them, and use them to read the rows
              in sorted order into a row buffer. The size of the buffer
              is the value of the
              <a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
              system variable. The code for this step is in the
              <code class="filename">sql/records.cc</code> source file.
</p></li></ol>
</div>
<p>
          One problem with this approach is that it reads rows twice:
          One time when evaluating the <code class="literal">WHERE</code> clause,
          and again after sorting the pair values. And even if the rows
          were accessed successively the first time (for example, if a
          table scan is done), the second time they are accessed
          randomly. (The sort keys are ordered, but the row positions
          are not.)
        </p><p>
          The modified <code class="literal">filesort</code> algorithm
          incorporates an optimization such that it records not only the
          sort key value and row position, but also the columns required
          for the query. This avoids reading the rows twice. The
          modified <code class="literal">filesort</code> algorithm works like
          this:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Read the rows that match the <code class="literal">WHERE</code>
              clause.
            </p></li><li class="listitem"><p>
              For each row, record a tuple of values consisting of the
              sort key value and row position, and also the columns
              required for the query.
            </p></li><li class="listitem"><p>
              Sort the tuples by sort key value
            </p></li><li class="listitem"><p>
              Retrieve the rows in sorted order, but read the required
              columns directly from the sorted tuples rather than by
              accessing the table a second time.
</p></li></ol>
</div>
<p>
          Using the modified <code class="literal">filesort</code> algorithm, the
          tuples are longer than the pairs used in the original method,
          and fewer of them fit in the sort buffer (the size of which is
          given by <a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>).
          As a result, it is possible for the extra I/O to make the
          modified approach slower, not faster. To avoid a slowdown, the
          optimization is used only if the total size of the extra
          columns in the sort tuple does not exceed the value of the
          <a class="link" href="server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a>
          system variable. (A symptom of setting the value of this
          variable too high is a combination of high disk activity and
          low CPU activity.)
        </p><p>
          For slow queries for which <code class="literal">filesort</code> is not
          used, try lowering
          <a class="link" href="server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a> to a
          value that is appropriate to trigger a
          <code class="literal">filesort</code>.
        </p><p>
          If you want to increase <code class="literal">ORDER BY</code> speed,
          check whether you can get MySQL to use indexes rather than an
          extra sorting phase. If this is not possible, you can try the
          following strategies:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Increase the size of the
              <a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
              variable.
            </p></li><li class="listitem"><p>
              Increase the size of the
              <a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
              variable.
            </p></li><li class="listitem"><p>
              Use less RAM per row by declaring columns only as large as
              they need to be to hold the values stored in them. For
              example, <code class="literal">CHAR(16)</code> is better than
              <code class="literal">CHAR(200)</code> if values never exceed 16
              characters.
            </p></li><li class="listitem"><p>
              Change <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> to point to
              a dedicated file system with large amounts of free space.
              Also, this option accepts several paths that are used in
              round-robin fashion, so you can use this feature to spread
              the load across several directories. Paths should be
              separated by colon characters
              (<span class="quote">“<span class="quote"><code class="literal">:</code></span>”</span>) on Unix and
              semicolon characters (<span class="quote">“<span class="quote"><code class="literal">;</code></span>”</span>)
              on Windows. The paths should be for directories in file
              systems that are located on different
              <span class="emphasis"><em>physical</em></span> disks, not different
              partitions on the same disk.
</p></li></ul>
</div>
<p>
          If an index is not used for <code class="literal">ORDER BY</code> but a
          <code class="literal">LIMIT</code> clause is also present, the optimizer
          may be able to avoid using a merge file and sort the rows in
          memory. For details, see <a class="xref" href="optimization.html#limit-optimization" title="8.2.1.19. Optimizing LIMIT Queries">Section 8.2.1.19, “Optimizing <code class="literal">LIMIT</code> Queries”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="group-by-optimization"></a>8.2.1.16. <code class="literal">GROUP BY</code> Optimization</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48366784"></a><a class="indexterm" name="idp48367856"></a><p>
          The most general way to satisfy a <code class="literal">GROUP BY</code>
          clause is to scan the whole table and create a new temporary
          table where all rows from each group are consecutive, and then
          use this temporary table to discover groups and apply
          aggregate functions (if any). In some cases, MySQL is able to
          do much better than that and to avoid creation of temporary
          tables by using index access.
        </p><p>
          The most important preconditions for using indexes for
          <code class="literal">GROUP BY</code> are that all <code class="literal">GROUP
          BY</code> columns reference attributes from the same index,
          and that the index stores its keys in order (for example, this
          is a <code class="literal">BTREE</code> index and not a
          <code class="literal">HASH</code> index). Whether use of temporary
          tables can be replaced by index access also depends on which
          parts of an index are used in a query, the conditions
          specified for these parts, and the selected aggregate
          functions.
        </p><p>
          There are two ways to execute a <code class="literal">GROUP BY</code>
          query through index access, as detailed in the following
          sections. In the first method, the grouping operation is
          applied together with all range predicates (if any). The
          second method first performs a range scan, and then groups the
          resulting tuples.
        </p><p>
          In MySQL, <code class="literal">GROUP BY</code> is used for sorting, so
          the server may also apply <code class="literal">ORDER BY</code>
          optimizations to grouping. See
          <a class="xref" href="optimization.html#order-by-optimization" title="8.2.1.15. ORDER BY Optimization">Section 8.2.1.15, “<code class="literal">ORDER BY</code> Optimization”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="loose-index-scan"></a>8.2.1.16.1. Loose Index Scan</h5>
</div>
</div>
</div>
<p>
            The most efficient way to process <code class="literal">GROUP
            BY</code> is when an index is used to directly retrieve
            the grouping columns. With this access method, MySQL uses
            the property of some index types that the keys are ordered
            (for example, <code class="literal">BTREE</code>). This property
            enables use of lookup groups in an index without having to
            consider all keys in the index that satisfy all
            <code class="literal">WHERE</code> conditions. This access method
            considers only a fraction of the keys in an index, so it is
            called a <em class="firstterm">loose index scan</em>. When there
            is no <code class="literal">WHERE</code> clause, a loose index scan
            reads as many keys as the number of groups, which may be a
            much smaller number than that of all keys. If the
            <code class="literal">WHERE</code> clause contains range predicates
            (see the discussion of the
            <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a> join type in
            <a class="xref" href="optimization.html#using-explain" title="8.8.1. Optimizing Queries with EXPLAIN">Section 8.8.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>), a loose index scan looks
            up the first key of each group that satisfies the range
            conditions, and again reads the least possible number of
            keys. This is possible under the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The query is over a single table.
              </p></li><li class="listitem"><p>
                The <code class="literal">GROUP BY</code> names only columns that
                form a leftmost prefix of the index and no other
                columns. (If, instead of <code class="literal">GROUP BY</code>,
                the query has a <code class="literal">DISTINCT</code> clause, all
                distinct attributes refer to columns that form a
                leftmost prefix of the index.) For example, if a table
                <code class="literal">t1</code> has an index on
                <code class="literal">(c1,c2,c3)</code>, loose index scan is
                applicable if the query has <code class="literal">GROUP BY c1,
                c2,</code>. It is not applicable if the query has
                <code class="literal">GROUP BY c2, c3</code> (the columns are not
                a leftmost prefix) or <code class="literal">GROUP BY c1, c2,
                c4</code> (<code class="literal">c4</code> is not in the
                index).
              </p></li><li class="listitem"><p>
                The only aggregate functions used in the select list (if
                any) are <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a> and
                <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>, and all of them
                refer to the same column. The column must be in the
                index and must follow the columns in the <code class="literal">GROUP
                BY</code>.
              </p></li><li class="listitem"><p>
                Any other parts of the index than those from the
                <code class="literal">GROUP BY</code> referenced in the query must
                be constants (that is, they must be referenced in
                equalities with constants), except for the argument of
                <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a> or
                <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a> functions.
              </p></li><li class="listitem"><p>
                For columns in the index, full column values must be
                indexed, not just a prefix. For example, with
                <code class="literal">c1 VARCHAR(20), INDEX (c1(10))</code>, the
                index cannot be used for loose index scan.
</p></li></ul>
</div>
<p>
            If loose index scan is applicable to a query, the
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output shows
            <code class="literal">Using index for group-by</code> in the
            <code class="literal">Extra</code> column.
          </p><p>
            Assume that there is an index
            <code class="literal">idx(c1,c2,c3)</code> on table
            <code class="literal">t1(c1,c2,c3,c4)</code>. The loose index scan
            access method can be used for the following queries:
          </p><pre class="programlisting">SELECT c1, c2 FROM t1 GROUP BY c1, c2;
SELECT DISTINCT c1, c2 FROM t1;
SELECT c1, MIN(c2) FROM t1 GROUP BY c1;
SELECT c1, c2 FROM t1 WHERE c1 &lt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
SELECT MAX(c3), MIN(c3), c1, c2 FROM t1 WHERE c2 &gt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
SELECT c2 FROM t1 WHERE c1 &lt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
SELECT c1, c2 FROM t1 WHERE c3 = <em class="replaceable"><code>const</code></em> GROUP BY c1, c2;
</pre><p>
            The following queries cannot be executed with this quick
            select method, for the reasons given:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                There are aggregate functions other than
                <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a> or
                <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>:
              </p><pre class="programlisting">SELECT c1, SUM(c2) FROM t1 GROUP BY c1;</pre></li><li class="listitem"><p>
                The columns in the <code class="literal">GROUP BY</code> clause do
                not form a leftmost prefix of the index:
              </p><pre class="programlisting">SELECT c1, c2 FROM t1 GROUP BY c2, c3;</pre></li><li class="listitem"><p>
                The query refers to a part of a key that comes after the
                <code class="literal">GROUP BY</code> part, and for which there is
                no equality with a constant:
              </p><pre class="programlisting">SELECT c1, c3 FROM t1 GROUP BY c1, c2;</pre><p>
                Were the query to include <code class="literal">WHERE c3 =
                <em class="replaceable"><code>const</code></em></code>, loose index
                scan could be used.
</p></li></ul>
</div>
<p>
            The loose index scan access method can be applied to other
            forms of aggregate function references in the select list,
            in addition to the <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a> and
            <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a> references already
            supported:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <a class="link" href="functions.html#function_avg"><code class="literal">AVG(DISTINCT)</code></a>,
                <a class="link" href="functions.html#function_sum"><code class="literal">SUM(DISTINCT)</code></a>, and
                <a class="link" href="functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a> are
                supported. <a class="link" href="functions.html#function_avg"><code class="literal">AVG(DISTINCT)</code></a>
                and <a class="link" href="functions.html#function_sum"><code class="literal">SUM(DISTINCT)</code></a> take a
                single argument.
                <a class="link" href="functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a> can have
                more than one column argument.
              </p></li><li class="listitem"><p>
                There must be no <code class="literal">GROUP BY</code> or
                <code class="literal">DISTINCT</code> clause in the query.
              </p></li><li class="listitem"><p>
                The loose scan limitations described earlier still
                apply.
</p></li></ul>
</div>
<p>
            Assume that there is an index
            <code class="literal">idx(c1,c2,c3)</code> on table
            <code class="literal">t1(c1,c2,c3,c4)</code>. The loose index scan
            access method can be used for the following queries:
          </p><pre class="programlisting">SELECT COUNT(DISTINCT c1), SUM(DISTINCT c1) FROM t1;

SELECT COUNT(DISTINCT c1, c2), COUNT(DISTINCT c2, c1) FROM t1;</pre><p>
            Loose index scan is not applicable for the following
            queries:
          </p><pre class="programlisting">SELECT DISTINCT COUNT(DISTINCT c1) FROM t1;

SELECT COUNT(DISTINCT c1) FROM t1 GROUP BY c1;</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="tight-index-scan"></a>8.2.1.16.2. Tight Index Scan</h5>

</div>

</div>

</div>
<p>
            A tight index scan may be either a full index scan or a
            range index scan, depending on the query conditions.
          </p><p>
            When the conditions for a loose index scan are not met, it
            still may be possible to avoid creation of temporary tables
            for <code class="literal">GROUP BY</code> queries. If there are range
            conditions in the <code class="literal">WHERE</code> clause, this
            method reads only the keys that satisfy these conditions.
            Otherwise, it performs an index scan. Because this method
            reads all keys in each range defined by the
            <code class="literal">WHERE</code> clause, or scans the whole index if
            there are no range conditions, we term it a <em class="firstterm">tight
            index scan</em>. With a tight index scan, the
            grouping operation is performed only after all keys that
            satisfy the range conditions have been found.
          </p><p>
            For this method to work, it is sufficient that there is a
            constant equality condition for all columns in a query
            referring to parts of the key coming before or in between
            parts of the <code class="literal">GROUP BY</code> key. The constants
            from the equality conditions fill in any <span class="quote">“<span class="quote">gaps</span>”</span>
            in the search keys so that it is possible to form complete
            prefixes of the index. These index prefixes then can be used
            for index lookups. If we require sorting of the
            <code class="literal">GROUP BY</code> result, and it is possible to
            form search keys that are prefixes of the index, MySQL also
            avoids extra sorting operations because searching with
            prefixes in an ordered index already retrieves all the keys
            in order.
          </p><p>
            Assume that there is an index
            <code class="literal">idx(c1,c2,c3)</code> on table
            <code class="literal">t1(c1,c2,c3,c4)</code>. The following queries do
            not work with the loose index scan access method described
            earlier, but still work with the tight index scan access
            method.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                There is a gap in the <code class="literal">GROUP BY</code>, but
                it is covered by the condition <code class="literal">c2 =
                'a'</code>:
              </p><pre class="programlisting">SELECT c1, c2, c3 FROM t1 WHERE c2 = 'a' GROUP BY c1, c3;</pre></li><li class="listitem"><p>
                The <code class="literal">GROUP BY</code> does not begin with the
                first part of the key, but there is a condition that
                provides a constant for that part:
</p><pre class="programlisting">SELECT c1, c2, c3 FROM t1 WHERE c1 = 'a' GROUP BY c2, c3;</pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="distinct-optimization"></a>8.2.1.17. <code class="literal">DISTINCT</code> Optimization</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48455888"></a><a class="indexterm" name="idp48456960"></a><p>
          <code class="literal">DISTINCT</code> combined with <code class="literal">ORDER
          BY</code> needs a temporary table in many cases.
        </p><p>
          Because <code class="literal">DISTINCT</code> may use <code class="literal">GROUP
          BY</code>, learn how MySQL works with columns in
          <code class="literal">ORDER BY</code> or <code class="literal">HAVING</code>
          clauses that are not part of the selected columns. See
          <a class="xref" href="functions.html#group-by-extensions" title="12.17.3. MySQL Extensions to GROUP BY">Section 12.17.3, “MySQL Extensions to <code class="literal">GROUP BY</code>”</a>.
        </p><p>
          In most cases, a <code class="literal">DISTINCT</code> clause can be
          considered as a special case of <code class="literal">GROUP BY</code>.
          For example, the following two queries are equivalent:
        </p><pre class="programlisting">SELECT DISTINCT c1, c2, c3 FROM t1
WHERE c1 &gt; <em class="replaceable"><code>const</code></em>;

SELECT c1, c2, c3 FROM t1
WHERE c1 &gt; <em class="replaceable"><code>const</code></em> GROUP BY c1, c2, c3;
</pre><p>
          Due to this equivalence, the optimizations applicable to
          <code class="literal">GROUP BY</code> queries can be also applied to
          queries with a <code class="literal">DISTINCT</code> clause. Thus, for
          more details on the optimization possibilities for
          <code class="literal">DISTINCT</code> queries, see
          <a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16. GROUP BY Optimization">Section 8.2.1.16, “<code class="literal">GROUP BY</code> Optimization”</a>.
        </p><p>
          When combining <code class="literal">LIMIT
          <em class="replaceable"><code>row_count</code></em></code> with
          <code class="literal">DISTINCT</code>, MySQL stops as soon as it finds
          <em class="replaceable"><code>row_count</code></em> unique rows.
        </p><p>
          If you do not use columns from all tables named in a query,
          MySQL stops scanning any unused tables as soon as it finds the
          first match. In the following case, assuming that
          <code class="literal">t1</code> is used before <code class="literal">t2</code>
          (which you can check with
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>), MySQL stops reading
          from <code class="literal">t2</code> (for any particular row in
          <code class="literal">t1</code>) when it finds the first row in
          <code class="literal">t2</code>:
</p><pre class="programlisting">SELECT DISTINCT t1.a FROM t1, t2 where t1.a=t2.a;</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="subquery-optimization"></a>8.2.1.18. Subquery Optimization</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48480736"></a><a class="indexterm" name="idp48481808"></a><p>
          The MySQL query optimizer has different strategies available
          to evaluate subqueries. For <code class="literal">IN</code> (or
          <code class="literal">=ANY</code>) subqueries, the optimizer has these
          choices:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Semi-join
            </p></li><li class="listitem"><p>
              Materialization
            </p></li><li class="listitem"><p>
              <code class="literal">EXISTS</code> strategy
</p></li></ul>
</div>
<p>
          For <code class="literal">NOT IN</code> (or
          <code class="literal">&lt;&gt;ANY</code>) subqueries, the optimizer has
          these choices:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Materialization
            </p></li><li class="listitem"><p>
              <code class="literal">EXISTS</code> strategy
</p></li></ul>
</div>
<p>
          The following sections provide more information about these
          optimization strategies.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="semi-joins"></a>8.2.1.18.1. Optimizing Subqueries with Semi-Join Transformations</h5>
</div>
</div>
</div>
<a class="indexterm" name="idp48494880"></a><p>
            As of MySQL 5.6.5, the optimizer uses semi-join strategies
            to improve subquery execution, as described in this section.
          </p><p>
            For an inner join between two tables, the join returns a row
            from one table as many times as there are matches in the
            other table. But for some questions, the only information
            that matters is whether there is a match, not the number of
            matches. Suppose that there are tables named
            <code class="literal">class</code> and <code class="literal">roster</code> that
            list classes in a course curriculum and class rosters
            (students enrolled in each class), respectively. To list the
            classes that actually have students enrolled, you could use
            this join:
          </p><pre class="programlisting">SELECT class.class_num, class.class_name
FROM class INNER JOIN roster
WHERE class.class_num = roster.class_num;</pre><p>
            However, the result lists each class once for each enrolled
            student. For the question being asked, this is unnecessary
            duplication of information.
          </p><p>
            Assuming that <code class="literal">class_num</code> is a primary key
            in the <code class="literal">class</code> table, duplicate suppression
            could be achieved by using
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT
            DISTINCT</code></a>, but it is inefficient to generate all
            matching rows first only to eliminate duplicates later.
          </p><p>
            The same duplicate-free result can be obtained by using a
            subquery:
          </p><pre class="programlisting">SELECT class_num, class_name
FROM class
WHERE class_num IN (SELECT class_num FROM roster);</pre><p>
            Here, the optimizer can recognize that the
            <code class="literal">IN</code> clause requires the subquery to return
            only one instance of each class number from the
            <code class="literal">roster</code> table. In this case, the query can
            be executed as a <em class="firstterm">semi-join</em>—that
            is, an operation that returns only one instance of each row
            in <code class="literal">class</code> that is matched by rows in
            <code class="literal">roster</code>.
          </p><p>
            Before MySQL 5.6.6, the outer query specification was
            limited to simple table scans or inner joins using comma
            syntax, and view references were not possible. As of 5.6.6,
            outer join and inner join syntax is permitted in the outer
            query specification, and the restriction that table
            references must be base tables has been lifted.
          </p><p>
            In MySQL, a subquery must satisfy these criteria to be
            handled as a semi-join:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                It must be an <code class="literal">IN</code> (or
                <code class="literal">=ANY</code>) subquery that appears at the
                top level of the <code class="literal">WHERE</code> or
                <code class="literal">ON</code> clause, possibly as a term in an
                <code class="literal">AND</code> expression. For example:
              </p><pre class="programlisting">SELECT ...
FROM ot1, ...
WHERE (oe1, ...) IN (SELECT ie1, ... FROM it1, ... WHERE ...);</pre><p>
                Here, <code class="literal">ot_<em class="replaceable"><code>i</code></em></code>
                and <code class="literal">it_<em class="replaceable"><code>i</code></em></code>
                represent tables in the outer and inner parts of the
                query, and
                <code class="literal">oe_<em class="replaceable"><code>i</code></em></code> and
                <code class="literal">ie_<em class="replaceable"><code>i</code></em></code>
                represent expressions that refer to columns in the outer
                and inner tables.
              </p></li><li class="listitem"><p>
                It must be a single
                <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> without
                <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> constructs.
              </p></li><li class="listitem"><p>
                It must not contain a <code class="literal">GROUP BY</code> or
                <code class="literal">HAVING</code> clause or aggregate functions.
              </p></li><li class="listitem"><p>
                It must not have <code class="literal">ORDER BY</code> with
                <code class="literal">LIMIT</code>.
              </p></li><li class="listitem"><p>
                The number of outer and inner tables together must be
                less than the maximum number of tables permitted in a
                join.
</p></li></ul>
</div>
<p>
            The subquery may be correlated or uncorrelated.
            <code class="literal">DISTINCT</code> is permitted, as is
            <code class="literal">LIMIT</code> unless <code class="literal">ORDER BY</code>
            is also used.
          </p><p>
            If a subquery meets the preceding criteria, MySQL converts
            it to a semi-join and makes a cost-based choice from these
            strategies:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Convert the subquery to a join, or use table pullout and
                run the query as an inner join between subquery tables
                and outer tables. Table pullout pulls a table out from
                the subquery to the outer query.
              </p></li><li class="listitem"><p>
                Duplicate Weedout: Run the semi-join as if it was a join
                and remove duplicate records using a temporary table.
              </p></li><li class="listitem"><p>
                FirstMatch: When scanning the inner tables for row
                combinations and there are multiple instances of a given
                value group, choose one rather than returning them all.
                This "shortcuts" scanning and eliminates production of
                unnecessary rows.
              </p></li><li class="listitem"><p>
                LooseScan: Scan a subquery table using an index that
                enables a single value to be chosen from each subquery's
                value group.
              </p></li><li class="listitem"><p>
                Materialize the subquery into a temporary table with an
                index and use the temporary table to perform a join. The
                index is used to remove duplicates. The index might also
                be used later for lookups when joining the temporary
                table with the outer tables; if not, the table is
                scanned.
</p></li></ul>
</div>
<p>
            Each of these strategies except Duplicate Weedout can be
            enabled or disabled using the
            <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
            variable. The <code class="literal">semijoin</code> flag controls
            whether semi-joins are used. If it is set to
            <code class="literal">on</code>, the <code class="literal">firstmatch</code>,
            <code class="literal">loosescan</code>, and
            <code class="literal">materialization</code> flags enable finer
            control over the permitted semi-join strategies. These flags
            are <code class="literal">on</code> by default. See
            <a class="xref" href="optimization.html#switchable-optimizations" title="8.8.5.2. Controlling Switchable Optimizations">Section 8.8.5.2, “Controlling Switchable Optimizations”</a>.
          </p><p>
            The use of semi-join strategies is indicated in
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Semi-joined tables show up in the outer select.
                <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN EXTENDED</code></a> plus
                <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> shows the
                rewritten query, which displays the semi-join structure.
                From this you can get an idea about which tables were
                pulled out of the semi-join. If a subquery was converted
                to a semi-join, you will see that the subquery predicate
                is gone and its tables and <code class="literal">WHERE</code>
                clause were merged into the outer query join list and
                <code class="literal">WHERE</code> clause.
              </p></li><li class="listitem"><p>
                Temporary table use for Duplicate Weedout is indicated
                by <code class="literal">Start temporary</code> and <code class="literal">End
                temporary</code> in the <code class="literal">Extra</code>
                column. Tables that were not pulled out and are in the
                range of <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output
                rows covered by <code class="literal">Start temporary</code> and
                <code class="literal">End temporary</code> will have their
                <code class="literal">rowid</code> in the temporary table.
              </p></li><li class="listitem"><p>
                <code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code>
                in the <code class="literal">Extra</code> column indicates join
                shortcutting.
              </p></li><li class="listitem"><p>
                <code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code>
                in the <code class="literal">Extra</code> column indicates use of
                the LooseScan strategy. <em class="replaceable"><code>m</code></em> and
                <em class="replaceable"><code>n</code></em> are key part numbers.
              </p></li><li class="listitem"><p>
                As of MySQL 5.6.7, temporary table use for
                materialization is indicated by rows with a
                <code class="literal">select_type</code> value of
                <code class="literal">MATERIALIZED</code> and rows with a
                <code class="literal">table</code> value of
                <code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code>.
              </p><p>
                Before MySQL 5.6.7, temporary table use for
                materialization is indicated in the
                <code class="literal">Extra</code> column by
                <code class="literal">Materialize</code> if a single table is
                used, or by <code class="literal">Start materialize</code> and
                <code class="literal">End materialize</code> if multiple tables
                are used. If <code class="literal">Scan</code> is present, no
                temporary table index is used for table reads.
                Otherwise, an index lookup is used.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="subquery-materialization"></a>8.2.1.18.2. Optimizing Subqueries with Subquery Materialization</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp48571856"></a><a class="indexterm" name="idp48572944"></a><a class="indexterm" name="idp48574032"></a><p>
            As of MySQL 5.6.5, the optimizer uses subquery
            materialization as a strategy that enables more efficient
            subquery processing.
          </p><p>
            If materialization is not used, the optimizer sometimes
            rewrites a noncorrelated subquery as a correlated subquery.
            For example, the following <code class="literal">IN</code> subquery is
            noncorrelated (<em class="replaceable"><code>where_condition</code></em>
            involves only columns from <code class="literal">t2</code> and not
            <code class="literal">t1</code>):
          </p><pre class="programlisting">SELECT * FROM t1
WHERE t1.a IN (SELECT t2.b FROM t2 WHERE <em class="replaceable"><code>where_condition</code></em>);
</pre><p>
            The optimizer might rewrite this as an
            <code class="literal">EXISTS</code> correlated subquery:
          </p><pre class="programlisting">SELECT * FROM t1
WHERE EXISTS (SELECT t2.b FROM t2 WHERE <em class="replaceable"><code>where_condition</code></em> AND t1.a=t2.b);
</pre><p>
            Subquery materialization using a temporary table avoids such
            rewrites and makes it possible to execute the subquery only
            once rather than once per row of the outer query.
            Materialization speeds up query execution by generating a
            subquery result as a temporary table, normally in memory.
            The first time MySQL needs the subquery result, it
            materializes that result into a temporary table. Any
            subsequent time the result is needed, MySQL refers again to
            the temporary table. The table is indexed with a hash index
            to make lookups fast and inexpensive. The index is unique,
            which makes the table smaller because it has no duplicates.
          </p><p>
            Subquery materialization attempts to use an in-memory
            temporary table when possible, falling back to on-disk
            storage if the table becomes too large. See
            <a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.3.3. How MySQL Uses Internal Temporary Tables">Section 8.4.3.3, “How MySQL Uses Internal Temporary Tables”</a>.
          </p><p>
            For subquery materialization to be used in MySQL, the
            <code class="literal">materialization</code> flag of the
            <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
            variable must be <code class="literal">on</code>. Materialization then
            applies to subquery predicates that appear anywhere (in the
            select list, <code class="literal">WHERE</code>,
            <code class="literal">ON</code>, <code class="literal">GROUP BY</code>,
            <code class="literal">HAVING</code>, or <code class="literal">ORDER BY</code>),
            for predicates that fall into any of these use cases:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The predicate has this form, when no outer expression
                <em class="replaceable"><code>oe_i</code></em> or inner expression
                <em class="replaceable"><code>ie_i</code></em> is nullable.
                <em class="replaceable"><code>N</code></em> can be 1 or larger.
              </p><pre class="programlisting">(<em class="replaceable"><code>oe_1</code></em>, <em class="replaceable"><code>oe_2</code></em>, ..., <em class="replaceable"><code>oe_N</code></em>) [NOT] IN (SELECT <em class="replaceable"><code>ie_1</code></em>, <em class="replaceable"><code>i_2</code></em>, ..., <em class="replaceable"><code>ie_N</code></em> ...)
</pre></li><li class="listitem"><p>
                The predicate has this form, when there is a single
                outer expression <em class="replaceable"><code>oe</code></em> and inner
                expression <em class="replaceable"><code>ie</code></em>. The
                expressions can be nullable.
              </p><pre class="programlisting"><em class="replaceable"><code>oe</code></em> [NOT] IN (SELECT <em class="replaceable"><code>ie</code></em> ...)
</pre></li><li class="listitem"><p>
                The predicate is <code class="literal">IN</code> or <code class="literal">NOT
                IN</code> and a result of <code class="literal">UNKNOWN</code>
                (<code class="literal">NULL</code>) has the same meaning as a
                result of <code class="literal">FALSE</code>.
</p></li></ul>
</div>
<p>
            The following examples illustrate how the requirement for
            equivalence of <code class="literal">UNKNOWN</code> and
            <code class="literal">FALSE</code> predicate evaluation affects
            whether subquery materialization can be used. Assume that
            <em class="replaceable"><code>where_condition</code></em> involves columns
            only from <code class="literal">t2</code> and not
            <code class="literal">t1</code> so that the subquery is noncorrelated.
          </p><p>
            This query is subject to materialization:
          </p><pre class="programlisting">SELECT * FROM t1
WHERE t1.a IN (SELECT t2.b FROM t2 WHERE <em class="replaceable"><code>where_condition</code></em>);
</pre><p>
            Here, it does not matter whether the <code class="literal">IN</code>
            predicate returns <code class="literal">UNKNOWN</code> or
            <code class="literal">FALSE</code>. Either way, the row from
            <code class="literal">t1</code> is not included in the query result.
          </p><p>
            An example where subquery materialization will not be used
            is the following query, where <code class="literal">t2.b</code> is a
            nullable column.
          </p><pre class="programlisting">SELECT * FROM t1
WHERE (t1.a,t1.b) NOT IN (SELECT t2.a,t2.b FROM t2
                          WHERE <em class="replaceable"><code>where_condition</code></em>);
</pre><p>
            Use of <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> with a query
            can give some indication of whether the optimizer uses
            subquery materialization. Compared to query execution that
            does not use materialization, <code class="literal">select_type</code>
            may change from <code class="literal">DEPENDENT SUBQUERY</code> to
            <code class="literal">SUBQUERY</code>. This indicates that, for a
            subquery that would be executed once per outer row,
            materialization enables the subquery to be executed just
            once. In addition, for <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN
            EXTENDED</code></a>, the text displayed by a following
            <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> will include
            <code class="literal">materialize</code>
            <code class="literal">materialize</code> and
            <code class="literal">materialized-subquery</code>
            (<code class="literal">materialized subselect</code> before MySQL
            5.6.6).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="from-clause-subquery-optimization"></a>8.2.1.18.3. Optimizing Subqueries in the <code class="literal">FROM</code> Clause (Derived
Tables)</h5>
</div>
</div>
</div>
<a class="indexterm" name="idp48626672"></a><p>
            As of MySQL 5.6.3, the optimizer more efficiently handles
            subqueries in the <code class="literal">FROM</code> clause (that is,
            derived tables):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Materialization of subqueries in the
                <code class="literal">FROM</code> clause is postponed until their
                contents are needed during query execution, which
                improves performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    Previously, subqueries in the
                    <code class="literal">FROM</code> clause were materialized for
                    <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
                    SELECT</code></a> statements. This resulted in
                    partial <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
                    execution, even though the purpose of
                    <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> is to obtain
                    query plan information, not to execute the query.
                    This materialization no longer occurs, so
                    <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> is faster for
                    such queries.
                  </p></li><li class="listitem"><p>
                    For non-<a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
                    queries, delay of materialization may result in not
                    having to do it at all. Consider a query that joins
                    the result of a subquery in the
                    <code class="literal">FROM</code> clause to another table: If
                    the optimizer processes that other table first and
                    finds that it returns no rows, the join need not be
                    carried out further and the optimizer can completely
                    skip materializing the subquery.
</p></li></ul>
</div>
</li><li class="listitem"><p>
                During query execution, the optimizer may add an index
                to a derived table to speed up row retrieval from it.
</p></li></ul>
</div>
<p>
            Consider the following
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement, for which
            a subquery appears in the <code class="literal">FROM</code> clause of
            a <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> query:
          </p><pre class="programlisting">EXPLAIN SELECT * FROM (SELECT * FROM t1);</pre><p>
            The optimizer avoids materializing the subquery by delaying
            it until the result is needed during
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> execution. In this
            case, the query is not executed, so the result is never
            needed.
          </p><p>
            Even for queries that are executed, delay of subquery
            materialization may permit the optimizer to avoid
            materialization entirely. Consider the following query,
            which joins the result of a subquery in the
            <code class="literal">FROM</code> clause to another table:
          </p><pre class="programlisting">SELECT * FROM t1
  JOIN (SELECT t2.f1 FROM t2) AS derived_t2 ON t1.f2=derived_t2.f1
  WHERE t1.f1 &gt; 0;</pre><p>
            If the optimization processes <code class="literal">t1</code> first
            and the <code class="literal">WHERE</code> clause produces an empty
            result, the join must necessarily be empty and the subquery
            need not be materialized.
          </p><p>
            In the worst case (derived tables are materialized), query
            execution will take the same time as before MySQL 5.6.3
            because no additional work is done. In the best case
            (derived tables are not materialized), query execution will
            be quicker by the time needed to perform materialization.
          </p><p>
            For cases when materialization is required for a subquery in
            the <code class="literal">FROM</code> clause, the optimizer may speed
            up access to the result by adding an index to the
            materialized table. If such an index would permit
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> access to the table,
            it can greatly reduce amount of data that must be read
            during query execution. Consider the following query:
          </p><pre class="programlisting">SELECT * FROM t1
  JOIN (SELECT * FROM t2) AS derived_t2 ON t1.f1=derived_t2.f1;</pre><p>
            The optimizer constructs an index over column
            <code class="literal">f1</code> from <code class="literal">derived_t2</code> if
            doing so would permit the use of
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> access for the lowest
            cost execution plan. After adding the index, the optimizer
            can treat the materialized derived table the same as a usual
            table with an index, and it benefits similarly from the
            generated index. The overhead of index creation is
            negligible compared to the cost of query execution without
            the index. If <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> access
            would result in higher cost than some other access method,
            no index is created and the optimizer loses nothing.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="subquery-optimization-with-exists"></a>8.2.1.18.4. Optimizing Subqueries with <code class="literal">EXISTS</code> Strategy</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp48660176"></a><a class="indexterm" name="idp48661664"></a><p>
            Certain optimizations are applicable to comparisons that use
            the <code class="literal">IN</code> operator to test subquery results
            (or that use <code class="literal">=ANY</code>, which is equivalent).
            This section discusses these optimizations, particularly
            with regard to the challenges that <code class="literal">NULL</code>
            values present. The last part of the discussion includes
            suggestions on what you can do to help the optimizer.
          </p><p>
            Consider the following subquery comparison:
          </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
            MySQL evaluates queries <span class="quote">“<span class="quote">from outside to
            inside.</span>”</span> That is, it first obtains the value of the
            outer expression <em class="replaceable"><code>outer_expr</code></em>, and
            then runs the subquery and captures the rows that it
            produces.
          </p><p>
            A very useful optimization is to <span class="quote">“<span class="quote">inform</span>”</span> the
            subquery that the only rows of interest are those where the
            inner expression <em class="replaceable"><code>inner_expr</code></em> is
            equal to <em class="replaceable"><code>outer_expr</code></em>. This is done
            by pushing down an appropriate equality into the subquery's
            <code class="literal">WHERE</code> clause. That is, the comparison is
            converted to this:
          </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em> AND <em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em>)
</pre><p>
            After the conversion, MySQL can use the pushed-down equality
            to limit the number of rows that it must examine when
            evaluating the subquery.
          </p><p>
            More generally, a comparison of <em class="replaceable"><code>N</code></em>
            values to a subquery that returns
            <em class="replaceable"><code>N</code></em>-value rows is subject to the
            same conversion. If <em class="replaceable"><code>oe_i</code></em> and
            <em class="replaceable"><code>ie_i</code></em> represent corresponding
            outer and inner expression values, this subquery comparison:
          </p><pre class="programlisting">(<em class="replaceable"><code>oe_1</code></em>, ..., <em class="replaceable"><code>oe_N</code></em>) IN
  (SELECT <em class="replaceable"><code>ie_1</code></em>, ..., <em class="replaceable"><code>ie_N</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
            Becomes:
          </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>
                          AND <em class="replaceable"><code>oe_1</code></em> = <em class="replaceable"><code>ie_1</code></em>
                          AND ...
                          AND <em class="replaceable"><code>oe_N</code></em> = <em class="replaceable"><code>ie_N</code></em>)
</pre><p>
            The following discussion assumes a single pair of outer and
            inner expression values for simplicity.
          </p><p>
            The conversion just described has its limitations. It is
            valid only if we ignore possible <code class="literal">NULL</code>
            values. That is, the <span class="quote">“<span class="quote">pushdown</span>”</span> strategy works
            as long as both of these two conditions are true:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <em class="replaceable"><code>outer_expr</code></em> and
                <em class="replaceable"><code>inner_expr</code></em> cannot be
                <code class="literal">NULL</code>.
              </p></li><li class="listitem"><p>
                You do not need to distinguish <code class="literal">NULL</code>
                from <code class="literal">FALSE</code> subquery results. (If the
                subquery is a part of an <a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
                or <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a> expression in the
                <code class="literal">WHERE</code> clause, MySQL assumes that you
                do not care.)
</p></li></ul>
</div>
<p>
            When either or both of those conditions do not hold,
            optimization is more complex.
          </p><p>
            Suppose that <em class="replaceable"><code>outer_expr</code></em> is known
            to be a non-<code class="literal">NULL</code> value but the subquery
            does not produce a row such that
            <em class="replaceable"><code>outer_expr</code></em> =
            <em class="replaceable"><code>inner_expr</code></em>. Then
            <code class="literal"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT
            ...)</code> evaluates as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">NULL</code>, if the
                <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces any row
                where <em class="replaceable"><code>inner_expr</code></em> is
                <code class="literal">NULL</code>
              </p></li><li class="listitem"><p>
                <code class="literal">FALSE</code>, if the
                <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces only
                non-<code class="literal">NULL</code> values or produces nothing
</p></li></ul>
</div>
<p>
            In this situation, the approach of looking for rows with
            <code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
            <em class="replaceable"><code>inner_expr</code></em></code> is no longer
            valid. It is necessary to look for such rows, but if none
            are found, also look for rows where
            <em class="replaceable"><code>inner_expr</code></em> is
            <code class="literal">NULL</code>. Roughly speaking, the subquery can
            be converted to:
          </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em> AND
        (<em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em> OR <em class="replaceable"><code>inner_expr</code></em> IS NULL))
</pre><p>
            The need to evaluate the extra <a class="link" href="functions.html#operator_is-null"><code class="literal">IS
            NULL</code></a> condition is why MySQL has the
            <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> access
            method:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN</code></strong>
    -&gt; <strong class="userinput"><code>SELECT <em class="replaceable"><code>outer_expr</code></em> IN (SELECT t2.maybe_null_key</code></strong>
    -&gt;                       <strong class="userinput"><code>FROM t2, t3 WHERE ...)</code></strong>
    -&gt; FROM t1;
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
...
*************************** 2. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: t2
         type: ref_or_null
possible_keys: maybe_null_key
          key: maybe_null_key
      key_len: 5
          ref: func
         rows: 2
        Extra: Using where; Using index
...
</pre><p>
            The <a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a> and
            <a class="link" href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
            subquery-specific access methods also have <span class="quote">“<span class="quote">or
            <code class="literal">NULL</code></span>”</span> variants. However, they are
            not visible in <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
            output, so you must use <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN
            EXTENDED</code></a> followed by <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW
            WARNINGS</code></a> (note the <code class="literal">checking
            NULL</code> in the warning message):
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN EXTENDED</code></strong>
    -&gt; <strong class="userinput"><code>SELECT <em class="replaceable"><code>outer_expr</code></em> IN (SELECT maybe_null_key FROM t2) FROM t1\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
...
*************************** 2. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: t2
         type: index_subquery
possible_keys: maybe_null_key
          key: maybe_null_key
      key_len: 5
          ref: func
         rows: 2
        Extra: Using index

mysql&gt; <strong class="userinput"><code>SHOW WARNINGS\G</code></strong>
*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: select (`test`.`t1`.`outer_expr`,
         (((`test`.`t1`.`outer_expr`) in t2 on
         maybe_null_key checking NULL))) AS `outer_expr IN (SELECT
         maybe_null_key FROM t2)` from `test`.`t1`
</pre><p>
            The additional <code class="literal">OR ... IS NULL</code> condition
            makes query execution slightly more complicated (and some
            optimizations within the subquery become inapplicable), but
            generally this is tolerable.
          </p><p>
            The situation is much worse when
            <em class="replaceable"><code>outer_expr</code></em> can be
            <code class="literal">NULL</code>. According to the SQL interpretation
            of <code class="literal">NULL</code> as <span class="quote">“<span class="quote">unknown value,</span>”</span>
            <code class="literal">NULL IN (SELECT
            <em class="replaceable"><code>inner_expr</code></em> ...)</code> should
            evaluate to:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">NULL</code>, if the
                <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces any rows
              </p></li><li class="listitem"><p>
                <code class="literal">FALSE</code>, if the
                <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> produces no rows
</p></li></ul>
</div>
<p>
            For proper evaluation, it is necessary to be able to check
            whether the <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> has
            produced any rows at all, so
            <code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
            <em class="replaceable"><code>inner_expr</code></em></code> cannot be
            pushed down into the subquery. This is a problem, because
            many real world subqueries become very slow unless the
            equality can be pushed down.
          </p><p>
            Essentially, there must be different ways to execute the
            subquery depending on the value of
            <em class="replaceable"><code>outer_expr</code></em>.
          </p><p>
            The optimizer chooses SQL compliance over speed, so it
            accounts for the possibility that
            <em class="replaceable"><code>outer_expr</code></em> might be
            <code class="literal">NULL</code>.
          </p><p>
            If <em class="replaceable"><code>outer_expr</code></em> is
            <code class="literal">NULL</code>, to evaluate the following
            expression, it is necessary to run the
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> to determine whether
            it produces any rows:
          </p><pre class="programlisting">NULL IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
            It is necessary to run the original
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> here, without any
            pushed-down equalities of the kind mentioned earlier.
          </p><p>
            On the other hand, when
            <em class="replaceable"><code>outer_expr</code></em> is not
            <code class="literal">NULL</code>, it is absolutely essential that
            this comparison:
          </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
            be converted to this expression that uses a pushed-down
            condition:
          </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em> AND <em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em>)
</pre><p>
            Without this conversion, subqueries will be slow. To solve
            the dilemma of whether to push down or not push down
            conditions into the subquery, the conditions are wrapped in
            <span class="quote">“<span class="quote">trigger</span>”</span> functions. Thus, an expression of the
            following form:
          </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
            is converted into:
          </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>
                          AND trigcond(<em class="replaceable"><code>outer_expr</code></em>=<em class="replaceable"><code>inner_expr</code></em>))
</pre><p>
            More generally, if the subquery comparison is based on
            several pairs of outer and inner expressions, the conversion
            takes this comparison:
          </p><pre class="programlisting">(<em class="replaceable"><code>oe_1</code></em>, ..., <em class="replaceable"><code>oe_N</code></em>) IN (SELECT <em class="replaceable"><code>ie_1</code></em>, ..., <em class="replaceable"><code>ie_N</code></em> FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>)
</pre><p>
            and converts it to this expression:
          </p><pre class="programlisting">EXISTS (SELECT 1 FROM ... WHERE <em class="replaceable"><code>subquery_where</code></em>
                          AND trigcond(<em class="replaceable"><code>oe_1</code></em>=<em class="replaceable"><code>ie_1</code></em>)
                          AND ...
                          AND trigcond(<em class="replaceable"><code>oe_N</code></em>=<em class="replaceable"><code>ie_N</code></em>)
       )
</pre><p>
            Each
            <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code> is
            a special function that evaluates to the following values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <em class="replaceable"><code>X</code></em> when the
                <span class="quote">“<span class="quote">linked</span>”</span> outer expression
                <em class="replaceable"><code>oe_i</code></em> is not
                <code class="literal">NULL</code>
              </p></li><li class="listitem"><p>
                <code class="literal">TRUE</code> when the <span class="quote">“<span class="quote">linked</span>”</span>
                outer expression <em class="replaceable"><code>oe_i</code></em> is
                <code class="literal">NULL</code>
</p></li></ul>
</div>
<p>
            Note that trigger functions are <span class="emphasis"><em>not</em></span>
            triggers of the kind that you create with
            <a class="link" href="sql-syntax.html#create-trigger" title="13.1.19. CREATE TRIGGER Syntax"><code class="literal">CREATE TRIGGER</code></a>.
          </p><p>
            Equalities that are wrapped into
            <code class="literal">trigcond()</code> functions are not first class
            predicates for the query optimizer. Most optimizations
            cannot deal with predicates that may be turned on and off at
            query execution time, so they assume any
            <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code> to
            be an unknown function and ignore it. At the moment,
            triggered equalities can be used by those optimizations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Reference optimizations:
                <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>
                [OR <em class="replaceable"><code>Y</code></em> IS NULL])</code> can
                be used to construct
                <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>,
                <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>, or
                <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> table
                accesses.
              </p></li><li class="listitem"><p>
                Index lookup-based subquery execution engines:
                <code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>)</code>
                can be used to construct
                <a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a> or
                <a class="link" href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
                accesses.
              </p></li><li class="listitem"><p>
                Table-condition generator: If the subquery is a join of
                several tables, the triggered condition will be checked
                as soon as possible.
</p></li></ul>
</div>
<p>
            When the optimizer uses a triggered condition to create some
            kind of index lookup-based access (as for the first two
            items of the preceding list), it must have a fallback
            strategy for the case when the condition is turned off. This
            fallback strategy is always the same: Do a full table scan.
            In <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output, the
            fallback shows up as <code class="literal">Full scan on NULL
            key</code> in the <code class="literal">Extra</code> column:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT t1.col1,</code></strong>
    -&gt; <strong class="userinput"><code>t1.col1 IN (SELECT t2.key1 FROM t2 WHERE t2.col2=t1.col2) FROM t1\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
        ...
*************************** 2. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: t2
         type: index_subquery
possible_keys: key1
          key: key1
      key_len: 5
          ref: func
         rows: 2
        Extra: Using where; Full scan on NULL key
</pre><p>
            If you run <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN EXTENDED</code></a>
            followed by <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a>,
            you can see the triggered condition:
          </p><pre class="programlisting">*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: select `test`.`t1`.`col1` AS `col1`,
         &lt;in_optimizer&gt;(`test`.`t1`.`col1`,
         &lt;exists&gt;(&lt;index_lookup&gt;(&lt;cache&gt;(`test`.`t1`.`col1`) in t2
         on key1 checking NULL
         where (`test`.`t2`.`col2` = `test`.`t1`.`col2`) having
         trigcond(&lt;is_not_null_test&gt;(`test`.`t2`.`key1`))))) AS
         `t1.col1 IN (select t2.key1 from t2 where t2.col2=t1.col2)`
         from `test`.`t1`</pre><p>
            The use of triggered conditions has some performance
            implications. A <code class="literal">NULL IN (SELECT ...)</code>
            expression now may cause a full table scan (which is slow)
            when it previously did not. This is the price paid for
            correct results (the goal of the trigger-condition strategy
            was to improve compliance and not speed).
          </p><p>
            For multiple-table subqueries, execution of <code class="literal">NULL IN
            (SELECT ...)</code> will be particularly slow because the
            join optimizer does not optimize for the case where the
            outer expression is <code class="literal">NULL</code>. It assumes that
            subquery evaluations with <code class="literal">NULL</code> on the
            left side are very rare, even if there are statistics that
            indicate otherwise. On the other hand, if the outer
            expression might be <code class="literal">NULL</code> but never
            actually is, there is no performance penalty.
          </p><p>
            To help the query optimizer better execute your queries, use
            these tips:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Declare a column as <code class="literal">NOT NULL</code> if it
                really is. (This also helps other aspects of the
                optimizer by simplifying condition testing for the
                column.)
              </p></li><li class="listitem"><p>
                If you do not need to distinguish a
                <code class="literal">NULL</code> from <code class="literal">FALSE</code>
                subquery result, you can easily avoid the slow execution
                path. Replace a comparison that looks like this:
              </p><pre class="programlisting"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ...)
</pre><p>
                with this expression:
              </p><pre class="programlisting">(<em class="replaceable"><code>outer_expr</code></em> IS NOT NULL) AND (<em class="replaceable"><code>outer_expr</code></em> IN (SELECT <em class="replaceable"><code>inner_expr</code></em> FROM ...))
</pre><p>
                Then <code class="literal">NULL IN (SELECT ...)</code> will never
                be evaluated because MySQL stops evaluating
                <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a> parts as soon as the
                expression result is clear.
</p></li></ul>
</div>
<p>
            The <code class="literal">subquery_materialization_cost_based</code>
            enables control over the choice between subquery
            materialization and <code class="literal">IN -&gt; EXISTS</code>
            subquery transformation. See
            <a class="xref" href="optimization.html#switchable-optimizations" title="8.8.5.2. Controlling Switchable Optimizations">Section 8.8.5.2, “Controlling Switchable Optimizations”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="limit-optimization"></a>8.2.1.19. Optimizing <code class="literal">LIMIT</code> Queries</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48821088"></a><a class="indexterm" name="idp48822160"></a><p>
          If you need only a specified number of rows from a result set,
          use a <code class="literal">LIMIT</code> clause in the query, rather
          than fetching the whole result set and throwing away the extra
          data.
        </p><p>
          MySQL sometimes optimizes a query that has a <code class="literal">LIMIT
          <em class="replaceable"><code>row_count</code></em></code> clause and no
          <code class="literal">HAVING</code> clause:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you select only a few rows with
              <code class="literal">LIMIT</code>, MySQL uses indexes in some cases
              when normally it would prefer to do a full table scan.
            </p></li><li class="listitem"><p>
              If you use <code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code> with
              <code class="literal">ORDER BY</code>, MySQL ends the sorting as
              soon as it has found the first
              <em class="replaceable"><code>row_count</code></em> rows of the sorted
              result, rather than sorting the entire result. If ordering
              is done by using an index, this is very fast. If a
              filesort must be done, all rows that match the query
              without the <code class="literal">LIMIT</code> clause are selected,
              and most or all of them are sorted, before the first
              <em class="replaceable"><code>row_count</code></em> are found. After the
              initial rows have been found, MySQL does not sort any
              remainder of the result set.
            </p></li><li class="listitem"><p>
              When combining <code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code> with
              <code class="literal">DISTINCT</code>, MySQL stops as soon as it
              finds <em class="replaceable"><code>row_count</code></em> unique rows.
            </p></li><li class="listitem"><p>
              In some cases, a <code class="literal">GROUP BY</code> can be
              resolved by reading the key in order (or doing a sort on
              the key) and then calculating summaries until the key
              value changes. In this case, <code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code> does not
              calculate any unnecessary <code class="literal">GROUP BY</code>
              values.
            </p></li><li class="listitem"><p>
              As soon as MySQL has sent the required number of rows to
              the client, it aborts the query unless you are using
              <code class="literal">SQL_CALC_FOUND_ROWS</code>.
            </p></li><li class="listitem"><p>
              <code class="literal">LIMIT 0</code> quickly returns an empty set.
              This can be useful for checking the validity of a query.
              When using one of the MySQL APIs, it can also be employed
              for obtaining the types of the result columns. (This trick
              does not work in the MySQL Monitor (the
              <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> program), which merely displays
              <code class="literal">Empty set</code> in such cases; instead, use
              <a class="link" href="sql-syntax.html#show-columns" title="13.7.5.6. SHOW COLUMNS Syntax"><code class="literal">SHOW COLUMNS</code></a> or
              <a class="link" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax"><code class="literal">DESCRIBE</code></a> for this purpose.)
            </p></li><li class="listitem"><p>
              When the server uses temporary tables to resolve the
              query, it uses the <code class="literal">LIMIT
              <em class="replaceable"><code>row_count</code></em></code> clause to
              calculate how much space is required.
</p></li></ul>
</div>
<p>
          As of MySQL 5.6.2, the optimizer more efficiently handles
          queries (and subqueries) of the following form:
        </p><pre class="programlisting">SELECT ... FROM <em class="replaceable"><code>single_table</code></em> ... ORDER BY <em class="replaceable"><code>non_index_column</code></em> [DESC] LIMIT [<em class="replaceable"><code>M</code></em>,]<em class="replaceable"><code>N</code></em>;
</pre><p>
          That type of query is common in web applications that display
          only a few rows from a larger result set. For example:
        </p><pre class="programlisting">SELECT col1, ... FROM t1 ... ORDER BY name LIMIT 10;
SELECT col1, ... FROM t1 ... ORDER BY RAND() LIMIT 15;</pre><p>
          The sort buffer has a size of
          <a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>. If the sort
          elements for <em class="replaceable"><code>N</code></em> rows are small
          enough to fit in the sort buffer
          (<em class="replaceable"><code>M</code></em>+<em class="replaceable"><code>N</code></em>
          rows if <em class="replaceable"><code>M</code></em> was specified), the
          server can avoid using a merge file and perform the sort
          entirely in memory by treating the sort buffer as a priority
          queue:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Scan the table, inserting the select list columns from
              each selected row in sorted order in the queue. If the
              queue is full, bump out the last row in the sort order.
            </p></li><li class="listitem"><p>
              Return the first <em class="replaceable"><code>N</code></em> rows from
              the queue. (If <em class="replaceable"><code>M</code></em> was specified,
              skip the first <em class="replaceable"><code>M</code></em> rows and
              return the next <em class="replaceable"><code>N</code></em> rows.)
</p></li></ul>
</div>
<p>
          Previously, the server performed this operation by using a
          merge file for the sort:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Scan the table, repeating these steps through the end of
              the table:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Select rows until the sort buffer is filled.
                </p></li><li class="listitem"><p>
                  Write the first <em class="replaceable"><code>N</code></em> rows in
                  the buffer
                  (<em class="replaceable"><code>M</code></em>+<em class="replaceable"><code>N</code></em>
                  rows if <em class="replaceable"><code>M</code></em> was specified) to
                  a merge file.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Sort the merge file and return the first
              <em class="replaceable"><code>N</code></em> rows. (If
              <em class="replaceable"><code>M</code></em> was specified, skip the first
              <em class="replaceable"><code>M</code></em> rows and return the next
              <em class="replaceable"><code>N</code></em> rows.)
</p></li></ul>
</div>
<p>
          The cost of the table scan is the same for the queue and
          merge-file methods, so the optimizer chooses between methods
          based on other costs:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The queue method involves more CPU for inserting rows into
              the queue in order
            </p></li><li class="listitem"><p>
              The merge-file method has I/O costs to write and read the
              file and CPU cost to sort it
</p></li></ul>
</div>
<p>
          The optimizer considers the balance between these factors for
          particular values of <em class="replaceable"><code>N</code></em> and the row
          size.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="how-to-avoid-table-scan"></a>8.2.1.20. How to Avoid Full Table Scans</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48873520"></a><a class="indexterm" name="idp48875008"></a><a class="indexterm" name="idp48876496"></a><p>
          The output from <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> shows
          <code class="literal">ALL</code> in the
          <code class="literal">type</code> column when MySQL uses a
          <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scan</a> to
          resolve a query. This usually happens under the following
          conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The table is so small that it is faster to perform a table
              scan than to bother with a key lookup. This is common for
              tables with fewer than 10 rows and a short row length.
            </p></li><li class="listitem"><p>
              There are no usable restrictions in the
              <code class="literal">ON</code> or <code class="literal">WHERE</code> clause
              for indexed columns.
            </p></li><li class="listitem"><p>
              You are comparing indexed columns with constant values and
              MySQL has calculated (based on the index tree) that the
              constants cover too large a part of the table and that a
              table scan would be faster. See
              <a class="xref" href="optimization.html#where-optimizations" title="8.2.1.2. How MySQL Optimizes WHERE Clauses">Section 8.2.1.2, “How MySQL Optimizes <code class="literal">WHERE</code> Clauses”</a>.
            </p></li><li class="listitem"><p>
              You are using a key with low cardinality (many rows match
              the key value) through another column. In this case, MySQL
              assumes that by using the key it probably will do many key
              lookups and that a table scan would be faster.
</p></li></ul>
</div>
<p>
          For small tables, a table scan often is appropriate and the
          performance impact is negligible. For large tables, try the
          following techniques to avoid having the optimizer incorrectly
          choose a table scan:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Use <code class="literal">ANALYZE TABLE
              <em class="replaceable"><code>tbl_name</code></em></code> to update
              the key distributions for the scanned table. See
              <a class="xref" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax">Section 13.7.2.1, “<code class="literal">ANALYZE TABLE</code> Syntax”</a>.
            </p></li><li class="listitem"><p>
              Use <code class="literal">FORCE INDEX</code> for the scanned table
              to tell MySQL that table scans are very expensive compared
              to using the given index:
            </p><pre class="programlisting">SELECT * FROM t1, t2 FORCE INDEX (<em class="replaceable"><code>index_for_column</code></em>)
  WHERE t1.<em class="replaceable"><code>col_name</code></em>=t2.<em class="replaceable"><code>col_name</code></em>;
</pre><p>
              See <a class="xref" href="sql-syntax.html#index-hints" title="13.2.9.3. Index Hint Syntax">Section 13.2.9.3, “Index Hint Syntax”</a>.
            </p></li><li class="listitem"><p>
              Start <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
              <a class="link" href="server-administration.html#sysvar_max_seeks_for_key"><code class="option">--max-seeks-for-key=1000</code></a>
              option or use <code class="literal">SET
              max_seeks_for_key=1000</code> to tell the optimizer to
              assume that no key scan causes more than 1,000 key seeks.
              See <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="non-select-optimization"></a>8.2.2. Optimizing DML Statements</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#insert-speed">8.2.2.1. Speed of <code class="literal">INSERT</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#update-speed">8.2.2.2. Speed of <code class="literal">UPDATE</code> Statements</a></span></dt><dt><span class="section"><a href="optimization.html#delete-speed">8.2.2.3. Speed of <code class="literal">DELETE</code> Statements</a></span></dt></dl>
</div>
<a class="indexterm" name="idp48901040"></a><p>
        This section explains how to speed up the data manipulation
        language (DML) statements,
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>. Traditional OLTP
        applications and modern web applications typically do many small
        DML operations, where concurrency is vital. Data analysis and
        reporting applications typically run DML operations that affect
        many rows at once, where the main considerations is the I/O to
        write large amounts of data and keep indexes up-to-date. For
        inserting and updating large volumes of data (known in the
        industry as ETL, for <span class="quote">“<span class="quote">extract-transform-load</span>”</span>),
        sometimes you use other SQL statements or external commands,
        that mimic the effects of <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="insert-speed"></a>8.2.2.1. Speed of <code class="literal">INSERT</code> Statements</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp48910512"></a><a class="indexterm" name="idp48911584"></a><a class="indexterm" name="idp48913072"></a><a class="indexterm" name="idp48914560"></a><p>
          To optimize insert speed, combine many small operations into a
          single large operation. Ideally, you make a single connection,
          send the data for many new rows at once, and delay all index
          updates and consistency checking until the very end.
        </p><p>
          The time required for inserting a row is determined by the
          following factors, where the numbers indicate approximate
          proportions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Connecting: (3)
            </p></li><li class="listitem"><p>
              Sending query to server: (2)
            </p></li><li class="listitem"><p>
              Parsing query: (2)
            </p></li><li class="listitem"><p>
              Inserting row: (1 × size of row)
            </p></li><li class="listitem"><p>
              Inserting indexes: (1 × number of indexes)
            </p></li><li class="listitem"><p>
              Closing: (1)
</p></li></ul>
</div>
<p>
          This does not take into consideration the initial overhead to
          open tables, which is done once for each concurrently running
          query.
        </p><p>
          The size of the table slows down the insertion of indexes by
          log <em class="replaceable"><code>N</code></em>, assuming B-tree indexes.
        </p><p>
          You can use the following methods to speed up inserts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you are inserting many rows from the same client at the
              same time, use <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
              statements with multiple <code class="literal">VALUES</code> lists
              to insert several rows at a time. This is considerably
              faster (many times faster in some cases) than using
              separate single-row <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
              statements. If you are adding data to a nonempty table,
              you can tune the
              <a class="link" href="server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a>
              variable to make data insertion even faster. See
              <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>.
            </p></li><li class="listitem"><p>
              When loading a table from a text file, use
              <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
              INFILE</code></a>. This is usually 20 times faster than
              using <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements.
              See <a class="xref" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax">Section 13.2.6, “<code class="literal">LOAD DATA INFILE</code>
      Syntax”</a>.
            </p></li><li class="listitem"><p>
              Take advantage of the fact that columns have default
              values. Insert values explicitly only when the value to be
              inserted differs from the default. This reduces the
              parsing that MySQL must do and improves the insert speed.
            </p></li><li class="listitem"><p>
              See <a class="xref" href="optimization.html#optimizing-innodb-bulk-data-loading" title="8.5.4. Bulk Data Loading for InnoDB Tables">Section 8.5.4, “Bulk Data Loading for <code class="literal">InnoDB</code> Tables”</a>
              for tips specific to <code class="literal">InnoDB</code> tables.
            </p></li><li class="listitem"><p>
              See <a class="xref" href="optimization.html#optimizing-myisam-bulk-data-loading" title="8.6.2. Bulk Data Loading for MyISAM Tables">Section 8.6.2, “Bulk Data Loading for <code class="literal">MyISAM</code> Tables”</a>
              for tips specific to <code class="literal">MyISAM</code> tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="update-speed"></a>8.2.2.2. Speed of <code class="literal">UPDATE</code> Statements</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48940320"></a><p>
          An update statement is optimized like a
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> query with the
          additional overhead of a write. The speed of the write depends
          on the amount of data being updated and the number of indexes
          that are updated. Indexes that are not changed do not get
          updated.
        </p><p>
          Another way to get fast updates is to delay updates and then
          do many updates in a row later. Performing multiple updates
          together is much quicker than doing one at a time if you lock
          the table.
        </p><p>
          For a <code class="literal">MyISAM</code> table that uses dynamic row
          format, updating a row to a longer total length may split the
          row. If you do this often, it is very important to use
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> occasionally.
          See <a class="xref" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax">Section 13.7.2.4, “<code class="literal">OPTIMIZE TABLE</code> Syntax”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="delete-speed"></a>8.2.2.3. Speed of <code class="literal">DELETE</code> Statements</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp48948240"></a><p>
          The time required to delete individual rows in a
          <code class="literal">MyISAM</code> table is exactly proportional to the
          number of indexes. To delete rows more quickly, you can
          increase the size of the key cache by increasing the
          <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
          variable. See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
        </p><p>
          To delete all rows from a <code class="literal">MyISAM</code> table,
          <code class="literal">TRUNCATE TABLE
          <em class="replaceable"><code>tbl_name</code></em></code> is faster than
          than <code class="literal">DELETE FROM
          <em class="replaceable"><code>tbl_name</code></em></code>. Truncate
          operations are not transaction-safe; an error occurs when
          attempting one in the course of an active transaction or
          active table lock. See <a class="xref" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax">Section 13.1.33, “<code class="literal">TRUNCATE TABLE</code> Syntax”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="permission-optimization"></a>8.2.3. Optimizing Database Privileges</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp48957632"></a><a class="indexterm" name="idp48959120"></a><p>
        The more complex your privilege setup, the more overhead applies
        to all SQL statements. Simplifying the privileges established by
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.4. GRANT Syntax"><code class="literal">GRANT</code></a> statements enables MySQL to
        reduce permission-checking overhead when clients execute
        statements. For example, if you do not grant any table-level or
        column-level privileges, the server need not ever check the
        contents of the <code class="literal">tables_priv</code> and
        <code class="literal">columns_priv</code> tables. Similarly, if you place
        no resource limits on any accounts, the server does not have to
        perform resource counting. If you have a very high
        statement-processing load, consider using a simplified grant
        structure to reduce permission-checking overhead.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="information-schema-optimization"></a>8.2.4. Optimizing <code class="literal">INFORMATION_SCHEMA</code> Queries</h3>

</div>

</div>

</div>
<p>
        Applications that monitor the database can make frequent use of
        the <code class="literal">INFORMATION_SCHEMA</code> tables. Certain types
        of queries for <code class="literal">INFORMATION_SCHEMA</code> tables can
        be optimized to execute more quickly. The goal is to minimize
        file operations (for example, scanning a directory or opening a
        table file) to collect the information that makes up these
        dynamic tables. These optimizations do have an effect on how
        collations are used for searches in
        <code class="literal">INFORMATION_SCHEMA</code> tables. For more
        information, see
        <a class="xref" href="globalization.html#charset-collation-information-schema" title="10.1.7.9. Collation and INFORMATION_SCHEMA Searches">Section 10.1.7.9, “Collation and <code class="literal">INFORMATION_SCHEMA</code> Searches”</a>.
      </p><p>
        <span class="bold"><strong>1) Try to use constant lookup values for
        database and table names in the <code class="literal">WHERE</code>
        clause</strong></span>
      </p><p>
        You can take advantage of this principle as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To look up databases or tables, use expressions that
            evaluate to a constant, such as literal values, functions
            that return a constant, or scalar subqueries.
          </p></li><li class="listitem"><p>
            Avoid queries that use a nonconstant database name lookup
            value (or no lookup value) because they require a scan of
            the data directory to find matching database directory
            names.
          </p></li><li class="listitem"><p>
            Within a database, avoid queries that use a nonconstant
            table name lookup value (or no lookup value) because they
            require a scan of the database directory to find matching
            table files.
</p></li></ul>
</div>
<p>
        This principle applies to the
        <code class="literal">INFORMATION_SCHEMA</code> tables shown in the
        following table, which shows the columns for which a constant
        lookup value enables the server to avoid a directory scan. For
        example, if you are selecting from
        <a class="link" href="information-schema.html#tables-table" title="20.23. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a>, using a constant lookup
        value for <code class="literal">TABLE_SCHEMA</code> in the
        <code class="literal">WHERE</code> clause enables a data directory scan to
        be avoided.
</p>
<div class="informaltable">
<table summary="This table lists INFORMATION_SCHEMA
          tables and table columns for which a constant lookup value
enables the server to avoid directory scans." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Table</th><th scope="col">Column to specify to avoid data directory scan</th><th scope="col">Column to specify to avoid database directory scan</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="information-schema.html#columns-table" title="20.4. The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">COLUMNS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#key-column-usage-table" title="20.11. The INFORMATION_SCHEMA KEY_COLUMN_USAGE Table"><code class="literal">KEY_COLUMN_USAGE</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#partitions-table" title="20.14. The INFORMATION_SCHEMA PARTITIONS Table"><code class="literal">PARTITIONS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#referential-constraints-table" title="20.18. The INFORMATION_SCHEMA REFERENTIAL_CONSTRAINTS Table"><code class="literal">REFERENTIAL_CONSTRAINTS</code></a></td><td><code class="literal">CONSTRAINT_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#statistics-table" title="20.22. The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#tables-table" title="20.23. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#table-constraints-table" title="20.25. The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">TABLE_CONSTRAINTS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#triggers-table" title="20.27. The INFORMATION_SCHEMA TRIGGERS Table"><code class="literal">TRIGGERS</code></a></td><td><code class="literal">EVENT_OBJECT_SCHEMA</code></td><td><code class="literal">EVENT_OBJECT_TABLE</code></td></tr><tr><td scope="row"><a class="link" href="information-schema.html#views-table" title="20.29. The INFORMATION_SCHEMA VIEWS Table"><code class="literal">VIEWS</code></a></td><td><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">TABLE_NAME</code></td></tr></tbody></table>
</div>
<p>
        The benefit of a query that is limited to a specific constant
        database name is that checks need be made only for the named
        database directory. Example:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test';</pre><p>
        Use of the literal database name <code class="literal">test</code> enables
        the server to check only the <code class="literal">test</code> database
        directory, regardless of how many databases there might be. By
        contrast, the following query is less efficient because it
        requires a scan of the data directory to determine which
        database names match the pattern <code class="literal">'test%'</code>:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA LIKE 'test%';</pre><p>
        For a query that is limited to a specific constant table name,
        checks need be made only for the named table within the
        corresponding database directory. Example:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME = 't1';</pre><p>
        Use of the literal table name <code class="literal">t1</code> enables the
        server to check only the files for the <code class="literal">t1</code>
        table, regardless of how many tables there might be in the
        <code class="literal">test</code> database. By contrast, the following
        query requires a scan of the <code class="literal">test</code> database
        directory to determine which table names match the pattern
        <code class="literal">'t%'</code>:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME LIKE 't%';</pre><p>
        The following query requires a scan of the database directory to
        determine matching database names for the pattern
        <code class="literal">'test%'</code>, and for each matching database, it
        requires a scan of the database directory to determine matching
        table names for the pattern <code class="literal">'t%'</code>:
      </p><pre class="programlisting">SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test%' AND TABLE_NAME LIKE 't%';</pre><p>
        <span class="bold"><strong>2) Write queries that minimize the number
        of table files that must be opened</strong></span>
      </p><p>
        For queries that refer to certain
        <code class="literal">INFORMATION_SCHEMA</code> table columns, several
        optimizations are available that minimize the number of table
        files that must be opened. Example:
      </p><pre class="programlisting">SELECT TABLE_NAME, ENGINE FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'test';</pre><p>
        In this case, after the server has scanned the database
        directory to determine the names of the tables in the database,
        those names become available with no further file system
        lookups. Thus, <code class="literal">TABLE_NAME</code> requires no files
        to be opened. The <code class="literal">ENGINE</code> (storage engine)
        value can be determined by opening the table's
        <code class="filename">.frm</code> file, without touching other table
        files such as the <code class="filename">.MYD</code> or
        <code class="filename">.MYI</code> file.
      </p><p>
        Some values, such as <code class="literal">INDEX_LENGTH</code> for
        <code class="literal">MyISAM</code> tables, require opening the
        <code class="filename">.MYD</code> or <code class="filename">.MYI</code> file as
        well.
      </p><p>
        The file-opening optimization types are denoted thus:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SKIP_OPEN_TABLE</code>: Table files do not need
            to be opened. The information has already become available
            within the query by scanning the database directory.
          </p></li><li class="listitem"><p>
            <code class="literal">OPEN_FRM_ONLY</code>: Only the table's
            <code class="filename">.frm</code> file need be opened.
          </p></li><li class="listitem"><p>
            <code class="literal">OPEN_TRIGGER_ONLY</code>: Only the table's
            <code class="filename">.TRG</code> file need be opened.
          </p></li><li class="listitem"><p>
            <code class="literal">OPEN_FULL_TABLE</code>: The unoptimized
            information lookup. The <code class="filename">.frm</code>,
            <code class="filename">.MYD</code>, and <code class="filename">.MYI</code>
            files must be opened.
</p></li></ul>
</div>
<p>
        The following list indicates how the preceding optimization
        types apply to <code class="literal">INFORMATION_SCHEMA</code> table
        columns. For tables and columns not named, none of the
        optimizations apply.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="information-schema.html#columns-table" title="20.4. The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">COLUMNS</code></a>:
            <code class="literal">OPEN_FRM_ONLY</code> applies to all columns
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#key-column-usage-table" title="20.11. The INFORMATION_SCHEMA KEY_COLUMN_USAGE Table"><code class="literal">KEY_COLUMN_USAGE</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#partitions-table" title="20.14. The INFORMATION_SCHEMA PARTITIONS Table"><code class="literal">PARTITIONS</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#referential-constraints-table" title="20.18. The INFORMATION_SCHEMA REFERENTIAL_CONSTRAINTS Table"><code class="literal">REFERENTIAL_CONSTRAINTS</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#statistics-table" title="20.22. The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a>:
</p>
<div class="informaltable">
<table summary="This table shows optimization types that apply to
              INFORMATION_SCHEMA
              STATISTICS table
columns." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Optimization type</th></tr></thead><tbody><tr><td scope="row"><code class="literal">TABLE_CATALOG</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">TABLE_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">NON_UNIQUE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">INDEX_SCHEMA</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">INDEX_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">SEQ_IN_INDEX</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">COLUMN_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">COLLATION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">CARDINALITY</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">SUB_PART</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">PACKED</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">NULLABLE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">INDEX_TYPE</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">COMMENT</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr></tbody></table>
</div>
</li><li class="listitem"><p>
            <a class="link" href="information-schema.html#tables-table" title="20.23. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a>:
</p>
<div class="informaltable">
<table summary="This table shows optimization types that apply to
              INFORMATION_SCHEMA
              TABLES table
columns." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Optimization type</th></tr></thead><tbody><tr><td scope="row"><code class="literal">TABLE_CATALOG</code></td><td><code class="literal">SKIP_OPEN_TABLE</code></td></tr><tr><td scope="row"><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">SKIP_OPEN_TABLE</code></td></tr><tr><td scope="row"><code class="literal">TABLE_NAME</code></td><td><code class="literal">SKIP_OPEN_TABLE</code></td></tr><tr><td scope="row"><code class="literal">TABLE_TYPE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">ENGINE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">VERSION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">TABLE_ROWS</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">AVG_ROW_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">DATA_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">MAX_DATA_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">INDEX_LENGTH</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">DATA_FREE</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">AUTO_INCREMENT</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">CREATE_TIME</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">UPDATE_TIME</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">CHECK_TIME</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">TABLE_COLLATION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">CHECKSUM</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">CREATE_OPTIONS</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">TABLE_COMMENT</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr></tbody></table>
</div>
</li><li class="listitem"><p>
            <a class="link" href="information-schema.html#table-constraints-table" title="20.25. The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">TABLE_CONSTRAINTS</code></a>:
            <code class="literal">OPEN_FULL_TABLE</code> applies to all columns
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#triggers-table" title="20.27. The INFORMATION_SCHEMA TRIGGERS Table"><code class="literal">TRIGGERS</code></a>:
            <code class="literal">OPEN_TRIGGER_ONLY</code> applies to all columns
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#views-table" title="20.29. The INFORMATION_SCHEMA VIEWS Table"><code class="literal">VIEWS</code></a>:
</p>
<div class="informaltable">
<table summary="This table shows optimization types that apply to
              INFORMATION_SCHEMA
VIEWS table columns." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Optimization type</th></tr></thead><tbody><tr><td scope="row"><code class="literal">TABLE_CATALOG</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">TABLE_SCHEMA</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">TABLE_NAME</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">VIEW_DEFINITION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">CHECK_OPTION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">IS_UPDATABLE</code></td><td><code class="literal">OPEN_FULL_TABLE</code></td></tr><tr><td scope="row"><code class="literal">DEFINER</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">SECURITY_TYPE</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">CHARACTER_SET_CLIENT</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr><tr><td scope="row"><code class="literal">COLLATION_CONNECTION</code></td><td><code class="literal">OPEN_FRM_ONLY</code></td></tr></tbody></table>
</div>
</li></ul>
</div>
<p>
        <span class="bold"><strong>3) Use
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> to determine whether the
        server can use <code class="literal">INFORMATION_SCHEMA</code>
        optimizations for a query</strong></span>
      </p><p>
        This applies particularly for
        <code class="literal">INFORMATION_SCHEMA</code> queries that search for
        information from more than one database, which might take a long
        time and impact performance. The <code class="literal">Extra</code> value
        in <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output indicates
        which, if any, of the optimizations described earlier the server
        can use to evaluate <code class="literal">INFORMATION_SCHEMA</code>
        queries. The following examples demonstrate the kinds of
        information you can expect to see in the
        <code class="literal">Extra</code> value.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME FROM INFORMATION_SCHEMA.VIEWS WHERE</code></strong>
    -&gt; <strong class="userinput"><code>TABLE_SCHEMA = 'test' AND TABLE_NAME = 'v1'\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: VIEWS
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA,TABLE_NAME
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned 0 databases
</pre><p>
        Use of constant database and table lookup values enables the
        server to avoid directory scans. For references to
        <code class="literal">VIEWS.TABLE_NAME</code>, only the
        <code class="filename">.frm</code> file need be opened.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME, ROW_FORMAT FROM INFORMATION_SCHEMA.TABLES\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: TABLES
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Open_full_table; Scanned all databases
</pre><p>
        No lookup values are provided (there is no
        <code class="literal">WHERE</code> clause), so the server must scan the
        data directory and each database directory. For each table thus
        identified, the table name and row format are selected.
        <code class="literal">TABLE_NAME</code> requires no further table files to
        be opened (the <code class="literal">SKIP_OPEN_TABLE</code> optimization
        applies). <code class="literal">ROW_FORMAT</code> requires all table files
        to be opened (<code class="literal">OPEN_FULL_TABLE</code> applies).
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> reports
        <code class="literal">OPEN_FULL_TABLE</code> because it is more expensive
        than <code class="literal">SKIP_OPEN_TABLE</code>.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT TABLE_NAME, TABLE_TYPE FROM INFORMATION_SCHEMA.TABLES</code></strong>
    -&gt; <strong class="userinput"><code>WHERE TABLE_SCHEMA = 'test'\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: TABLES
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned 1 database
</pre><p>
        No table name lookup value is provided, so the server must scan
        the <code class="literal">test</code> database directory. For the
        <code class="literal">TABLE_NAME</code> and <code class="literal">TABLE_TYPE</code>
        columns, the <code class="literal">SKIP_OPEN_TABLE</code> and
        <code class="literal">OPEN_FRM_ONLY</code> optimizations apply,
        respectively. <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> reports
        <code class="literal">OPEN_FRM_ONLY</code> because it is more expensive.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT B.TABLE_NAME</code></strong>
    -&gt; <strong class="userinput"><code>FROM INFORMATION_SCHEMA.TABLES AS A, INFORMATION_SCHEMA.COLUMNS AS B</code></strong>
    -&gt; <strong class="userinput"><code>WHERE A.TABLE_SCHEMA = 'test'</code></strong>
    -&gt; <strong class="userinput"><code>AND A.TABLE_NAME = 't1'</code></strong>
    -&gt; <strong class="userinput"><code>AND B.TABLE_NAME = A.TABLE_NAME\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: A
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA,TABLE_NAME
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Skip_open_table; Scanned 0 databases
*************************** 2. row ***************************
           id: 1
  select_type: SIMPLE
        table: B
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned all databases;
               Using join buffer
</pre><p>
        For the first <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output row:
        Constant database and table lookup values enable the server to
        avoid directory scans for <code class="literal">TABLES</code> values.
        References to <code class="literal">TABLES.TABLE_NAME</code> require no
        further table files.
      </p><p>
        For the second <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output
        row: All <a class="link" href="information-schema.html#columns-table" title="20.4. The INFORMATION_SCHEMA COLUMNS Table"><code class="literal">COLUMNS</code></a> table values are
        <code class="literal">OPEN_FRM_ONLY</code> lookups, so
        <code class="literal">COLUMNS.TABLE_NAME</code> requires the
        <code class="filename">.frm</code> file to be opened.
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT * FROM INFORMATION_SCHEMA.COLLATIONS\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: COLLATIONS
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra:
</pre><p>
        In this case, no optimizations apply because
        <a class="link" href="information-schema.html#collations-table" title="20.2. The INFORMATION_SCHEMA COLLATIONS Table"><code class="literal">COLLATIONS</code></a> is not one of the
        <code class="literal">INFORMATION_SCHEMA</code> tables for which
        optimizations are available.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="miscellaneous-optimization-tips"></a>8.2.5. Other Optimization Tips</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49225792"></a><a class="indexterm" name="idp49227280"></a><p>
        This section lists a number of miscellaneous tips for improving
        query processing speed:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Use persistent connections to the database to avoid
            connection overhead. If you cannot use persistent
            connections and you are initiating many new connections to
            the database, you may want to change the value of the
            <a class="link" href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> variable.
            See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
          </p></li><li class="listitem"><p>
            Always check whether all your queries really use the indexes
            that you have created in the tables. In MySQL, you can do
            this with the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
            statement. See <a class="xref" href="optimization.html#using-explain" title="8.8.1. Optimizing Queries with EXPLAIN">Section 8.8.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>.
          </p></li><li class="listitem"><p>
            Try to avoid complex <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            queries on <code class="literal">MyISAM</code> tables that are updated
            frequently, to avoid problems with table locking that occur
            due to contention between readers and writers.
          </p></li><li class="listitem"><p>
            <code class="literal">MyISAM</code> supports concurrent inserts: If a
            table has no free blocks in the middle of the data file, you
            can <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> new rows into it
            at the same time that other threads are reading from the
            table. If it is important to be able to do this, consider
            using the table in ways that avoid deleting rows. Another
            possibility is to run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> to defragment the table after you have
            deleted a lot of rows from it. This behavior is altered by
            setting the
            <a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> variable.
            You can force new rows to be appended (and therefore permit
            concurrent inserts), even in tables that have deleted rows.
            See <a class="xref" href="optimization.html#concurrent-inserts" title="8.10.3. Concurrent Inserts">Section 8.10.3, “Concurrent Inserts”</a>.
          </p></li><li class="listitem"><p>
            To fix any compression issues that may have occurred with
            <code class="literal">ARCHIVE</code> tables, you can use
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>. See
            <a class="xref" href="storage-engines.html#archive-storage-engine" title="14.6. The ARCHIVE Storage Engine">Section 14.6, “The <code class="literal">ARCHIVE</code> Storage Engine”</a>.
          </p></li><li class="listitem"><p>
            Use <code class="literal">ALTER TABLE ... ORDER BY
            <em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code> if you
            usually retrieve rows in
            <code class="literal"><em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code> order. By
            using this option after extensive changes to the table, you
            may be able to get higher performance.
          </p></li><li class="listitem"><p>
            In some cases, it may make sense to introduce a column that
            is <span class="quote">“<span class="quote">hashed</span>”</span> based on information from other
            columns. If this column is short, reasonably unique, and
            indexed, it may be much faster than a <span class="quote">“<span class="quote">wide</span>”</span>
            index on many columns. In MySQL, it is very easy to use this
            extra column:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>hash_col</code></em>=MD5(CONCAT(<em class="replaceable"><code>col1</code></em>,<em class="replaceable"><code>col2</code></em>))
  AND <em class="replaceable"><code>col1</code></em>='<em class="replaceable"><code>constant</code></em>' AND <em class="replaceable"><code>col2</code></em>='<em class="replaceable"><code>constant</code></em>';
</pre></li><li class="listitem"><p>
            For <code class="literal">MyISAM</code> tables that change frequently,
            try to avoid all variable-length columns
            (<a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a>, and
            <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>). The table uses dynamic
            row format if it includes even a single variable-length
            column. See <a class="xref" href="storage-engines.html" title="Chapter 14. Storage Engines">Chapter 14, <i>Storage Engines</i></a>.
          </p></li><li class="listitem"><p>
            It is normally not useful to split a table into different
            tables just because the rows become large. In accessing a
            row, the biggest performance hit is the disk seek needed to
            find the first byte of the row. After finding the data, most
            modern disks can read the entire row fast enough for most
            applications. The only cases where splitting up a table
            makes an appreciable difference is if it is a
            <code class="literal">MyISAM</code> table using dynamic row format
            that you can change to a fixed row size, or if you very
            often need to scan the table but do not need most of the
            columns. See <a class="xref" href="storage-engines.html" title="Chapter 14. Storage Engines">Chapter 14, <i>Storage Engines</i></a>.
          </p></li><li class="listitem"><p>
            If you often need to calculate results such as counts based
            on information from a lot of rows, it may be preferable to
            introduce a new table and update the counter in real time.
            An update of the following form is very fast:
          </p><pre class="programlisting">UPDATE <em class="replaceable"><code>tbl_name</code></em> SET <em class="replaceable"><code>count_col</code></em>=<em class="replaceable"><code>count_col</code></em>+1 WHERE <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>constant</code></em>;
</pre><p>
            This is very important when you use MySQL storage engines
            such as <code class="literal">MyISAM</code> that has only table-level
            locking (multiple readers with single writers). This also
            gives better performance with most database systems, because
            the row locking manager in this case has less to do.
          </p></li><li class="listitem"><p>
            If you need to collect statistics from large log tables, use
            summary tables instead of scanning the entire log table.
            Maintaining the summaries should be much faster than trying
            to calculate statistics <span class="quote">“<span class="quote">live.</span>”</span> Regenerating
            new summary tables from the logs when things change
            (depending on business decisions) is faster than changing
            the running application.
          </p></li><li class="listitem"><p>
            If possible, classify reports as <span class="quote">“<span class="quote">live</span>”</span> or as
            <span class="quote">“<span class="quote">statistical,</span>”</span> where data needed for
            statistical reports is created only from summary tables that
            are generated periodically from the live data.
          </p></li><li class="listitem"><p>
            Take advantage of the fact that columns have default values.
            Insert values explicitly only when the value to be inserted
            differs from the default. This reduces the parsing that
            MySQL must do and improves the insert speed.
          </p></li><li class="listitem"><p>
            In some cases, it is convenient to pack and store data into
            a <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> column. In this case,
            you must provide code in your application to pack and unpack
            information, but this may save a lot of accesses at some
            stage. This is practical when you have data that does not
            conform well to a rows-and-columns table structure.
          </p></li><li class="listitem"><p>
            Normally, try to keep all data nonredundant (observing what
            is referred to in database theory as <em class="firstterm">third normal
            form</em>). However, there may be situations in which
            it can be advantageous to duplicate information or create
            summary tables to gain more speed.
          </p></li><li class="listitem"><p>
            Stored routines or UDFs (user-defined functions) may be a
            good way to gain performance for some tasks. See
            <a class="xref" href="stored-programs-views.html#stored-routines" title="19.2. Using Stored Routines (Procedures and Functions)">Section 19.2, “Using Stored Routines (Procedures and Functions)”</a>, and
            <a class="xref" href="extending-mysql.html#adding-functions" title="23.3. Adding New Functions to MySQL">Section 23.3, “Adding New Functions to MySQL”</a>, for more information.
          </p></li><li class="listitem"><p>
            You can increase performance by caching queries or answers
            in your application and then executing many inserts or
            updates together. If your database system supports table
            locks (as does MySQL), this should help to ensure that the
            index cache is only flushed once after all updates. You can
            also take advantage of MySQL's query cache to achieve
            similar results; see <a class="xref" href="optimization.html#query-cache" title="8.9.3. The MySQL Query Cache">Section 8.9.3, “The MySQL Query Cache”</a>.
          </p></li><li class="listitem"><p>
            Use multiple-row <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements to store many rows with one SQL statement. (This
            is a relatively portable technique.)
          </p></li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> to load large amounts of data. This is
            faster than using <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements.
          </p></li><li class="listitem"><p>
            Use <code class="literal">AUTO_INCREMENT</code> columns so that each
            row in a table can be identified by a single unique value.
          </p></li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> once in a
            while to avoid fragmentation with dynamic-format
            <code class="literal">MyISAM</code> tables. See
            <a class="xref" href="storage-engines.html#myisam-table-formats" title="14.3.3. MyISAM Table Storage Formats">Section 14.3.3, “<code class="literal">MyISAM</code> Table Storage Formats”</a>.
          </p></li><li class="listitem"><p>
            Use <code class="literal">MEMORY</code> tables when possible to get
            more speed. See <a class="xref" href="storage-engines.html#memory-storage-engine" title="14.4. The MEMORY Storage Engine">Section 14.4, “The <code class="literal">MEMORY</code> Storage Engine”</a>.
            <code class="literal">MEMORY</code> tables are useful for noncritical
            data that is accessed often, such as information about the
            last displayed banner for users who don't have cookies
            enabled in their Web browser. User sessions are another
            alternative available in many Web application environments
            for handling volatile state data.
          </p></li><li class="listitem"><p>
            With Web servers, images and other binary assets should
            normally be stored as files. That is, store only a reference
            to the file rather than the file itself in the database.
            Most Web servers are better at caching files than database
            contents, so using files is generally faster.
          </p></li><li class="listitem"><p>
            Columns with identical information in different tables
            should be declared to have identical data types so that
            joins based on the corresponding columns will be faster.
          </p></li><li class="listitem"><p>
            Try to keep column names simple. For example, in a table
            named <code class="literal">customer</code>, use a column name of
            <code class="literal">name</code> instead of
            <code class="literal">customer_name</code>. To make your names
            portable to other SQL servers, consider keeping them shorter
            than 18 characters.
          </p></li><li class="listitem"><p>
            If you need really high speed, look at the low-level
            interfaces for data storage that the different SQL servers
            support. For example, by accessing the MySQL
            <code class="literal">MyISAM</code> storage engine directly, you could
            get a speed increase of two to five times compared to using
            the SQL interface. To be able to do this, the data must be
            on the same server as the application, and usually it should
            only be accessed by one process (because external file
            locking is really slow). One could eliminate these problems
            by introducing low-level <code class="literal">MyISAM</code> commands
            in the MySQL server (this could be one easy way to get more
            performance if needed). By carefully designing the database
            interface, it should be quite easy to support this type of
            optimization.
          </p></li><li class="listitem"><p>
            If you are using numeric data, it is faster in many cases to
            access information from a database (using a live connection)
            than to access a text file. Information in the database is
            likely to be stored in a more compact format than in the
            text file, so accessing it involves fewer disk accesses. You
            also save code in your application because you need not
            parse your text files to find line and column boundaries.
          </p></li><li class="listitem"><p>
            Replication can provide a performance benefit for some
            operations. You can distribute client retrievals among
            replication servers to split up the load. To avoid slowing
            down the master while making backups, you can make backups
            using a slave server. See <a class="xref" href="replication.html" title="Chapter 16. Replication">Chapter 16, <i>Replication</i></a>.
          </p></li><li class="listitem"><p>
            Declaring a <code class="literal">MyISAM</code> table with the
            <code class="literal">DELAY_KEY_WRITE=1</code> table option makes
            index updates faster because they are not flushed to disk
            until the table is closed. The downside is that if something
            kills the server while such a table is open, you must ensure
            that the table is okay by running the server with the
            <a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a>
            option, or by running <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> before
            restarting the server. (However, even in this case, you
            should not lose anything by using
            <code class="literal">DELAY_KEY_WRITE</code>, because the key
            information can always be generated from the data rows.)
          </p></li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT
            LOW_PRIORITY</code></a> for supported nontransactional tables
            when you want to give <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statements higher priority than your inserts.
          </p></li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT
            HIGH_PRIORITY</code></a> for supported nontransactional
            tables to get retrievals that jump the queue. That is, the
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is executed even if
            there is another client waiting to do a write.
          </p><p>
            <code class="literal">LOW_PRIORITY</code> and
            <code class="literal">HIGH_PRIORITY</code> have an effect only for
            nontransactional storage engines that use only table-level
            locking.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimization-indexes"></a>8.3. Optimization and Indexes</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#mysql-indexes">8.3.1. How MySQL Uses Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-primary-keys">8.3.2. Using Primary Keys</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-foreign-keys">8.3.3. Using Foreign Keys</a></span></dt><dt><span class="section"><a href="optimization.html#column-indexes">8.3.4. Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-column-indexes">8.3.5. Multiple-Column Indexes</a></span></dt><dt><span class="section"><a href="optimization.html#verifying-index-usage">8.3.6. Verifying Index Usage</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-index-statistics">8.3.7. <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> Index Statistics
Collection</a></span></dt><dt><span class="section"><a href="optimization.html#index-btree-hash">8.3.8. Comparison of B-Tree and Hash Indexes</a></span></dt></dl>
</div>
<a class="indexterm" name="idp49318608"></a><p>
      The best way to improve the performance of
      <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> operations is to create
      indexes on one or more of the columns that are tested in the
      query. The index entries act like pointers to the table rows,
      allowing the query to quickly determine which rows match a
      condition in the <code class="literal">WHERE</code> clause, and retrieve the
      other column values for those rows. All MySQL data types can be
      indexed.
    </p><p>
      Although it can be tempting to create an indexes for every
      possible column used in a query, unnecessary indexes waste space
      and waste time for MySQL to determine which indexes to use. You
      must find the right balance to achieve fast queries using the
      optimal set of indexes.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-indexes"></a>8.3.1. How MySQL Uses Indexes</h3>
</div>
</div>
</div>
<a class="indexterm" name="idp49324112"></a><p>
        Indexes are used to find rows with specific column values
        quickly. Without an index, MySQL must begin with the first row
        and then read through the entire table to find the relevant
        rows. The larger the table, the more this costs. If the table
        has an index for the columns in question, MySQL can quickly
        determine the position to seek to in the middle of the data file
        without having to look at all the data. If a table has 1,000
        rows, this is at least 100 times faster than reading
        sequentially.
      </p><p>
        Most MySQL indexes (<code class="literal">PRIMARY KEY</code>,
        <code class="literal">UNIQUE</code>, <code class="literal">INDEX</code>, and
        <code class="literal">FULLTEXT</code>) are stored in
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a>. Exceptions are that
        indexes on spatial data types use R-trees, and that
        <code class="literal">MEMORY</code> tables also support
        <a class="link" href="glossary.html#glos_hash_index" title="hash index">hash indexes</a>.
      </p><p>
        In general, indexes are used as described in the following
        discussion. Characteristics specific to hash indexes (as used in
        <code class="literal">MEMORY</code> tables) are described at the end of
        this section.
      </p><p>
        MySQL uses indexes for these operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To find the rows matching a <code class="literal">WHERE</code> clause
            quickly.
          </p></li><li class="listitem"><p>
            To eliminate rows from consideration. If there is a choice
            between multiple indexes, MySQL normally uses the index that
            finds the smallest number of rows (the most
            <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selective</a> index).
          </p></li><li class="listitem"><p>
            To retrieve rows from other tables when performing joins.
            MySQL can use indexes on columns more efficiently if they
            are declared as the same type and size. In this context,
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> and
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> are considered the same
            if they are declared as the same size. For example,
            <code class="literal">VARCHAR(10)</code> and
            <code class="literal">CHAR(10)</code> are the same size, but
            <code class="literal">VARCHAR(10)</code> and
            <code class="literal">CHAR(15)</code> are not.
          </p><p>
            Comparison of dissimilar columns may prevent use of indexes
            if values cannot be compared directly without conversion.
            Suppose that a numeric column is compared to a string
            column. For a given value such as <code class="literal">1</code> in
            the numeric column, it might compare equal to any number of
            values in the string column such as <code class="literal">'1'</code>,
            <code class="literal">' 1'</code>, <code class="literal">'00001'</code>, or
            <code class="literal">'01.e1'</code>. This rules out use of any
            indexes for the string column.
          </p></li><li class="listitem"><p>
            To find the <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a> or
            <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a> value for a specific
            indexed column <em class="replaceable"><code>key_col</code></em>. This is
            optimized by a preprocessor that checks whether you are
            using <code class="literal">WHERE <em class="replaceable"><code>key_part_N</code></em> =
            <em class="replaceable"><code>constant</code></em></code> on all key
            parts that occur before <em class="replaceable"><code>key_col</code></em>
            in the index. In this case, MySQL does a single key lookup
            for each <a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a> or
            <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a> expression and replaces
            it with a constant. If all expressions are replaced with
            constants, the query returns at once. For example:
          </p><pre class="programlisting">SELECT MIN(<em class="replaceable"><code>key_part2</code></em>),MAX(<em class="replaceable"><code>key_part2</code></em>)
  FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_part1</code></em>=10;
</pre></li><li class="listitem"><p>
            To sort or group a table if the sorting or grouping is done
            on a leftmost prefix of a usable key (for example,
            <code class="literal">ORDER BY <em class="replaceable"><code>key_part1</code></em>,
            <em class="replaceable"><code>key_part2</code></em></code>). If all key
            parts are followed by <code class="literal">DESC</code>, the key is
            read in reverse order. See
            <a class="xref" href="optimization.html#order-by-optimization" title="8.2.1.15. ORDER BY Optimization">Section 8.2.1.15, “<code class="literal">ORDER BY</code> Optimization”</a>, and
            <a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16. GROUP BY Optimization">Section 8.2.1.16, “<code class="literal">GROUP BY</code> Optimization”</a>.
          </p></li><li class="listitem"><p>
            In some cases, a query can be optimized to retrieve values
            without consulting the data rows. (An index that provides
            all the necessary results for a query is called a
            <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering index</a>.)
            If a query uses only columns from a table that are numeric
            and that form a leftmost prefix for some key, the selected
            values can be retrieved from the index tree for greater
            speed:
          </p><pre class="programlisting">SELECT <em class="replaceable"><code>key_part3</code></em> FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em>=1
</pre></li></ul>
</div>
<p>
        Indexes are less important for queries on small tables, or big
        tables where report queries process most or all of the rows.
        When a query needs to access most of the rows, reading
        sequentially is faster than working through an index. Sequential
        reads minimize disk seeks, even if not all the rows are needed
        for the query. See <a class="xref" href="optimization.html#how-to-avoid-table-scan" title="8.2.1.20. How to Avoid Full Table Scans">Section 8.2.1.20, “How to Avoid Full Table Scans”</a> for
        details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-primary-keys"></a>8.3.2. Using Primary Keys</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49367712"></a><p>
        The primary key for a table represents the column or set of
        columns that you use in your most vital queries. It has an
        associated index, for fast query performance. Query performance
        benefits from the <code class="literal">NOT NULL</code> optimization,
        because it cannot include any <code class="literal">NULL</code> values.
        With the <code class="literal">InnoDB</code> storage engine, the table
        data is physically organized to do ultra-fast lookups and sorts
        based on the primary key column or columns.
      </p><p>
        If your table is big and important, but does not have an obvious
        column or set of columns to use as a primary key, you might
        create a separate column with auto-increment values to use as
        the primary key. These unique IDs can serve as pointers to
        corresponding rows in other tables when you join tables using
        foreign keys.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-foreign-keys"></a>8.3.3. Using Foreign Keys</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49374048"></a><p>
        If a table has many columns, and you query many different
        combinations of columns, it might be efficient to split the
        less-frequently used data into separate tables with a few
        columns each, and relate them back to the main table by
        duplicating the numeric ID column from the main table. That way,
        each small table can have a primary key for fast lookups of its
        data, and you can query just the set of columns that you need
        using a join operation. Depending on how the data is
        distributed, the queries might perform less I/O and take up less
        cache memory because the relevant columns are packed together on
        disk. (To maximize performance, queries try to read as few data
        blocks as possible from disk; tables with only a few columns can
        fit more rows in each data block.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="column-indexes"></a>8.3.4. Column Indexes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49377888"></a><a class="indexterm" name="idp49379376"></a><a class="indexterm" name="idp49380864"></a><p>
        The most common type of index involves a single column, storing
        copies of the values from that column in a data structure,
        allowing fast lookups for the rows with the corresponding column
        values. The B-tree data structure lets the index quickly find a
        specific value, a set of values, or a range of values,
        corresponding to operators such as <code class="literal">=</code>,
        <code class="literal">&gt;</code>, <code class="literal">≤</code>,
        <code class="literal">BETWEEN</code>, <code class="literal">IN</code>, and so on, in
        a <code class="literal">WHERE</code> clause.
      </p><p>
        The maximum number of indexes per table and the maximum index
        length is defined per storage engine. See
        <a class="xref" href="storage-engines.html" title="Chapter 14. Storage Engines">Chapter 14, <i>Storage Engines</i></a>. All storage engines support
        at least 16 indexes per table and a total index length of at
        least 256 bytes. Most storage engines have higher limits.
</p><a class="indexterm" name="idp49388176"></a><a class="indexterm" name="idp49389664"></a><a class="indexterm" name="idp49391152"></a><a class="indexterm" name="idp49392640"></a>
<h4><a name="idp49394128"></a>
        Prefix Indexes
</h4>
<p>
        With
        <code class="literal"><em class="replaceable"><code>col_name</code></em>(<em class="replaceable"><code>N</code></em>)</code>
        syntax in an index specification, you can create an index that
        uses only the first <em class="replaceable"><code>N</code></em> characters of a
        string column. Indexing only a prefix of column values in this
        way can make the index file much smaller. When you index a
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> column, you
        <span class="emphasis"><em>must</em></span> specify a prefix length for the index.
        For example:
      </p><pre class="programlisting">CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));</pre><p>
        Prefixes can be up to 1000 bytes long (767 bytes for
        <code class="literal">InnoDB</code> tables, unless you have
        <a class="link" href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> set).
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          Prefix limits are measured in bytes, while the prefix length
          in <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements is
          interpreted as number of characters. <span class="emphasis"><em>Take this into
          account when specifying a prefix length for a column that uses
          a multi-byte character set</em></span>.
</p>
</div>
<h4><a name="idp49404272"></a>
        FULLTEXT Indexes
</h4>
<p>
        You can also create <code class="literal">FULLTEXT</code> indexes. These
        are used for full-text searches. Only the
        <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> and
        <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> storage engines support
        <code class="literal">FULLTEXT</code> indexes and only for
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
        <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns. Indexing always
        takes place over the entire column and column prefix indexing is
        not supported. For details, see
        <a class="xref" href="functions.html#fulltext-search" title="12.9. Full-Text Search Functions">Section 12.9, “Full-Text Search Functions”</a>.
      </p><p>
        Optimizations are applied to certain kinds of
        <code class="literal">FULLTEXT</code> queries against single
        <code class="literal">InnoDB</code> tables. Queries with these
        characteristics are particularly efficient:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FULLTEXT</code> queries that only return the
            document ID, or the document ID and the search rank.
          </p></li><li class="listitem"><p>
            <code class="literal">FULLTEXT</code> queries that sort the matching
            rows in descending order of score and apply a
            <code class="literal">LIMIT</code> clause to take the top N matching
            rows. For this optimization to apply, there must be no
            <code class="literal">WHERE</code> clauses and only a single
            <code class="literal">ORDER BY</code> clause in descending order.
          </p></li><li class="listitem"><p>
            <code class="literal">FULLTEXT</code> queries that retrieve only the
            <code class="literal">COUNT(*)</code> value of rows matching a search
            term, with no additional <code class="literal">WHERE</code> clauses.
            Code the <code class="literal">WHERE</code> clause as <code class="literal">WHERE
            MATCH(<em class="replaceable"><code>text</code></em>) AGAINST
            ('<em class="replaceable"><code>other_text</code></em>')</code>, without
            any <code class="literal">&gt; 0</code> comparison operator.
</p></li></ul>
</div>
<h4><a name="idp49425520"></a>
        Spatial Indexes
</h4>
<p>
        You can also create indexes on spatial data types. Currently,
        only <code class="literal">MyISAM</code> supports R-tree indexes on
        spatial types. Other storage engines use B-trees for indexing
        spatial types (except for <code class="literal">ARCHIVE</code>, which does
        not support spatial type indexing).
</p>
<h4><a name="idp49428032"></a>
        Indexes in the MEMORY Storage Engine
</h4>
<p>
        The <code class="literal">MEMORY</code> storage engine uses
        <code class="literal">HASH</code> indexes by default, but also supports
        <code class="literal">BTREE</code> indexes.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="multiple-column-indexes"></a>8.3.5. Multiple-Column Indexes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49432176"></a><a class="indexterm" name="idp49433248"></a><a class="indexterm" name="idp49434736"></a><p>
        MySQL can create composite indexes (that is, indexes on multiple
        columns). An index may consist of up to 16 columns. For certain
        data types, you can index a prefix of the column (see
        <a class="xref" href="optimization.html#column-indexes" title="8.3.4. Column Indexes">Section 8.3.4, “Column Indexes”</a>).
      </p><p>
        MySQL can use multiple-column indexes for queries that test all
        the columns in the index, or queries that test just the first
        column, the first two columns, the first three columns, and so
        on. If you specify the columns in the right order in the index
        definition, a single composite index can speed up several kinds
        of queries on the same table.
      </p><p>
        A multiple-column index can be considered a sorted array, the
        rows of which contain values that are created by concatenating
        the values of the indexed columns.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          As an alternative to a composite index, you can introduce a
          column that is <span class="quote">“<span class="quote">hashed</span>”</span> based on information from
          other columns. If this column is short, reasonably unique, and
          indexed, it might be faster than a <span class="quote">“<span class="quote">wide</span>”</span> index
          on many columns. In MySQL, it is very easy to use this extra
          column:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>hash_col</code></em>=MD5(CONCAT(<em class="replaceable"><code>val1</code></em>,<em class="replaceable"><code>val2</code></em>))
  AND <em class="replaceable"><code>col1</code></em>=<em class="replaceable"><code>val1</code></em> AND <em class="replaceable"><code>col2</code></em>=<em class="replaceable"><code>val2</code></em>;
</pre>
</div>
<p>
        Suppose that a table has the following specification:
      </p><pre class="programlisting">CREATE TABLE test (
    id         INT NOT NULL,
    last_name  CHAR(30) NOT NULL,
    first_name CHAR(30) NOT NULL,
    PRIMARY KEY (id),
    INDEX name (last_name,first_name)
);</pre><p>
        The <code class="literal">name</code> index is an index over the
        <code class="literal">last_name</code> and <code class="literal">first_name</code>
        columns. The index can be used for lookups in queries that
        specify values in a known range for combinations of
        <code class="literal">last_name</code> and <code class="literal">first_name</code>
        values. It can also be used for queries that specify just a
        <code class="literal">last_name</code> value because that column is a
        leftmost prefix of the index (as described later in this
        section). Therefore, the <code class="literal">name</code> index is used
        for lookups in the following queries:
      </p><pre class="programlisting">SELECT * FROM test WHERE last_name='Widenius';

SELECT * FROM test
  WHERE last_name='Widenius' AND first_name='Michael';

SELECT * FROM test
  WHERE last_name='Widenius'
  AND (first_name='Michael' OR first_name='Monty');

SELECT * FROM test
  WHERE last_name='Widenius'
  AND first_name &gt;='M' AND first_name &lt; 'N';</pre><p>
        However, the <code class="literal">name</code> index is
        <span class="emphasis"><em>not</em></span> used for lookups in the following
        queries:
      </p><pre class="programlisting">SELECT * FROM test WHERE first_name='Michael';

SELECT * FROM test
  WHERE last_name='Widenius' OR first_name='Michael';</pre><p>
        Suppose that you issue the following
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col1=<em class="replaceable"><code>val1</code></em> AND col2=<em class="replaceable"><code>val2</code></em>;</code></strong>
</pre><p>
        If a multiple-column index exists on <code class="literal">col1</code> and
        <code class="literal">col2</code>, the appropriate rows can be fetched
        directly. If separate single-column indexes exist on
        <code class="literal">col1</code> and <code class="literal">col2</code>, the
        optimizer attempts to use the Index Merge optimization (see
        <a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">Section 8.2.1.4, “Index Merge Optimization”</a>), or attempts to find
        the most restrictive index by deciding which index excludes more
        rows and using that index to fetch the rows.
      </p><a class="indexterm" name="idp49463920"></a><a class="indexterm" name="idp49465408"></a><p>
        If the table has a multiple-column index, any leftmost prefix of
        the index can be used by the optimizer to find rows. For
        example, if you have a three-column index on <code class="literal">(col1,
        col2, col3)</code>, you have indexed search capabilities on
        <code class="literal">(col1)</code>, <code class="literal">(col1, col2)</code>, and
        <code class="literal">(col1, col2, col3)</code>.
      </p><p>
        MySQL cannot use the index to perform lookups if the columns do
        not form a leftmost prefix of the index. Suppose that you have
        the <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements shown here:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col1=<em class="replaceable"><code>val1</code></em>;
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col1=<em class="replaceable"><code>val1</code></em> AND col2=<em class="replaceable"><code>val2</code></em>;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col2=<em class="replaceable"><code>val2</code></em>;
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE col2=<em class="replaceable"><code>val2</code></em> AND col3=<em class="replaceable"><code>val3</code></em>;
</pre><p>
        If an index exists on <code class="literal">(col1, col2, col3)</code>,
        only the first two queries use the index. The third and fourth
        queries do involve indexed columns, but
        <code class="literal">(col2)</code> and <code class="literal">(col2, col3)</code>
        are not leftmost prefixes of <code class="literal">(col1, col2,
        col3)</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="verifying-index-usage"></a>8.3.6. Verifying Index Usage</h3>

</div>

</div>

</div>
<p>
        Always check whether all your queries really use the indexes
        that you have created in the tables. Use the
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement, as described
        in <a class="xref" href="optimization.html#using-explain" title="8.8.1. Optimizing Queries with EXPLAIN">Section 8.8.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-index-statistics"></a>8.3.7. <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> Index Statistics
Collection</h3>
</div>
</div>
</div>
<p>
        Storage engines collect statistics about tables for use by the
        optimizer. Table statistics are based on value groups, where a
        value group is a set of rows with the same key prefix value. For
        optimizer purposes, an important statistic is the average value
        group size.
      </p><p>
        MySQL uses the average value group size in the following ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To estimate how may rows must be read for each
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> access
          </p></li><li class="listitem"><p>
            To estimate how many row a partial join will produce; that
            is, the number of rows that an operation of this form will
            produce:
          </p><pre class="programlisting">(...) JOIN <em class="replaceable"><code>tbl_name</code></em> ON <em class="replaceable"><code>tbl_name</code></em>.<em class="replaceable"><code>key</code></em> = <em class="replaceable"><code>expr</code></em>
</pre></li></ul>
</div>
<p>
        As the average value group size for an index increases, the
        index is less useful for those two purposes because the average
        number of rows per lookup increases: For the index to be good
        for optimization purposes, it is best that each index value
        target a small number of rows in the table. When a given index
        value yields a large number of rows, the index is less useful
        and MySQL is less likely to use it.
      </p><p>
        The average value group size is related to table cardinality,
        which is the number of value groups. The
        <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> statement displays a
        cardinality value based on <em class="replaceable"><code>N/S</code></em>, where
        <em class="replaceable"><code>N</code></em> is the number of rows in the table
        and <em class="replaceable"><code>S</code></em> is the average value group
        size. That ratio yields an approximate number of value groups in
        the table.
      </p><p>
        For a join based on the <code class="literal">&lt;=&gt;</code> comparison
        operator, <code class="literal">NULL</code> is not treated differently
        from any other value: <code class="literal">NULL &lt;=&gt; NULL</code>,
        just as <code class="literal"><em class="replaceable"><code>N</code></em> &lt;=&gt;
        <em class="replaceable"><code>N</code></em></code> for any other
        <em class="replaceable"><code>N</code></em>.
      </p><p>
        However, for a join based on the <code class="literal">=</code> operator,
        <code class="literal">NULL</code> is different from
        non-<code class="literal">NULL</code> values:
        <code class="literal"><em class="replaceable"><code>expr1</code></em> =
        <em class="replaceable"><code>expr2</code></em></code> is not true when
        <em class="replaceable"><code>expr1</code></em> or
        <em class="replaceable"><code>expr2</code></em> (or both) are
        <code class="literal">NULL</code>. This affects
        <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> accesses for comparisons
        of the form <code class="literal"><em class="replaceable"><code>tbl_name.key</code></em> =
        <em class="replaceable"><code>expr</code></em></code>: MySQL will not access
        the table if the current value of
        <em class="replaceable"><code>expr</code></em> is <code class="literal">NULL</code>,
        because the comparison cannot be true.
      </p><p>
        For <code class="literal">=</code> comparisons, it does not matter how
        many <code class="literal">NULL</code> values are in the table. For
        optimization purposes, the relevant value is the average size of
        the non-<code class="literal">NULL</code> value groups. However, MySQL
        does not currently enable that average size to be collected or
        used.
      </p><p>
        For <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code>
        tables, you have some control over collection of table
        statistics by means of the
        <a class="link" href="storage-engines.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a> and
        <a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> system
        variables, respectively. These variables have three possible
        values, which differ as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When the variable is set to <code class="literal">nulls_equal</code>,
            all <code class="literal">NULL</code> values are treated as identical
            (that is, they all form a single value group).
          </p><p>
            If the <code class="literal">NULL</code> value group size is much
            higher than the average non-<code class="literal">NULL</code> value
            group size, this method skews the average value group size
            upward. This makes index appear to the optimizer to be less
            useful than it really is for joins that look for
            non-<code class="literal">NULL</code> values. Consequently, the
            <code class="literal">nulls_equal</code> method may cause the
            optimizer not to use the index for
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> accesses when it
            should.
          </p></li><li class="listitem"><p>
            When the variable is set to
            <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
            values are not considered the same. Instead, each
            <code class="literal">NULL</code> value forms a separate value group
            of size 1.
          </p><p>
            If you have many <code class="literal">NULL</code> values, this method
            skews the average value group size downward. If the average
            non-<code class="literal">NULL</code> value group size is large,
            counting <code class="literal">NULL</code> values each as a group of
            size 1 causes the optimizer to overestimate the value of the
            index for joins that look for non-<code class="literal">NULL</code>
            values. Consequently, the <code class="literal">nulls_unequal</code>
            method may cause the optimizer to use this index for
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> lookups when other
            methods may be better.
          </p></li><li class="listitem"><p>
            When the variable is set to
            <code class="literal">nulls_ignored</code>, <code class="literal">NULL</code>
            values are ignored.
</p></li></ul>
</div>
<p>
        If you tend to use many joins that use
        <code class="literal">&lt;=&gt;</code> rather than <code class="literal">=</code>,
        <code class="literal">NULL</code> values are not special in comparisons
        and one <code class="literal">NULL</code> is equal to another. In this
        case, <code class="literal">nulls_equal</code> is the appropriate
        statistics method.
      </p><p>
        The <a class="link" href="storage-engines.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a> system
        variable has a global value; the
        <a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> system
        variable has both global and session values. Setting the global
        value affects statistics collection for tables from the
        corresponding storage engine. Setting the session value affects
        statistics collection only for the current client connection.
        This means that you can force a table's statistics to be
        regenerated with a given method without affecting other clients
        by setting the session value of
        <a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>.
      </p><p>
        To regenerate table statistics, you can use any of the following
        methods:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Execute <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            --stats_method=<em class="replaceable"><code>method_name</code></em>
            --analyze</strong></span></a>
          </p></li><li class="listitem"><p>
            Change the table to cause its statistics to go out of date
            (for example, insert a row and then delete it), and then set
            <a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> and
            issue an <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
            statement
</p></li></ul>
</div>
<p>
        Some caveats regarding the use of
        <a class="link" href="storage-engines.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a> and
        <a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            You can force table statistics to be collected explicitly,
            as just described. However, MySQL may also collect
            statistics automatically. For example, if during the course
            of executing statements for a table, some of those
            statements modify the table, MySQL may collect statistics.
            (This may occur for bulk inserts or deletes, or some
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, for
            example.) If this happens, the statistics are collected
            using whatever value
            <a class="link" href="storage-engines.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a> or
            <a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a> has at
            the time. Thus, if you collect statistics using one method,
            but the system variable is set to the other method when a
            table's statistics are collected automatically later, the
            other method will be used.
          </p></li><li class="listitem"><p>
            There is no way to tell which method was used to generate
            statistics for a given table.
          </p></li><li class="listitem"><p>
            These variables apply only to <code class="literal">InnoDB</code> and
            <code class="literal">MyISAM</code> tables. Other storage engines have
            only one method for collecting table statistics. Usually it
            is closer to the <code class="literal">nulls_equal</code> method.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-btree-hash"></a>8.3.8. Comparison of B-Tree and Hash Indexes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49558368"></a><a class="indexterm" name="idp49559440"></a><p>
        Understanding the B-tree and hash data structures can help
        predict how different queries perform on different storage
        engines that use these data structures in their indexes,
        particularly for the <code class="literal">MEMORY</code> storage engine
        that lets you choose B-tree or hash indexes.
</p>
<h4><a name="idp49561920"></a>
        B-Tree Index Characteristics
</h4>
<a class="indexterm" name="idp49562368"></a><a class="indexterm" name="idp49563856"></a><a class="indexterm" name="idp49565344"></a><a class="indexterm" name="idp49566832"></a><p>
        A B-tree index can be used for column comparisons in expressions
        that use the <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
        <a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
        <a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
        <a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
        <a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
        or <a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a> operators. The index
        also can be used for <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
        comparisons if the argument to <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
        is a constant string that does not start with a wildcard
        character. For example, the following
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements use indexes:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE 'Patrick%';
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE 'Pat%_ck%';
</pre><p>
        In the first statement, only rows with <code class="literal">'Patrick' &lt;=
        <em class="replaceable"><code>key_col</code></em> &lt; 'Patricl'</code> are
        considered. In the second statement, only rows with
        <code class="literal">'Pat' &lt;= <em class="replaceable"><code>key_col</code></em> &lt;
        'Pau'</code> are considered.
      </p><p>
        The following <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements
        do not use indexes:
      </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE '%Patrick%';
SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>key_col</code></em> LIKE <em class="replaceable"><code>other_col</code></em>;
</pre><p>
        In the first statement, the <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
        value begins with a wildcard character. In the second statement,
        the <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> value is not a constant.
      </p><p>
        If you use <code class="literal">... LIKE
        '%<em class="replaceable"><code>string</code></em>%'</code> and
        <em class="replaceable"><code>string</code></em> is longer than three
        characters, MySQL uses the <em class="firstterm">Turbo Boyer-Moore
        algorithm</em> to initialize the pattern for the string
        and then uses this pattern to perform the search more quickly.
      </p><a class="indexterm" name="idp49591040"></a><a class="indexterm" name="idp49592528"></a><p>
        A search using <code class="literal"><em class="replaceable"><code>col_name</code></em> IS
        NULL</code> employs indexes if
        <em class="replaceable"><code>col_name</code></em> is indexed.
      </p><p>
        Any index that does not span all
        <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a> levels in the
        <code class="literal">WHERE</code> clause is not used to optimize the
        query. In other words, to be able to use an index, a prefix of
        the index must be used in every <a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
        group.
      </p><p>
        The following <code class="literal">WHERE</code> clauses use indexes:
      </p><pre class="programlisting">... WHERE <em class="replaceable"><code>index_part1</code></em>=1 AND <em class="replaceable"><code>index_part2</code></em>=2 AND <em class="replaceable"><code>other_column</code></em>=3
    /* <em class="replaceable"><code>index</code></em> = 1 OR <em class="replaceable"><code>index</code></em> = 2 */
... WHERE <em class="replaceable"><code>index</code></em>=1 OR A=10 AND <em class="replaceable"><code>index</code></em>=2
    /* optimized like "<em class="replaceable"><code>index_part1</code></em>='hello'" */
... WHERE <em class="replaceable"><code>index_part1</code></em>='hello' AND <em class="replaceable"><code>index_part3</code></em>=5
    /* Can use index on <em class="replaceable"><code>index1</code></em> but not on <em class="replaceable"><code>index2</code></em> or <em class="replaceable"><code>index3</code></em> */
... WHERE <em class="replaceable"><code>index1</code></em>=1 AND <em class="replaceable"><code>index2</code></em>=2 OR <em class="replaceable"><code>index1</code></em>=3 AND <em class="replaceable"><code>index3</code></em>=3;
</pre><p>
        These <code class="literal">WHERE</code> clauses do
        <span class="emphasis"><em>not</em></span> use indexes:
      </p><pre class="programlisting">    /* <em class="replaceable"><code>index_part1</code></em> is not used */
... WHERE <em class="replaceable"><code>index_part2</code></em>=1 AND <em class="replaceable"><code>index_part3</code></em>=2

    /*  Index is not used in both parts of the WHERE clause  */
... WHERE <em class="replaceable"><code>index</code></em>=1 OR A=10

    /* No index spans all rows  */
... WHERE <em class="replaceable"><code>index_part1</code></em>=1 OR <em class="replaceable"><code>index_part2</code></em>=10
</pre><p>
        Sometimes MySQL does not use an index, even if one is available.
        One circumstance under which this occurs is when the optimizer
        estimates that using the index would require MySQL to access a
        very large percentage of the rows in the table. (In this case, a
        table scan is likely to be much faster because it requires fewer
        seeks.) However, if such a query uses <code class="literal">LIMIT</code>
        to retrieve only some of the rows, MySQL uses an index anyway,
        because it can much more quickly find the few rows to return in
        the result.
</p>
<h4><a name="idp49615088"></a>
        Hash Index Characteristics
</h4>
<a class="indexterm" name="idp49615536"></a><p>
        Hash indexes have somewhat different characteristics from those
        just discussed:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            They are used only for equality comparisons that use the
            <code class="literal">=</code> or <code class="literal">&lt;=&gt;</code>
            operators (but are <span class="emphasis"><em>very</em></span> fast). They are
            not used for comparison operators such as
            <code class="literal">&lt;</code> that find a range of values. Systems
            that rely on this type of single-value lookup are known as
            <span class="quote">“<span class="quote">key-value stores</span>”</span>; to use MySQL for such
            applications, use hash indexes wherever possible.
          </p></li><li class="listitem"><p>
            The optimizer cannot use a hash index to speed up
            <code class="literal">ORDER BY</code> operations. (This type of index
            cannot be used to search for the next entry in order.)
          </p></li><li class="listitem"><p>
            MySQL cannot determine approximately how many rows there are
            between two values (this is used by the range optimizer to
            decide which index to use). This may affect some queries if
            you change a <code class="literal">MyISAM</code> table to a
            hash-indexed <code class="literal">MEMORY</code> table.
          </p></li><li class="listitem"><p>
            Only whole keys can be used to search for a row. (With a
            B-tree index, any leftmost prefix of the key can be used to
            find rows.)
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-database-structure"></a>8.4. Optimizing Database Structure</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#data-size">8.4.1. Optimizing Data Size</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-data-types">8.4.2. Optimizing MySQL Data Types</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-multi-tables">8.4.3. Optimizing for Many Tables</a></span></dt></dl>
</div>
<p>
      In your role as a database designer, look for the most efficient
      way to organize your schemas, tables, and columns. As when tuning
      application code, you minimize I/O, keep related items together,
      and plan ahead so that performance stays high as the data volume
      increases. Starting with an efficient database design makes it
      easier for team members to write high-performing application code,
      and makes the database likely to endure as applications evolve and
      are rewritten.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="data-size"></a>8.4.1. Optimizing Data Size</h3>
</div>
</div>
</div>
<a class="indexterm" name="idp49629872"></a><a class="indexterm" name="idp49631360"></a><a class="indexterm" name="idp49632848"></a><a class="indexterm" name="idp49634336"></a><a class="indexterm" name="idp49635824"></a><p>
        Design your tables to minimize their space on the disk. This can
        result in huge improvements by reducing the amount of data
        written to and read from disk. Smaller tables normally require
        less main memory while their contents are being actively
        processed during query execution. Any space reduction for table
        data also results in smaller indexes that can be processed
        faster.
      </p><p>
        MySQL supports many different storage engines (table types) and
        row formats. For each table, you can decide which storage and
        indexing method to use. Choosing the proper table format for
        your application can give you a big performance gain. See
        <a class="xref" href="storage-engines.html" title="Chapter 14. Storage Engines">Chapter 14, <i>Storage Engines</i></a>.
      </p><p>
        You can get better performance for a table and minimize storage
        space by using the techniques listed here:
</p>
<h4><a name="idp49639920"></a>
        Table Columns
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Use the most efficient (smallest) data types possible. MySQL
            has many specialized types that save disk space and memory.
            For example, use the smaller integer types if possible to
            get smaller tables. <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">MEDIUMINT</code></a>
            is often a better choice than
            <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INT</code></a> because a
            <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">MEDIUMINT</code></a> column uses 25%
            less space.
          </p></li><li class="listitem"><p>
            Declare columns to be <code class="literal">NOT NULL</code> if
            possible. It makes SQL operations faster, by enabling better
            use of indexes and eliminating overhead for testing whether
            each value is <code class="literal">NULL</code>. You also save some
            storage space, one bit per column. If you really need
            <code class="literal">NULL</code> values in your tables, use them.
            Just avoid the default setting that allows
            <code class="literal">NULL</code> values in every column.
</p></li></ul>
</div>
<h4><a name="idp49648384"></a>
        Row Format
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">InnoDB</code> tables use a compact storage
            format. In versions of MySQL earlier than 5.0.3,
            <code class="literal">InnoDB</code> rows contain some redundant
            information, such as the number of columns and the length of
            each column, even for fixed-size columns. By default, tables
            are created in the compact format
            (<code class="literal">ROW_FORMAT=COMPACT</code>). If you wish to
            downgrade to older versions of MySQL, you can request the
            old format with <code class="literal">ROW_FORMAT=REDUNDANT</code>.
          </p><p>
            The presence of the compact row format decreases row storage
            space by about 20% at the cost of increasing CPU use for
            some operations. If your workload is a typical one that is
            limited by cache hit rates and disk speed it is likely to be
            faster. If it is a rare case that is limited by CPU speed,
            it might be slower.
          </p><p>
            The compact <code class="literal">InnoDB</code> format also changes
            how <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> columns containing
            UTF-8 data are stored. With
            <code class="literal">ROW_FORMAT=REDUNDANT</code>, a UTF-8
            <code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code>
            occupies 3 × <em class="replaceable"><code>N</code></em> bytes, given
            that the maximum length of a UTF-8 encoded character is
            three bytes. Many languages can be written primarily using
            single-byte UTF-8 characters, so a fixed storage length
            often wastes space. With
            <code class="literal">ROW_FORMAT=COMPACT</code> format,
            <code class="literal">InnoDB</code> allocates a variable amount of
            storage in the range from <em class="replaceable"><code>N</code></em> to 3
            × <em class="replaceable"><code>N</code></em> bytes for these columns
            by stripping trailing spaces if necessary. The minimum
            storage length is kept as <em class="replaceable"><code>N</code></em> bytes
            to facilitate in-place updates in typical cases.
          </p></li><li class="listitem"><p>
            To minimize space even further by storing table data in
            compressed form, specify
            <code class="literal">ROW_FORMAT=COMPRESSED</code> when creating
            <code class="literal">InnoDB</code> tables, or run the
            <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> command on an existing
            <code class="literal">MyISAM</code> table. (<code class="literal">InnoDB</code>
            tables compressed tables are readable and writable, while
            <code class="literal">MyISAM</code> compressed tables are read-only.)
          </p></li><li class="listitem"><p>
            For <code class="literal">MyISAM</code> tables, if you do not have any
            variable-length columns
            (<a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
            <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns), a fixed-size
            row format is used. This is faster but may waste some space.
            See <a class="xref" href="storage-engines.html#myisam-table-formats" title="14.3.3. MyISAM Table Storage Formats">Section 14.3.3, “<code class="literal">MyISAM</code> Table Storage Formats”</a>. You can hint
            that you want to have fixed length rows even if you have
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns with the
            <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> option
            <code class="literal">ROW_FORMAT=FIXED</code>.
</p></li></ul>
</div>
<h4><a name="idp49674384"></a>
        Indexes
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The primary index of a table should be as short as possible.
            This makes identification of each row easy and efficient.
            For <code class="literal">InnoDB</code> tables, the primary key
            columns are duplicated in each secondary index entry, so a
            short primary key saves considerable space if you have many
            secondary indexes.
          </p></li><li class="listitem"><p>
            Create only the indexes that you need to improve query
            performance. Indexes are good for retrieval, but slow down
            insert and update operations. If you access a table mostly
            by searching on a combination of columns, create a single
            composite index on them rather than a separate index for
            each column. The first part of the index should be the
            column most used. If you <span class="emphasis"><em>always</em></span> use
            many columns when selecting from the table, the first column
            in the index should be the one with the most duplicates, to
            obtain better compression of the index.
          </p></li><li class="listitem"><p>
            If it is very likely that a long string column has a unique
            prefix on the first number of characters, it is better to
            index only this prefix, using MySQL's support for creating
            an index on the leftmost part of the column (see
            <a class="xref" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax">Section 13.1.13, “<code class="literal">CREATE INDEX</code> Syntax”</a>). Shorter indexes are faster,
            not only because they require less disk space, but because
            they also give you more hits in the index cache, and thus
            fewer disk seeks. See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
</p></li></ul>
</div>
<h4><a name="idp49681296"></a>
        Joins
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In some circumstances, it can be beneficial to split into
            two a table that is scanned very often. This is especially
            true if it is a dynamic-format table and it is possible to
            use a smaller static format table that can be used to find
            the relevant rows when scanning the table.
          </p></li><li class="listitem"><p>
            Declare columns with identical information in different
            tables with identical data types, to speed up joins based on
            the corresponding columns.
          </p></li><li class="listitem"><p>
            Keep column names simple, so that you can use the same name
            across different tables and simplify join queries. For
            example, in a table named <code class="literal">customer</code>, use a
            column name of <code class="literal">name</code> instead of
            <code class="literal">customer_name</code>. To make your names
            portable to other SQL servers, consider keeping them shorter
            than 18 characters.
</p></li></ul>
</div>
<h4><a name="idp49687488"></a>
        Normalization
</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Normally, try to keep all data nonredundant (observing what
            is referred to in database theory as <em class="firstterm">third normal
            form</em>). Instead of repeating lengthy values such
            as names and addresses, assign them unique IDs, repeat these
            IDs as needed across multiple smaller tables, and join the
            tables in queries by referencing the IDs in the join clause.
          </p></li><li class="listitem"><p>
            If speed is more important than disk space and the
            maintenance costs of keeping multiple copies of data, for
            example in a business intelligence scenario where you
            analyze all the data from large tables, you can relax the
            normalization rules, duplicating information or creating
            summary tables to gain more speed.
</p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimize-data-types"></a>8.4.2. Optimizing MySQL Data Types</h3>

</div>

</div>

</div>

<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#optimize-numeric">8.4.2.1. Optimizing for Numeric Data</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-character">8.4.2.2. Optimizing for Character and String Types</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-blob">8.4.2.3. Optimizing for BLOB Types</a></span></dt><dt><span class="section"><a href="optimization.html#procedure-analyse">8.4.2.4. Using <code class="literal">PROCEDURE ANALYSE</code></a></span></dt></dl>
</div>
<p></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="optimize-numeric"></a>8.4.2.1. Optimizing for Numeric Data</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp49693424"></a><p></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              For unique IDs or other values that can be represented as
              either strings or numbers, prefer numeric columns to
              string columns. Since large numeric values can be stored
              in fewer bytes than the corresponding strings, it is
              faster and takes less memory to transfer and compare them.
            </p></li><li class="listitem"><p>
              If you are using numeric data, it is faster in many cases
              to access information from a database (using a live
              connection) than to access a text file. Information in the
              database is likely to be stored in a more compact format
              than in the text file, so accessing it involves fewer disk
              accesses. You also save code in your application because
              you can avoid parsing the text file to find line and
              column boundaries.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="optimize-character"></a>8.4.2.2. Optimizing for Character and String Types</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp49699136"></a><p>
          For character and string columns, follow these guidelines:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Use binary collation order for fast comparison and sort
              operations, when you do not need language-specific
              collation features. You can use the
              <a class="link" href="globalization.html#charset-binary-op" title="10.1.7.7. The BINARY Operator">BINARY</a> operator
              to use binary collation within a particular query.
            </p></li><li class="listitem"><p>
              When comparing values from different columns, declare
              those columns with the same character set and collation
              wherever possible, to avoid string conversions while
              running the query.
            </p></li><li class="listitem"><p>
              For column values less than 8KB in size, use binary
              <code class="literal">VARCHAR</code> instead of
              <code class="literal">BLOB</code>. The <code class="literal">GROUP BY</code>
              and <code class="literal">ORDER BY</code> clauses can generate
              temporary tables, and these temporary tables can use the
              <code class="literal">MEMORY</code> storage engine if the original
              table does not contain any <code class="literal">BLOB</code>
              columns.
            </p></li><li class="listitem"><p>
              If a table contains string columns such as name and
              address, but many queries do not retrieve those columns,
              consider splitting the string columns into a separate
              table and using join queries with a foreign key when
              necessary. When MySQL retrieves any value from a row, it
              reads a data block containing all the columns of that row
              (and possibly other adjacent rows). Keeping each row
              small, with only the most frequently used columns, allows
              more rows to fit in each data block. Such compact tables
              reduce disk I/O and memory usage for common queries.
            </p></li><li class="listitem"><p>
              When you use a randomly generated value as a primary key
              in an <code class="literal">InnoDB</code> table, prefix it with an
              ascending value such as the current date and time if
              possible. When consecutive primary values are physically
              stored near each other, <code class="literal">InnoDB</code> can
              insert and retrieve them faster.
            </p></li><li class="listitem"><p>
              See <a class="xref" href="optimization.html#optimize-numeric" title="8.4.2.1. Optimizing for Numeric Data">Section 8.4.2.1, “Optimizing for Numeric Data”</a> for reasons why a
              numeric column is usually preferable to an equivalent
              string column.
</p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="optimize-blob"></a>8.4.2.3. Optimizing for BLOB Types</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp49716304"></a><p></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              When storing a large blob containing textual data,
              consider compressing it first. Do not use this technique
              when the entire table is compressed by
              <code class="literal">InnoDB</code> or <code class="literal">MyISAM</code>.
            </p></li><li class="listitem"><p>
              For a table with several columns, to reduce memory
              requirements for queries that do not use the BLOB column,
              consider splitting the BLOB column into a separate table
              and referencing it with a join query when needed.
            </p></li><li class="listitem"><p>
              Since the performance requirements to retrieve and display
              a BLOB value might be very different from other data
              types, you could put the BLOB-specific table on a
              different storage device or even a separate database
              instance. For example, to retrieve a BLOB might require a
              large sequential disk read that is better suited to a
              traditional hard drive than to an
              <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD device</a>.
            </p></li><li class="listitem"><p>
              See <a class="xref" href="optimization.html#optimize-character" title="8.4.2.2. Optimizing for Character and String Types">Section 8.4.2.2, “Optimizing for Character and String Types”</a> for reasons why a
              binary <code class="literal">VARCHAR</code> column is sometimes
              preferable to an equivalent BLOB column.
            </p></li><li class="listitem"><p>
              Rather than testing for equality against a very long text
              string, you can store a hash of the column value in a
              separate column, index that column, and test the hashed
              value in queries. (Use the <code class="literal">MD5()</code> or
              <code class="literal">CRC32()</code> function to produce the hash
              value.) Since hash functions can produce duplicate results
              for different inputs, you still include a clause
              <code class="literal">AND <em class="replaceable"><code>blob_column</code></em> =
              <em class="replaceable"><code>long_string_value</code></em></code> in
              the query to guard against false matches; the performance
              benefit comes from the smaller, easily scanned index for
              the hashed values.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="procedure-analyse"></a>8.4.2.4. Using <code class="literal">PROCEDURE ANALYSE</code></h4>

</div>

</div>

</div>
<p>
          <code class="literal">ANALYSE([<em class="replaceable"><code>max_elements</code></em>[,<em class="replaceable"><code>max_memory</code></em>]])</code>
        </p><a class="indexterm" name="idp49737808"></a><a class="indexterm" name="idp49738880"></a><p>
          <code class="literal">ANALYSE()</code> examines the result from a query
          and returns an analysis of the results that suggests optimal
          data types for each column that may help reduce table sizes.
          To obtain this analysis, append <code class="literal">PROCEDURE
          ANALYSE</code> to the end of a
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement:
        </p><pre class="programlisting">SELECT ... FROM ... WHERE ... PROCEDURE ANALYSE([<em class="replaceable"><code>max_elements</code></em>,[<em class="replaceable"><code>max_memory</code></em>]])
</pre><p>
          For example:
        </p><pre class="programlisting">SELECT col1, col2 FROM table1 PROCEDURE ANALYSE(10, 2000);</pre><p>
          The results show some statistics for the values returned by
          the query, and propose an optimal data type for the columns.
          This can be helpful for checking your existing tables, or
          after importing new data. You may need to try different
          settings for the arguments so that <code class="literal">PROCEDURE
          ANALYSE()</code> does not suggest the
          <a class="link" href="data-types.html#enum" title="11.4.4. The ENUM Type"><code class="literal">ENUM</code></a> data type when it is not
          appropriate.
        </p><p>
          The arguments are optional and are used as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>max_elements</code></em> (default 256) is
              the maximum number of distinct values that
              <code class="literal">ANALYSE()</code> notices per column. This is
              used by <code class="literal">ANALYSE()</code> to check whether the
              optimal data type should be of type
              <a class="link" href="data-types.html#enum" title="11.4.4. The ENUM Type"><code class="literal">ENUM</code></a>; if there are more
              than <em class="replaceable"><code>max_elements</code></em> distinct
              values, then <a class="link" href="data-types.html#enum" title="11.4.4. The ENUM Type"><code class="literal">ENUM</code></a> is not a
              suggested type.
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>max_memory</code></em> (default 8192) is
              the maximum amount of memory that
              <code class="literal">ANALYSE()</code> should allocate per column
              while trying to find all distinct values.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimize-multi-tables"></a>8.4.3. Optimizing for Many Tables</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#table-cache">8.4.3.1. How MySQL Opens and Closes Tables</a></span></dt><dt><span class="section"><a href="optimization.html#creating-many-tables">8.4.3.2. Disadvantages of Creating Many Tables in the Same Database</a></span></dt><dt><span class="section"><a href="optimization.html#internal-temporary-tables">8.4.3.3. How MySQL Uses Internal Temporary Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idp49758112"></a><p>
        Some techniques for keeping individual queries fast involve
        splitting data across many tables. When the number of tables
        runs into the thousands or even millions, the overhead of
        dealing with all these tables becomes a new performance
        consideration.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="table-cache"></a>8.4.3.1. How MySQL Opens and Closes Tables</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp49761264"></a><a class="indexterm" name="idp49762336"></a><a class="indexterm" name="idp49763824"></a><a class="indexterm" name="idp49765312"></a><a class="indexterm" name="idp49766800"></a><a class="indexterm" name="idp49768288"></a><a class="indexterm" name="idp49769360"></a><a class="indexterm" name="idp49770848"></a><p>
          When you execute a <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin status</strong></span></a>
          command, you should see something like this:
        </p><pre class="programlisting">Uptime: 426 Running threads: 1 Questions: 11082
Reloads: 1 Open tables: 12</pre><p>
          The <code class="literal">Open tables</code> value of 12 can be somewhat
          puzzling if you have only six tables.
        </p><p>
          MySQL is multi-threaded, so there may be many clients issuing
          queries for a given table simultaneously. To minimize the
          problem with multiple client sessions having different states
          on the same table, the table is opened independently by each
          concurrent session. This uses additional memory but normally
          increases performance. With <code class="literal">MyISAM</code> tables,
          one extra file descriptor is required for the data file for
          each client that has the table open. (By contrast, the index
          file descriptor is shared between all sessions.)
        </p><p>
          The <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> and
          <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a> system
          variables affect the maximum number of files the server keeps
          open. If you increase one or both of these values, you may run
          up against a limit imposed by your operating system on the
          per-process number of open file descriptors. Many operating
          systems permit you to increase the open-files limit, although
          the method varies widely from system to system. Consult your
          operating system documentation to determine whether it is
          possible to increase the limit and how to do so.
        </p><p>
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> is related
          to <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>. For
          example, for 200 concurrent running connections, specify a
          table cache size of at least <code class="literal">200 *
          <em class="replaceable"><code>N</code></em></code>, where
          <em class="replaceable"><code>N</code></em> is the maximum number of tables
          per join in any of the queries which you execute. You must
          also reserve some extra file descriptors for temporary tables
          and files.
        </p><p>
          Make sure that your operating system can handle the number of
          open file descriptors implied by the
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> setting. If
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> is set too
          high, MySQL may run out of file descriptors and refuse
          connections, fail to perform queries, and be very unreliable.
          You also have to take into account that the
          <code class="literal">MyISAM</code> storage engine needs two file
          descriptors for each unique open table. You can increase the
          number of file descriptors available to MySQL using the
          <a class="link" href="server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a> startup
          option to <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. See
          <a class="xref" href="error-handling.html#not-enough-file-handles" title="C.5.2.18. 'File' Not Found and Similar Errors">Section C.5.2.18, “<span class="errortext">'<em class="replaceable"><code>File</code></em>' Not Found</span> and
          Similar Errors”</a>.
        </p><p>
          The cache of open tables is kept at a level of
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> entries. The
          default value is 400; this can be changed with the
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="option">--table_open_cache</code></a> option to
          <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. Note that MySQL may temporarily
          open more tables than this to execute queries.
        </p><p>
          MySQL closes an unused table and removes it from the table
          cache under the following circumstances:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              When the cache is full and a thread tries to open a table
              that is not in the cache.
            </p></li><li class="listitem"><p>
              When the cache contains more than
              <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> entries
              and a table in the cache is no longer being used by any
              threads.
            </p></li><li class="listitem"><p>
              When a table flushing operation occurs. This happens when
              someone issues a
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> statement or executes a
              <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-tables</strong></span></a> or
              <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin refresh</strong></span></a> command.
</p></li></ul>
</div>
<p>
          When the table cache fills up, the server uses the following
          procedure to locate a cache entry to use:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Tables that are not currently in use are released,
              beginning with the table least recently used.
            </p></li><li class="listitem"><p>
              If a new table needs to be opened, but the cache is full
              and no tables can be released, the cache is temporarily
              extended as necessary. When the cache is in a temporarily
              extended state and a table goes from a used to unused
              state, the table is closed and released from the cache.
</p></li></ul>
</div>
<p>
          A <code class="literal">MyISAM</code> table is opened for each
          concurrent access. This means the table needs to be opened
          twice if two threads access the same table or if a thread
          accesses the table twice in the same query (for example, by
          joining the table to itself). Each concurrent open requires an
          entry in the table cache. The first open of any
          <code class="literal">MyISAM</code> table takes two file descriptors:
          one for the data file and one for the index file. Each
          additional use of the table takes only one file descriptor for
          the data file. The index file descriptor is shared among all
          threads.
        </p><p>
          If you are opening a table with the <code class="literal">HANDLER
          <em class="replaceable"><code>tbl_name</code></em> OPEN</code> statement,
          a dedicated table object is allocated for the thread. This
          table object is not shared by other threads and is not closed
          until the thread calls <code class="literal">HANDLER
          <em class="replaceable"><code>tbl_name</code></em> CLOSE</code> or the
          thread terminates. When this happens, the table is put back in
          the table cache (if the cache is not full). See
          <a class="xref" href="sql-syntax.html#handler" title="13.2.4. HANDLER Syntax">Section 13.2.4, “<code class="literal">HANDLER</code> Syntax”</a>.
        </p><p>
          You can determine whether your table cache is too small by
          checking the <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> status variable
          <a class="link" href="server-administration.html#statvar_Opened_tables"><code class="literal">Opened_tables</code></a>, which
          indicates the number of table-opening operations since the
          server started:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Opened_tables';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Opened_tables | 2741  |
+---------------+-------+
</pre><p>
          If the value is very large or increases rapidly, even when you
          have not issued many
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statements, increase the table cache size. See
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>, and
          <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-many-tables"></a>8.4.3.2. Disadvantages of Creating Many Tables in the Same Database</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp49816368"></a><p>
          If you have many <code class="literal">MyISAM</code> tables in the same
          database directory, open, close, and create operations are
          slow. If you execute <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          statements on many different tables, there is a little
          overhead when the table cache is full, because for every table
          that has to be opened, another must be closed. You can reduce
          this overhead by increasing the number of entries permitted in
          the table cache.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="internal-temporary-tables"></a>8.4.3.3. How MySQL Uses Internal Temporary Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp49821392"></a><p>
          In some cases, the server creates internal temporary tables
          while processing queries. Such a table can be held in memory
          and processed by the <code class="literal">MEMORY</code> storage engine,
          or stored on disk and processed by the
          <code class="literal">MyISAM</code> storage engine. The server may
          create a temporary table initially as an in-memory table, then
          convert it to an on-disk table if it becomes too large. Users
          have no direct control over when the server creates an
          internal temporary table or which storage engine the server
          uses to manage it.
        </p><p>
          Temporary tables can be created under conditions such as
          these:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If there is an <code class="literal">ORDER BY</code> clause and a
              different <code class="literal">GROUP BY</code> clause, or if the
              <code class="literal">ORDER BY</code> or <code class="literal">GROUP BY</code>
              contains columns from tables other than the first table in
              the join queue, a temporary table is created.
            </p></li><li class="listitem"><p>
              <code class="literal">DISTINCT</code> combined with <code class="literal">ORDER
              BY</code> may require a temporary table.
            </p></li><li class="listitem"><p>
              If you use the <code class="literal">SQL_SMALL_RESULT</code> option,
              MySQL uses an in-memory temporary table, unless the query
              also contains elements (described later) that require
              on-disk storage.
            </p></li><li class="listitem"><p>
              Derived tables (subqueries in the <code class="literal">FROM</code>
              clause).
            </p></li><li class="listitem"><p>
              Tables created for subquery or semi-join materialization.
</p></li></ul>
</div>
<p>
          To determine whether a query requires a temporary table, use
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> and check the
          <code class="literal">Extra</code> column to see whether it says
          <code class="literal">Using temporary</code>. See
          <a class="xref" href="optimization.html#using-explain" title="8.8.1. Optimizing Queries with EXPLAIN">Section 8.8.1, “Optimizing Queries with <code class="literal">EXPLAIN</code>”</a>. <code class="literal">EXPLAIN</code>
          will not necessarily say <code class="literal">Using temporary</code>
          for derived or materialized temporary tables.
        </p><p>
          Some conditions prevent the use of an in-memory temporary
          table, in which case the server uses an on-disk table instead:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Presence of a <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> or
              <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a> column in the table
            </p></li><li class="listitem"><p>
              Presence of any string column in a <code class="literal">GROUP
              BY</code> or <code class="literal">DISTINCT</code> clause larger
              than 512 bytes
            </p></li><li class="listitem"><p>
              Presence of any string column with a maximum length larger
              than 512 (bytes for binary strings, characters for
              nonbinary strings) in the
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> list, if
              <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> or
              <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION ALL</code></a>
              is used
</p></li></ul>
</div>
<p>
          If an internal temporary table is created initially as an
          in-memory table but becomes too large, MySQL automatically
          converts it to an on-disk table. The maximum size for
          in-memory temporary tables is the minimum of the
          <a class="link" href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a> and
          <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> values.
          This differs from <code class="literal">MEMORY</code> tables explicitly
          created with <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>: For
          such tables, the
          <a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> system
          variable determines how large the table is permitted to grow
          and there is no conversion to on-disk format.
        </p><p>
          When the server creates an internal temporary table (either in
          memory or on disk), it increments the
          <a class="link" href="server-administration.html#statvar_Created_tmp_tables"><code class="literal">Created_tmp_tables</code></a> status
          variable. If the server creates the table on disk (either
          initially or by converting an in-memory table) it increments
          the <a class="link" href="server-administration.html#statvar_Created_tmp_disk_tables"><code class="literal">Created_tmp_disk_tables</code></a>
          status variable.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-innodb"></a>8.5. Optimizing for <code class="literal">InnoDB</code> Tables</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#optimizing-innodb-storage-layout">8.5.1. Optimizing Storage Layout for <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-transaction-management">8.5.2. Optimizing <code class="literal">InnoDB</code> Transaction Management</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-logging">8.5.3. Optimizing <code class="literal">InnoDB</code> Logging</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-bulk-data-loading">8.5.4. Bulk Data Loading for <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-queries">8.5.5. Optimizing <code class="literal">InnoDB</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-ddl-operations">8.5.6. Optimizing <code class="literal">InnoDB</code> DDL Operations</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-diskio">8.5.7. Optimizing <code class="literal">InnoDB</code> Disk I/O</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-configuration-variables">8.5.8. Optimizing <code class="literal">InnoDB</code> Configuration Variables</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-many-tables">8.5.9. Optimizing <code class="literal">InnoDB</code> for Systems with Many Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idp49860080"></a><a class="indexterm" name="idp49861984"></a><p>
      <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> is the storage engine that
      MySQL customers typically use in production databases where
      reliability and concurrency are important. Because
      <code class="literal">InnoDB</code> is the default storage engine in MySQL
      5.5 and higher, you can expect to see <code class="literal">InnoDB</code>
      tables more often than before. This section explains how to
      optimize database operations for <code class="literal">InnoDB</code> tables.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-storage-layout"></a>8.5.1. Optimizing Storage Layout for <code class="literal">InnoDB</code> Tables</h3>
</div>
</div>
</div>

<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Once your data reaches a stable size, or a growing table has
            increased by tens or some hundreds of megabytes, consider
            using the <code class="literal">OPTIMIZE TABLE</code> statement to
            reorganize the table and compact any wasted space. The
            reorganized tables require less disk I/O to perform full
            table scans. This is a straightforward technique that can
            improve performance when other techniques such as improving
            index usage or tuning application code are not practical.
          </p><p>
            <code class="literal">OPTIMIZE TABLE</code> copies the data part of
            the table and rebuilds the indexes. The benefits come from
            improved packing of data within indexes, and reduced
            fragmentation within the tablespaces and on disk. The
            benefits vary depending on the data in each table. You may
            find that there are significant gains for some and not for
            others, or that the gains decrease over time until you next
            optimize the table. This operation can be slow if the table
            is large or if the indexes being rebuilt don't fit into the
            buffer pool. The first run after adding a lot of data to a
            table is often much slower than later runs.
          </p></li><li class="listitem"><p>
            In <code class="literal">InnoDB</code>, having a long <code class="literal">PRIMARY
            KEY</code> (either a single column with a lengthy value,
            or several columns that form a long composite value) wastes
            a lot of disk space. The primary key value for a row is
            duplicated in all the secondary index records that point to
            the same row. (See
            <a class="xref" href="storage-engines.html#innodb-table-and-index" title="14.2.3.12. InnoDB Table and Index Structures">Section 14.2.3.12, “<code class="literal">InnoDB</code> Table and Index Structures”</a>.) Create an
            <code class="literal">AUTO_INCREMENT</code> column as the primary key
            if your primary key is long, or index a prefix of a long
            <code class="literal">VARCHAR</code> column instead of the entire
            column.
          </p></li><li class="listitem"><p>
            Use the <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> data type
            instead of <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> to store
            variable-length strings or for columns with many
            <code class="literal">NULL</code> values. A
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            column always takes <em class="replaceable"><code>N</code></em> characters
            to store data, even if the string is shorter or its value is
            <code class="literal">NULL</code>. Smaller tables fit better in the
            buffer pool and reduce disk I/O.
          </p><p>
            When using <code class="literal">COMPACT</code> row format (the
            default <code class="literal">InnoDB</code> format in MySQL
            5.6) and variable-length character sets, such
            as <code class="literal">utf8</code> or <code class="literal">sjis</code>,
            <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            columns occupy a variable amount of space, but still at
            least <em class="replaceable"><code>N</code></em> bytes.
          </p></li><li class="listitem"><p>
            For tables that are big, or contain lots of repetitive text
            or numeric data, consider using
            <code class="literal">COMPRESSED</code> row format. Less disk I/O is
            required to bring data into the buffer pool, or to perform
            full table scans. Before making a permanent decision,
            measure the amount of compression you can achieve by using
            <code class="literal">COMPRESSED</code> versus
            <code class="literal">COMPACT</code> row format.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-transaction-management"></a>8.5.2. Optimizing <code class="literal">InnoDB</code> Transaction Management</h3>

</div>

</div>

</div>
<p>
        To optimize <code class="literal">InnoDB</code> transaction processing,
        find the ideal balance between the performance overhead of
        transactional features and the workload of your server. For
        example, an application might encounter performance issues if it
        commits thousands of times per second, and different performance
        issues if it commits only every 2-3 hours.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The default MySQL setting <code class="literal">AUTOCOMMIT=1</code>
            can impose performance limitations on a busy database
            server. Where practical, wrap several related DML operations
            into a single transaction, by issuing <code class="literal">SET
            AUTOCOMMIT=0</code> or a <code class="literal">START
            TRANSACTION</code> statement, followed by a
            <code class="literal">COMMIT</code> statement after making all the
            changes.
          </p><p>
            <code class="literal">InnoDB</code> must flush the log to disk at each
            transaction commit if that transaction made modifications to
            the database. When each change is followed by a commit (as
            with the default autocommit setting), the I/O throughput of
            the storage device puts a cap on the number of potential
            operations per second.
          </p></li><li class="listitem"><p>
            Alternatively, for transactions that consist only of a
            single <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement,
            turning on <code class="literal">AUTOCOMMIT</code> helps
            <code class="literal">InnoDB</code> to recognize read-only
            transactions and optimize them. See
            <a class="xref" href="storage-engines.html#innodb-performance-ro-txn" title="14.2.4.2.3. Optimizations for Read-Only Transactions">Section 14.2.4.2.3, “Optimizations for Read-Only Transactions”</a> for
            requirements.
          </p></li><li class="listitem"><p>
            Avoid performing rollbacks after inserting, updating, or
            deleting huge numbers of rows. If a big transaction is
            slowing down server performance, rolling it back can make
            the problem worse, potentially taking several times as long
            to perform as the original DML operations. Killing the
            database process does not help, because the rollback starts
            again on server startup.
          </p><p>
            To minimize the chance of this issue occurring: increase the
            size of the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
            pool</a> so that all the DML changes can be cached rather
            than immediately written to disk; set
            <a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=all</code></a>
            so that update and delete operations are buffered in
            addition to inserts; and consider issuing
            <code class="literal">COMMIT</code> statements periodically during the
            big DML operation, possibly breaking a single delete or
            update into multiple statements that operate on smaller
            numbers of rows.
          </p><p>
            To get rid of a runaway rollback once it occurs, increase
            the buffer pool so that the rollback becomes CPU-bound and
            runs fast, or kill the server and restart with
            <a class="link" href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery=3</code></a>, as
            explained in <a class="xref" href="storage-engines.html#innodb-recovery" title="14.2.3.13. The InnoDB Recovery Process">Section 14.2.3.13, “The <code class="literal">InnoDB</code> Recovery Process”</a>.
          </p><p>
            This issue is expected to be less prominent in MySQL 5.5 and
            up, or in MySQL 5.1 with the InnoDB Plugin, because the
            default setting
            <a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=all</code></a>
            allows update and delete operations to be cached in memory,
            making them faster to perform in the first place, and also
            faster to roll back if needed. Make sure to use this
            parameter setting on servers that process long-running
            transactions with many inserts, updates, or deletes.
          </p></li><li class="listitem"><p>
            If you can afford the loss of some of the latest committed
            transactions if a crash occurs, you can set the
            <a class="link" href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
            parameter to 0. <code class="literal">InnoDB</code> tries to flush the
            log once per second anyway, although the flush is not
            guaranteed. Also, set the value of
            <a class="link" href="storage-engines.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a> to 0,
            which will reduce the number of disk flushes due to
            synchronizing on disk data and the binary log.
          </p></li><li class="listitem"><p>
            When rows are modified or deleted, the rows and associated
            <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> are not
            physically removed immediately, or even immediately after
            the transaction commits. The old data is preserved until
            transactions that started earlier or concurrently are
            finished, so that those transactions can access the previous
            state of modified or deleted rows. Thus, a long-running
            transaction can prevent <code class="literal">InnoDB</code> from
            purging data that was changed by a different transaction.
          </p></li><li class="listitem"><p>
            When rows are modified or deleted within a long-running
            transaction, other transactions using the
            <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> and
            <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
            levels have to do more work to reconstruct the older data if
            they read those same rows.
          </p></li><li class="listitem"><p>
            When a long-running transaction modifies a table, queries
            against that table from other transactions do not make use
            of the <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering
            index</a> technique. Queries that normally could retrieve
            all the result columns from a secondary index, instead look
            up the appropriate values from the table data.
          </p><p>
            If secondary index pages are found to have a
            <code class="literal">PAGE_MAX_TRX_ID</code> that is too new, or if
            records in the secondary index are delete-marked,
            <code class="literal">InnoDB</code> may need to look up records using
            a clustered index.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-logging"></a>8.5.3. Optimizing <code class="literal">InnoDB</code> Logging</h3>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Make your log files big, even as big as the buffer pool.
            When <code class="literal">InnoDB</code> has written the log files
            full, it must write the modified contents of the buffer pool
            to disk in a checkpoint. Small log files cause many
            unnecessary disk writes. Although historically big log files
            caused lengthy recovery times, recovery is now much faster
            and you can confidently use large log files.
          </p></li><li class="listitem"><p>
            Make the log buffer quite large as well (on the order of
            8MB).
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-bulk-data-loading"></a>8.5.4. Bulk Data Loading for <code class="literal">InnoDB</code> Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp49933872"></a><p>
        These performance tips supplement the general guidelines for
        fast inserts in <a class="xref" href="optimization.html#insert-speed" title="8.2.2.1. Speed of INSERT Statements">Section 8.2.2.1, “Speed of <code class="literal">INSERT</code> Statements”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When importing data into <code class="literal">InnoDB</code>, turn off
            autocommit mode, because it performs a log flush to disk for
            every insert. To disable autocommit during your import
            operation, surround it with
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">SET
            autocommit</code></a> and
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> statements:
          </p><pre class="programlisting">SET autocommit=0;<em class="replaceable"><code>... SQL import statements ...</code></em>
COMMIT;
</pre><p>
            The <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> option
            <a class="link" href="programs.html#option_mysqldump_opt"><code class="option">--opt</code></a> creates dump files
            that are fast to import into an <code class="literal">InnoDB</code>
            table, even without wrapping them with the
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">SET
            autocommit</code></a> and
            <a class="link" href="sql-syntax.html#commit" title="13.3.1. START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> statements.
          </p></li><li class="listitem"><p>
            If you have <code class="literal">UNIQUE</code> constraints on
            secondary keys, you can speed up table imports by
            temporarily turning off the uniqueness checks during the
            import session:
          </p><pre class="programlisting">SET unique_checks=0;<em class="replaceable"><code>... SQL import statements ...</code></em>
SET unique_checks=1;
</pre><p>
            For big tables, this saves a lot of disk I/O because
            <code class="literal">InnoDB</code> can use its insert buffer to write
            secondary index records in a batch. Be certain that the data
            contains no duplicate keys.
          </p></li><li class="listitem"><p>
            If you have <code class="literal">FOREIGN KEY</code> constraints in
            your tables, you can speed up table imports by turning off
            the foreign key checks for the duration of the import
            session:
          </p><pre class="programlisting">SET foreign_key_checks=0;<em class="replaceable"><code>... SQL import statements ...</code></em>
SET foreign_key_checks=1;
</pre><p>
            For big tables, this can save a lot of disk I/O.
          </p></li><li class="listitem"><p>
            Use the multiple-row <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            syntax to reduce communication overhead between the client
            and the server if you need to insert many rows:
          </p><pre class="programlisting">INSERT INTO yourtable VALUES (1,2), (5,5), ...;</pre><p>
            This tip is valid for inserts into any table, not just
            <code class="literal">InnoDB</code> tables.
          </p></li><li class="listitem"><p>
            When doing bulk inserts into tables with auto-increment
            columns, set
            <a class="link" href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> to
            2 instead of the default value 1. See
            <a class="xref" href="server-administration.html#innodb-auto-increment-configurable" title="5.4.4.2. Configurable InnoDB Auto-Increment Locking">Section 5.4.4.2, “Configurable <code class="literal">InnoDB</code> Auto-Increment Locking”</a> for
            details.
          </p></li><li class="listitem"><p>
            For optimal performance when loading data into an
            <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index,
            follow this set of steps:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Define a column <code class="literal">FTS_DOC_ID</code> at table
                creation time, of type <code class="literal">BIGINT UNSIGNED NOT
                NULL</code>, with a unique index named
                <code class="literal">FTS_DOC_ID_INDEX</code>. For example:
              </p><pre class="programlisting">CREATE TABLE t1 (
FTS_DOC_ID BIGINT unsigned NOT NULL AUTO_INCREMENT,
title varchar(255) NOT NULL DEFAULT ”,
text mediumtext NOT NULL,
PRIMARY KEY (`FTS_DOC_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
CREATE UNIQUE INDEX FTS_DOC_ID_INDEX on t1(FTS_DOC_ID);
              </pre></li><li class="listitem"><p>
                Load the data into the table.
              </p></li><li class="listitem"><p>
                Create the <code class="literal">FULLTEXT</code> index after the
                data is loaded.
</p></li></ul>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
              When adding <code class="literal">FTS_DOC_ID</code> column at table
              creation time, ensure that the
              <code class="literal">FTS_DOC_ID</code> column is updated when the
              <code class="literal">FULLTEXT</code> indexed column is updated, as
              the <code class="literal">FTS_DOC_ID</code> must increase
              monotonically with each
              <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> or
              <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>. If you choose not
              to add the <code class="literal">FTS_DOC_ID</code> at table creation
              time and have <code class="literal">InnoDB</code> manage DOC IDs for
              you, <code class="literal">InnoDB</code> will add the
              <code class="literal">FTS_DOC_ID</code> as a hidden column with the
              next <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE
              FULLTEXT INDEX</code></a> call. This approach, however,
              requires a table rebuild which will impact performance.
</p>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-queries"></a>8.5.5. Optimizing <code class="literal">InnoDB</code> Queries</h3>

</div>

</div>

</div>
<p>
        To tune queries for <code class="literal">InnoDB</code> tables, create an
        appropriate set of indexes on each table. See
        <a class="xref" href="optimization.html#mysql-indexes" title="8.3.1. How MySQL Uses Indexes">Section 8.3.1, “How MySQL Uses Indexes”</a> for details. Follow these
        guidelines for <code class="literal">InnoDB</code> indexes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Because each <code class="literal">InnoDB</code> table has a
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> (whether
            you request one or not), specify a set of primary key
            columns for each table, columns that are used in the most
            important and time-critical queries.
          </p></li><li class="listitem"><p>
            Do not specify too many or too long columns in the primary
            key, because these column values are duplicated in each
            secondary index. When an index contains unnecessary data,
            the I/O to read this data and memory to cache it reduce the
            performance and scalability of the server.
          </p></li><li class="listitem"><p>
            Do not create a separate
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary index</a>
            for each column, because each query can only make use of one
            index. Indexes on rarely tested columns or columns with only
            a few different values might not be helpful for any queries.
            If you have many queries for the same table, testing
            different combinations of columns, try to create a small
            number of
            <a class="link" href="glossary.html#glos_concatenated_index" title="concatenated index">concatenated
            indexes</a> rather than a large number of single-column
            indexes. If an index contains all the columns needed for the
            result set (known as a
            <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering index</a>),
            the query might be able to avoid reading the table data at
            all.
          </p></li><li class="listitem"><p>
            If an indexed column cannot contain any
            <code class="literal">NULL</code> values, declare it as <code class="literal">NOT
            NULL</code> when you create the table. The optimizer can
            better determine which index is most effective to use for a
            query, when it knows whether each column contains
            <code class="literal">NULL</code> values or not.
          </p></li><li class="listitem"><p>
            In MySQL 5.6.4 and higher, you can optimize single-query
            transactions for <code class="literal">InnoDB</code> tables, using the
            technique in <a class="xref" href="storage-engines.html#innodb-performance-ro-txn" title="14.2.4.2.3. Optimizations for Read-Only Transactions">Section 14.2.4.2.3, “Optimizations for Read-Only Transactions”</a>.
          </p></li><li class="listitem"><p>
            If you often have recurring queries for tables that are not
            updated frequently, enable the query cache:
          </p><pre class="programlisting">[mysqld]
query_cache_type = 1
query_cache_size = 10M</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-ddl-operations"></a>8.5.6. Optimizing <code class="literal">InnoDB</code> DDL Operations</h3>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For DDL operations on tables and indexes
            (<code class="literal">CREATE</code>, <code class="literal">ALTER</code>, and
            <code class="literal">DROP</code> statements), the most significant
            aspect for <code class="literal">InnoDB</code> tables is that creating
            and dropping secondary indexes is much faster in MySQL 5.5
            and higher, than in MySQL 5.1 and before. See
            <a class="ulink" href="http://dev.mysql.com/doc/refman/5.5/en/innodb-create-index.html" target="_top">Fast Index Creation in the InnoDB Storage Engine</a> for details.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Fast index creation</span>”</span> makes it faster in some
            cases to drop an index before loading data into a table,
            then re-create the index after loading the data.
          </p></li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> to empty a
            table, not <code class="literal">DELETE FROM
            <em class="replaceable"><code>tbl_name</code></em></code>. Foreign key
            constraints can make a <code class="literal">TRUNCATE</code> statement
            work like a regular <code class="literal">DELETE</code> statement, in
            which case a sequence of commands like
            <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> and
            <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> might be
            fastest.
          </p></li><li class="listitem"><p>
            Because the primary key is integral to the storage layout of
            each <code class="literal">InnoDB</code> table, and changing the
            definition of the primary key involves reorganizing the
            whole table, always set up the primary key as part of the
            <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement, and
            plan ahead so that you do not need to
            <code class="literal">ALTER</code> or <code class="literal">DROP</code> the
            primary key afterward.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-diskio"></a>8.5.7. Optimizing <code class="literal">InnoDB</code> Disk I/O</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp50018288"></a><p>
        If you follow the best practices for database design and the
        tuning techniques for SQL operations, but your database is still
        slowed by heavy disk I/O activity, explore these low-level
        techniques related to disk I/O. If the Unix
        <code class="filename">top</code> tool or the Windows Task Manager shows
        that the CPU usage percentage with your workload is less than
        70%, your workload is probably disk-bound.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When table data is cached in the <code class="literal">InnoDB</code>
            buffer pool, it can be processed over and over by queries
            without requiring any disk I/O. Specify the size of the
            buffer pool with the
            <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            option. This memory area is important enough that busy
            databases often specify a size approximately 80% of the
            amount of physical memory. For more information, see
            <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
          </p></li><li class="listitem"><p>
            In some versions of GNU/Linux and Unix, flushing files to
            disk with the Unix <code class="literal">fsync()</code> call (which
            <code class="literal">InnoDB</code> uses by default) and similar
            methods is surprisingly slow. If database write performance
            is an issue, conduct benchmarks with the
            <a class="link" href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
            parameter set to <code class="literal">O_DSYNC</code>.
          </p></li><li class="listitem"><p>
            When using the <code class="literal">InnoDB</code> storage engine on
            Solaris 10 for x86_64 architecture (AMD Opteron), use direct
            I/O for <code class="literal">InnoDB</code>-related files, to avoid
            degradation of <code class="literal">InnoDB</code> performance. To use
            direct I/O for an entire UFS file system used for storing
            <code class="literal">InnoDB</code>-related files, mount it with the
            <code class="literal">forcedirectio</code> option; see
            <code class="literal">mount_ufs(1M)</code>. (The default on Solaris
            10/x86_64 is <span class="emphasis"><em>not</em></span> to use this option.)
            To apply direct I/O only to <code class="literal">InnoDB</code> file
            operations rather than the whole file system, set
            <a class="link" href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method =
            O_DIRECT</code></a>. With this setting,
            <code class="literal">InnoDB</code> calls
            <code class="literal">directio()</code> instead of
            <code class="literal">fcntl()</code> for I/O to data files (not for
            I/O to log files).
          </p></li><li class="listitem"><p>
            When using the <code class="literal">InnoDB</code> storage engine with
            a large
            <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            value on any release of Solaris 2.6 and up and any platform
            (sparc/x86/x64/amd64), conduct benchmarks with
            <code class="literal">InnoDB</code> data files and log files on raw
            devices or on a separate direct I/O UFS file system, using
            the <code class="literal">forcedirectio</code> mount option as
            described earlier. (It is necessary to use the mount option
            rather than setting
            <a class="link" href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> if you
            want direct I/O for the log files.) Users of the Veritas
            file system VxFS should use the
            <code class="literal">convosync=direct</code> mount option.
          </p><p>
            Do not place other MySQL data files, such as those for
            <code class="literal">MyISAM</code> tables, on a direct I/O file
            system. Executables or libraries <span class="emphasis"><em>must
            not</em></span> be placed on a direct I/O file system.
          </p></li><li class="listitem"><p>
            If you have additional storage devices available to set up a
            RAID configuration or symbolic links to different disks,
            <a class="xref" href="optimization.html#disk-issues" title="8.11.3. Optimizing Disk I/O">Section 8.11.3, “Optimizing Disk I/O”</a> for additional low-level I/O
            tips.
          </p></li><li class="listitem"><p>
            If throughput drops periodically because of
            <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoint</a>
            operations, consider increasing the value of the
            <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
            configuration option. Higher values cause more frequent
            <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a>, avoiding the
            backlog of work that can cause dips in throughput.
          </p></li><li class="listitem"><p>
            If the system is not falling behind with
            <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> operations,
            consider lowering the value of the
            <a class="link" href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
            configuration option. Typically, you keep this option value
            as low as practical, but not so low that it causes periodic
            drops in throughput as mentioned in the preceding bullet. In
            a typical scenario where you could lower the option value,
            you might see a combination like this in the output from
            <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                History list length low, below a few thousand.
              </p></li><li class="listitem"><p>
                Insert buffer merges close to rows inserted.
              </p></li><li class="listitem"><p>
                Modified pages in buffer pool consistently well below
                <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
                of the buffer pool. (Measure at a time when the server
                is not doing bulk inserts; it is normal during bulk
                inserts for the modified pages percentage to rise
                significantly.)
              </p></li><li class="listitem"><p>
                <code class="literal">Log sequence number - Last checkpoint</code>
                is at less than 7/8 or ideally less than 6/8 of the
                total size of the <code class="literal">InnoDB</code>
                <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Other <code class="literal">InnoDB</code> configuration options to
            consider when tuning I/O-bound workloads include
            <a class="link" href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a>,


            <a class="link" href="storage-engines.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_lru_scan_depth"><code class="literal">innodb_lru_scan_depth</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_open_files"><code class="literal">innodb_open_files</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>,
            <a class="link" href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>,
            and <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-configuration-variables"></a>8.5.8. Optimizing <code class="literal">InnoDB</code> Configuration Variables</h3>

</div>

</div>

</div>
<p>
        Different settings work best for servers with light, predictable
        loads, versus servers that are running near full capacity all
        the time, or that experience spikes of high activity.
      </p><p>
        Because the <code class="literal">InnoDB</code> storage engine performs
        many of its optimizations automatically, many performance-tuning
        tasks involve monitoring to ensure that the database is
        performing well, and changing configuration options when
        performance drops. See
        <a class="xref" href="storage-engines.html#innodb-performance-schema" title="14.2.4.2.26. Integration with the MySQL Performance Schema">Section 14.2.4.2.26, “Integration with the MySQL Performance Schema”</a> for information
        about detailed <code class="literal">InnoDB</code> performance monitoring.
      </p><p>
        For information about the most important and most recent
        <code class="literal">InnoDB</code> performance features, see
        <a class="xref" href="storage-engines.html#innodb-performance" title="14.2.4.2. InnoDB Performance and Scalability Enhancements">Section 14.2.4.2, “<code class="literal">InnoDB</code> Performance and Scalability Enhancements”</a>. Even if you have used
        <code class="literal">InnoDB</code> tables in prior versions, these
        features might be new to you, because they are from the
        <span class="quote">“<span class="quote">InnoDB Plugin</span>”</span>. The Plugin co-existed alongside
        the built-in <code class="literal">InnoDB</code> in MySQL 5.1, and becomes
        the default storage engine in MySQL 5.5 and higher.
      </p><p>
        The main configuration steps you can perform include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Enabling <code class="literal">InnoDB</code> to use high-performance
            memory allocators on systems that include them. See
            <a class="xref" href="storage-engines.html#innodb-performance-use_sys_malloc" title="14.2.4.2.12. Using Operating System Memory Allocators">Section 14.2.4.2.12, “Using Operating System Memory Allocators”</a>.
          </p></li><li class="listitem"><p>
            Controlling the types of DML operations for which
            <code class="literal">InnoDB</code> buffers the changed data, to avoid
            frequent small disk writes. See
            <a class="xref" href="storage-engines.html#innodb-performance-change_buffering" title="14.2.4.2.13. Controlling InnoDB Change Buffering">Section 14.2.4.2.13, “Controlling InnoDB Change Buffering”</a>.
            Because the default is to buffer all types of DML
            operations, only change this setting if you need to reduce
            the amount of buffering.
          </p></li><li class="listitem"><p>
            Turning the adaptive hash indexing feature on and off. See
            <a class="xref" href="storage-engines.html#innodb-performance-adaptive_hash_index" title="14.2.4.2.14. Controlling Adaptive Hash Indexing">Section 14.2.4.2.14, “Controlling Adaptive Hash Indexing”</a>.
            You might change this setting during periods of unusual
            activity, then restore it to its original setting.
          </p></li><li class="listitem"><p>
            Setting a limit on the number of concurrent threads that
            <code class="literal">InnoDB</code> processes, if context switching is
            a bottleneck. See
            <a class="xref" href="storage-engines.html#innodb-performance-thread_concurrency" title="14.2.4.2.15. Changes Regarding Thread Concurrency">Section 14.2.4.2.15, “Changes Regarding Thread Concurrency”</a>.
          </p></li><li class="listitem"><p>
            Controlling the amount of prefetching that
            <code class="literal">InnoDB</code> does with its read-ahead
            operations. When the system has unused I/O capacity, more
            read-ahead can improve the performance of queries. Too much
            read-ahead can cause periodic drops in performance on a
            heavily loaded system. See
            <a class="xref" href="storage-engines.html#innodb-performance-read_ahead" title="14.2.4.2.16. Changes in the Read-Ahead Algorithm">Section 14.2.4.2.16, “Changes in the Read-Ahead Algorithm”</a>.
          </p></li><li class="listitem"><p>
            Increasing the number of background threads for read or
            write operations, if you have a high-end I/O subsystem that
            is not fully utilized by the default values. See
            <a class="xref" href="storage-engines.html#innodb-performance-multiple_io_threads" title="14.2.4.2.17. Multiple Background InnoDB I/O Threads">Section 14.2.4.2.17, “Multiple Background InnoDB I/O Threads”</a>.
          </p></li><li class="listitem"><p>
            Controlling how much I/O <code class="literal">InnoDB</code> performs
            in the background. See
            <a class="xref" href="storage-engines.html#innodb-performance-thread_io_rate" title="14.2.4.2.20. Controlling the InnoDB Master Thread I/O Rate">Section 14.2.4.2.20, “Controlling the InnoDB Master Thread I/O Rate”</a>. The
            amount of background I/O is higher than in MySQL 5.1, so you
            might scale back this setting if you observe periodic drops
            in performance.
          </p></li><li class="listitem"><p>
            Controlling the algorithm that determines when
            <code class="literal">InnoDB</code> performs certain types of
            background writes. See
            <a class="xref" href="storage-engines.html#innodb-performance-adaptive_flushing" title="14.2.4.2.21. Controlling the Flushing Rate of Dirty Pages from the InnoDB Buffer Pool">Section 14.2.4.2.21, “Controlling the Flushing Rate of Dirty Pages from the InnoDB Buffer Pool”</a>. The
            algorithm works for some types of workloads but not others,
            so might turn off this setting if you observe periodic drops
            in performance.
          </p></li><li class="listitem"><p>
            Taking advantage of multicore processors and their cache
            memory configuration, to minimize delays in context
            switching. See
            <a class="xref" href="storage-engines.html#innodb-performance-spin_lock_polling" title="14.2.4.2.23. Control of Spin Lock Polling">Section 14.2.4.2.23, “Control of Spin Lock Polling”</a>.
          </p></li><li class="listitem"><p>
            Preventing one-time operations such as table scans from
            interfering with the frequently accessed data stored in the
            <code class="literal">InnoDB</code> buffer cache. See
            <a class="xref" href="storage-engines.html#innodb-performance-midpoint_insertion" title="14.2.4.2.24. Making the Buffer Pool Scan Resistant">Section 14.2.4.2.24, “Making the Buffer Pool Scan Resistant”</a>.
          </p></li><li class="listitem"><p>
            Adjusting your log files to a size that makes sense for
            reliability and crash recovery. See
            <a class="xref" href="storage-engines.html#innodb-performance-recovery" title="14.2.4.2.25. Improvements to Crash Recovery Performance">Section 14.2.4.2.25, “Improvements to Crash Recovery Performance”</a>. Historically,
            people have kept their <code class="literal">InnoDB</code> log files
            small to avoid long startup times after a crash. Internal
            improvements in <code class="literal">InnoDB</code> make startup much
            faster, so the log file size is not such a performance
            factor anymore. If your log files are artificially small,
            increasing the size can help performance by reducing the I/O
            that occurs as redo log records are recycled.
          </p></li><li class="listitem"><p>
            Configuring the size and number of instances for the
            <code class="literal">InnoDB</code> buffer pool, especially important
            for systems with multi-gigabyte buffer pools. See
            <a class="xref" href="storage-engines.html#innodb-multiple-buffer-pools" title="14.2.4.2.27. Improvements to Performance from Multiple Buffer Pools">Section 14.2.4.2.27, “Improvements to Performance from Multiple Buffer Pools”</a>.
          </p></li><li class="listitem"><p>
            Increasing the maximum number of concurrent transactions,
            which dramatically improves scalability for the busiest
            databases. See
            <a class="xref" href="storage-engines.html#innodb-multiple-rollback-segments" title="14.2.4.2.28. Better Scalability with Multiple Rollback Segments">Section 14.2.4.2.28, “Better Scalability with Multiple Rollback Segments”</a>.
            Although this feature does not require any action during
            day-to-day operation, you must perform a
            <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>
            during or after upgrading the database to MySQL 5.5 to
            enable the higher limit.
          </p></li><li class="listitem"><p>
            Moving purge operations (a type of garbage collection) into
            a background thread. See
            <a class="xref" href="storage-engines.html#innodb-improved-purge-scheduling" title="14.2.4.2.29. Better Scalability with Improved Purge Scheduling">Section 14.2.4.2.29, “Better Scalability with Improved Purge Scheduling”</a>. To
            effectively measure the results of this setting, tune the
            other I/O-related and thread-related configuration settings
            first.
          </p></li><li class="listitem"><p>
            Reducing the amount of switching that
            <code class="literal">InnoDB</code> does between concurrent threads,
            so that SQL operations on a busy server do not queue up and
            form a <span class="quote">“<span class="quote">traffic jam</span>”</span>. Set a value for the
            <a class="link" href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
            option, up to approximately 32 for a high-powered modern
            system. Increase the value for the
            <a class="link" href="storage-engines.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>
            option, typically to 5000 or so, This combination of options
            sets a cap on the number of threads that
            <code class="literal">InnoDB</code> processes at any one time, and
            allows each thread to do substantial work before being
            swapped out, so that the number of waiting threads stays low
            and operations can complete without excessive context
            switching.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-innodb-many-tables"></a>8.5.9. Optimizing <code class="literal">InnoDB</code> for Systems with Many Tables</h3>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">InnoDB</code> computes index
            <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> values
            for a table the first time that table is accessed after
            startup, instead of storing such values in the table. This
            step can take significant time on systems that partition the
            data into many tables. Since this overhead only applies to
            the initial table open operation, to <span class="quote">“<span class="quote">warm up</span>”</span>
            a table for later use, access it immediately after startup
            by issuing a statement such as <code class="literal">SELECT 1 FROM
            <em class="replaceable"><code>tbl_name</code></em> LIMIT 1</code>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-myisam"></a>8.6. Optimizing for <code class="literal">MyISAM</code> Tables</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#optimizing-queries-myisam">8.6.1. Optimizing <code class="literal">MyISAM</code> Queries</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-myisam-bulk-data-loading">8.6.2. Bulk Data Loading for <code class="literal">MyISAM</code> Tables</a></span></dt><dt><span class="section"><a href="optimization.html#repair-table-speed">8.6.3. Speed of <code class="literal">REPAIR TABLE</code> Statements</a></span></dt></dl>
</div>
<a class="indexterm" name="idp50133664"></a><p>
      The <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> storage engine performs
      best with read-mostly data or with low-concurrency operations,
      because table locks limit the ability to perform simultaneous
      updates. In MySQL 5.6,
      <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> is the default storage engine
      rather than <code class="literal">MyISAM</code>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-queries-myisam"></a>8.6.1. Optimizing <code class="literal">MyISAM</code> Queries</h3>
</div>
</div>
</div>
<p>
        Some general tips for speeding up queries on
        <code class="literal">MyISAM</code> tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To help MySQL better optimize queries, use
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> or run
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk --analyze</strong></span></a> on a table after it
            has been loaded with data. This updates a value for each
            index part that indicates the average number of rows that
            have the same value. (For unique indexes, this is always 1.)
            MySQL uses this to decide which index to choose when you
            join two tables based on a nonconstant expression. You can
            check the result from the table analysis by using
            <code class="literal">SHOW INDEX FROM
            <em class="replaceable"><code>tbl_name</code></em></code> and examining
            the <code class="literal">Cardinality</code> value. <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            --description --verbose</strong></span></a> shows index distribution
            information.
          </p></li><li class="listitem"><p>
            To sort an index and data according to an index, use
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk --sort-index --sort-records=1</strong></span></a>
            (assuming that you want to sort on index 1). This is a good
            way to make queries faster if you have a unique index from
            which you want to read all rows in order according to the
            index. The first time you sort a large table this way, it
            may take a long time.
          </p></li><li class="listitem"><p>
            Try to avoid complex <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            queries on <code class="literal">MyISAM</code> tables that are updated
            frequently, to avoid problems with table locking that occur
            due to contention between readers and writers.
          </p></li><li class="listitem"><p>
            <code class="literal">MyISAM</code> supports concurrent inserts: If a
            table has no free blocks in the middle of the data file, you
            can <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> new rows into it
            at the same time that other threads are reading from the
            table. If it is important to be able to do this, consider
            using the table in ways that avoid deleting rows. Another
            possibility is to run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> to defragment the table after you have
            deleted a lot of rows from it. This behavior is altered by
            setting the
            <a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> variable.
            You can force new rows to be appended (and therefore permit
            concurrent inserts), even in tables that have deleted rows.
            See <a class="xref" href="optimization.html#concurrent-inserts" title="8.10.3. Concurrent Inserts">Section 8.10.3, “Concurrent Inserts”</a>.
          </p></li><li class="listitem"><p>
            For <code class="literal">MyISAM</code> tables that change frequently,
            try to avoid all variable-length columns
            (<a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a>, and
            <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">TEXT</code></a>). The table uses dynamic
            row format if it includes even a single variable-length
            column. See <a class="xref" href="storage-engines.html" title="Chapter 14. Storage Engines">Chapter 14, <i>Storage Engines</i></a>.
          </p></li><li class="listitem"><p>
            It is normally not useful to split a table into different
            tables just because the rows become large. In accessing a
            row, the biggest performance hit is the disk seek needed to
            find the first byte of the row. After finding the data, most
            modern disks can read the entire row fast enough for most
            applications. The only cases where splitting up a table
            makes an appreciable difference is if it is a
            <code class="literal">MyISAM</code> table using dynamic row format
            that you can change to a fixed row size, or if you very
            often need to scan the table but do not need most of the
            columns. See <a class="xref" href="storage-engines.html" title="Chapter 14. Storage Engines">Chapter 14, <i>Storage Engines</i></a>.
          </p></li><li class="listitem"><p>
            Use <code class="literal">ALTER TABLE ... ORDER BY
            <em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code> if you
            usually retrieve rows in
            <code class="literal"><em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>, ...</code> order. By
            using this option after extensive changes to the table, you
            may be able to get higher performance.
          </p></li><li class="listitem"><p>
            If you often need to calculate results such as counts based
            on information from a lot of rows, it may be preferable to
            introduce a new table and update the counter in real time.
            An update of the following form is very fast:
          </p><pre class="programlisting">UPDATE <em class="replaceable"><code>tbl_name</code></em> SET <em class="replaceable"><code>count_col</code></em>=<em class="replaceable"><code>count_col</code></em>+1 WHERE <em class="replaceable"><code>key_col</code></em>=<em class="replaceable"><code>constant</code></em>;
</pre><p>
            This is very important when you use MySQL storage engines
            such as <code class="literal">MyISAM</code> that has only table-level
            locking (multiple readers with single writers). This also
            gives better performance with most database systems, because
            the row locking manager in this case has less to do.
          </p></li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> for
            <code class="literal">MyISAM</code> (or other supported
            nontransactional tables) when you do not need to know when
            your data is written. This reduces the overall insertion
            impact because many rows can be written with a single disk
            write.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
              As of MySQL 5.6.6, <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT
              DELAYED</code></a> is deprecated, and will be removed in a
              future release. Use <code class="literal">INSERT</code> (without
              <code class="literal">DELAYED</code>) instead.
</p>
</div>
</li><li class="listitem"><p>
            Use <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
            periodically to avoid fragmentation with dynamic-format
            <code class="literal">MyISAM</code> tables. See
            <a class="xref" href="storage-engines.html#myisam-table-formats" title="14.3.3. MyISAM Table Storage Formats">Section 14.3.3, “<code class="literal">MyISAM</code> Table Storage Formats”</a>.
          </p></li><li class="listitem"><p>
            Declaring a <code class="literal">MyISAM</code> table with the
            <code class="literal">DELAY_KEY_WRITE=1</code> table option makes
            index updates faster because they are not flushed to disk
            until the table is closed. The downside is that if something
            kills the server while such a table is open, you must ensure
            that the table is okay by running the server with the
            <a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a>
            option, or by running <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> before
            restarting the server. (However, even in this case, you
            should not lose anything by using
            <code class="literal">DELAY_KEY_WRITE</code>, because the key
            information can always be generated from the data rows.)
          </p></li><li class="listitem"><p>
            Strings are automatically prefix- and end-space compressed
            in <code class="literal">MyISAM</code> indexes. See
            <a class="xref" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax">Section 13.1.13, “<code class="literal">CREATE INDEX</code> Syntax”</a>.
          </p></li><li class="listitem"><p>
            You can increase performance by caching queries or answers
            in your application and then executing many inserts or
            updates together. Locking the table during this operation
            ensures that the index cache is only flushed once after all
            updates. You can also take advantage of MySQL's query cache
            to achieve similar results; see
            <a class="xref" href="optimization.html#query-cache" title="8.9.3. The MySQL Query Cache">Section 8.9.3, “The MySQL Query Cache”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-myisam-bulk-data-loading"></a>8.6.2. Bulk Data Loading for <code class="literal">MyISAM</code> Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp50193680"></a><p>
        These performance tips supplement the general guidelines for
        fast inserts in <a class="xref" href="optimization.html#insert-speed" title="8.2.2.1. Speed of INSERT Statements">Section 8.2.2.1, “Speed of <code class="literal">INSERT</code> Statements”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To improve performance when multiple clients insert a lot of
            rows, use the <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a>
            statement. See <a class="xref" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax">Section 13.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>. This
            technique works for <code class="literal">MyISAM</code> and some other
            storage engines, but not <code class="literal">InnoDB</code>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
              As of MySQL 5.6.6, <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT
              DELAYED</code></a> is deprecated, and will be removed in a
              future release. Use <code class="literal">INSERT</code> (without
              <code class="literal">DELAYED</code>) instead.
</p>
</div>
</li><li class="listitem"><p>
            For a <code class="literal">MyISAM</code> table, you can use
            concurrent inserts to add rows at the same time that
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements are
            running, if there are no deleted rows in middle of the data
            file. See <a class="xref" href="optimization.html#concurrent-inserts" title="8.10.3. Concurrent Inserts">Section 8.10.3, “Concurrent Inserts”</a>.
          </p></li><li class="listitem"><p>
            With some extra work, it is possible to make
            <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> run even faster for a
            <code class="literal">MyISAM</code> table when the table has many
            indexes. Use the following procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Execute a <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
                TABLES</code></a> statement or a <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
                flush-tables</strong></span></a> command.
              </p></li><li class="listitem"><p>
                Use <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk --keys-used=0 -rq
                <em class="replaceable"><code>/path/to/db/tbl_name</code></em></strong></span></a>
                to remove all use of indexes for the table.
              </p></li><li class="listitem"><p>
                Insert data into the table with
                <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
                INFILE</code></a>. This does not update any indexes and
                therefore is very fast.
              </p></li><li class="listitem"><p>
                If you intend only to read from the table in the future,
                use <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> to compress it. See
                <a class="xref" href="storage-engines.html#compressed-format" title="14.3.3.3. Compressed Table Characteristics">Section 14.3.3.3, “Compressed Table Characteristics”</a>.
              </p></li><li class="listitem"><p>
                Re-create the indexes with <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk -rq
                <em class="replaceable"><code>/path/to/db/tbl_name</code></em></strong></span></a>.
                This creates the index tree in memory before writing it
                to disk, which is much faster that updating the index
                during <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD
                DATA INFILE</code></a> because it avoids lots of disk
                seeks. The resulting index tree is also perfectly
                balanced.
              </p></li><li class="listitem"><p>
                Execute a <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
                TABLES</code></a> statement or a <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
                flush-tables</strong></span></a> command.
</p></li></ol>
</div>
<p>
            <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> performs the preceding optimization
            automatically if the <code class="literal">MyISAM</code> table into
            which you insert data is empty. The main difference between
            automatic optimization and using the procedure explicitly is
            that you can let <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> allocate much
            more temporary memory for the index creation than you might
            want the server to allocate for index re-creation when it
            executes the <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA INFILE</code></a> statement.
          </p><p>
            You can also disable or enable the nonunique indexes for a
            <code class="literal">MyISAM</code> table by using the following
            statements rather than <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>. If you
            use these statements, you can skip the
            <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLE</code></a>
            operations:
          </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISABLE KEYS;
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENABLE KEYS;
</pre></li><li class="listitem"><p>
            To speed up <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> operations
            that are performed with multiple statements for
            nontransactional tables, lock your tables:
          </p><pre class="programlisting">LOCK TABLES a WRITE;
INSERT INTO a VALUES (1,23),(2,34),(4,33);
INSERT INTO a VALUES (8,26),(6,29);
...
UNLOCK TABLES;</pre><p>
            This benefits performance because the index buffer is
            flushed to disk only once, after all
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements have
            completed. Normally, there would be as many index buffer
            flushes as there are <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
            statements. Explicit locking statements are not needed if
            you can insert all rows with a single
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>.
          </p><p>
            Locking also lowers the total time for multiple-connection
            tests, although the maximum wait time for individual
            connections might go up because they wait for locks. Suppose
            that five clients attempt to perform inserts simultaneously
            as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Connection 1 does 1000 inserts
              </p></li><li class="listitem"><p>
                Connections 2, 3, and 4 do 1 insert
              </p></li><li class="listitem"><p>
                Connection 5 does 1000 inserts
</p></li></ul>
</div>
<p>
            If you do not use locking, connections 2, 3, and 4 finish
            before 1 and 5. If you use locking, connections 2, 3, and 4
            probably do not finish before 1 or 5, but the total time
            should be about 40% faster.
          </p><p>
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations are very
            fast in MySQL, but you can obtain better overall performance
            by adding locks around everything that does more than about
            five successive inserts or updates. If you do very many
            successive inserts, you could do a <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a> followed by an
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> once in a while (each 1,000 rows or so) to
            permit other threads to access table. This would still
            result in a nice performance gain.
          </p><p>
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> is still much slower
            for loading data than
            <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
            INFILE</code></a>, even when using the strategies just
            outlined.
          </p></li><li class="listitem"><p>
            To increase performance for <code class="literal">MyISAM</code>
            tables, for both
            <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> and <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            enlarge the key cache by increasing the
            <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
            variable. See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="repair-table-speed"></a>8.6.3. Speed of <code class="literal">REPAIR TABLE</code> Statements</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> for
        <code class="literal">MyISAM</code> tables is similar to using
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> for repair operations, and some of
        the same performance optimizations apply:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> has variables that control
            memory allocation. You may be able to its improve
            performance by setting these variables, as described in
            <a class="xref" href="programs.html#myisamchk-memory" title="4.6.3.6. myisamchk Memory Usage">Section 4.6.3.6, “<span class="command"><strong>myisamchk</strong></span> Memory Usage”</a>.
          </p></li><li class="listitem"><p>
            For <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>, the same
            principle applies, but because the repair is done by the
            server, you set server system variables instead of
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> variables. Also, in addition to
            setting memory-allocation variables, increasing the
            <a class="link" href="server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>
            system variable increases the likelihood that the repair
            will use the faster filesort method and avoid the slower
            repair by key cache method. Set the variable to the maximum
            file size for your system, after checking to be sure that
            there is enough free space to hold a copy of the table
            files. The free space must be available in the file system
            containing the original table files.
</p></li></ul>
</div>
<p>
        Suppose that a <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> table-repair
        operation is done using the following options to set its
        memory-allocation variables:
      </p><pre class="programlisting">--key_buffer_size=128M --myisam_sort_buffer_size=256M
--read_buffer_size=64M --write_buffer_size=64M</pre><p>
        Some of those <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> variables correspond
        to server system variables:
</p>
<div class="informaltable">
<table summary="This table lists myisamchk
variables and corresponding server system variables." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col"><a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> Variable</th><th scope="col">System Variable</th></tr></thead><tbody><tr><td scope="row"><code class="literal">key_buffer_size</code></td><td><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a></td></tr><tr><td scope="row"><code class="literal">myisam_sort_buffer_size</code></td><td><a class="link" href="server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a></td></tr><tr><td scope="row"><code class="literal">read_buffer_size</code></td><td><a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a></td></tr><tr><td scope="row"><code class="literal">write_buffer_size</code></td><td>none</td></tr></tbody></table>
</div>
<p>
        Each of the server system variables can be set at runtime, and
        some of them
        (<a class="link" href="server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a>,
        <a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>) have a
        session value in addition to a global value. Setting a session
        value limits the effect of the change to your current session
        and does not affect other users. Changing a global-only variable
        (<a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>,
        <a class="link" href="server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>)
        affects other users as well. For
        <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>, you must take
        into account that the buffer is shared with those users. For
        example, if you set the <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
        <code class="literal">key_buffer_size</code> variable to 128MB, you could
        set the corresponding
        <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system variable
        larger than that (if it is not already set larger), to permit
        key buffer use by activity in other sessions. However, changing
        the global key buffer size invalidates the buffer, causing
        increased disk I/O and slowdown for other sessions. An
        alternative that avoids this problem is to use a separate key
        cache, assign to it the indexes from the table to be repaired,
        and deallocate it when the repair is complete. See
        <a class="xref" href="optimization.html#multiple-key-caches" title="8.9.2.2. Multiple Key Caches">Section 8.9.2.2, “Multiple Key Caches”</a>.
      </p><p>
        Based on the preceding remarks, a <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR
        TABLE</code></a> operation can be done as follows to use settings
        similar to the <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> command. Here a
        separate 128MB key buffer is allocated and the file system is
        assumed to permit a file size of at least 100GB.
      </p><pre class="programlisting">SET SESSION myisam_sort_buffer_size = 256*1024*1024;
SET SESSION read_buffer_size = 64*1024*1024;
SET GLOBAL myisam_max_sort_file_size = 100*1024*1024*1024;
SET GLOBAL repair_cache.key_buffer_size = 128*1024*1024;
CACHE INDEX <em class="replaceable"><code>tbl_name</code></em> IN repair_cache;
LOAD INDEX INTO CACHE <em class="replaceable"><code>tbl_name</code></em>;
REPAIR TABLE <em class="replaceable"><code>tbl_name</code></em> ;
SET GLOBAL repair_cache.key_buffer_size = 0;
</pre><p>
        If you intend to change a global variable but want to do so only
        for the duration of a <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR
        TABLE</code></a> operation to minimally affect other users, save
        its value in a user variable and restore it afterward. For
        example:
      </p><pre class="programlisting">SET @old_myisam_sort_buffer_size = @@global.myisam_max_sort_file_size;
SET GLOBAL myisam_max_sort_file_size = 100*1024*1024*1024;
REPAIR TABLE tbl_name ;
SET GLOBAL myisam_max_sort_file_size = @old_myisam_max_sort_file_size;</pre><p>
        The system variables that affect <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR
        TABLE</code></a> can be set globally at server startup if you
        want the values to be in effect by default. For example, add
        these lines to the server <code class="filename">my.cnf</code> file:
      </p><pre class="programlisting">[mysqld]
myisam_sort_buffer_size=256M
key_buffer_size=1G
myisam_max_sort_file_size=100G</pre><p>
        These settings do not include
        <a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>. Setting
        <a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a> globally to a
        large value does so for all sessions and can cause performance
        to suffer due to excessive memory allocation for a server with
        many simultaneous sessions.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-memory-tables"></a>8.7. Optimizing for <code class="literal">MEMORY</code> Tables</h2>

</div>

</div>

</div>
<a class="indexterm" name="idp50307328"></a><p>
      Consider using <code class="literal">MEMORY</code> tables for noncritical
      data that is accessed often, and is read-only or rarely updated.
      Benchmark your application against equivalent
      <code class="literal">InnoDB</code> or <code class="literal">MyISAM</code> tables
      under a realistic workload, to confirm that any additional
      performance is worth the risk of losing data, or the overhead of
      copying data from a disk-based table at application start.
    </p><p>
      For best performance with <code class="literal">MEMORY</code> tables,
      examine the kinds of queries against each table, and specify the
      type to use for each associated index, either a B-tree index or a
      hash index. On the <a class="link" href="sql-syntax.html#create-index" title="13.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>
      statement, use the clause <code class="literal">USING BTREE</code> or
      <code class="literal">USING HASH</code>. B-tree indexes are fast for queries
      that do greater-than or less-than comparisons through operators
      such as <code class="literal">&gt;</code> or <code class="literal">BETWEEN</code>.
      Hash indexes are only fast for queries that look up single values
      through the <code class="literal">=</code> operator, or a restricted set of
      values through the <code class="literal">IN</code> operator. For why
      <code class="literal">USING BTREE</code> is often a better choice than the
      default <code class="literal">USING HASH</code>, see
      <a class="xref" href="optimization.html#how-to-avoid-table-scan" title="8.2.1.20. How to Avoid Full Table Scans">Section 8.2.1.20, “How to Avoid Full Table Scans”</a>. For implementation
      details of the different types of <code class="literal">MEMORY</code>
      indexes, see <a class="xref" href="optimization.html#index-btree-hash" title="8.3.8. Comparison of B-Tree and Hash Indexes">Section 8.3.8, “Comparison of B-Tree and Hash Indexes”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="execution-plan-information"></a>8.8. Understanding the Query Execution Plan</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#using-explain">8.8.1. Optimizing Queries with <code class="literal">EXPLAIN</code></a></span></dt><dt><span class="section"><a href="optimization.html#explain-output">8.8.2. <code class="literal">EXPLAIN</code> Output Format</a></span></dt><dt><span class="section"><a href="optimization.html#explain-extended">8.8.3. <code class="literal">EXPLAIN EXTENDED</code> Output Format</a></span></dt><dt><span class="section"><a href="optimization.html#estimating-performance">8.8.4. Estimating Query Performance</a></span></dt><dt><span class="section"><a href="optimization.html#controlling-optimizer">8.8.5. Controlling the Query Optimizer</a></span></dt></dl>
</div>
<p>
      Depending on the details of your tables, columns, indexes, and the
      conditions in your <code class="literal">WHERE</code> clause, the MySQL
      optimizer considers many techniques to efficiently perform the
      lookups involved in an SQL query. A query on a huge table can be
      performed without reading all the rows; a join involving several
      tables can be performed without comparing every combination of
      rows. The set of operations that the optimizer chooses to perform
      the most efficient query is called the <span class="quote">“<span class="quote">query execution
      plan</span>”</span>, also known as the
      <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> plan. Your goals are to
      recognize the aspects of the
      <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> plan that indicate a query
      is optimized well, and to learn the SQL syntax and indexing
      techniques to improve the plan if you see some inefficient
      operations.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="using-explain"></a>8.8.1. Optimizing Queries with <code class="literal">EXPLAIN</code></h3>
</div>
</div>
</div>
<a class="indexterm" name="idp50328128"></a><a class="indexterm" name="idp50329200"></a><p>
        The <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement can be used
        to obtain information about how MySQL executes a statement:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            As of MySQL 5.6.3, permitted explainable statements for
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> are
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a>, and
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>. Before MySQL 5.6.3,
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is the only
            explainable statement.
          </p></li><li class="listitem"><p>
            When <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> is used with an
            explainable statement, MySQL displays information from the
            optimizer about the statement execution plan. That is, MySQL
            explains how it would process the statement, including
            information about how tables are joined and in which order.
            For information about using
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> to obtain execution
            plan information, see <a class="xref" href="optimization.html#explain-output" title="8.8.2. EXPLAIN Output Format">Section 8.8.2, “<code class="literal">EXPLAIN</code> Output Format”</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN EXTENDED</code></a> can be used
            to obtain additional execution plan information. See
            <a class="xref" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format">Section 8.8.3, “<code class="literal">EXPLAIN EXTENDED</code> Output Format”</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
            PARTITIONS</code></a> is useful for examining queries
            involving partitioned tables. See
            <a class="xref" href="partitioning.html#partitioning-info" title="18.3.5. Obtaining Information About Partitions">Section 18.3.5, “Obtaining Information About Partitions”</a>.
          </p></li><li class="listitem"><p>
            As of MySQL 5.6.3, the <code class="literal">FORMAT</code> option can
            be used to select the output format.
            <code class="literal">TRADITIONAL</code> presents the output in
            tabular format. This is the default if no
            <code class="literal">FORMAT</code> option is present.
            <code class="literal">JSON</code> format displays the information in
            JSON format. With <code class="literal">FORMAT = JSON</code>, the
            output includes extended and partition information.
</p></li></ul>
</div>
<p>
        <a class="indexterm" name="idp50352976"></a>

        With the help of <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>, you can
        see where you should add indexes to tables so that the statement
        executes faster by using indexes to find rows. You can also use
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> to check whether the
        optimizer joins the tables in an optimal order. To give a hint
        to the optimizer to use a join order corresponding to the order
        in which the tables are named in a
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement, begin the
        statement with <code class="literal">SELECT STRAIGHT_JOIN</code> rather
        than just <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>. (See
        <a class="xref" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax">Section 13.2.9, “<code class="literal">SELECT</code> Syntax”</a>.)
      </p><p>
        If you have a problem with indexes not being used when you
        believe that they should be, run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
        TABLE</code></a> to update table statistics, such as cardinality
        of keys, that can affect the choices the optimizer makes. See
        <a class="xref" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax">Section 13.7.2.1, “<code class="literal">ANALYZE TABLE</code> Syntax”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> can also be used to
          obtain information about the columns in a table.
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
          <em class="replaceable"><code>tbl_name</code></em></code></a> is synonymous
          with <code class="literal">DESCRIBE
          <em class="replaceable"><code>tbl_name</code></em></code> and
          <code class="literal">SHOW COLUMNS FROM
          <em class="replaceable"><code>tbl_name</code></em></code>. For more
          information, see <a class="xref" href="sql-syntax.html#describe" title="13.8.1. DESCRIBE Syntax">Section 13.8.1, “<code class="literal">DESCRIBE</code> Syntax”</a>, and
          <a class="xref" href="sql-syntax.html#show-columns" title="13.7.5.6. SHOW COLUMNS Syntax">Section 13.7.5.6, “<code class="literal">SHOW COLUMNS</code> Syntax”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="explain-output"></a>8.8.2. <code class="literal">EXPLAIN</code> Output Format</h3>

</div>

</div>

</div>
<p>
        The <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement provides
        information about the execution plan for a
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement.
      </p><p>
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> returns a row of
        information for each table used in the
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement. It lists the
        tables in the output in the order that MySQL would read them
        while processing the statement. MySQL resolves all joins using a
        nested-loop join method. This means that MySQL reads a row from
        the first table, and then finds a matching row in the second
        table, the third table, and so on. When all tables are
        processed, MySQL outputs the selected columns and backtracks
        through the table list until a table is found for which there
        are more matching rows. The next row is read from this table and
        the process continues with the next table.
      </p><p>
        When the <code class="literal">EXTENDED</code> keyword is used,
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> produces extra
        information that can be viewed by issuing a
        <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> statement following
        the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement.
        <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN EXTENDED</code></a> also displays
        the <code class="literal">filtered</code> column. See
        <a class="xref" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format">Section 8.8.3, “<code class="literal">EXPLAIN EXTENDED</code> Output Format”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          You cannot use the <code class="literal">EXTENDED</code> and
          <code class="literal">PARTITIONS</code> keywords together in the same
          <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="optimization.html#explain-output-columns" title="8.8.2.  ???TITLE??? Output Columns"><code class="literal">EXPLAIN</code>
            Output Columns</a>
          </p></li><li class="listitem"><p>
            <a class="link" href="optimization.html#explain-join-types" title="8.8.2.  ???TITLE??? Join Types"><code class="literal">EXPLAIN</code>
            Join Types</a>
          </p></li><li class="listitem"><p>
            <a class="link" href="optimization.html#explain-extra-information" title="8.8.2.  ???TITLE??? Extra Information"><code class="literal">EXPLAIN</code>
            Extra Information</a>
          </p></li><li class="listitem"><p>
            <a class="link" href="optimization.html#explain-output-interpretation" title="8.8.2.  ???TITLE??? Output Interpretation"><code class="literal">EXPLAIN</code>
            Output Interpretation</a>
</p></li></ul>
</div>
<h4><a name="explain-output-columns"></a>
        <code class="literal">EXPLAIN</code> Output Columns
</h4>
<p>
        This section describes the output columns produced by
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>. Later sections provide
        additional information about the
        <a class="link" href="optimization.html#explain-join-types" title="8.8.2.  ???TITLE??? Join Types"><code class="literal">type</code></a>
        and
        <a class="link" href="optimization.html#explain-extra-information" title="8.8.2.  ???TITLE??? Extra Information"><code class="literal">Extra</code></a>
        columns.
      </p><p>
        Each output row from <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
        provides information about one table. Each row contains the
        values summarized in
        <a class="xref" href="optimization.html#explain-output-column-table" title="Table 8.1. EXPLAIN Output Columns">Table 8.1, “<code class="literal">EXPLAIN</code> Output Columns”</a>, and described in
        more detail following the table.
</p>
<div class="table">
<a name="explain-output-column-table"></a><p class="title"><b>Table 8.1. <code class="literal">EXPLAIN</code> Output Columns</b></p>
<div class="table-contents">
<table summary="EXPLAIN Output Columns" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column</th><th scope="col">Meaning</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="optimization.html#explain_id"><code class="literal">id</code></a></td><td>The <code class="literal">SELECT</code> identifier</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_select_type"><code class="literal">select_type</code></a></td><td>The <code class="literal">SELECT</code> type</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_table"><code class="literal">table</code></a></td><td>The table for the output row</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_partitions"><code class="literal">partitions</code></a></td><td>The matching partitions</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_type"><code class="literal">type</code></a></td><td>The join type</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_possible_keys"><code class="literal">possible_keys</code></a></td><td>The possible indexes to choose</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_key"><code class="literal">key</code></a></td><td>The index actually chosen</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_key_len"><code class="literal">key_len</code></a></td><td>The length of the chosen key</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_ref"><code class="literal">ref</code></a></td><td>The columns compared to the index</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_rows"><code class="literal">rows</code></a></td><td>Estimate of rows to be examined</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_filtered"><code class="literal">filtered</code></a></td><td>Percentage of rows filtered by table condition</td></tr><tr><td scope="row"><a class="link" href="optimization.html#explain_extra"><code class="literal">Extra</code></a></td><td>Additional information</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="explain_id"></a>
            <code class="literal">id</code>
          </p><p>
            The <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> identifier. This
            is the sequential number of the
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> within the query. The
            value can be <code class="literal">NULL</code> if the row refers to
            the union result of other rows. In this case, the
            <code class="literal">table</code> column shows a value like
            <code class="literal">&lt;union<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>N</code></em>&gt;</code>
            to indicate that the row refers to the union of the rows
            with <code class="literal">id</code> values of
            <em class="replaceable"><code>M</code></em> and
            <em class="replaceable"><code>N</code></em>.
          </p></li><li class="listitem"><p><a name="explain_select_type"></a>
            <code class="literal">select_type</code>
          </p><p>
            The type of <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, which can
            be any of those shown in the following table.
</p>
<div class="informaltable">
<table summary="This table lists select_type
              values and describes the meaning of each." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col"><code class="literal">select_type</code> Value</th><th scope="col">Meaning</th></tr></thead><tbody><tr><td scope="row"><code class="literal">SIMPLE</code></td><td>Simple <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> (not using
                    <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> or subqueries)</td></tr><tr><td scope="row"><code class="literal">PRIMARY</code></td><td>Outermost <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a></td></tr><tr><td scope="row"><a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a></td><td>Second or later <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement in a
                    <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a></td></tr><tr><td scope="row"><code class="literal">DEPENDENT UNION</code></td><td>Second or later <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement in a
                    <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a>, dependent on
                    outer query</td></tr><tr><td scope="row"><code class="literal">UNION RESULT</code></td><td>Result of a <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a>.</td></tr><tr><td scope="row"><code class="literal">SUBQUERY</code></td><td>First <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> in subquery</td></tr><tr><td scope="row"><code class="literal">DEPENDENT SUBQUERY</code></td><td>First <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> in subquery, dependent on
                    outer query</td></tr><tr><td scope="row"><code class="literal">DERIVED</code></td><td>Derived table <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> (subquery in
                    <code class="literal">FROM</code> clause)</td></tr><tr><td scope="row"><code class="literal">MATERIALIZED</code></td><td>Materialized subquery</td></tr><tr><td scope="row"><code class="literal">UNCACHEABLE SUBQUERY</code></td><td>A subquery for which the result cannot be cached and must be
                    re-evaluated for each row of the outer query</td></tr><tr><td scope="row"><code class="literal">UNCACHEABLE UNION</code></td><td>The second or later select in a <a class="link" href="sql-syntax.html#union" title="13.2.9.4. UNION Syntax"><code class="literal">UNION</code></a>
                    that belongs to an uncacheable subquery (see
<code class="literal">UNCACHEABLE SUBQUERY</code>)</td></tr></tbody></table>
</div>
<p>
            <code class="literal">DEPENDENT</code> typically signifies the use of
            a correlated subquery. See
            <a class="xref" href="sql-syntax.html#correlated-subqueries" title="13.2.10.7. Correlated Subqueries">Section 13.2.10.7, “Correlated Subqueries”</a>.
          </p><p>
            <code class="literal">DEPENDENT SUBQUERY</code> evaluation differs
            from <code class="literal">UNCACHEABLE SUBQUERY</code> evaluation. For
            <code class="literal">DEPENDENT SUBQUERY</code>, the subquery is
            re-evaluated only once for each set of different values of
            the variables from its outer context. For
            <code class="literal">UNCACHEABLE SUBQUERY</code>, the subquery is
            re-evaluated for each row of the outer context.
          </p><p>
            Cacheability of subqueries differs from caching of query
            results in the query cache (which is described in
            <a class="xref" href="optimization.html#query-cache-operation" title="8.9.3.1. How the Query Cache Operates">Section 8.9.3.1, “How the Query Cache Operates”</a>). Subquery caching
            occurs during query execution, whereas the query cache is
            used to store results only after query execution finishes.
          </p></li><li class="listitem"><p><a name="explain_table"></a>
            <code class="literal">table</code>
          </p><p>
            The name of the table to which the row of output refers.
            This can also be one of the following values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">&lt;union<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>N</code></em>&gt;</code>:
                The row refers to the union of the rows with
                <code class="literal">id</code> values of
                <em class="replaceable"><code>M</code></em> and
                <em class="replaceable"><code>N</code></em>.
              </p></li><li class="listitem"><p>
                <code class="literal">&lt;derived<em class="replaceable"><code>N</code></em>&gt;</code>:
                The row refers to the derived table result for the row
                with an <code class="literal">id</code> value of
                <em class="replaceable"><code>N</code></em>. A derived table may
                result, for example, from a subquery in the
                <code class="literal">FROM</code> clause.
              </p></li><li class="listitem"><p>
                <code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code>:
                The row refers to the result of a materialized subquery
                for the row with an <code class="literal">id</code> value of
                <em class="replaceable"><code>N</code></em>. See
                <a class="xref" href="optimization.html#subquery-materialization" title="8.2.1.18.2. Optimizing Subqueries with Subquery Materialization">Section 8.2.1.18.2, “Optimizing Subqueries with Subquery Materialization”</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="explain_partitions"></a>
            <code class="literal">partitions</code>
          </p><p>
            The partitions from which records would be matched by the
            query. This column is displayed only if the
            <code class="literal">PARTITIONS</code> keyword is used. The value is
            <code class="literal">NULL</code> for nonpartitioned tables. See
            <a class="xref" href="partitioning.html#partitioning-info" title="18.3.5. Obtaining Information About Partitions">Section 18.3.5, “Obtaining Information About Partitions”</a>.
          </p></li><li class="listitem"><p><a name="explain_type"></a>
            <code class="literal">type</code>
          </p><p>
            The join type. For descriptions of the different types, see
            <a class="link" href="optimization.html#explain-join-types" title="8.8.2.  ???TITLE??? Join Types"><code class="literal">EXPLAIN</code>
            Join Types</a>.
          </p></li><li class="listitem"><p><a name="explain_possible_keys"></a>
            <code class="literal">possible_keys</code>
          </p><p>
            The <code class="literal">possible_keys</code> column indicates which
            indexes MySQL can choose from use to find the rows in this
            table. Note that this column is totally independent of the
            order of the tables as displayed in the output from
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>. That means that some
            of the keys in <code class="literal">possible_keys</code> might not be
            usable in practice with the generated table order.
          </p><p>
            If this column is <code class="literal">NULL</code>, there are no
            relevant indexes. In this case, you may be able to improve
            the performance of your query by examining the
            <code class="literal">WHERE</code> clause to check whether it refers
            to some column or columns that would be suitable for
            indexing. If so, create an appropriate index and check the
            query with <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> again. See
            <a class="xref" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax">Section 13.1.7, “<code class="literal">ALTER TABLE</code> Syntax”</a>.
          </p><p>
            To see what indexes a table has, use <code class="literal">SHOW INDEX
            FROM <em class="replaceable"><code>tbl_name</code></em></code>.
          </p></li><li class="listitem"><p><a name="explain_key"></a>
            <code class="literal">key</code>
          </p><p>
            The <code class="literal">key</code> column indicates the key (index)
            that MySQL actually decided to use. If MySQL decides to use
            one of the <code class="literal">possible_keys</code> indexes to look
            up rows, that index is listed as the key value.
          </p><p>
            It is possible that <code class="literal">key</code> will name an
            index that is not present in the
            <code class="literal">possible_keys</code> value. This can happen if
            none of the <code class="literal">possible_keys</code> indexes are
            suitable for looking up rows, but all the columns selected
            by the query are columns of some other index. That is, the
            named index covers the selected columns, so although it is
            not used to determine which rows to retrieve, an index scan
            is more efficient than a data row scan.
          </p><p>
            For <code class="literal">InnoDB</code>, a secondary index might cover
            the selected columns even if the query also selects the
            primary key because <code class="literal">InnoDB</code> stores the
            primary key value with each secondary index. If
            <code class="literal">key</code> is <code class="literal">NULL</code>, MySQL
            found no index to use for executing the query more
            efficiently.
          </p><p>
            To force MySQL to use or ignore an index listed in the
            <code class="literal">possible_keys</code> column, use <code class="literal">FORCE
            INDEX</code>, <code class="literal">USE INDEX</code>, or
            <code class="literal">IGNORE INDEX</code> in your query. See
            <a class="xref" href="sql-syntax.html#index-hints" title="13.2.9.3. Index Hint Syntax">Section 13.2.9.3, “Index Hint Syntax”</a>.
          </p><p>
            For <code class="literal">MyISAM</code> and <code class="literal">NDB</code>
            tables, running <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
            helps the optimizer choose better indexes. For
            <code class="literal">NDB</code> tables, this also improves
            performance of distributed pushed-down joins. For
            <code class="literal">MyISAM</code> tables, <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk
            --analyze</strong></span></a> does the same as
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. See
            <a class="xref" href="backup-and-recovery.html#myisam-table-maintenance" title="7.6. MyISAM Table Maintenance and Crash Recovery">Section 7.6, “<code class="literal">MyISAM</code> Table Maintenance and Crash Recovery”</a>.
          </p></li><li class="listitem"><p><a name="explain_key_len"></a>
            <code class="literal">key_len</code>
          </p><p>
            The <code class="literal">key_len</code> column indicates the length
            of the key that MySQL decided to use. The length is
            <code class="literal">NULL</code> if the <code class="literal">key</code> column
            says <code class="literal">NULL</code>. Note that the value of
            <code class="literal">key_len</code> enables you to determine how many
            parts of a multiple-part key MySQL actually uses.
          </p></li><li class="listitem"><p><a name="explain_ref"></a>
            <code class="literal">ref</code>
          </p><p>
            The <code class="literal">ref</code> column shows which columns or
            constants are compared to the index named in the
            <code class="literal">key</code> column to select rows from the table.
          </p></li><li class="listitem"><p><a name="explain_rows"></a>
            <code class="literal">rows</code>
          </p><p>
            The <code class="literal">rows</code> column indicates the number of
            rows MySQL believes it must examine to execute the query.
          </p><p>
            For <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables, this number
            is an estimate, and may not always be exact.
          </p></li><li class="listitem"><p><a name="explain_filtered"></a>
            <code class="literal">filtered</code>
          </p><p>
            The <code class="literal">filtered</code> column indicates an
            estimated percentage of table rows that will be filtered by
            the table condition. That is, <code class="literal">rows</code> shows
            the estimated number of rows examined and
            <code class="literal">rows</code> × <code class="literal">filtered</code>
            / <code class="literal">100</code> shows the number of rows that will
            be joined with previous tables. This column is displayed if
            you use <a class="link" href="optimization.html#explain-extended" title="8.8.3. EXPLAIN EXTENDED Output Format"><code class="literal">EXPLAIN EXTENDED</code></a>.
          </p></li><li class="listitem"><p><a name="explain_extra"></a>
            <code class="literal">Extra</code>
          </p><p>
            This column contains additional information about how MySQL
            resolves the query. For descriptions of the different
            values, see
            <a class="link" href="optimization.html#explain-extra-information" title="8.8.2.  ???TITLE??? Extra Information"><code class="literal">EXPLAIN</code>
            Extra Information</a>.
</p></li></ul>
</div>
<h4><a name="explain-join-types"></a>
        <code class="literal">EXPLAIN</code> Join Types
</h4>
<p>
        The <code class="literal">type</code> column of
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output describes how
        tables are joined. The following list describes the join types,
        ordered from the best type to the worst:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="jointype_system"></a>
            <a class="indexterm" name="idp50564592"></a>

            <a class="indexterm" name="idp50566080"></a>

            <a class="indexterm" name="idp50567568"></a>

            <a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>
          </p><p>
            The table has only one row (= system table). This is a
            special case of the <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
            join type.
          </p></li><li class="listitem"><p><a name="jointype_const"></a>
            <a class="indexterm" name="idp50572272"></a>

            <a class="indexterm" name="idp50573760"></a>

            <a class="indexterm" name="idp50575248"></a>

            <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
          </p><p>
            The table has at most one matching row, which is read at the
            start of the query. Because there is only one row, values
            from the column in this row can be regarded as constants by
            the rest of the optimizer.
            <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a> tables are very
            fast because they are read only once.
          </p><p>
            <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a> is used when you
            compare all parts of a <code class="literal">PRIMARY KEY</code> or
            <code class="literal">UNIQUE</code> index to constant values. In the
            following queries, <em class="replaceable"><code>tbl_name</code></em> can
            be used as a <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a> table:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>primary_key</code></em>=1;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>primary_key_part1</code></em>=1 AND <em class="replaceable"><code>primary_key_part2</code></em>=2;
</pre></li><li class="listitem"><p><a name="jointype_eq_ref"></a>
            <a class="indexterm" name="idp50587168"></a>

            <a class="indexterm" name="idp50588656"></a>

            <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
          </p><p>
            One row is read from this table for each combination of rows
            from the previous tables. Other than the
            <a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a> and
            <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a> types, this is the
            best possible join type. It is used when all parts of an
            index are used by the join and the index is a
            <code class="literal">PRIMARY KEY</code> or <code class="literal">UNIQUE NOT
            NULL</code> index.
          </p><p>
            <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a> can be used for
            indexed columns that are compared using the
            <code class="literal">=</code> operator. The comparison value can be a
            constant or an expression that uses columns from tables that
            are read before this table. In the following examples, MySQL
            can use an <a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a> join to
            process <em class="replaceable"><code>ref_table</code></em>:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>;

SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part1</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>
  AND <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part2</code></em>=1;
</pre></li><li class="listitem"><p><a name="jointype_ref"></a>
            <a class="indexterm" name="idp50606000"></a>

            <a class="indexterm" name="idp50607456"></a>

            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
          </p><p>
            All rows with matching index values are read from this table
            for each combination of rows from the previous tables.
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> is used if the join
            uses only a leftmost prefix of the key or if the key is not
            a <code class="literal">PRIMARY KEY</code> or
            <code class="literal">UNIQUE</code> index (in other words, if the join
            cannot select a single row based on the key value). If the
            key that is used matches only a few rows, this is a good
            join type.
          </p><p>
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> can be used for
            indexed columns that are compared using the
            <code class="literal">=</code> or <code class="literal">&lt;=&gt;</code>
            operator. In the following examples, MySQL can use a
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a> join to process
            <em class="replaceable"><code>ref_table</code></em>:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>ref_table</code></em> WHERE <em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>expr</code></em>;

SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>;

SELECT * FROM <em class="replaceable"><code>ref_table</code></em>,<em class="replaceable"><code>other_table</code></em>
  WHERE <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part1</code></em>=<em class="replaceable"><code>other_table</code></em>.<em class="replaceable"><code>column</code></em>
  AND <em class="replaceable"><code>ref_table</code></em>.<em class="replaceable"><code>key_column_part2</code></em>=1;
</pre></li><li class="listitem"><p><a name="jointype_fulltext"></a>
            <a class="indexterm" name="idp50626736"></a>

            <a class="indexterm" name="idp50628224"></a>

            <a class="link" href="optimization.html#jointype_fulltext"><code class="literal">fulltext</code></a>
          </p><p>
            The join is performed using a <code class="literal">FULLTEXT</code>
            index.
          </p></li><li class="listitem"><p><a name="jointype_ref_or_null"></a>
            <a class="indexterm" name="idp50632752"></a>

            <a class="indexterm" name="idp50634240"></a>

            <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
          </p><p>
            This join type is like
            <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>, but with the
            addition that MySQL does an extra search for rows that
            contain <code class="literal">NULL</code> values. This join type
            optimization is used most often in resolving subqueries. In
            the following examples, MySQL can use a
            <a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a> join to
            process <em class="replaceable"><code>ref_table</code></em>:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>ref_table</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em>=<em class="replaceable"><code>expr</code></em> OR <em class="replaceable"><code>key_column</code></em> IS NULL;
</pre><p>
            See <a class="xref" href="optimization.html#is-null-optimization" title="8.2.1.8. IS NULL Optimization">Section 8.2.1.8, “<code class="literal">IS NULL</code> Optimization”</a>.
          </p></li><li class="listitem"><p><a name="jointype_index_merge"></a>
            <a class="indexterm" name="idp50644528"></a>

            <a class="indexterm" name="idp50646016"></a>

            <a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
          </p><p>
            This join type indicates that the Index Merge optimization
            is used. In this case, the <code class="literal">key</code> column in
            the output row contains a list of indexes used, and
            <code class="literal">key_len</code> contains a list of the longest
            key parts for the indexes used. For more information, see
            <a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">Section 8.2.1.4, “Index Merge Optimization”</a>.
          </p></li><li class="listitem"><p><a name="jointype_unique_subquery"></a>
            <a class="indexterm" name="idp50652032"></a>

            <a class="indexterm" name="idp50653520"></a>

            <a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
          </p><p>
            This type replaces <a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
            for some <code class="literal">IN</code> subqueries of the following
            form:
          </p><pre class="programlisting"><em class="replaceable"><code>value</code></em> IN (SELECT <em class="replaceable"><code>primary_key</code></em> FROM <em class="replaceable"><code>single_table</code></em> WHERE <em class="replaceable"><code>some_expr</code></em>)
</pre><p>
            <a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a> is just
            an index lookup function that replaces the subquery
            completely for better efficiency.
          </p></li><li class="listitem"><p><a name="jointype_index_subquery"></a>
            <a class="indexterm" name="idp50662528"></a>

            <a class="indexterm" name="idp50664016"></a>

            <a class="link" href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
          </p><p>
            This join type is similar to
            <a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>. It
            replaces <code class="literal">IN</code> subqueries, but it works for
            nonunique indexes in subqueries of the following form:
          </p><pre class="programlisting"><em class="replaceable"><code>value</code></em> IN (SELECT <em class="replaceable"><code>key_column</code></em> FROM <em class="replaceable"><code>single_table</code></em> WHERE <em class="replaceable"><code>some_expr</code></em>)
</pre></li><li class="listitem"><p><a name="jointype_range"></a>
            <a class="indexterm" name="idp50671776"></a>

            <a class="indexterm" name="idp50673264"></a>

            <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
          </p><p>
            Only rows that are in a given range are retrieved, using an
            index to select the rows. The <code class="literal">key</code> column
            in the output row indicates which index is used. The
            <code class="literal">key_len</code> contains the longest key part
            that was used. The <code class="literal">ref</code> column is
            <code class="literal">NULL</code> for this type.
          </p><p>
            <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a> can be used when a
            key column is compared to a constant using any of the
            <a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>,
            <a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>,
            <a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>,
            <a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>,
            <a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>,
            <a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>,
            <a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>,
            <a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>,
            <a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>, or
            <a class="link" href="functions.html#function_in"><code class="literal">IN()</code></a> operators:
          </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em> = 10;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em> BETWEEN 10 and 20;

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_column</code></em> IN (10,20,30);

SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE <em class="replaceable"><code>key_part1</code></em> = 10 AND <em class="replaceable"><code>key_part2</code></em> IN (10,20,30);
</pre></li><li class="listitem"><p><a name="jointype_index"></a>
            <a class="indexterm" name="idp50694608"></a>

            <a class="indexterm" name="idp50696096"></a>

            <a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
          </p><p>
            The <code class="literal">index</code> join type is the same as
            <code class="literal">ALL</code>, except that the
            index tree is scanned. This occurs two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If the index is a covering index for the queries and can
                be used to satisfy all data required from the table,
                only the index tree is scanned. In this case, the
                <code class="literal">Extra</code> column says <code class="literal">Using
                index</code>. An index-only scan usually is faster
                than <code class="literal">ALL</code> because
                the size of the index usually is smaller than the table
                data.
              </p></li><li class="listitem"><p>
                A full table scan is performed using reads from the
                index to look up data rows in index order. <code class="literal">Uses
                index</code> does not appear in the
                <code class="literal">Extra</code> column.
</p></li></ul>
</div>
<p>
            MySQL can use this join type when the query uses only
            columns that are part of a single index.
          </p></li><li class="listitem"><p><a name="jointype_all"></a>
            <a class="indexterm" name="idp50708496"></a>

            <a class="indexterm" name="idp50709952"></a>

            <code class="literal">ALL</code>
          </p><p>
            A full table scan is done for each combination of rows from
            the previous tables. This is normally not good if the table
            is the first table not marked
            <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>, and usually
            <span class="emphasis"><em>very</em></span> bad in all other cases. Normally,
            you can avoid <code class="literal">ALL</code> by
            adding indexes that enable row retrieval from the table
            based on constant values or column values from earlier
            tables.
</p></li></ul>
</div>
<h4><a name="explain-extra-information"></a>
        <code class="literal">EXPLAIN</code> Extra Information
</h4>
<p>
        The <code class="literal">Extra</code> column of
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output contains
        additional information about how MySQL resolves the query. The
        following list explains the values that can appear in this
        column. If you want to make your queries as fast as possible,
        look out for <code class="literal">Extra</code> values of <code class="literal">Using
        filesort</code> and <code class="literal">Using temporary</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Child of '<em class="replaceable"><code>table</code></em>' pushed
            join@1</code>
          </p><p>
            This table is referenced as the child of
            <em class="replaceable"><code>table</code></em> in a join that can be
            pushed down to the NDB kernel. Applies only in MySQL
            Cluster, when pushed-down joins are enabled. See the
            description of the
            <a class="link" href="mysql-cluster.html#sysvar_ndb_join_pushdown"><code class="literal">ndb_join_pushdown</code></a> server
            system variable for more information and examples.
          </p></li><li class="listitem"><p>
            <code class="literal">const row not found</code>
          </p><p>
            For a query such as <code class="literal">SELECT ... FROM
            <em class="replaceable"><code>tbl_name</code></em></code>, the table was
            empty.
          </p></li><li class="listitem"><p>
            <code class="literal">Deleting all rows</code>
          </p><p>
            For <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>, some storage
            engines (such as <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>)
            support a handler method that removes all table rows in a
            simple and fast way. This <code class="literal">Extra</code> value is
            displayed if the engine uses this optimization.
          </p></li><li class="listitem"><p>
            <code class="literal">Distinct</code>
          </p><p>
            MySQL is looking for distinct values, so it stops searching
            for more rows for the current row combination after it has
            found the first matching row.
          </p></li><li class="listitem"><p>
            <code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code>
          </p><p>
            The semi-join FirstMatch join shortcutting strategy is used
            for <em class="replaceable"><code>tbl_name</code></em>.
          </p></li><li class="listitem"><p>
            <code class="literal">Full scan on NULL key</code>
          </p><p>
            This occurs for subquery optimization as a fallback strategy
            when the optimizer cannot use an index-lookup access method.
          </p></li><li class="listitem"><p>
            <code class="literal">Impossible HAVING</code>
          </p><p>
            The <code class="literal">HAVING</code> clause is always false and
            cannot select any rows.
          </p></li><li class="listitem"><p>
            <code class="literal">Impossible WHERE</code>
          </p><p>
            The <code class="literal">WHERE</code> clause is always false and
            cannot select any rows.
          </p></li><li class="listitem"><p>
            <code class="literal">Impossible WHERE noticed after reading const
            tables</code>
          </p><p>
            MySQL has read all <a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
            (and <a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>) tables and
            notice that the <code class="literal">WHERE</code> clause is always
            false.
          </p></li><li class="listitem"><p>
            <code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code>
          </p><p>
            The semi-join LooseScan strategy is used.
            <em class="replaceable"><code>m</code></em> and
            <em class="replaceable"><code>n</code></em> are key part numbers.
          </p></li><li class="listitem"><p>
            <code class="literal">Materialize</code>, <code class="literal">Scan</code>
          </p><p>
            Before MySQL 5.6.7, this indicates use of a single
            materialized temporary table. If <code class="literal">Scan</code> is
            present, no temporary table index is used for table reads.
            Otherwise, an index lookup is used. See also the
            <code class="literal">Start materialize</code> entry.
          </p><p>
            As of MySQL 5.6.7, materialization is indicated by rows with
            a <code class="literal">select_type</code> value of
            <code class="literal">MATERIALIZED</code> and rows with a
            <code class="literal">table</code> value of
            <code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">No matching min/max row</code>
          </p><p>
            No row satisfies the condition for a query such as
            <code class="literal">SELECT MIN(...) FROM ... WHERE
            <em class="replaceable"><code>condition</code></em></code>.
          </p></li><li class="listitem"><p>
            <code class="literal">no matching row in const table</code>
          </p><p>
            For a query with a join, there was an empty table or a table
            with no rows satisfying a unique index condition.
          </p></li><li class="listitem"><p>
            <code class="literal">No matching rows after partition pruning</code>
          </p><p>
            For <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> or
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, the optimizer found
            nothing to delete or update after partition pruning. It is
            similar in meaning to <code class="literal">Impossible WHERE</code>
            for <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements.
          </p></li><li class="listitem"><p>
            <code class="literal">No tables used</code>
          </p><p>
            The query has no <code class="literal">FROM</code> clause, or has a
            <code class="literal">FROM DUAL</code> clause.
          </p><p>
            For <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> or
            <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> statements,
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> displays this value
            when there is no <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> part.
            For example, it appears for <code class="literal">EXPLAIN INSERT INTO t
            VALUES(10)</code> because that is equivalent to
            <code class="literal">EXPLAIN INSERT INTO t SELECT 10 FROM
            DUAL</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">Not exists</code>
          </p><p>
            MySQL was able to do a <code class="literal">LEFT JOIN</code>
            optimization on the query and does not examine more rows in
            this table for the previous row combination after it finds
            one row that matches the <code class="literal">LEFT JOIN</code>
            criteria. Here is an example of the type of query that can
            be optimized this way:
          </p><pre class="programlisting">SELECT * FROM t1 LEFT JOIN t2 ON t1.id=t2.id
  WHERE t2.id IS NULL;</pre><p>
            Assume that <code class="literal">t2.id</code> is defined as
            <code class="literal">NOT NULL</code>. In this case, MySQL scans
            <code class="literal">t1</code> and looks up the rows in
            <code class="literal">t2</code> using the values of
            <code class="literal">t1.id</code>. If MySQL finds a matching row in
            <code class="literal">t2</code>, it knows that
            <code class="literal">t2.id</code> can never be
            <code class="literal">NULL</code>, and does not scan through the rest
            of the rows in <code class="literal">t2</code> that have the same
            <code class="literal">id</code> value. In other words, for each row in
            <code class="literal">t1</code>, MySQL needs to do only a single
            lookup in <code class="literal">t2</code>, regardless of how many rows
            actually match in <code class="literal">t2</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">Range checked for each record (index map:
            <em class="replaceable"><code>N</code></em>)</code>
          </p><p>
            MySQL found no good index to use, but found that some of
            indexes might be used after column values from preceding
            tables are known. For each row combination in the preceding
            tables, MySQL checks whether it is possible to use a
            <a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a> or
            <a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a> access method
            to retrieve rows. This is not very fast, but is faster than
            performing a join with no index at all. The applicability
            criteria are as described in
            <a class="xref" href="optimization.html#range-optimization" title="8.2.1.3. Range Optimization">Section 8.2.1.3, “Range Optimization”</a>, and
            <a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">Section 8.2.1.4, “Index Merge Optimization”</a>, with the
            exception that all column values for the preceding table are
            known and considered to be constants.
          </p><p>
            Indexes are numbered beginning with 1, in the same order as
            shown by <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> for the
            table. The index map value <em class="replaceable"><code>N</code></em> is a
            bitmask value that indicates which indexes are candidates.
            For example, a value of <code class="literal">0x19</code> (binary
            11001) means that indexes 1, 4, and 5 will be considered.
          </p></li><li class="listitem"><p>
            <code class="literal">Scanned <em class="replaceable"><code>N</code></em>
            databases</code>
          </p><p>
            This indicates how many directory scans the server performs
            when processing a query for
            <code class="literal">INFORMATION_SCHEMA</code> tables, as described
            in <a class="xref" href="optimization.html#information-schema-optimization" title="8.2.4. Optimizing INFORMATION_SCHEMA Queries">Section 8.2.4, “Optimizing <code class="literal">INFORMATION_SCHEMA</code> Queries”</a>. The
            value of <em class="replaceable"><code>N</code></em> can be 0, 1, or
            <code class="literal">all</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">Select tables optimized away</code>
          </p><p>
            The query contained only aggregate functions
            (<a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>,
            <a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>) that were all resolved
            using an index, or <a class="link" href="functions.html#function_count"><code class="literal">COUNT(*)</code></a>
            for <code class="literal">MyISAM</code>, and no <code class="literal">GROUP
            BY</code> clause. The optimizer determined that only one
            row should be returned.
          </p></li><li class="listitem"><p>
            <code class="literal">Skip_open_table</code>,
            <code class="literal">Open_frm_only</code>,
            <code class="literal">Open_trigger_only</code>,
            <code class="literal">Open_full_table</code>
          </p><p>
            These values indicate file-opening optimizations that apply
            to queries for <code class="literal">INFORMATION_SCHEMA</code> tables,
            as described in
            <a class="xref" href="optimization.html#information-schema-optimization" title="8.2.4. Optimizing INFORMATION_SCHEMA Queries">Section 8.2.4, “Optimizing <code class="literal">INFORMATION_SCHEMA</code> Queries”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">Skip_open_table</code>: Table files do not
                need to be opened. The information has already become
                available within the query by scanning the database
                directory.
              </p></li><li class="listitem"><p>
                <code class="literal">Open_frm_only</code>: Only the table's
                <code class="filename">.frm</code> file need be opened.
              </p></li><li class="listitem"><p>
                <code class="literal">Open_trigger_only</code>: Only the table's
                <code class="filename">.TRG</code> file need be opened.
              </p></li><li class="listitem"><p>
                <code class="literal">Open_full_table</code>: The unoptimized
                information lookup. The <code class="filename">.frm</code>,
                <code class="filename">.MYD</code>, and <code class="filename">.MYI</code>
                files must be opened.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            <code class="literal">Start materialize</code>, <code class="literal">End
            materialize</code>, <code class="literal">Scan</code>
          </p><p>
            Before MySQL 5.6.7, this indicates use of multiple
            materialized temporary tables. If <code class="literal">Scan</code> is
            present, no temporary table index is used for table reads.
            Otherwise, an index lookup is used. See also the
            <code class="literal">Materialize</code> entry.
          </p><p>
            As of MySQL 5.6.7, materialization is indicated by rows with
            a <code class="literal">select_type</code> value of
            <code class="literal">MATERIALIZED</code> and rows with a
            <code class="literal">table</code> value of
            <code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">Start temporary</code>, <code class="literal">End
            temporary</code>
          </p><p>
            This indicates temporary table use for the semi-join
            Duplicate Weedout strategy.
          </p></li><li class="listitem"><p>
            <code class="literal">unique row not found</code>
          </p><p>
            For a query such as <code class="literal">SELECT ... FROM
            <em class="replaceable"><code>tbl_name</code></em></code>, no rows
            satisfy the condition for a <code class="literal">UNIQUE</code> index
            or <code class="literal">PRIMARY KEY</code> on the table.
          </p></li><li class="listitem"><p>
            <code class="literal">Using filesort</code>
          </p><p>
            MySQL must do an extra pass to find out how to retrieve the
            rows in sorted order. The sort is done by going through all
            rows according to the join type and storing the sort key and
            pointer to the row for all rows that match the
            <code class="literal">WHERE</code> clause. The keys then are sorted
            and the rows are retrieved in sorted order. See
            <a class="xref" href="optimization.html#order-by-optimization" title="8.2.1.15. ORDER BY Optimization">Section 8.2.1.15, “<code class="literal">ORDER BY</code> Optimization”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using index</code>
          </p><p>
            The column information is retrieved from the table using
            only information in the index tree without having to do an
            additional seek to read the actual row. This strategy can be
            used when the query uses only columns that are part of a
            single index.
          </p><p>
            If the <code class="literal">Extra</code> column also says
            <code class="literal">Using where</code>, it means the index is being
            used to perform lookups of key values. Without
            <code class="literal">Using where</code>, the optimizer may be reading
            the index to avoid reading data rows but not using it for
            lookups. For example, if the index is a covering index for
            the query, the optimizer may scan it without using it for
            lookups.
          </p><p>
            For <code class="literal">InnoDB</code> tables that have a
            user-defined clustered index, that index can be used even
            when <code class="literal">Using index</code> is absent from the
            <code class="literal">Extra</code> column. This is the case if
            <code class="literal">type</code> is
            <a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a> and
            <code class="literal">key</code> is <code class="literal">PRIMARY</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using index condition</code>
          </p><p>
            Tables are read by accessing index tuples and testing them
            first to determine whether to read full table rows. In this
            way, index information is used to defer (<span class="quote">“<span class="quote">push
            down</span>”</span>) reading full table rows unless it is
            necessary. See
            <a class="xref" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.6. Index Condition Pushdown Optimization">Section 8.2.1.6, “Index Condition Pushdown Optimization”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using index for group-by</code>
          </p><p>
            Similar to the <code class="literal">Using index</code> table access
            method, <code class="literal">Using index for group-by</code>
            indicates that MySQL found an index that can be used to
            retrieve all columns of a <code class="literal">GROUP BY</code> or
            <code class="literal">DISTINCT</code> query without any extra disk
            access to the actual table. Additionally, the index is used
            in the most efficient way so that for each group, only a few
            index entries are read. For details, see
            <a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16. GROUP BY Optimization">Section 8.2.1.16, “<code class="literal">GROUP BY</code> Optimization”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using join buffer (Block Nested Loop)</code>,
            <code class="literal">Using join buffer (Batched Key Access)</code>
          </p><p>
            Tables from earlier joins are read in portions into the join
            buffer, and then their rows are used from the buffer to
            perform the join with the current table. <code class="literal">(Block
            Nested Loop)</code> indicates use of the Block
            Nested-Loop algorithm and <code class="literal">(Batched Key
            Access)</code> indicates use of the Batched Key Access
            algorithm. That is, the keys from the table on the preceding
            line of the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output
            will be buffered, and the matching rows will be fetched in
            batches from the table represented by the line in which
            <code class="literal">Using join buffer</code> appears.
          </p></li><li class="listitem"><p>
            <code class="literal">Using MRR</code>
          </p><p>
            Tables are read using the Multi-Range Read optimization
            strategy. See <a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.13. Multi-Range Read Optimization">Section 8.2.1.13, “Multi-Range Read Optimization”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using sort_union(...)</code>, <code class="literal">Using
            union(...)</code>, <code class="literal">Using
            intersect(...)</code>
          </p><p>
            These indicate how index scans are merged for the
            <a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a> join type.
            See <a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">Section 8.2.1.4, “Index Merge Optimization”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using temporary</code>
          </p><p>
            To resolve the query, MySQL needs to create a temporary
            table to hold the result. This typically happens if the
            query contains <code class="literal">GROUP BY</code> and
            <code class="literal">ORDER BY</code> clauses that list columns
            differently.
          </p></li><li class="listitem"><p>
            <code class="literal">Using where</code>
          </p><p>
            A <code class="literal">WHERE</code> clause is used to restrict which
            rows to match against the next table or send to the client.
            Unless you specifically intend to fetch or examine all rows
            from the table, you may have something wrong in your query
            if the <code class="literal">Extra</code> value is not <code class="literal">Using
            where</code> and the table join type is
            <code class="literal">ALL</code> or
            <a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Using where with pushed condition</code>
          </p><p>
            This item applies to <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a> tables
            <span class="emphasis"><em>only</em></span>. It means that MySQL Cluster is
            using the Condition Pushdown optimization to improve the
            efficiency of a direct comparison between a nonindexed
            column and a constant. In such cases, the condition is
            <span class="quote">“<span class="quote">pushed down</span>”</span> to the cluster's data nodes
            and is evaluated on all data nodes simultaneously. This
            eliminates the need to send nonmatching rows over the
            network, and can speed up such queries by a factor of 5 to
            10 times over cases where Condition Pushdown could be but is
            not used. For more information, see
            <a class="xref" href="optimization.html#condition-pushdown-optimization" title="8.2.1.5. Engine Condition Pushdown Optimization">Section 8.2.1.5, “Engine Condition Pushdown Optimization”</a>.
</p></li></ul>
</div>
<h4><a name="explain-output-interpretation"></a>
        <code class="literal">EXPLAIN</code> Output Interpretation
</h4>
<p>
        You can get a good indication of how good a join is by taking
        the product of the values in the <code class="literal">rows</code> column
        of the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output. This
        should tell you roughly how many rows MySQL must examine to
        execute the query. If you restrict queries with the
        <a class="link" href="server-administration.html#sysvar_max_join_size"><code class="literal">max_join_size</code></a> system variable,
        this row product also is used to determine which multiple-table
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements to execute and
        which to abort. See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
      </p><p>
        The following example shows how a multiple-table join can be
        optimized progressively based on the information provided by
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>.
      </p><p>
        Suppose that you have the <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
        statement shown here and that you plan to examine it using
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>:
      </p><pre class="programlisting">EXPLAIN SELECT tt.TicketNumber, tt.TimeIn,
               tt.ProjectReference, tt.EstimatedShipDate,
               tt.ActualShipDate, tt.ClientID,
               tt.ServiceCodes, tt.RepetitiveID,
               tt.CurrentProcess, tt.CurrentDPPerson,
               tt.RecordVolume, tt.DPPrinted, et.COUNTRY,
               et_1.COUNTRY, do.CUSTNAME
        FROM tt, et, et AS et_1, do
        WHERE tt.SubmitTime IS NULL
          AND tt.ActualPC = et.EMPLOYID
          AND tt.AssignedPC = et_1.EMPLOYID
          AND tt.ClientID = do.CUSTNMBR;</pre><p>
        For this example, make the following assumptions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The columns being compared have been declared as follows.
</p>
<div class="informaltable">
<table summary="This table outlines table names, column names, and
              data types for the columns being compared in the
              EXPLAIN example described in the
preceding text." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Table</th><th scope="col">Column</th><th scope="col">Data Type</th></tr></thead><tbody><tr><td scope="row"><code class="literal">tt</code></td><td><code class="literal">ActualPC</code></td><td><code class="literal">CHAR(10)</code></td></tr><tr><td scope="row"><code class="literal">tt</code></td><td><code class="literal">AssignedPC</code></td><td><code class="literal">CHAR(10)</code></td></tr><tr><td scope="row"><code class="literal">tt</code></td><td><code class="literal">ClientID</code></td><td><code class="literal">CHAR(10)</code></td></tr><tr><td scope="row"><code class="literal">et</code></td><td><code class="literal">EMPLOYID</code></td><td><code class="literal">CHAR(15)</code></td></tr><tr><td scope="row"><code class="literal">do</code></td><td><code class="literal">CUSTNMBR</code></td><td><code class="literal">CHAR(15)</code></td></tr></tbody></table>
</div>
</li><li class="listitem"><p>
            The tables have the following indexes.
</p>
<div class="informaltable">
<table summary="This table lists indexes for each of the tables
              that are part of the EXPLAIN example
described in the preceding text." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Table</th><th scope="col">Index</th></tr></thead><tbody><tr><td scope="row"><code class="literal">tt</code></td><td><code class="literal">ActualPC</code></td></tr><tr><td scope="row"><code class="literal">tt</code></td><td><code class="literal">AssignedPC</code></td></tr><tr><td scope="row"><code class="literal">tt</code></td><td><code class="literal">ClientID</code></td></tr><tr><td scope="row"><code class="literal">et</code></td><td><code class="literal">EMPLOYID</code> (primary key)</td></tr><tr><td scope="row"><code class="literal">do</code></td><td><code class="literal">CUSTNMBR</code> (primary key)</td></tr></tbody></table>
</div>
</li><li class="listitem"><p>
            The <code class="literal">tt.ActualPC</code> values are not evenly
            distributed.
</p></li></ul>
</div>
<p>
        Initially, before any optimizations have been performed, the
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement produces the
        following information:
      </p><pre class="programlisting">table type possible_keys key  key_len ref  rows  Extra
et    ALL  PRIMARY       NULL NULL    NULL 74
do    ALL  PRIMARY       NULL NULL    NULL 2135
et_1  ALL  PRIMARY       NULL NULL    NULL 74
tt    ALL  AssignedPC,   NULL NULL    NULL 3872
           ClientID,
           ActualPC
      Range checked for each record (index map: 0x23)</pre><p>
        Because <code class="literal">type</code> is
        <code class="literal">ALL</code> for each table, this
        output indicates that MySQL is generating a Cartesian product of
        all the tables; that is, every combination of rows. This takes
        quite a long time, because the product of the number of rows in
        each table must be examined. For the case at hand, this product
        is 74 × 2135 × 74 × 3872 = 45,268,558,720
        rows. If the tables were bigger, you can only imagine how long
        it would take.
      </p><p>
        One problem here is that MySQL can use indexes on columns more
        efficiently if they are declared as the same type and size. In
        this context, <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> and
        <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> are considered the same if
        they are declared as the same size.
        <code class="literal">tt.ActualPC</code> is declared as
        <code class="literal">CHAR(10)</code> and <code class="literal">et.EMPLOYID</code>
        is <code class="literal">CHAR(15)</code>, so there is a length mismatch.
      </p><p>
        To fix this disparity between column lengths, use
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to lengthen
        <code class="literal">ActualPC</code> from 10 characters to 15 characters:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE tt MODIFY ActualPC VARCHAR(15);</code></strong>
</pre><p>
        Now <code class="literal">tt.ActualPC</code> and
        <code class="literal">et.EMPLOYID</code> are both
        <code class="literal">VARCHAR(15)</code>. Executing the
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement again produces
        this result:
      </p><pre class="programlisting">table type   possible_keys key     key_len ref         rows    Extra
tt    ALL    AssignedPC,   NULL    NULL    NULL        3872    Using
             ClientID,                                         where
             ActualPC
do    ALL    PRIMARY       NULL    NULL    NULL        2135
      Range checked for each record (index map: 0x1)
et_1  ALL    PRIMARY       NULL    NULL    NULL        74
      Range checked for each record (index map: 0x1)
et    eq_ref PRIMARY       PRIMARY 15      tt.ActualPC 1</pre><p>
        This is not perfect, but is much better: The product of the
        <code class="literal">rows</code> values is less by a factor of 74. This
        version executes in a couple of seconds.
      </p><p>
        A second alteration can be made to eliminate the column length
        mismatches for the <code class="literal">tt.AssignedPC =
        et_1.EMPLOYID</code> and <code class="literal">tt.ClientID =
        do.CUSTNMBR</code> comparisons:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER TABLE tt MODIFY AssignedPC VARCHAR(15),</code></strong>
    -&gt;                <strong class="userinput"><code>MODIFY ClientID   VARCHAR(15);</code></strong>
</pre><p>
        After that modification, <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>
        produces the output shown here:
      </p><pre class="programlisting">table type   possible_keys key      key_len ref           rows Extra
et    ALL    PRIMARY       NULL     NULL    NULL          74
tt    ref    AssignedPC,   ActualPC 15      et.EMPLOYID   52   Using
             ClientID,                                         where
             ActualPC
et_1  eq_ref PRIMARY       PRIMARY  15      tt.AssignedPC 1
do    eq_ref PRIMARY       PRIMARY  15      tt.ClientID   1</pre><p>
        At this point, the query is optimized almost as well as
        possible. The remaining problem is that, by default, MySQL
        assumes that values in the <code class="literal">tt.ActualPC</code> column
        are evenly distributed, and that is not the case for the
        <code class="literal">tt</code> table. Fortunately, it is easy to tell
        MySQL to analyze the key distribution:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ANALYZE TABLE tt;</code></strong>
</pre><p>
        With the additional index information, the join is perfect and
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> produces this result:
      </p><pre class="programlisting">table type   possible_keys key     key_len ref           rows Extra
tt    ALL    AssignedPC    NULL    NULL    NULL          3872 Using
             ClientID,                                        where
             ActualPC
et    eq_ref PRIMARY       PRIMARY 15      tt.ActualPC   1
et_1  eq_ref PRIMARY       PRIMARY 15      tt.AssignedPC 1
do    eq_ref PRIMARY       PRIMARY 15      tt.ClientID   1</pre><p>
        <a class="indexterm" name="idp50980656"></a>

        Note that the <code class="literal">rows</code> column in the output from
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> is an educated guess from
        the MySQL join optimizer. Check whether the numbers are even
        close to the truth by comparing the <code class="literal">rows</code>
        product with the actual number of rows that the query returns.
        If the numbers are quite different, you might get better
        performance by using <code class="literal">STRAIGHT_JOIN</code> in your
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement and trying to
        list the tables in a different order in the
        <code class="literal">FROM</code> clause.
      </p><p>
        It is possible in some cases to execute statements that modify
        data when <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
        SELECT</code></a> is used with a subquery; for more information,
        see <a class="xref" href="sql-syntax.html#from-clause-subqueries" title="13.2.10.8. Subqueries in the FROM Clause">Section 13.2.10.8, “Subqueries in the <code class="literal">FROM</code> Clause”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="explain-extended"></a>8.8.3. <code class="literal">EXPLAIN EXTENDED</code> Output Format</h3>

</div>

</div>

</div>
<p>
        When <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> is used with the
        <code class="literal">EXTENDED</code> keyword, the output includes a
        <code class="literal">filtered</code> column not otherwise displayed. This
        column indicates the estimated percentage of table rows that
        will be filtered by the table condition. In addition, the
        statement produces extra information that can be viewed by
        issuing a <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> statement
        following the <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> statement.
        The <code class="literal">Message</code> value in
        <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> output displays how
        the optimizer qualifies table and column names in the
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement, what the
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> looks like after the
        application of rewriting and optimization rules, and possibly
        other notes about the optimization process. Here is an example:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN EXTENDED</code></strong>
    -&gt; <strong class="userinput"><code>SELECT t1.a, t1.a IN (SELECT t2.a FROM t2) FROM t1\G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: t1
         type: index
possible_keys: NULL
          key: PRIMARY
      key_len: 4
          ref: NULL
         rows: 4
     filtered: 100.00
        Extra: Using index
*************************** 2. row ***************************
           id: 2
  select_type: SUBQUERY
        table: t2
         type: index
possible_keys: a
          key: a
      key_len: 5
          ref: NULL
         rows: 3
     filtered: 100.00
        Extra: Using index
2 rows in set, 1 warning (0.00 sec)

mysql&gt; <strong class="userinput"><code>SHOW WARNINGS\G</code></strong>
*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: /* select#1 */ select `test`.`t1`.`a` AS `a`,
         &lt;in_optimizer&gt;(`test`.`t1`.`a`,`test`.`t1`.`a` in
         ( &lt;materialize&gt; (/* select#2 */ select `test`.`t2`.`a`
         from `test`.`t2` where 1 having 1 ),
         &lt;primary_index_lookup&gt;(`test`.`t1`.`a` in
         &lt;temporary table&gt; on &lt;auto_key&gt;
         where ((`test`.`t1`.`a` = `materialized-subquery`.`a`))))) AS `t1.a
         IN (SELECT t2.a FROM t2)` from `test`.`t1`
1 row in set (0.00 sec)
</pre><p>
        As of MySQL 5.6.3,
        <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
        EXTENDED</code></a> can be used with
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
        <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#replace" title="13.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a>, and
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements. However, the
        following <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a> statement
        displays a nonempty result only for
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements. Before MySQL
        5.6.3, <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
        EXTENDED</code></a> can be used only with
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements.
      </p><p>
        Because the statement displayed by <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW
        WARNINGS</code></a> may contain special markers to provide
        information about query rewriting or optimizer actions, the
        statement is not necessarily valid SQL and is not intended to be
        executed. The output may also include rows with
        <code class="literal">Message</code> values that provide additional
        non-SQL explanatory notes about actions taken by the optimizer.
      </p><p>
        The following list describes special markers that can appear in
        <code class="literal">EXTENDED</code> output displayed by
        <a class="link" href="sql-syntax.html#show-warnings" title="13.7.5.41. SHOW WARNINGS Syntax"><code class="literal">SHOW WARNINGS</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;auto_key&gt;</code>
          </p><p>
            An automatically generated key for a temporary table.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;cache&gt;(<em class="replaceable"><code>expr</code></em>)</code>
          </p><p>
            The expression (such as a scalar subquery) is executed once
            and the resulting value is saved in memory for later use.
            For results consisting of multiple values, a temporary table
            may be created and you will see <code class="literal">&lt;temporary
            table&gt;</code> instead.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;exists&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p>
            The subquery predicate is converted to an
            <code class="literal">EXISTS</code> predicate and the subquery is
            transformed so that it can be used together with the
            <code class="literal">EXISTS</code> predicate.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;in_optimizer&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p>
            This is an internal optimizer object with no user
            significance.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;index_lookup&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p>
            The query fragment is processed using an index lookup to
            find qualifying rows.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;if&gt;(<em class="replaceable"><code>condition</code></em>,
            <em class="replaceable"><code>expr1</code></em>,
            <em class="replaceable"><code>expr2</code></em>)</code>
          </p><p>
            If the condition is true, evaluate to
            <em class="replaceable"><code>expr1</code></em>, otherwise
            <em class="replaceable"><code>expr2</code></em>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;is_not_null_test&gt;(<em class="replaceable"><code>expr</code></em>)</code>
          </p><p>
            A test to verify that the expression does not evaluate to
            <code class="literal">NULL</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;materialize&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p>
            Subquery materialization is used.
          </p></li><li class="listitem"><p>
            <code class="literal">`materialized-subquery`.<em class="replaceable"><code>col_name</code></em></code>,
            <code class="literal">`materialized
            subselect`.<em class="replaceable"><code>col_name</code></em></code>
          </p><p>
            A reference to the column
            <em class="replaceable"><code>col_name</code></em> in an internal temporary
            table materialized to hold the result from evaluating a
            subquery.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;primary_index_lookup&gt;(<em class="replaceable"><code>query
            fragment</code></em>)</code>
          </p><p>
            The query fragment is processed using a primary key lookup
            to find qualifying rows.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;ref_null_helper&gt;(<em class="replaceable"><code>expr</code></em>)</code>
          </p><p>
            This is an internal optimizer object with no user
            significance.
          </p></li><li class="listitem"><p>
            <code class="literal">/* select#<em class="replaceable"><code>N</code></em> */
            <em class="replaceable"><code>select_stmt</code></em></code>
          </p><p>
            The <code class="literal">SELECT</code> is associated with the row in
            non-<code class="literal">EXTENDED</code>
            <a class="link" href="sql-syntax.html#explain" title="13.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output that has an
            <code class="literal">id</code> value of <em class="replaceable"><code>N</code></em>.
          </p></li><li class="listitem"><p>
            <code class="literal"><em class="replaceable"><code>outer_tables</code></em> semi join
            (<em class="replaceable"><code>inner_tables</code></em>)</code>
          </p><p>
            A semi-join operation.
            <em class="replaceable"><code>inner_tables</code></em> shows the tables
            that were not pulled out. See <a class="xref" href="optimization.html#semi-joins" title="8.2.1.18.1. Optimizing Subqueries with Semi-Join Transformations">Section 8.2.1.18.1, “Optimizing Subqueries with Semi-Join Transformations”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;temporary table&gt;</code>
          </p><p>
            This represents an internal temporary table created to cache
            an intermediate result.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="estimating-performance"></a>8.8.4. Estimating Query Performance</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51062048"></a><a class="indexterm" name="idp51063536"></a><a class="indexterm" name="idp51065024"></a><p>
        In most cases, you can estimate query performance by counting
        disk seeks. For small tables, you can usually find a row in one
        disk seek (because the index is probably cached). For bigger
        tables, you can estimate that, using B-tree indexes, you need
        this many seeks to find a row:
        <code class="literal">log(<em class="replaceable"><code>row_count</code></em>) /
        log(<em class="replaceable"><code>index_block_length</code></em> / 3 * 2 /
        (<em class="replaceable"><code>index_length</code></em> +
        <em class="replaceable"><code>data_pointer_length</code></em>)) + 1</code>.
      </p><p>
        In MySQL, an index block is usually 1,024 bytes and the data
        pointer is usually four bytes. For a 500,000-row table with a
        key value length of three bytes (the size of
        <a class="link" href="data-types.html#integer-types" title="11.2.1. Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">MEDIUMINT</code></a>), the formula indicates
        <code class="literal">log(500,000)/log(1024/3*2/(3+4)) + 1</code> =
        <code class="literal">4</code> seeks.
      </p><p>
        This index would require storage of about 500,000 * 7 * 3/2 =
        5.2MB (assuming a typical index buffer fill ratio of 2/3), so
        you probably have much of the index in memory and so need only
        one or two calls to read data to find the row.
      </p><p>
        For writes, however, you need four seek requests to find where
        to place a new index value and normally two seeks to update the
        index and write the row.
      </p><p>
        Note that the preceding discussion does not mean that your
        application performance slowly degenerates by log
        <em class="replaceable"><code>N</code></em>. As long as everything is cached by
        the OS or the MySQL server, things become only marginally slower
        as the table gets bigger. After the data gets too big to be
        cached, things start to go much slower until your applications
        are bound only by disk seeks (which increase by log
        <em class="replaceable"><code>N</code></em>). To avoid this, increase the key
        cache size as the data grows. For <code class="literal">MyISAM</code>
        tables, the key cache size is controlled by the
        <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
        variable. See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="controlling-optimizer"></a>8.8.5. Controlling the Query Optimizer</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#controlling-query-plan-evaluation">8.8.5.1. Controlling Query Plan Evaluation</a></span></dt><dt><span class="section"><a href="optimization.html#switchable-optimizations">8.8.5.2. Controlling Switchable Optimizations</a></span></dt></dl>
</div>
<a class="indexterm" name="idp51078912"></a><p>
        MySQL provides optimizer control through system variables that
        affect how query plans are evaluated and which switchable
        optimizations are enabled.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="controlling-query-plan-evaluation"></a>8.8.5.1. Controlling Query Plan Evaluation</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp51081952"></a><p>
          The task of the query optimizer is to find an optimal plan for
          executing an SQL query. Because the difference in performance
          between <span class="quote">“<span class="quote">good</span>”</span> and <span class="quote">“<span class="quote">bad</span>”</span> plans can
          be orders of magnitude (that is, seconds versus hours or even
          days), most query optimizers, including that of MySQL, perform
          a more or less exhaustive search for an optimal plan among all
          possible query evaluation plans. For join queries, the number
          of possible plans investigated by the MySQL optimizer grows
          exponentially with the number of tables referenced in a query.
          For small numbers of tables (typically less than 7 to 10) this
          is not a problem. However, when larger queries are submitted,
          the time spent in query optimization may easily become the
          major bottleneck in the server's performance.
        </p><p>
          A more flexible method for query optimization enables the user
          to control how exhaustive the optimizer is in its search for
          an optimal query evaluation plan. The general idea is that the
          fewer plans that are investigated by the optimizer, the less
          time it spends in compiling a query. On the other hand,
          because the optimizer skips some plans, it may miss finding an
          optimal plan.
        </p><p>
          The behavior of the optimizer with respect to the number of
          plans it evaluates can be controlled using two system
          variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The <a class="link" href="server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level</code></a>
              variable tells the optimizer to skip certain plans based
              on estimates of the number of rows accessed for each
              table. Our experience shows that this kind of
              <span class="quote">“<span class="quote">educated guess</span>”</span> rarely misses optimal plans,
              and may dramatically reduce query compilation times. That
              is why this option is on
              (<code class="literal">optimizer_prune_level=1</code>) by default.
              However, if you believe that the optimizer missed a better
              query plan, this option can be switched off
              (<code class="literal">optimizer_prune_level=0</code>) with the risk
              that query compilation may take much longer. Note that,
              even with the use of this heuristic, the optimizer still
              explores a roughly exponential number of plans.
            </p></li><li class="listitem"><p>
              The
              <a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
              variable tells how far into the <span class="quote">“<span class="quote">future</span>”</span> of
              each incomplete plan the optimizer should look to evaluate
              whether it should be expanded further. Smaller values of
              <a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
              may result in orders of magnitude smaller query
              compilation times. For example, queries with 12, 13, or
              more tables may easily require hours and even days to
              compile if
              <a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a> is
              close to the number of tables in the query. At the same
              time, if compiled with
              <a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
              equal to 3 or 4, the optimizer may compile in less than a
              minute for the same query. If you are unsure of what a
              reasonable value is for
              <a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>,
              this variable can be set to 0 to tell the optimizer to
              determine the value automatically.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="switchable-optimizations"></a>8.8.5.2. Controlling Switchable Optimizations</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp51099152"></a><a class="indexterm" name="idp51100240"></a><p>
          The <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a> system
          variable enables control over optimizer behavior. Its value is
          a set of flags, each of which has a value of
          <code class="literal">on</code> or <code class="literal">off</code> to indicate
          whether the corresponding optimizer behavior is enabled or
          disabled. This variable has global and session values and can
          be changed at runtime. The global default can be set at server
          startup.
        </p><p>
          To see the current set of optimizer flags, select the variable
          value:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong>
*************************** 1. row ***************************
@@optimizer_switch: index_merge=on,index_merge_union=on,
                    index_merge_sort_union=on,
                    index_merge_intersection=on,
                    engine_condition_pushdown=on,
                    index_condition_pushdown=on,
                    mrr=on,mrr_cost_based=on,
                    block_nested_loop=on,batched_key_access=off,
                    materialization=on,semijoin=on,loosescan=on,
                    firstmatch=on,
                    subquery_materialization_cost_based=on,
                    use_index_extensions=on
</pre><p>
          To change the value of
          <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>, assign a
          value consisting of a comma-separated list of one or more
          commands:
        </p><pre class="programlisting">SET [GLOBAL|SESSION] optimizer_switch='<em class="replaceable"><code>command</code></em>[,<em class="replaceable"><code>command</code></em>]...';
</pre><p>
          Each <em class="replaceable"><code>command</code></em> value should have one
          of the forms shown in the following table.
</p>
<div class="informaltable">
<table summary="This table describes the syntax of the
            command value for SET
            optimizer_switch
commands." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Command Syntax</th><th scope="col">Meaning</th></tr></thead><tbody><tr><td scope="row"><code class="literal">default</code></td><td>Reset every optimization to its default value</td></tr><tr><td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=default</code></td><td>Set the named optimization to its default value</td></tr><tr><td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=off</code></td><td>Disable the named optimization</td></tr><tr><td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=on</code></td><td>Enable the named optimization</td></tr></tbody></table>
</div>
<p>
          The order of the commands in the value does not matter,
          although the <code class="literal">default</code> command is executed
          first if present. Setting an
          <em class="replaceable"><code>opt_name</code></em> flag to
          <code class="literal">default</code> sets it to whichever of
          <code class="literal">on</code> or <code class="literal">off</code> is its default
          value. Specifying any given
          <em class="replaceable"><code>opt_name</code></em> more than once in the
          value is not permitted and causes an error. Any errors in the
          value cause the assignment to fail with an error, leaving the
          value of <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
          unchanged.
        </p><p>
          The following table lists the permissible
          <em class="replaceable"><code>opt_name</code></em> flag names, grouped by
          optimization strategy.
</p>
<div class="informaltable">
<table summary="This table lists permissible
            opt_name flag names, grouped by
            optimization strategy." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Optimization</th><th scope="col">Flag Name</th><th scope="col">Meaning</th></tr></thead><tbody><tr><td scope="row">Batched Key Access</td><td><code class="literal">batched_key_access</code></td><td>Controls use of BKA join algorithm</td></tr><tr><td scope="row">Block Nested-Loop</td><td><code class="literal">block_nested_loop</code></td><td>Controls use of BNL join algorithm</td></tr><tr><td scope="row">Engine Condition Pushdown</td><td><code class="literal">engine_condition_pushdown</code></td><td>Controls engine condition pushdown</td></tr><tr><td scope="row">Index Condition Pushdown</td><td><code class="literal">index_condition_pushdown</code></td><td>Controls index condition pushdown</td></tr><tr><td scope="row">Index Extensions</td><td><code class="literal">use_index_extensions</code></td><td>Controls use of index extensions</td></tr><tr><td scope="row">Index Merge</td><td><code class="literal">index_merge</code></td><td>Controls all Index Merge optimizations</td></tr><tr><td scope="row"> </td><td><code class="literal">index_merge_intersection</code></td><td>Controls the Index Merge Intersection Access optimization</td></tr><tr><td scope="row"> </td><td><code class="literal">index_merge_sort_union</code></td><td>Controls the Index Merge Sort-Union Access optimization</td></tr><tr><td scope="row"> </td><td><code class="literal">index_merge_union</code></td><td>Controls the Index Merge Union Access optimization</td></tr><tr><td scope="row">Multi-Range Read</td><td><code class="literal">mrr</code></td><td>Controls the Multi-Range Read strategy</td></tr><tr><td scope="row"> </td><td><code class="literal">mrr_cost_based</code></td><td>Controls use of cost-based MRR if <code class="literal">mrr=on</code></td></tr><tr><td scope="row">Semi-join</td><td><code class="literal">semijoin</code></td><td>Controls all semi-join strategies</td></tr><tr><td scope="row"> </td><td><code class="literal">firstmatch</code></td><td>Controls the semi-join FirstMatch strategy</td></tr><tr><td scope="row"> </td><td><code class="literal">loosescan</code></td><td>Controls the semi-join LooseScan strategy (not to be confused with
LooseScan for <code class="literal">GROUP BY</code>)</td></tr><tr><td scope="row">Subquery materialization</td><td><code class="literal">materialization</code></td><td>Controls materialization (including semi-join materialization)</td></tr><tr><td scope="row"> </td><td><code class="literal">subquery_materialization_cost_based</code></td><td>Used cost-based materialization choice</td></tr></tbody></table>
</div>
<p>
          The <code class="literal">block_nested_loop</code> and
          <code class="literal">batched_key_access</code> flags were added in
          MySQL 5.6.3. For <code class="literal">batched_key_access</code> to have
          any effect when set to <code class="literal">on</code>, the
          <code class="literal">mrr</code> flag must also be
          <code class="literal">on</code>. Currently, the cost estimation for MRR
          is too pessimistic. Hence, it is also necessary for
          <code class="literal">mrr_cost_based</code> to be <code class="literal">off</code>
          for BKA to be used.
        </p><p>
          <code class="literal">semijoin</code>, <code class="literal">firstmatch</code>,
          <code class="literal">loosescan</code>, and
          <code class="literal">materialization</code> flags were added in MySQL
          5.6.5 to enable control over semi-join and subquery
          materialization strategies. The <code class="literal">semijoin</code>
          flag controls whether semi-joins are used. If it is set to
          <code class="literal">on</code>, the <code class="literal">firstmatch</code> and
          <code class="literal">loosescan</code> flags enable finer control over
          the permitted semi-join strategies. The
          <code class="literal">materialization</code> flag controls whether
          subquery materialization is used. If
          <code class="literal">semijoin</code> and
          <code class="literal">materialization</code> are both
          <code class="literal">on</code>, semi-joins also use materialization
          where applicable. These flags are <code class="literal">on</code> by
          default.
        </p><p>
          The <code class="literal">subquery_materialization_cost_based</code> was
          added in MySQL 5.6.7 to enable control over the choice between
          subquery materialization and <code class="literal">IN -&gt;
          EXISTS</code> subquery transformation. If the flag is
          <code class="literal">on</code> (the default), the optimizer performs a
          cost-based choice between subquery materialization and
          <code class="literal">IN -&gt; EXISTS</code> subquery transformation if
          either method could be used. If the flag is
          <code class="literal">off</code>, the optimizer chooses subquery
          materialization over <code class="literal">IN -&gt; EXISTS</code>
          subquery transformation, which was the previous behavior
          before MySQL 5.6.7.
        </p><p>
          For more information about individual optimization strategies,
          see the following sections:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="xref" href="optimization.html#bnl-bka-optimization" title="8.2.1.14. Block Nested-Loop and Batched Key Access Joins">Section 8.2.1.14, “Block Nested-Loop and Batched Key Access Joins”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="optimization.html#condition-pushdown-optimization" title="8.2.1.5. Engine Condition Pushdown Optimization">Section 8.2.1.5, “Engine Condition Pushdown Optimization”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="optimization.html#index-extensions" title="8.2.1.7. Use of Index Extensions">Section 8.2.1.7, “Use of Index Extensions”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.6. Index Condition Pushdown Optimization">Section 8.2.1.6, “Index Condition Pushdown Optimization”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.4. Index Merge Optimization">Section 8.2.1.4, “Index Merge Optimization”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.13. Multi-Range Read Optimization">Section 8.2.1.13, “Multi-Range Read Optimization”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="optimization.html#subquery-optimization" title="8.2.1.18. Subquery Optimization">Section 8.2.1.18, “Subquery Optimization”</a>
</p></li></ul>
</div>
<p>
          When you assign a value to
          <a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>, flags that
          are not mentioned keep their current values. This makes it
          possible to enable or disable specific optimizer behaviors in
          a single statement without affecting other behaviors. The
          statement does not depend on what other optimizer flags exist
          and what their values are. Suppose that all Index Merge
          optimizations are enabled:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong>
*************************** 1. row ***************************
@@optimizer_switch: index_merge=on,index_merge_union=on,
                    index_merge_sort_union=on,
                    index_merge_intersection=on,
                    engine_condition_pushdown=on,
                    index_condition_pushdown=on,
                    mrr=on,mrr_cost_based=on,
                    block_nested_loop=on,batched_key_access=off,
                    materialization=on,semijoin=on,loosescan=on,
                    firstmatch=on,
                    subquery_materialization_cost_based=on,
                    use_index_extensions=on
</pre><p>
          If the server is using the Index Merge Union or Index Merge
          Sort-Union access methods for certain queries and you want to
          check whether the optimizer will perform better without them,
          set the variable value like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET optimizer_switch='index_merge_union=off,index_merge_sort_union=off';</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong>
*************************** 1. row ***************************
@@optimizer_switch: index_merge=on,index_merge_union=off,
                    index_merge_sort_union=off,
                    index_merge_intersection=on,
                    engine_condition_pushdown=on,
                    index_condition_pushdown=on,
                    mrr=on,mrr_cost_based=on,
                    block_nested_loop=on,batched_key_access=off,
                    materialization=on,semijoin=on,loosescan=on,
                    firstmatch=on,
                    subquery_materialization_cost_based=on,
                    use_index_extensions=on
</pre>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="buffering-caching"></a>8.9. Buffering and Caching</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#innodb-buffer-pool">8.9.1. The <code class="literal">InnoDB</code> Buffer Pool</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-key-cache">8.9.2. The <code class="literal">MyISAM</code> Key Cache</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache">8.9.3. The MySQL Query Cache</a></span></dt><dt><span class="section"><a href="optimization.html#statement-caching">8.9.4. Caching of Prepared Statements and Stored Programs</a></span></dt></dl>
</div>
<p>
      MySQL uses several strategies that cache information in memory
      buffers to increase performance.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-buffer-pool"></a>8.9.1. The <code class="literal">InnoDB</code> Buffer Pool</h3>
</div>
</div>
</div>
<a class="indexterm" name="idp51212336"></a><a class="indexterm" name="idp51213408"></a><a class="indexterm" name="idp51214480"></a><p>
        <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> maintains a storage area
        called the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
        for caching data and indexes in memory. Knowing how the
        <code class="literal">InnoDB</code> buffer pool works, and taking
        advantage of it to keep frequently accessed data in memory, is
        an important aspect of MySQL tuning.
</p>
<h4><a name="idp51218464"></a>
        Guidelines
</h4>
<p>
        Ideally, you set the size of the buffer pool to as large a value
        as practical, leaving enough memory for other processes on the
        server to run without excessive paging. The larger the buffer
        pool, the more <code class="literal">InnoDB</code> acts like an in-memory
        database, reading data from disk once and then accessing the
        data from memory during subsequent reads. The buffer pool even
        caches data changed by insert and update operations, so that
        disk writes can be grouped together for better performance.
      </p><p>
        Depending on the typical workload on your system, you might
        adjust the proportions of the parts within the buffer pool. You
        can tune the way the buffer pool chooses which blocks to cache
        once it fills up, to keep frequently accessed data in memory
        despite sudden spikes of activity for operations such as backups
        or reporting.
      </p><p>
        With 64-bit systems with large memory sizes, you can split the
        buffer pool into multiple parts, to minimize contention for the
        memory structures among concurrent operations. For details, see
        <a class="xref" href="storage-engines.html#innodb-multiple-buffer-pools" title="14.2.4.2.27. Improvements to Performance from Multiple Buffer Pools">Section 14.2.4.2.27, “Improvements to Performance from Multiple Buffer Pools”</a>.
</p>
<h4><a name="idp51222528"></a>
        Internal Details
</h4>
<p>
        <code class="literal">InnoDB</code> manages the pool as a list, using a
        variation of the least recently used (LRU) algorithm. When room
        is needed to add a new block to the pool,
        <code class="literal">InnoDB</code> evicts the least recently used block
        and adds the new block to the middle of the list. This
        <span class="quote">“<span class="quote">midpoint insertion strategy</span>”</span> treats the list as
        two sublists:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            At the head, a sublist of <span class="quote">“<span class="quote">new</span>”</span> (or
            <span class="quote">“<span class="quote">young</span>”</span>) blocks that were accessed recently.
          </p></li><li class="listitem"><p>
            At the tail, a sublist of <span class="quote">“<span class="quote">old</span>”</span> blocks that
            were accessed less recently.
</p></li></ul>
</div>
<p>
        This algorithm keeps blocks that are heavily used by queries in
        the new sublist. The old sublist contains less-used blocks;
        these blocks are candidates for
        <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a>.
      </p><p>
        The LRU algorithm operates as follows by default:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            3/8 of the buffer pool is devoted to the old sublist.
          </p></li><li class="listitem"><p>
            The midpoint of the list is the boundary where the tail of
            the new sublist meets the head of the old sublist.
          </p></li><li class="listitem"><p>
            When <code class="literal">InnoDB</code> reads a block into the buffer
            pool, it initially inserts it at the midpoint (the head of
            the old sublist). A block can be read in because it is
            required for a user-specified operation such as an SQL
            query, or as part of a
            <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> operation
            performed automatically by <code class="literal">InnoDB</code>.
          </p></li><li class="listitem"><p>
            Accessing to a block in the old sublist makes it
            <span class="quote">“<span class="quote">young</span>”</span>, moving it to the head of the buffer
            pool (the head of the new sublist). If the block was read in
            because it was required, the first access occurs immediately
            and the block is made young. If the block was read in due to
            read-ahead, the first access does not occur immediately (and
            might not occur at all before the block is evicted).
          </p></li><li class="listitem"><p>
            As the database operates, blocks in the buffer pool that are
            not accessed <span class="quote">“<span class="quote">age</span>”</span> by moving toward the tail of
            the list. Blocks in both the new and old sublists age as
            other blocks are made new. Blocks in the old sublist also
            age as blocks are inserted at the midpoint. Eventually, a
            block that remains unused for long enough reaches the tail
            of the old sublist and is evicted.
</p></li></ul>
</div>
<p>
        By default, blocks read by queries immediately move into the new
        sublist, meaning they will stay in the buffer pool for a long
        time. A table scan (such as performed for a
        <a class="link" href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> operation, or a
        <code class="literal">SELECT</code> statement with no
        <code class="literal">WHERE</code> clause) can bring a large amount of
        data into the buffer pool and evict an equivalent amount of
        older data, even if the new data is never used again. Similarly,
        blocks that are loaded by the read-ahead background thread and
        then accessed only once move to the head of the new list. These
        situations can push frequently used blocks to the old sublist,
        where they become subject to eviction.
</p>
<h4><a name="idp51243232"></a>
        Configuration Options
</h4>
<p>
        Several <code class="literal">InnoDB</code> system variables control the
        size of the buffer pool and let you tune the LRU algorithm:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          </p><p>
            Specifies the size of the buffer pool. If your buffer pool
            is small and you have sufficient memory, making the pool
            larger can improve performance by reducing the amount of
            disk I/O needed as queries access
            <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables.
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          </p><p>
            Divides the buffer pool into a user-specified number of
            separate regions, each with its own LRU list and related
            data structures, to reduce contention during concurrent
            memory read and write operations. This option takes effect
            only when you set the
            <code class="literal">innodb_buffer_pool_size</code> to a size of 1
            gigabyte or more. The total size you specify is divided
            among all the buffer pools. For best efficiency, specify a
            combination of
            <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
            and <a class="link" href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            so that each buffer pool instance is at least 1 gigabyte.
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
          </p><p>
            Specifies the approximate percentage of the buffer pool that
            <code class="literal">InnoDB</code> uses for the old block sublist.
            The range of values is 5 to 95. The default value is 37
            (that is, 3/8 of the pool).
          </p></li><li class="listitem"><p>
            <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
          </p><p>
            Specifies how long in milliseconds (ms) a block inserted
            into the old sublist must stay there after its first access
            before it can be moved to the new sublist. The default value
            is 0: A block inserted into the old sublist moves to the new
            sublist when Innodb has evicted 1/4 of the inserted block's
            pages from the buffer pool, no matter how soon after
            insertion the access occurs. If the value is greater than 0,
            blocks remain in the old sublist until an access occurs at
            least that many ms after the first access. For example, a
            value of 1000 causes blocks to stay in the old sublist for 1
            second after the first access before they become eligible to
            move to the new sublist.
</p></li></ul>
</div>
<p>
        Setting <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        greater than 0 prevents one-time table scans from flooding the
        new sublist with blocks used only for the scan. Rows in a block
        read in for a scan are accessed many times in rapid succession,
        but the block is unused after that. If
        <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> is set
        to a value greater than time to process the block, the block
        remains in the <span class="quote">“<span class="quote">old</span>”</span> sublist and ages to the tail
        of the list to be evicted quickly. This way, blocks used only
        for a one-time scan do not act to the detriment of heavily used
        blocks in the new sublist.
      </p><p>
        <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> can be
        set at runtime, so you can change it temporarily while
        performing operations such as table scans and dumps:
      </p><pre class="programlisting">SET GLOBAL innodb_old_blocks_time = 1000;<em class="replaceable"><code>... perform queries that scan tables ...</code></em>
SET GLOBAL innodb_old_blocks_time = 0;
</pre><p>
        This strategy does not apply if your intent is to <span class="quote">“<span class="quote">warm
        up</span>”</span> the buffer pool by filling it with a table's content.
        For example, benchmark tests often perform a table or index scan
        at server startup, because that data would normally be in the
        buffer pool after a period of normal use. In this case, leave
        <a class="link" href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> set to
        0, at least until the warmup phase is complete.
</p>
<h4><a name="idp51266976"></a>
        Monitoring the Buffer Pool
</h4>
<p>
        The output from the InnoDB Standard Monitor contains several
        fields in the <code class="literal">BUFFER POOL AND MEMORY</code> section
        that pertain to operation of the buffer pool LRU algorithm:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Old database pages</code>: The number of pages
            in the old sublist of the buffer pool.
          </p></li><li class="listitem"><p>
            <code class="literal">Pages made young, not young</code>: The number
            of old pages that were moved to the head of the buffer pool
            (the new sublist), and the number of pages that have
            remained in the old sublist without being made new.
          </p></li><li class="listitem"><p>
            <code class="literal">youngs/s non-youngs/s</code>: The number of
            accesses to old pages that have resulted in making them
            young or not. This metric differs from that of the previous
            item in two ways. First, it relates only to old pages.
            Second, it is based on number of accesses to pages and not
            the number of pages. (There can be multiple accesses to a
            given page, all of which are counted.)
          </p></li><li class="listitem"><p>
            <code class="literal">young-making rate</code>: Hits that cause blocks
            to move to the head of the buffer pool.
          </p></li><li class="listitem"><p>
            <code class="literal">not</code>: Hits that do not cause blocks to
            move to the head of the buffer pool (due to the delay not
            being met).
</p></li></ul>
</div>
<p>
        The <code class="literal">young-making</code> rate and
        <code class="literal">not</code> rate will not normally add up to the
        overall buffer pool hit rate. Hits for blocks in the old sublist
        cause them to move to the new sublist, but hits to blocks in the
        new sublist cause them to move to the head of the list only if
        they are a certain distance from the head.
      </p><p>
        The preceding information from the Monitor can help you make LRU
        tuning decisions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you see very low <code class="literal">youngs/s</code> values when
            you do not have large scans going on, that indicates that
            you might need to either reduce the delay time, or increase
            the percentage of the buffer pool used for the old sublist.
            Increasing the percentage makes the old sublist larger, so
            blocks in that sublist take longer to move to the tail and
            be evicted. This increases the likelihood that they will be
            accessed again and be made young.
          </p></li><li class="listitem"><p>
            If you do not see a lot of <code class="literal">non-youngs/s</code>
            when you are doing large table scans (and lots of
            <code class="literal">youngs/s</code>), to tune your delay value to be
            larger.
</p></li></ul>
</div>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p xmlns="">
          Per second averages provided in <code class="literal">InnoDB</code>
          Monitor output are based on the elapsed time between the
          current time and the last time <code class="literal">InnoDB</code>
          Monitor output was printed.
</p>
</div>
<p>
        For more information about InnoDB Monitors, see
        <a class="xref" href="storage-engines.html#innodb-monitors" title="14.2.4.4. SHOW ENGINE INNODB STATUS and the InnoDB Monitors">Section 14.2.4.4, “<code class="literal">SHOW ENGINE INNODB
        STATUS</code> and the <code class="literal">InnoDB</code> Monitors”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="myisam-key-cache"></a>8.9.2. The <code class="literal">MyISAM</code> Key Cache</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#shared-key-cache">8.9.2.1. Shared Key Cache Access</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-key-caches">8.9.2.2. Multiple Key Caches</a></span></dt><dt><span class="section"><a href="optimization.html#midpoint-insertion">8.9.2.3. Midpoint Insertion Strategy</a></span></dt><dt><span class="section"><a href="optimization.html#index-preloading">8.9.2.4. Index Preloading</a></span></dt><dt><span class="section"><a href="optimization.html#key-cache-block-size">8.9.2.5. Key Cache Block Size</a></span></dt><dt><span class="section"><a href="optimization.html#key-cache-restructuring">8.9.2.6. Restructuring a Key Cache</a></span></dt></dl>
</div>
<a class="indexterm" name="idp51290032"></a><a class="indexterm" name="idp51291104"></a><p>
        To minimize disk I/O, the <code class="literal">MyISAM</code> storage
        engine exploits a strategy that is used by many database
        management systems. It employs a cache mechanism to keep the
        most frequently accessed table blocks in memory:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For index blocks, a special structure called the
            <em class="firstterm">key cache</em> (or <em class="firstterm">key
            buffer</em>) is maintained. The structure contains a
            number of block buffers where the most-used index blocks are
            placed.
          </p></li><li class="listitem"><p>
            For data blocks, MySQL uses no special cache. Instead it
            relies on the native operating system file system cache.
</p></li></ul>
</div>
<p>
        This section first describes the basic operation of the
        <code class="literal">MyISAM</code> key cache. Then it discusses features
        that improve key cache performance and that enable you to better
        control cache operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Multiple sessions can access the cache concurrently.
          </p></li><li class="listitem"><p>
            You can set up multiple key caches and assign table indexes
            to specific caches.
</p></li></ul>
</div>
<p>
        To control the size of the key cache, use the
        <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> system
        variable. If this variable is set equal to zero, no key cache is
        used. The key cache also is not used if the
        <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> value is too
        small to allocate the minimal number of block buffers (8).
      </p><p>
        When the key cache is not operational, index files are accessed
        using only the native file system buffering provided by the
        operating system. (In other words, table index blocks are
        accessed using the same strategy as that employed for table data
        blocks.)
      </p><p>
        An index block is a contiguous unit of access to the
        <code class="literal">MyISAM</code> index files. Usually the size of an
        index block is equal to the size of nodes of the index B-tree.
        (Indexes are represented on disk using a B-tree data structure.
        Nodes at the bottom of the tree are leaf nodes. Nodes above the
        leaf nodes are nonleaf nodes.)
      </p><p>
        All block buffers in a key cache structure are the same size.
        This size can be equal to, greater than, or less than the size
        of a table index block. Usually one these two values is a
        multiple of the other.
      </p><p>
        When data from any table index block must be accessed, the
        server first checks whether it is available in some block buffer
        of the key cache. If it is, the server accesses data in the key
        cache rather than on disk. That is, it reads from the cache or
        writes into it rather than reading from or writing to disk.
        Otherwise, the server chooses a cache block buffer containing a
        different table index block (or blocks) and replaces the data
        there by a copy of required table index block. As soon as the
        new index block is in the cache, the index data can be accessed.
      </p><p>
        If it happens that a block selected for replacement has been
        modified, the block is considered <span class="quote">“<span class="quote">dirty.</span>”</span> In this
        case, prior to being replaced, its contents are flushed to the
        table index from which it came.
      </p><p>
        Usually the server follows an <em class="firstterm">LRU (Least Recently
        Used)</em> strategy: When choosing a block for
        replacement, it selects the least recently used index block. To
        make this choice easier, the key cache module maintains all used
        blocks in a special list (<em class="firstterm">LRU chain</em>)
        ordered by time of use. When a block is accessed, it is the most
        recently used and is placed at the end of the list. When blocks
        need to be replaced, blocks at the beginning of the list are the
        least recently used and become the first candidates for
        eviction.
      </p><p>
        The <code class="literal">InnoDB</code> storage engine also uses an LRU
        algorithm, to manage its buffer pool. See
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1. The InnoDB Buffer Pool">Section 8.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="shared-key-cache"></a>8.9.2.1. Shared Key Cache Access</h4>
</div>
</div>
</div>
<p>
          Threads can access key cache buffers simultaneously, subject
          to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              A buffer that is not being updated can be accessed by
              multiple sessions.
            </p></li><li class="listitem"><p>
              A buffer that is being updated causes sessions that need
              to use it to wait until the update is complete.
            </p></li><li class="listitem"><p>
              Multiple sessions can initiate requests that result in
              cache block replacements, as long as they do not interfere
              with each other (that is, as long as they need different
              index blocks, and thus cause different cache blocks to be
              replaced).
</p></li></ul>
</div>
<p>
          Shared access to the key cache enables the server to improve
          throughput significantly.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="multiple-key-caches"></a>8.9.2.2. Multiple Key Caches</h4>

</div>

</div>

</div>
<p>
          Shared access to the key cache improves performance but does
          not eliminate contention among sessions entirely. They still
          compete for control structures that manage access to the key
          cache buffers. To reduce key cache access contention further,
          MySQL also provides multiple key caches. This feature enables
          you to assign different table indexes to different key caches.
        </p><p>
          Where there are multiple key caches, the server must know
          which cache to use when processing queries for a given
          <code class="literal">MyISAM</code> table. By default, all
          <code class="literal">MyISAM</code> table indexes are cached in the
          default key cache. To assign table indexes to a specific key
          cache, use the <a class="link" href="sql-syntax.html#cache-index" title="13.7.6.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a>
          statement (see <a class="xref" href="sql-syntax.html#cache-index" title="13.7.6.2. CACHE INDEX Syntax">Section 13.7.6.2, “<code class="literal">CACHE INDEX</code> Syntax”</a>). For example,
          the following statement assigns indexes from the tables
          <code class="literal">t1</code>, <code class="literal">t2</code>, and
          <code class="literal">t3</code> to the key cache named
          <code class="literal">hot_cache</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CACHE INDEX t1, t2, t3 IN hot_cache;</code></strong>
+---------+--------------------+----------+----------+
| Table   | Op                 | Msg_type | Msg_text |
+---------+--------------------+----------+----------+
| test.t1 | assign_to_keycache | status   | OK       |
| test.t2 | assign_to_keycache | status   | OK       |
| test.t3 | assign_to_keycache | status   | OK       |
+---------+--------------------+----------+----------+
</pre><p>
          The key cache referred to in a <a class="link" href="sql-syntax.html#cache-index" title="13.7.6.2. CACHE INDEX Syntax"><code class="literal">CACHE
          INDEX</code></a> statement can be created by setting its size
          with a <a class="link" href="sql-syntax.html#set-statement" title="13.7.4. SET Syntax"><code class="literal">SET
          GLOBAL</code></a> parameter setting statement or by using
          server startup options. For example:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=128*1024;</code></strong>
</pre><p>
          To destroy a key cache, set its size to zero:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=0;</code></strong>
</pre><p>
          Note that you cannot destroy the default key cache. Any
          attempt to do this will be ignored:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL key_buffer_size = 0;</code></strong>

mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'key_buffer_size';</code></strong>
+-----------------+---------+
| Variable_name   | Value   |
+-----------------+---------+
| key_buffer_size | 8384512 |
+-----------------+---------+
</pre><p>
          Key cache variables are structured system variables that have
          a name and components. For
          <code class="literal">keycache1.key_buffer_size</code>,
          <code class="literal">keycache1</code> is the cache variable name and
          <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> is the cache
          component. See <a class="xref" href="server-administration.html#structured-system-variables" title="5.1.5.1. Structured System Variables">Section 5.1.5.1, “Structured System Variables”</a>,
          for a description of the syntax used for referring to
          structured key cache system variables.
        </p><p>
          By default, table indexes are assigned to the main (default)
          key cache created at the server startup. When a key cache is
          destroyed, all indexes assigned to it are reassigned to the
          default key cache.
        </p><p>
          For a busy server, you can use a strategy that involves three
          key caches:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              A <span class="quote">“<span class="quote">hot</span>”</span> key cache that takes up 20% of the
              space allocated for all key caches. Use this for tables
              that are heavily used for searches but that are not
              updated.
            </p></li><li class="listitem"><p>
              A <span class="quote">“<span class="quote">cold</span>”</span> key cache that takes up 20% of the
              space allocated for all key caches. Use this cache for
              medium-sized, intensively modified tables, such as
              temporary tables.
            </p></li><li class="listitem"><p>
              A <span class="quote">“<span class="quote">warm</span>”</span> key cache that takes up 60% of the
              key cache space. Employ this as the default key cache, to
              be used by default for all other tables.
</p></li></ul>
</div>
<p>
          One reason the use of three key caches is beneficial is that
          access to one key cache structure does not block access to the
          others. Statements that access tables assigned to one cache do
          not compete with statements that access tables assigned to
          another cache. Performance gains occur for other reasons as
          well:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The hot cache is used only for retrieval queries, so its
              contents are never modified. Consequently, whenever an
              index block needs to be pulled in from disk, the contents
              of the cache block chosen for replacement need not be
              flushed first.
            </p></li><li class="listitem"><p>
              For an index assigned to the hot cache, if there are no
              queries requiring an index scan, there is a high
              probability that the index blocks corresponding to nonleaf
              nodes of the index B-tree remain in the cache.
            </p></li><li class="listitem"><p>
              An update operation most frequently executed for temporary
              tables is performed much faster when the updated node is
              in the cache and need not be read in from disk first. If
              the size of the indexes of the temporary tables are
              comparable with the size of cold key cache, the
              probability is very high that the updated node is in the
              cache.
</p></li></ul>
</div>
<p>
          The <a class="link" href="sql-syntax.html#cache-index" title="13.7.6.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a> statement sets
          up an association between a table and a key cache, but the
          association is lost each time the server restarts. If you want
          the association to take effect each time the server starts,
          one way to accomplish this is to use an option file: Include
          variable settings that configure your key caches, and an
          <code class="literal">init-file</code> option that names a file
          containing <a class="link" href="sql-syntax.html#cache-index" title="13.7.6.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a>
          statements to be executed. For example:
        </p><pre class="programlisting">key_buffer_size = 4G
hot_cache.key_buffer_size = 2G
cold_cache.key_buffer_size = 2G
init_file=/<em class="replaceable"><code>path</code></em>/<em class="replaceable"><code>to</code></em>/<em class="replaceable"><code>data-directory</code></em>/mysqld_init.sql
</pre><p>
          The statements in <code class="filename">mysqld_init.sql</code> are
          executed each time the server starts. The file should contain
          one SQL statement per line. The following example assigns
          several tables each to <code class="literal">hot_cache</code> and
          <code class="literal">cold_cache</code>:
        </p><pre class="programlisting">CACHE INDEX db1.t1, db1.t2, db2.t3 IN hot_cache
CACHE INDEX db1.t4, db2.t5, db2.t6 IN cold_cache</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="midpoint-insertion"></a>8.9.2.3. Midpoint Insertion Strategy</h4>

</div>

</div>

</div>
<p>
          By default, the key cache management system uses a simple LRU
          strategy for choosing key cache blocks to be evicted, but it
          also supports a more sophisticated method called the
          <em class="firstterm">midpoint insertion strategy.</em>
        </p><p>
          When using the midpoint insertion strategy, the LRU chain is
          divided into two parts: a hot sublist and a warm sublist. The
          division point between two parts is not fixed, but the key
          cache management system takes care that the warm part is not
          <span class="quote">“<span class="quote">too short,</span>”</span> always containing at least
          <a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
          percent of the key cache blocks.
          <a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a> is a
          component of structured key cache variables, so its value is a
          parameter that can be set per cache.
        </p><p>
          When an index block is read from a table into the key cache,
          it is placed at the end of the warm sublist. After a certain
          number of hits (accesses of the block), it is promoted to the
          hot sublist. At present, the number of hits required to
          promote a block (3) is the same for all index blocks.
        </p><p>
          A block promoted into the hot sublist is placed at the end of
          the list. The block then circulates within this sublist. If
          the block stays at the beginning of the sublist for a long
          enough time, it is demoted to the warm sublist. This time is
          determined by the value of the
          <a class="link" href="server-administration.html#sysvar_key_cache_age_threshold"><code class="literal">key_cache_age_threshold</code></a>
          component of the key cache.
        </p><p>
          The threshold value prescribes that, for a key cache
          containing <em class="replaceable"><code>N</code></em> blocks, the block at
          the beginning of the hot sublist not accessed within the last
          <code class="literal"><em class="replaceable"><code>N</code></em> *
          key_cache_age_threshold / 100</code> hits is to be moved to
          the beginning of the warm sublist. It then becomes the first
          candidate for eviction, because blocks for replacement always
          are taken from the beginning of the warm sublist.
        </p><p>
          The midpoint insertion strategy enables you to keep
          more-valued blocks always in the cache. If you prefer to use
          the plain LRU strategy, leave the
          <a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
          value set to its default of 100.
        </p><p>
          The midpoint insertion strategy helps to improve performance
          when execution of a query that requires an index scan
          effectively pushes out of the cache all the index blocks
          corresponding to valuable high-level B-tree nodes. To avoid
          this, you must use a midpoint insertion strategy with the
          <a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a> set
          to much less than 100. Then valuable frequently hit nodes are
          preserved in the hot sublist during an index scan operation as
          well.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="index-preloading"></a>8.9.2.4. Index Preloading</h4>

</div>

</div>

</div>
<p>
          If there are enough blocks in a key cache to hold blocks of an
          entire index, or at least the blocks corresponding to its
          nonleaf nodes, it makes sense to preload the key cache with
          index blocks before starting to use it. Preloading enables you
          to put the table index blocks into a key cache buffer in the
          most efficient way: by reading the index blocks from disk
          sequentially.
        </p><p>
          Without preloading, the blocks are still placed into the key
          cache as needed by queries. Although the blocks will stay in
          the cache, because there are enough buffers for all of them,
          they are fetched from disk in random order, and not
          sequentially.
        </p><p>
          To preload an index into a cache, use the
          <a class="link" href="sql-syntax.html#load-index" title="13.7.6.5. LOAD INDEX INTO CACHE Syntax"><code class="literal">LOAD INDEX INTO
          CACHE</code></a> statement. For example, the following
          statement preloads nodes (index blocks) of indexes of the
          tables <code class="literal">t1</code> and <code class="literal">t2</code>:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;</code></strong>
+---------+--------------+----------+----------+
| Table   | Op           | Msg_type | Msg_text |
+---------+--------------+----------+----------+
| test.t1 | preload_keys | status   | OK       |
| test.t2 | preload_keys | status   | OK       |
+---------+--------------+----------+----------+
</pre><p>
          The <code class="literal">IGNORE LEAVES</code> modifier causes only
          blocks for the nonleaf nodes of the index to be preloaded.
          Thus, the statement shown preloads all index blocks from
          <code class="literal">t1</code>, but only blocks for the nonleaf nodes
          from <code class="literal">t2</code>.
        </p><p>
          If an index has been assigned to a key cache using a
          <a class="link" href="sql-syntax.html#cache-index" title="13.7.6.2. CACHE INDEX Syntax"><code class="literal">CACHE INDEX</code></a> statement,
          preloading places index blocks into that cache. Otherwise, the
          index is loaded into the default key cache.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="key-cache-block-size"></a>8.9.2.5. Key Cache Block Size</h4>

</div>

</div>

</div>
<p>
          It is possible to specify the size of the block buffers for an
          individual key cache using the
          <a class="link" href="server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a>
          variable. This permits tuning of the performance of I/O
          operations for index files.
        </p><p>
          The best performance for I/O operations is achieved when the
          size of read buffers is equal to the size of the native
          operating system I/O buffers. But setting the size of key
          nodes equal to the size of the I/O buffer does not always
          ensure the best overall performance. When reading the big leaf
          nodes, the server pulls in a lot of unnecessary data,
          effectively preventing reading other leaf nodes.
        </p><p>
          To control the size of blocks in the <code class="filename">.MYI</code>
          index file of <code class="literal">MyISAM</code> tables, use the
          <a class="link" href="server-administration.html#option_mysqld_myisam-block-size"><code class="option">--myisam-block-size</code></a> option at
          server startup.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="key-cache-restructuring"></a>8.9.2.6. Restructuring a Key Cache</h4>

</div>

</div>

</div>
<p>
          A key cache can be restructured at any time by updating its
          parameter values. For example:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL cold_cache.key_buffer_size=4*1024*1024;</code></strong>
</pre><p>
          If you assign to either the
          <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> or
          <a class="link" href="server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a> key
          cache component a value that differs from the component's
          current value, the server destroys the cache's old structure
          and creates a new one based on the new values. If the cache
          contains any dirty blocks, the server saves them to disk
          before destroying and re-creating the cache. Restructuring
          does not occur if you change other key cache parameters.
        </p><p>
          When restructuring a key cache, the server first flushes the
          contents of any dirty buffers to disk. After that, the cache
          contents become unavailable. However, restructuring does not
          block queries that need to use indexes assigned to the cache.
          Instead, the server directly accesses the table indexes using
          native file system caching. File system caching is not as
          efficient as using a key cache, so although queries execute, a
          slowdown can be anticipated. After the cache has been
          restructured, it becomes available again for caching indexes
          assigned to it, and the use of file system caching for the
          indexes ceases.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="query-cache"></a>8.9.3. The MySQL Query Cache</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#query-cache-operation">8.9.3.1. How the Query Cache Operates</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-in-select">8.9.3.2. Query Cache <code class="literal">SELECT</code> Options</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-configuration">8.9.3.3. Query Cache Configuration</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-status-and-maintenance">8.9.3.4. Query Cache Status and Maintenance</a></span></dt></dl>
</div>
<a class="indexterm" name="idp51397040"></a><a class="indexterm" name="idp51398112"></a><p>
        The query cache stores the text of a
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement together with
        the corresponding result that was sent to the client. If an
        identical statement is received later, the server retrieves the
        results from the query cache rather than parsing and executing
        the statement again. The query cache is shared among sessions,
        so a result set generated by one client can be sent in response
        to the same query issued by another client.
      </p><p>
        The query cache can be useful in an environment where you have
        tables that do not change very often and for which the server
        receives many identical queries. This is a typical situation for
        many Web servers that generate many dynamic pages based on
        database content.
      </p><p>
        The query cache does not return stale data. When tables are
        modified, any relevant entries in the query cache are flushed.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          The query cache does not work in an environment where you have
          multiple <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> servers updating the same
          <code class="literal">MyISAM</code> tables.
</p>
</div>
<p>
        The query cache is used for prepared statements under the
        conditions described in <a class="xref" href="optimization.html#query-cache-operation" title="8.9.3.1. How the Query Cache Operates">Section 8.9.3.1, “How the Query Cache Operates”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          As of MySQL 5.6.5, the query cache is not supported for
          partitioned tables, and is automatically disabled for queries
          involving partitioned tables. The query cache cannot be
          enabled for such queries. (Bug #53775)
</p>
</div>
<p>
        Some performance data for the query cache follows. These results
        were generated by running the MySQL benchmark suite on a Linux
        Alpha 2×500MHz system with 2GB RAM and a 64MB query cache.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If all the queries you are performing are simple (such as
            selecting a row from a table with one row), but still differ
            so that the queries cannot be cached, the overhead for
            having the query cache active is 13%. This could be regarded
            as the worst case scenario. In real life, queries tend to be
            much more complicated, so the overhead normally is
            significantly lower.
          </p></li><li class="listitem"><p>
            Searches for a single row in a single-row table are 238%
            faster with the query cache than without it. This can be
            regarded as close to the minimum speedup to be expected for
            a query that is cached.
</p></li></ul>
</div>
<p>
        To disable the query cache at server startup, set the
        <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> system
        variable to 0. By disabling the query cache code, there is no
        noticeable overhead.
      </p><p>
        The query cache offers the potential for substantial performance
        improvement, but do not assume that it will do so under all
        circumstances. With some query cache configurations or server
        workloads, you might actually see a performance decrease:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Be cautious about sizing the query cache excessively large,
            which increases the overhead required to maintain the cache,
            possibly beyond the benefit of enabling it. Sizes in tens of
            megabytes are usually beneficial. Sizes in the hundreds of
            megabytes might not be.
          </p></li><li class="listitem"><p>
            Server workload has a significant effect on query cache
            efficiency. A query mix consisting almost entirely of a
            fixed set of <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statements is much more likely to benefit from enabling the
            cache than a mix in which frequent
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements cause
            continual invalidation of results in the cache. In some
            cases, a workaround is to use the
            <code class="literal">SQL_NO_CACHE</code> option to prevent results
            from even entering the cache for
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements that use
            frequently modified tables. (See
            <a class="xref" href="optimization.html#query-cache-in-select" title="8.9.3.2. Query Cache SELECT Options">Section 8.9.3.2, “Query Cache <code class="literal">SELECT</code> Options”</a>.)
</p></li></ul>
</div>
<p>
        To verify that enabling the query cache is beneficial, test the
        operation of your MySQL server with the cache enabled and
        disabled. Then retest periodically because query cache
        efficiency may change as server workload changes.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-operation"></a>8.9.3.1. How the Query Cache Operates</h4>
</div>
</div>
</div>
<p>
          This section describes how the query cache works when it is
          operational. <a class="xref" href="optimization.html#query-cache-configuration" title="8.9.3.3. Query Cache Configuration">Section 8.9.3.3, “Query Cache Configuration”</a>,
          describes how to control whether it is operational.
        </p><p>
          Incoming queries are compared to those in the query cache
          before parsing, so the following two queries are regarded as
          different by the query cache:
        </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>tbl_name</code></em>
Select * from <em class="replaceable"><code>tbl_name</code></em>
</pre><p>
          Queries must be <span class="emphasis"><em>exactly</em></span> the same (byte
          for byte) to be seen as identical. In addition, query strings
          that are identical may be treated as different for other
          reasons. Queries that use different databases, different
          protocol versions, or different default character sets are
          considered different queries and are cached separately.
        </p><p>
          The cache is not used for queries of the following types:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Queries that are a subquery of an outer query
            </p></li><li class="listitem"><p>
              Queries executed within the body of a stored function,
              trigger, or event
</p></li></ul>
</div>
<p>
          Before a query result is fetched from the query cache, MySQL
          checks whether the user has
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> privilege for all
          databases and tables involved. If this is not the case, the
          cached result is not used.
        </p><p>
          If a query result is returned from query cache, the server
          increments the <a class="link" href="server-administration.html#statvar_Qcache_hits"><code class="literal">Qcache_hits</code></a>
          status variable, not <code class="literal">Com_select</code>. See
          <a class="xref" href="optimization.html#query-cache-status-and-maintenance" title="8.9.3.4. Query Cache Status and Maintenance">Section 8.9.3.4, “Query Cache Status and Maintenance”</a>.
        </p><p>
          If a table changes, all cached queries that use the table
          become invalid and are removed from the cache. This includes
          queries that use <code class="literal">MERGE</code> tables that map to
          the changed table. A table can be changed by many types of
          statements, such as <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>,
          <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>, or
          <a class="link" href="sql-syntax.html#drop-database" title="13.1.21. DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a>.
        </p><p>
          The query cache also works within transactions when using
          <code class="literal">InnoDB</code> tables.
        </p><p>
          In MySQL 5.6, the result from a
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> query on a view is
          cached.
        </p><p>
          The query cache works for <code class="literal">SELECT SQL_CALC_FOUND_ROWS
          ...</code> queries and stores a value that is returned by a
          following <code class="literal">SELECT FOUND_ROWS()</code> query.
          <a class="link" href="functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a> returns the
          correct value even if the preceding query was fetched from the
          cache because the number of found rows is also stored in the
          cache. The <code class="literal">SELECT FOUND_ROWS()</code> query itself
          cannot be cached.
        </p><p>
          Prepared statements that are issued using the binary protocol
          using <a class="link" href="connectors-apis.html#mysql-stmt-prepare" title="22.8.11.21. mysql_stmt_prepare()"><code class="literal">mysql_stmt_prepare()</code></a> and
          <a class="link" href="connectors-apis.html#mysql-stmt-execute" title="22.8.11.10. mysql_stmt_execute()"><code class="literal">mysql_stmt_execute()</code></a> (see
          <a class="xref" href="connectors-apis.html#c-api-prepared-statements" title="22.8.8. C API Prepared Statements">Section 22.8.8, “C API Prepared Statements”</a>), are subject to
          limitations on caching. Comparison with statements in the
          query cache is based on the text of the statement after
          expansion of <code class="literal">?</code> parameter markers. The
          statement is compared only with other cached statements that
          were executed using the binary protocol. That is, for query
          cache purposes, prepared statements issued using the binary
          protocol are distinct from prepared statements issued using
          the text protocol (see
          <a class="xref" href="sql-syntax.html#sql-syntax-prepared-statements" title="13.5. SQL Syntax for Prepared Statements">Section 13.5, “SQL Syntax for Prepared Statements”</a>).
        </p><p>
          A query cannot be cached if it contains any of the functions
          shown in the following table.
</p>
<div class="informaltable">
<table summary="This table lists functions that if used within a
query, do not allow the query to be cached." border="1"><colgroup><col><col><col></colgroup><tbody><tr><td scope="row"><a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a></td><td><a class="link" href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a></td><td><a class="link" href="functions.html#function_convert-tz"><code class="literal">CONVERT_TZ()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_curdate"><code class="literal">CURDATE()</code></a></td><td><a class="link" href="functions.html#function_current-date"><code class="literal">CURRENT_DATE()</code></a></td><td><a class="link" href="functions.html#function_current-time"><code class="literal">CURRENT_TIME()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_current-timestamp"><code class="literal">CURRENT_TIMESTAMP()</code></a></td><td><a class="link" href="functions.html#function_curtime"><code class="literal">CURTIME()</code></a></td><td><a class="link" href="functions.html#function_database"><code class="literal">DATABASE()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_encrypt"><code class="literal">ENCRYPT()</code></a> with one parameter</td><td><a class="link" href="functions.html#function_found-rows"><code class="literal">FOUND_ROWS()</code></a></td><td><a class="link" href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_last-insert-id"><code class="literal">LAST_INSERT_ID()</code></a></td><td><a class="link" href="functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a></td><td><a class="link" href="functions.html#function_master-pos-wait"><code class="literal">MASTER_POS_WAIT()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_now"><code class="literal">NOW()</code></a></td><td><a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a></td><td><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a></td><td><a class="link" href="functions.html#function_sleep"><code class="literal">SLEEP()</code></a></td><td><a class="link" href="functions.html#function_sysdate"><code class="literal">SYSDATE()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a> with no parameters</td><td><a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a></td><td><a class="link" href="functions.html#function_uuid"><code class="literal">UUID()</code></a></td></tr><tr><td scope="row"><a class="link" href="functions.html#function_uuid-short"><code class="literal">UUID_SHORT()</code></a></td><td> </td><td> </td></tr></tbody></table>
</div>
<p>
          A query also is not cached under these conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              It refers to user-defined functions (UDFs) or stored
              functions.
            </p></li><li class="listitem"><p>
              It refers to user variables or local stored program
              variables.
            </p></li><li class="listitem"><p>
              It refers to tables in the <code class="literal">mysql</code>,
              <code class="literal">INFORMATION_SCHEMA</code>, or
              <code class="literal">performance_schema</code> database.
            </p></li><li class="listitem"><p>
              (<span class="emphasis"><em>MySQL 5.6.5 and later</em></span>:) It refers to
              any partitioned tables.
            </p></li><li class="listitem"><p>
              It is of any of the following forms:
            </p><pre class="programlisting">SELECT ... LOCK IN SHARE MODE
SELECT ... FOR UPDATE
SELECT ... INTO OUTFILE ...
SELECT ... INTO DUMPFILE ...
SELECT * FROM ... WHERE autoincrement_col IS NULL</pre><p>
              The last form is not cached because it is used as the ODBC
              workaround for obtaining the last insert ID value. See the
              Connector/ODBC section of
              <a class="xref" href="connectors-apis.html" title="Chapter 22. Connectors and APIs">Chapter 22, <i>Connectors and APIs</i></a>.
            </p><p>
              Statements within transactions that use
              <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> isolation
              level also cannot be cached because they use <code class="literal">LOCK
              IN SHARE MODE</code> locking.
            </p></li><li class="listitem"><p>
              It uses <code class="literal">TEMPORARY</code> tables.
            </p></li><li class="listitem"><p>
              It does not use any tables.
            </p></li><li class="listitem"><p>
              It generates warnings.
            </p></li><li class="listitem"><p>
              The user has a column-level privilege for any of the
              involved tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-in-select"></a>8.9.3.2. Query Cache <code class="literal">SELECT</code> Options</h4>

</div>

</div>

</div>
<p>
          Two query cache-related options may be specified in
          <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp51502160"></a>

              <code class="literal">SQL_CACHE</code>
            </p><p>
              The query result is cached if it is cacheable and the
              value of the
              <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> system
              variable is <code class="literal">ON</code> or
              <code class="literal">DEMAND</code>.
            </p></li><li class="listitem"><a class="indexterm" name="idp51507216"></a><p>
              <code class="literal">SQL_NO_CACHE</code>
            </p><p>
              The server does not use the query cache. It neither checks
              the query cache to see whether the result is already
              cached, nor does it cache the query result. (Due to a
              limitation in the parser, a space character must precede
              and follow the <code class="literal">SQL_NO_CACHE</code> keyword; a
              nonspace such as a newline causes the server to check the
              query cache to see whether the result is already cached.)
</p></li></ul>
</div>
<p>
          Examples:
        </p><pre class="programlisting">SELECT SQL_CACHE id, name FROM customer;
SELECT SQL_NO_CACHE id, name FROM customer;</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-configuration"></a>8.9.3.3. Query Cache Configuration</h4>

</div>

</div>

</div>
<p>
          The <a class="link" href="server-administration.html#sysvar_have_query_cache"><code class="literal">have_query_cache</code></a> server
          system variable indicates whether the query cache is
          available:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+
</pre><p>
          When using a standard MySQL binary, this value is always
          <code class="literal">YES</code>, even if query caching is disabled.
        </p><p>
          Several other system variables control query cache operation.
          These can be set in an option file or on the command line when
          starting <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. The query cache system
          variables all have names that begin with
          <code class="literal">query_cache_</code>. They are described briefly in
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>, with additional
          configuration information given here.
        </p><p>
          To set the size of the query cache, set the
          <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> system
          variable. Setting it to 0 disables the query cache, as does
          setting <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type=0</code></a>.
          By default, the query cache is disabled. This is achieved
          using a default size of 1M, with a default for
          <code class="literal">query_cache_type</code> of 0. (Before MySQL 5.6.8,
          the default size is 0, with a default
          <code class="literal">query_cache_type</code> of 1.)
        </p><p>
          To reduce overhead significantly, also start the server with
          <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type=0</code></a> if you
          will not be using the query cache.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            When using the Windows Configuration Wizard to install or
            configure MySQL, the default value for
            <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> will be
            configured automatically for you based on the different
            configuration types available. When using the Windows
            Configuration Wizard, the query cache may be enabled (that
            is, set to a nonzero value) due to the selected
            configuration. The query cache is also controlled by the
            setting of the
            <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> variable.
            Check the values of these variables as set in your
            <code class="filename">my.ini</code> file after configuration has
            taken place.
</p>
</div>
<p>
          When you set <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a>
          to a nonzero value, keep in mind that the query cache needs a
          minimum size of about 40KB to allocate its structures. (The
          exact size depends on system architecture.) If you set the
          value too small, you'll get a warning, as in this example:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 40000;</code></strong>
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; <strong class="userinput"><code>SHOW WARNINGS\G</code></strong>
*************************** 1. row ***************************
  Level: Warning
   Code: 1282
Message: Query cache failed to set size 39936;
         new query cache size is 0

mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 41984;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| query_cache_size | 41984 |
+------------------+-------+
</pre><p>
          For the query cache to actually be able to hold any query
          results, its size must be set larger:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 1000000;</code></strong>
Query OK, 0 rows affected (0.04 sec)

mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong>
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| query_cache_size | 999424 |
+------------------+--------+
1 row in set (0.00 sec)
</pre><p>
          The <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> value is
          aligned to the nearest 1024 byte block. The value reported may
          therefore be different from the value that you assign.
        </p><p>
          If the query cache size is greater than 0, the
          <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> variable
          influences how it works. This variable can be set to the
          following values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              A value of <code class="literal">0</code> or <code class="literal">OFF</code>
              prevents caching or retrieval of cached results.
            </p></li><li class="listitem"><p>
              A value of <code class="literal">1</code> or <code class="literal">ON</code>
              enables caching except of those statements that begin with
              <code class="literal">SELECT SQL_NO_CACHE</code>.
            </p></li><li class="listitem"><p>
              A value of <code class="literal">2</code> or
              <code class="literal">DEMAND</code> causes caching of only those
              statements that begin with <code class="literal">SELECT
              SQL_CACHE</code>.
</p></li></ul>
</div>
<p>
          If <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="literal">query_cache_size</code></a> is 0, you
          should also set
          <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> variable to
          0. In this case, the server does not acquire the query cache
          mutex at all, which means that the query cache cannot be
          enabled at runtime and there is reduced overhead in query
          execution.
        </p><p>
          Setting the <code class="literal">GLOBAL</code>
          <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> value
          determines query cache behavior for all clients that connect
          after the change is made. Individual clients can control cache
          behavior for their own connection by setting the
          <code class="literal">SESSION</code>
          <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a> value. For
          example, a client can disable use of the query cache for its
          own queries like this:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET SESSION query_cache_type = OFF;</code></strong>
</pre><p>
          If you set <a class="link" href="server-administration.html#sysvar_query_cache_type"><code class="literal">query_cache_type</code></a>
          at server startup (rather than at runtime with a
          <a class="link" href="sql-syntax.html#set-statement" title="13.7.4. SET Syntax"><code class="literal">SET</code></a>
          statement), only the numeric values are permitted.
        </p><p>
          To control the maximum size of individual query results that
          can be cached, set the
          <a class="link" href="server-administration.html#sysvar_query_cache_limit"><code class="literal">query_cache_limit</code></a> system
          variable. The default value is 1MB.
        </p><p>
          Be careful not to set the size of the cache too large. Due to
          the need for threads to lock the cache during updates, you may
          see lock contention issues with a very large cache.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
            You can set the maximum size that can be specified for the
            query cache at runtime with the
            <a class="link" href="sql-syntax.html#set-statement" title="13.7.4. SET Syntax"><code class="literal">SET</code></a>
            statement by using the
            <code class="option">--maximum-query_cache_size=<em class="replaceable"><code>32M</code></em></code>
            option on the command line or in the configuration file.
</p>
</div>
<p>
          When a query is to be cached, its result (the data sent to the
          client) is stored in the query cache during result retrieval.
          Therefore the data usually is not handled in one big chunk.
          The query cache allocates blocks for storing this data on
          demand, so when one block is filled, a new block is allocated.
          Because memory allocation operation is costly (timewise), the
          query cache allocates blocks with a minimum size given by the
          <a class="link" href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>
          system variable. When a query is executed, the last result
          block is trimmed to the actual data size so that unused memory
          is freed. Depending on the types of queries your server
          executes, you might find it helpful to tune the value of
          <a class="link" href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The default value of
              <a class="link" href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>
              is 4KB. This should be adequate for most cases.
            </p></li><li class="listitem"><p>
              If you have a lot of queries with small results, the
              default block size may lead to memory fragmentation, as
              indicated by a large number of free blocks. Fragmentation
              can force the query cache to prune (delete) queries from
              the cache due to lack of memory. In this case, decrease
              the value of
              <a class="link" href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>.
              The number of free blocks and queries removed due to
              pruning are given by the values of the
              <a class="link" href="server-administration.html#statvar_Qcache_free_blocks"><code class="literal">Qcache_free_blocks</code></a> and
              <a class="link" href="server-administration.html#statvar_Qcache_lowmem_prunes"><code class="literal">Qcache_lowmem_prunes</code></a>
              status variables.
            </p></li><li class="listitem"><p>
              If most of your queries have large results (check the
              <a class="link" href="server-administration.html#statvar_Qcache_total_blocks"><code class="literal">Qcache_total_blocks</code></a> and
              <a class="link" href="server-administration.html#statvar_Qcache_queries_in_cache"><code class="literal">Qcache_queries_in_cache</code></a>
              status variables), you can increase performance by
              increasing
              <a class="link" href="server-administration.html#sysvar_query_cache_min_res_unit"><code class="literal">query_cache_min_res_unit</code></a>.
              However, be careful to not make it too large (see the
              previous item).
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-status-and-maintenance"></a>8.9.3.4. Query Cache Status and Maintenance</h4>

</div>

</div>

</div>
<p>
          To check whether the query cache is present in your MySQL
          server, use the following statement:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+
</pre><p>
          You can defragment the query cache to better utilize its
          memory with the <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
          QUERY CACHE</code></a> statement. The statement does not remove
          any queries from the cache.
        </p><p>
          The <code class="literal">RESET QUERY CACHE</code> statement removes all
          query results from the query cache. The
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statement also does this.
        </p><p>
          To monitor query cache performance, use
          <a class="link" href="sql-syntax.html#show-status" title="13.7.5.36. SHOW STATUS Syntax"><code class="literal">SHOW STATUS</code></a> to view the cache
          status variables:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Qcache%';</code></strong>
+-------------------------+--------+
| Variable_name           | Value  |
+-------------------------+--------+
| Qcache_free_blocks      | 36     |
| Qcache_free_memory      | 138488 |
| Qcache_hits             | 79570  |
| Qcache_inserts          | 27087  |
| Qcache_lowmem_prunes    | 3114   |
| Qcache_not_cached       | 22989  |
| Qcache_queries_in_cache | 415    |
| Qcache_total_blocks     | 912    |
+-------------------------+--------+
</pre><p>
          Descriptions of each of these variables are given in
          <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>. Some uses for them
          are described here.
        </p><p>
          The total number of <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          queries is given by this formula:
        </p><pre class="programlisting">  Com_select
+ Qcache_hits
+ queries with errors found by parser</pre><p>
          The <code class="literal">Com_select</code> value is given by this
          formula:
        </p><pre class="programlisting">  Qcache_inserts
+ Qcache_not_cached
+ queries with errors found during the column-privileges check</pre><p>
          The query cache uses variable-length blocks, so
          <a class="link" href="server-administration.html#statvar_Qcache_total_blocks"><code class="literal">Qcache_total_blocks</code></a> and
          <a class="link" href="server-administration.html#statvar_Qcache_free_blocks"><code class="literal">Qcache_free_blocks</code></a> may
          indicate query cache memory fragmentation. After
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH QUERY
          CACHE</code></a>, only a single free block remains.
        </p><p>
          Every cached query requires a minimum of two blocks (one for
          the query text and one or more for the query results). Also,
          every table that is used by a query requires one block.
          However, if two or more queries use the same table, only one
          table block needs to be allocated.
        </p><p>
          The information provided by the
          <a class="link" href="server-administration.html#statvar_Qcache_lowmem_prunes"><code class="literal">Qcache_lowmem_prunes</code></a> status
          variable can help you tune the query cache size. It counts the
          number of queries that have been removed from the cache to
          free up memory for caching new queries. The query cache uses a
          least recently used (LRU) strategy to decide which queries to
          remove from the cache. Tuning information is given in
          <a class="xref" href="optimization.html#query-cache-configuration" title="8.9.3.3. Query Cache Configuration">Section 8.9.3.3, “Query Cache Configuration”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="statement-caching"></a>8.9.4. Caching of Prepared Statements and Stored Programs</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51602928"></a><a class="indexterm" name="idp51604416"></a><p>
        For certain statements that a client might execute multiple
        times during a session, the server converts the statement to an
        internal structure and caches that structure to be used during
        execution. Caching enables the server to perform more
        efficiently because it avoids the overhead of reconverting the
        statement should it be needed again during the session.
        Conversion and caching occurs for these statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Prepared statements, both those processed at the SQL level
            (using the <a class="link" href="sql-syntax.html#prepare" title="13.5.1. PREPARE Syntax"><code class="literal">PREPARE</code></a> statement)
            and those processed using the binary client/server protocol
            (using the
            <a class="link" href="connectors-apis.html#mysql-stmt-prepare" title="22.8.11.21. mysql_stmt_prepare()"><code class="literal">mysql_stmt_prepare()</code></a> C API
            function). The
            <a class="link" href="server-administration.html#sysvar_max_prepared_stmt_count"><code class="literal">max_prepared_stmt_count</code></a>
            system variable controls the total number of statements the
            server caches. (The sum of the number of prepared statements
            across all sessions.)
          </p></li><li class="listitem"><p>
            Stored programs (stored procedures and functions, triggers,
            and events). In this case, the server converts and caches
            the entire program body. The
            <a class="link" href="server-administration.html#sysvar_stored_program_cache"><code class="literal">stored_program_cache</code></a> system
            variable indicates the approximate number of stored programs
            the the server caches per session.
</p></li></ul>
</div>
<p>
        The server maintains caches for prepared statements and stored
        programs on a per-session basis. Statements cached for one
        session are not accessible to other sessions. When a session
        ends, the server discards any statements cached for it.
      </p><p>
        When the server uses a cached internal statement structure, it
        must take care that the structure does not go out of date.
        Metadata changes can occur for an object used by the statement,
        causing a mismatch between the current object definition and the
        definition as represented in the internal statement structure.
        Metadata changes occur for DDL statements such as those that
        create, drop, alter, rename, or truncate tables, or that
        analyze, optimize, or repair tables. Table content changes (for
        example, with <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> or
        <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>) do not change metadata,
        nor do <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements.
      </p><p>
        Here is an illustration of the problem. Suppose that a client
        prepares this statement:
      </p><pre class="programlisting">PREPARE s1 FROM 'SELECT * FROM t1';</pre><p>
        The <code class="literal">SELECT *</code> expands in the internal
        structure to the list of columns in the table. If the set of
        columns in the table is modified with <code class="literal">ALTER
        TABLE</code>, the prepared statement goes out of date. If the
        server does not detect this change the next time the client
        executes <code class="literal">s1</code>, the prepared statement will
        return incorrect results.
      </p><p>
        To avoid problems caused by metadata changes to tables or views
        referred to by the prepared statement, the server detects these
        changes and automatically reprepares the statement when it is
        next executed. That is, the server reparses the statement and
        rebuilds the internal structure. Reparsing also occurs after
        referenced tables or views are flushed from the table definition
        cache, either implicitly to make room for new entries in the
        cache, or explicitly due to
        <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>.
      </p><p>
        Similarly, if changes occur to objects used by a stored program,
        the server reparses affected statements within the program.
        (Before MySQL 5.6.6, the server does not detect metadata changes
        affecting stored programs, so such changes can cause incorrect
        results or errors.)
      </p><p>
        The server also detects metadata changes for objects in
        expressions. These might be used in statements specific to
        stored programs, such as <code class="literal">DECLARE CURSOR</code> or
        flow-control statements such as
        <a class="link" href="sql-syntax.html#if" title="13.6.5.2. IF Syntax"><code class="literal">IF</code></a>,
        <a class="link" href="sql-syntax.html#case" title="13.6.5.1. CASE Syntax"><code class="literal">CASE</code></a>, and
        <a class="link" href="sql-syntax.html#return" title="13.6.5.7. RETURN Syntax"><code class="literal">RETURN</code></a>.
      </p><p>
        To avoid reparsing entire stored programs, the server reparses
        affected statements or expressions within a program only as
        needed. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Suppose that metadata for a table or view is changed.
            Reparsing occurs for a <code class="literal">SELECT *</code> within
            the program that accesses the table or view, but not for a
            <code class="literal">SELECT *</code> that does not access the table
            or view.
          </p></li><li class="listitem"><p>
            When a statement is affected, the server reparses it only
            partially if possible. Consider this
            <a class="link" href="sql-syntax.html#case" title="13.6.5.1. CASE Syntax"><code class="literal">CASE</code></a> statement:
          </p><pre class="programlisting">CASE <em class="replaceable"><code>case_expr</code></em>
  WHEN <em class="replaceable"><code>when_expr1</code></em> ...
  WHEN <em class="replaceable"><code>when_expr2</code></em> ...
  WHEN <em class="replaceable"><code>when_expr3</code></em> ...
  ...
END CASE
</pre><p>
            If a metadata change affects only <code class="literal">WHEN
            <em class="replaceable"><code>when_expr3</code></em></code>, that
            expression is reparsed. <em class="replaceable"><code>case_expr</code></em>
            and the other <code class="literal">WHEN</code> expressions are not
            reparsed.
</p></li></ul>
</div>
<p>
        Reparsing uses the default database and SQL mode that were in
        effect for the original conversion to internal form.
      </p><p>
        The server attempts reparsing up to three times. An error occurs
        if all attempts fail.
      </p><p>
        Reparsing is automatic, but to the extent that it occurs,
        diminishes prepared statement and stored program performance.
      </p><p>
        For prepared statements, the
        <a class="link" href="server-administration.html#statvar_Com_xxx"><code class="literal">Com_stmt_reprepare</code></a>
        status variable tracks the number of repreparations.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="locking-issues"></a>8.10. Optimizing Locking Operations</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#internal-locking">8.10.1. Internal Locking Methods</a></span></dt><dt><span class="section"><a href="optimization.html#table-locking">8.10.2. Table Locking Issues</a></span></dt><dt><span class="section"><a href="optimization.html#concurrent-inserts">8.10.3. Concurrent Inserts</a></span></dt><dt><span class="section"><a href="optimization.html#metadata-locking">8.10.4. Metadata Locking</a></span></dt><dt><span class="section"><a href="optimization.html#external-locking">8.10.5. External Locking</a></span></dt></dl>
</div>
<p>
      MySQL manages contention for table contents using
      <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Internal locking is performed within the MySQL server itself
          to manage contention for table contents by multiple threads.
          This type of locking is internal because it is performed
          entirely by the server and involves no other programs. See
          <a class="xref" href="optimization.html#internal-locking" title="8.10.1. Internal Locking Methods">Section 8.10.1, “Internal Locking Methods”</a>.
        </p></li><li class="listitem"><p>
          External locking occurs when the server and other programs
          lock <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> table files to
          coordinate among themselves which program can access the
          tables at which time. See <a class="xref" href="optimization.html#external-locking" title="8.10.5. External Locking">Section 8.10.5, “External Locking”</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="internal-locking"></a>8.10.1. Internal Locking Methods</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51648544"></a><a class="indexterm" name="idp51649616"></a><a class="indexterm" name="idp51651104"></a><a class="indexterm" name="idp51652176"></a><a class="indexterm" name="idp51653664"></a><a class="indexterm" name="idp51654736"></a><a class="indexterm" name="idp51655808"></a><a class="indexterm" name="idp51657296"></a><a class="indexterm" name="idp51658784"></a><p>
        This section discusses internal locking; that is, locking
        performed within the MySQL server itself to manage contention
        for table contents by multiple sessions. This type of locking is
        internal because it is performed entirely by the server and
        involves no other programs. For locking performed on MySQL files
        by other programs, see <a class="xref" href="optimization.html#external-locking" title="8.10.5. External Locking">Section 8.10.5, “External Locking”</a>.
</p>
<h4><a name="idp51661200"></a>
        Row-Level Locking
</h4>
<p>
        MySQL uses <a class="link" href="glossary.html#glos_row_lock" title="row lock">row-level
        locking</a> for <code class="literal">InnoDB</code> tables to support
        simultaneous write access by multiple sessions, making them
        suitable for multi-user, highly concurrent, and OLTP
        applications.
      </p><p>
        To avoid <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> when
        performing multiple concurrent write operations on a single
        <code class="literal">InnoDB</code> table, acquire necessary locks at the
        start of the transaction by issuing a <code class="literal">SELECT ... FOR
        UPDATE</code> statement for each group of rows expected to be
        modified, even if the <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
        statements come later in the transaction. If transactions modify
        or lock more than one table, issue the applicable statements in
        the same order within each transaction. Deadlocks affect
        performance rather than representing a serious error, because
        <code class="literal">InnoDB</code> automatically
        <a class="link" href="glossary.html#glos_deadlock_detection" title="deadlock detection">detects</a> deadlock
        conditions and rolls back one of the affected transactions.
      </p><p>
        Advantages of row-level locking:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Fewer lock conflicts when different sessions access
            different rows.
          </p></li><li class="listitem"><p>
            Fewer changes for rollbacks.
          </p></li><li class="listitem"><p>
            Possible to lock a single row for a long time.
</p></li></ul>
</div>
<h4><a name="idp51672304"></a>
        Table-Level Locking
</h4>
<p>
        MySQL uses <a class="link" href="glossary.html#glos_table_lock" title="table lock">table-level
        locking</a> for <code class="literal">MyISAM</code>,
        <code class="literal">MEMORY</code>, and <code class="literal">MERGE</code> tables,
        allowing only one session to update those tables at a time,
        making them more suitable for read-only, read-mostly, or
        single-user applications.
      </p><p>
        These storage engines avoid
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> by always
        requesting all needed locks at once at the beginning of a query
        and always locking the tables in the same order. The tradeoff is
        that this strategy reduces concurrency; other sessions that want
        to modify the table must wait until the current
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statement finishes.
      </p><p>
        MySQL grants table write locks as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            If there are no locks on the table, put a write lock on it.
          </p></li><li class="listitem"><p>
            Otherwise, put the lock request in the write lock queue.
</p></li></ol>
</div>
<p>
        MySQL grants table read locks as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            If there are no write locks on the table, put a read lock on
            it.
          </p></li><li class="listitem"><p>
            Otherwise, put the lock request in the read lock queue.
</p></li></ol>
</div>
<p>
        Table updates are given higher priority than table retrievals.
        Therefore, when a lock is released, the lock is made available
        to the requests in the write lock queue and then to the requests
        in the read lock queue. This ensures that updates to a table are
        not <span class="quote">“<span class="quote">starved</span>”</span> even if there is heavy
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> activity for the table.
        However, if you have many updates for a table,
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements wait until
        there are no more updates.
      </p><p>
        For information on altering the priority of reads and writes,
        see <a class="xref" href="optimization.html#table-locking" title="8.10.2. Table Locking Issues">Section 8.10.2, “Table Locking Issues”</a>.
      </p><p>
        You can analyze the table lock contention on your system by
        checking the
        <a class="link" href="server-administration.html#statvar_Table_locks_immediate"><code class="literal">Table_locks_immediate</code></a> and
        <a class="link" href="server-administration.html#statvar_Table_locks_waited"><code class="literal">Table_locks_waited</code></a> status
        variables, which indicate the number of times that requests for
        table locks could be granted immediately and the number that had
        to wait, respectively:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Table%';</code></strong>
+-----------------------+---------+
| Variable_name         | Value   |
+-----------------------+---------+
| Table_locks_immediate | 1151552 |
| Table_locks_waited    | 15324   |
+-----------------------+---------+
</pre><a class="indexterm" name="idp51692672"></a><a class="indexterm" name="idp51693744"></a><p>
        The <code class="literal">MyISAM</code> storage engine supports concurrent
        inserts to reduce contention between readers and writers for a
        given table: If a <code class="literal">MyISAM</code> table has no free
        blocks in the middle of the data file, rows are always inserted
        at the end of the data file. In this case, you can freely mix
        concurrent <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements for a
        <code class="literal">MyISAM</code> table without locks. That is, you can
        insert rows into a <code class="literal">MyISAM</code> table at the same
        time other clients are reading from it. Holes can result from
        rows having been deleted from or updated in the middle of the
        table. If there are holes, concurrent inserts are disabled but
        are enabled again automatically when all holes have been filled
        with new data.. This behavior is altered by the
        <a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> system
        variable. See <a class="xref" href="optimization.html#concurrent-inserts" title="8.10.3. Concurrent Inserts">Section 8.10.3, “Concurrent Inserts”</a>.
      </p><p>
        If you acquire a table lock explicitly with
        <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>, you can request a
        <code class="literal">READ LOCAL</code> lock rather than a
        <code class="literal">READ</code> lock to enable other sessions to perform
        concurrent inserts while you have the table locked.
      </p><p>
        To perform many <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> operations on a table
        <code class="literal">real_table</code> when concurrent inserts are not
        possible, you can insert rows into a temporary table
        <code class="literal">temp_table</code> and update the real table with the
        rows from the temporary table periodically. This can be done
        with the following code:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>LOCK TABLES real_table WRITE, temp_table WRITE;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO real_table SELECT * FROM temp_table;</code></strong>
mysql&gt; <strong class="userinput"><code>DELETE FROM temp_table;</code></strong>
mysql&gt; <strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre><p>
        Advantages of table-level locking:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Requires relatively little memory.
          </p></li><li class="listitem"><p>
            Fast when used on a large part of the table because only a
            single lock is involved.
          </p></li><li class="listitem"><p>
            Fast if you often do <code class="literal">GROUP BY</code> operations
            on a large part of the data or if you must scan the entire
            table frequently.
</p></li></ul>
</div>
<p>
        Generally, table locks are suited to the following cases:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Most statements for the table are reads.
          </p></li><li class="listitem"><p>
            Statements for the table are a mix of reads and writes,
            where writes are updates or deletes for a single row that
            can be fetched with one key read:
          </p><pre class="programlisting">UPDATE <em class="replaceable"><code>tbl_name</code></em> SET <em class="replaceable"><code>column</code></em>=<em class="replaceable"><code>value</code></em> WHERE <em class="replaceable"><code>unique_key_col</code></em>=<em class="replaceable"><code>key_value</code></em>;
DELETE FROM <em class="replaceable"><code>tbl_name</code></em> WHERE <em class="replaceable"><code>unique_key_col</code></em>=<em class="replaceable"><code>key_value</code></em>;
</pre></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> combined with
            concurrent <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements,
            and very few <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements.
          </p></li><li class="listitem"><p>
            Many scans or <code class="literal">GROUP BY</code> operations on the
            entire table without any writers.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="table-locking"></a>8.10.2. Table Locking Issues</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51730544"></a><p>
        <code class="literal">InnoDB</code> tables use row-level locking so that
        multiple sessions and applications can read from and write to
        the same table simultaneously, without making each other wait or
        producing inconsistent results. For this storage engine, avoid
        using the <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> statement,
        because it does not offer any extra protection, but instead
        reduces concurrency. The automatic row-level locking makes these
        tables suitable for your busiest databases with your most
        important data, while also simplifying application logic since
        you do not need to lock and unlock tables. Consequently, the
        <code class="literal">InnoDB</code> storage engine is the default in MySQL
        5.6.
      </p><p>
        MySQL uses table locking (instead of page, row, or column
        locking) for all storage engines except
        <code class="literal">InnoDB</code>. The locking operations themselves do
        not have much overhead. But because only one session can write
        to a table at any one time, for best performance with these
        other storage engines, use them primarily for tables that are
        queried often and rarely inserted into or updated.
</p>
<h4><a name="idp51736912"></a>
        Performance Considerations Favoring <code class="literal">InnoDB</code>
</h4>
<p>
        When choosing whether to create a table using
        <code class="literal">InnoDB</code> or a different storage engine, keep in
        mind the following disadvantages of table locking:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Table locking enables many sessions to read from a table at
            the same time, but if a session wants to write to a table,
            it must first get exclusive access, meaning it might have to
            wait for other sessions to finish with the table first.
            During the update, all other sessions that want to access
            this particular table must wait until the update is done.
          </p></li><li class="listitem"><p>
            Table locking causes problems when a session is waiting
            because the disk is full and free space needs to become
            available before the session can proceed. In this case, all
            sessions that want to access the problem table are also put
            in a waiting state until more disk space is made available.
          </p></li><li class="listitem"><p>
            A <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement that takes
            a long time to run prevents other sessions from updating the
            table in the meantime, making the other sessions appear slow
            or unresponsive. While a session is waiting to get exclusive
            access to the table for updates, other sessions that issue
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements will queue
            up behind it, reducing concurrency even for read-only
            sessions.
</p></li></ul>
</div>
<h4><a name="idp51744992"></a>
        Workarounds for Locking Performance Issues
</h4>
<p>
        The following items describe some ways to avoid or reduce
        contention caused by table locking:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Consider switching the table to the
            <code class="literal">InnoDB</code> storage engine, either using
            <code class="literal">CREATE TABLE ... ENGINE=INNODB</code> during
            setup, or using <code class="literal">ALTER TABLE ...
            ENGINE=INNODB</code> for an existing table. See
            <a class="xref" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine">Section 14.2, “The <code class="literal">InnoDB</code> Storage Engine”</a> for more details
            about this storage engine.
          </p></li><li class="listitem"><p>
            Optimize <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements to
            run faster so that they lock tables for a shorter time. You
            might have to create some summary tables to do this.
          </p></li><li class="listitem"><p>
            Start <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with
            <a class="link" href="server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a>. For
            storage engines that use only table-level locking (such as
            <code class="literal">MyISAM</code>, <code class="literal">MEMORY</code>, and
            <code class="literal">MERGE</code>), this gives all statements that
            update (modify) a table lower priority than
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements. In this
            case, the second <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statement in the preceding scenario would execute before the
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statement, and would
            not wait for the first <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            to finish.
          </p></li><li class="listitem"><p>
            To specify that all updates issued in a specific connection
            should be done with low priority, set the
            <a class="link" href="server-administration.html#sysvar_low_priority_updates"><code class="literal">low_priority_updates</code></a> server
            system variable equal to 1.
          </p></li><li class="listitem"><p>
            To give a specific <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statement lower
            priority, use the <code class="literal">LOW_PRIORITY</code> attribute.
          </p></li><li class="listitem"><p>
            To give a specific <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
            statement higher priority, use the
            <code class="literal">HIGH_PRIORITY</code> attribute. See
            <a class="xref" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax">Section 13.2.9, “<code class="literal">SELECT</code> Syntax”</a>.
          </p></li><li class="listitem"><p>
            Start <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with a low value for the
            <a class="link" href="server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a> system
            variable to force MySQL to temporarily elevate the priority
            of all <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements that
            are waiting for a table after a specific number of inserts
            to the table occur. This permits <code class="literal">READ</code>
            locks after a certain number of <code class="literal">WRITE</code>
            locks.
          </p></li><li class="listitem"><p>
            

            If you have problems with
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> combined with
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, consider switching to
            <code class="literal">MyISAM</code> tables, which support concurrent
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> and
            <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements. (See
            <a class="xref" href="optimization.html#concurrent-inserts" title="8.10.3. Concurrent Inserts">Section 8.10.3, “Concurrent Inserts”</a>.)
          </p></li><li class="listitem"><p>
            If you mix inserts and deletes on the same nontransactional
            table, <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> may
            help. See <a class="xref" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax">Section 13.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
              As of MySQL 5.6.6, <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT
              DELAYED</code></a> is deprecated, and will be removed in a
              future release. Use <code class="literal">INSERT</code> (without
              <code class="literal">DELAYED</code>) instead.
</p>
</div>
</li><li class="listitem"><p>
            If you have problems with mixed
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> and
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements, the
            <code class="literal">LIMIT</code> option to
            <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> may help. See
            <a class="xref" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax">Section 13.2.2, “<code class="literal">DELETE</code> Syntax”</a>.
          </p></li><li class="listitem"><p>
            Using <code class="literal">SQL_BUFFER_RESULT</code> with
            <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements can help to
            make the duration of table locks shorter. See
            <a class="xref" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax">Section 13.2.9, “<code class="literal">SELECT</code> Syntax”</a>.
          </p></li><li class="listitem"><p>
            Splitting table contents into separate tables may help, by
            allowing queries to run against columns in one table, while
            updates are confined to columns in a different table.
          </p></li><li class="listitem"><p>
            You could change the locking code in
            <code class="filename">mysys/thr_lock.c</code> to use a single queue.
            In this case, write locks and read locks would have the same
            priority, which might help some applications.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="concurrent-inserts"></a>8.10.3. Concurrent Inserts</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51797632"></a><a class="indexterm" name="idp51798704"></a><p>
        The <code class="literal">MyISAM</code> storage engine supports concurrent
        inserts to reduce contention between readers and writers for a
        given table: If a <code class="literal">MyISAM</code> table has no holes
        in the data file (deleted rows in the middle), an
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement can be executed
        to add rows to the end of the table at the same time that
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements are reading
        rows from the table. If there are multiple
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements, they are
        queued and performed in sequence, concurrently with the
        <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements. The results of
        a concurrent <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> may not be
        visible immediately.
      </p><p>
        The <a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> system
        variable can be set to modify the concurrent-insert processing.
        By default, the variable is set to <code class="literal">AUTO</code> (or
        1) and concurrent inserts are handled as just described. If
        <a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> is set to
        <code class="literal">NEVER</code> (or 0), concurrent inserts are
        disabled. If the variable is set to <code class="literal">ALWAYS</code>
        (or 2), concurrent inserts at the end of the table are permitted
        even for tables that have deleted rows. See also the description
        of the <a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a> system
        variable.
      </p><p>
        Under circumstances where concurrent inserts can be used, there
        is seldom any need to use the <code class="literal">DELAYED</code>
        modifier for <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements.
        See <a class="xref" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax">Section 13.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
      </p><p>
        If you are using the binary log, concurrent inserts are
        converted to normal inserts for <code class="literal">CREATE ...
        SELECT</code> or
        <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1. INSERT ... SELECT Syntax"><code class="literal">INSERT ...
        SELECT</code></a> statements. This is done to ensure that you can
        re-create an exact copy of your tables by applying the log
        during a backup operation. See <a class="xref" href="server-administration.html#binary-log" title="5.2.4. The Binary Log">Section 5.2.4, “The Binary Log”</a>. In
        addition, for those statements a read lock is placed on the
        selected-from table such that inserts into that table are
        blocked. The effect is that concurrent inserts for that table
        must wait as well.
      </p><p>
        With <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
        INFILE</code></a>, if you specify <code class="literal">CONCURRENT</code>
        with a <code class="literal">MyISAM</code> table that satisfies the
        condition for concurrent inserts (that is, it contains no free
        blocks in the middle), other sessions can retrieve data from the
        table while <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a> is
        executing. Use of the <code class="literal">CONCURRENT</code> option
        affects the performance of <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD
        DATA</code></a> a bit, even if no other session is using the
        table at the same time.
      </p><p>
        If you specify <code class="literal">HIGH_PRIORITY</code>, it overrides
        the effect of the
        <a class="link" href="server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a> option if
        the server was started with that option. It also causes
        concurrent inserts not to be used.
      </p><p>
        For <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
        TABLE</code></a>, the difference between <code class="literal">READ
        LOCAL</code> and <code class="literal">READ</code> is that
        <code class="literal">READ LOCAL</code> permits nonconflicting
        <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements (concurrent
        inserts) to execute while the lock is held. However, this cannot
        be used if you are going to manipulate the database using
        processes external to the server while you hold the lock.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="metadata-locking"></a>8.10.4. Metadata Locking</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51831200"></a><a class="indexterm" name="idp51832688"></a><p>
        MySQL uses metadata locking to manage access to objects (tables,
        triggers, and so forth). Metadata locking is used to ensure data
        consistency but does involve some overhead, which increases as
        query volume increases. Metadata contention increases the more
        that multiple queries attempt to access the same objects.
      </p><p>
        Metadata locking is not a replacement for the table definition
        case, and its mutxes and locks differ from the
        <code class="literal">LOCK_open</code> mutex. The following discussion
        provides some information about how metadata locking works.
      </p><p>
        To ensure transaction serializability, the server must not
        permit one session to perform a data definition language (DDL)
        statement on a table that is used in an uncompleted transaction
        in another session. The server achieves this by acquiring
        metadata locks on tables used within a transaction and deferring
        release of those locks until the transaction ends. A metadata
        lock on a table prevents changes to the table's structure. This
        locking approach has the implication that a table that is being
        used by a transaction within one session cannot be used in DDL
        statements by other sessions until the transaction ends.
      </p><p>
        This principle applies not only to transactional tables, but
        also to nontransactional tables. Suppose that a session begins a
        transaction that uses transactional table <code class="literal">t</code>
        and nontransactional table <code class="literal">nt</code> as follows:
      </p><pre class="programlisting">START TRANSACTION;
SELECT * FROM t;
SELECT * FROM nt;</pre><p>
        Metadata locks are held on both <code class="literal">t</code> and
        <code class="literal">nt</code> until the transaction ends. If another
        session attempts a DDL operation on either table, it blocks
        until metadata lock release at transaction end. For example, a
        second session blocks if it attempts any of these operations:
      </p><pre class="programlisting">DROP TABLE t;
ALTER TABLE t ...;
DROP TABLE nt;
ALTER TABLE nt ...;</pre><p>
        If the server acquires metadata locks for a statement that is
        syntactically valid but fails during execution, it does not
        release the locks early. Lock release is still deferred to the
        end of the transaction because the failed statement is written
        to the binary log and the locks protect log consistency.
      </p><p>
        In autocommit mode, each statement is in effect a complete
        transaction, so metadata locks acquired for the statement are
        held only to the end of the statement.
      </p><p>
        Metadata locks acquired during a
        <a class="link" href="sql-syntax.html#prepare" title="13.5.1. PREPARE Syntax"><code class="literal">PREPARE</code></a> statement are released
        once the statement has been prepared, even if preparation occurs
        within a multiple-statement transaction.
      </p><p>
        Before MySQL 5.5, when a transaction acquired the equivalent of
        a metadata lock for a table used within a statement, it released
        the lock at the end of the statement. This approach had the
        disadvantage that if a DDL statement occurred for a table that
        was being used by another session in an active transaction,
        statements could be written to the binary log in the wrong
        order.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="external-locking"></a>8.10.5. External Locking</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51848352"></a><a class="indexterm" name="idp51849424"></a><p>
        External locking is the use of file system locking to manage
        contention for <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> database
        tables by multiple processes. External locking is used in
        situations where a single process such as the MySQL server
        cannot be assumed to be the only process that requires access to
        tables. Here are some examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you run multiple servers that use the same database
            directory (not recommended), each server must have external
            locking enabled.
          </p></li><li class="listitem"><p>
            If you use <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to perform table
            maintenance operations on
            <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables, you must either
            ensure that the server is not running, or that the server
            has external locking enabled so that it locks table files as
            necessary to coordinate with <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
            for access to the tables. The same is true for use of
            <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> to pack
            <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables.
          </p><p>
            If the server is run with external locking enabled, you can
            use <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> at any time for read
            operations such a checking tables. In this case, if the
            server tries to update a table that
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> is using, the server will wait
            for <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to finish before it
            continues.
          </p><p>
            If you use <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> for write operations
            such as repairing or optimizing tables, or if you use
            <a class="link" href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span class="command"><strong>myisampack</strong></span></a> to pack tables, you
            <span class="emphasis"><em>must</em></span> always ensure that the
            <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server is not using the table. If
            you don't stop <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>, at least do a
            <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-tables</strong></span></a> before you run
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>. Your tables <span class="emphasis"><em>may
            become corrupted</em></span> if the server and
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> access the tables
            simultaneously.
</p></li></ul>
</div>
<p>
        With external locking in effect, each process that requires
        access to a table acquires a file system lock for the table
        files before proceeding to access the table. If all necessary
        locks cannot be acquired, the process is blocked from accessing
        the table until the locks can be obtained (after the process
        that currently holds the locks releases them).
      </p><p>
        External locking affects server performance because the server
        must sometimes wait for other processes before it can access
        tables.
      </p><p>
        External locking is unnecessary if you run a single server to
        access a given data directory (which is the usual case) and if
        no other programs such as <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> need to
        modify tables while the server is running. If you only
        <span class="emphasis"><em>read</em></span> tables with other programs, external
        locking is not required, although <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>
        might report warnings if the server changes tables while
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> is reading them.
      </p><p>
        With external locking disabled, to use
        <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>, you must either stop the server
        while <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> executes or else lock and
        flush the tables before running <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>.
        (See <a class="xref" href="optimization.html#system-optimization" title="8.11.1. System Factors and Startup Parameter Tuning">Section 8.11.1, “System Factors and Startup Parameter Tuning”</a>.) To avoid this
        requirement, use the <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a>
        and <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> statements to
        check and repair <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables.
      </p><p>
        For <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>, external locking is controlled by
        the value of the
        <a class="link" href="server-administration.html#sysvar_skip_external_locking"><code class="literal">skip_external_locking</code></a> system
        variable. When this variable is enabled, external locking is
        disabled, and vice versa. From MySQL 4.0 on, external locking is
        disabled by default.
      </p><p>
        Use of external locking can be controlled at server startup by
        using the <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> or
        <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a>
        option.
      </p><p>
        If you do use external locking option to enable updates to
        <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables from many MySQL
        processes, you must ensure that the following conditions are
        satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Do not use the query cache for queries that use tables that
            are updated by another process.
          </p></li><li class="listitem"><p>
            Do not start the server with the
            <a class="link" href="server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=ALL</code></a> option
            or use the <code class="literal">DELAY_KEY_WRITE=1</code> table option
            for any shared tables. Otherwise, index corruption can
            occur.
</p></li></ul>
</div>
<p>
        The easiest way to satisfy these conditions is to always use
        <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> together with
        <a class="link" href="server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=OFF</code></a> and
        <a class="link" href="server-administration.html#sysvar_query_cache_size"><code class="option">--query-cache-size=0</code></a>. (This is
        not done by default because in many setups it is useful to have
        a mixture of the preceding options.)
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimizing-the-server"></a>8.11. Optimizing the MySQL Server</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#system-optimization">8.11.1. System Factors and Startup Parameter Tuning</a></span></dt><dt><span class="section"><a href="optimization.html#server-parameters">8.11.2. Tuning Server Parameters</a></span></dt><dt><span class="section"><a href="optimization.html#disk-issues">8.11.3. Optimizing Disk I/O</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-memory">8.11.4. Optimizing Memory Use</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-network">8.11.5. Optimizing Network Use</a></span></dt><dt><span class="section"><a href="optimization.html#thread-pool-plugin">8.11.6. The Thread Pool Plugin</a></span></dt></dl>
</div>
<p>
      This section discusses optimization techniques for the database
      server, primarily dealing with system configuration rather than
      tuning SQL statements. The information in this section is
      appropriate for DBAs who want to ensure performance and
      scalability across the servers they manage; for developers
      constructing installation scripts that include setting up the
      database; and people running MySQL themselves for development,
      testing, and so on who want to maximize their own productivity.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="system-optimization"></a>8.11.1. System Factors and Startup Parameter Tuning</h3>
</div>
</div>
</div>
<a class="indexterm" name="idp51897520"></a><a class="indexterm" name="idp51899008"></a><a class="indexterm" name="idp51900080"></a><p>
        We start with system-level factors, because some of these
        decisions must be made very early to achieve large performance
        gains. In other cases, a quick look at this section may suffice.
        However, it is always nice to have a sense of how much can be
        gained by changing factors that apply at this level.
      </p><p>
        The operating system to use is very important. To get the best
        use of multiple-CPU machines, you should use Solaris (because
        its threads implementation works well) or Linux (because the 2.4
        and later kernels have good SMP support). Note that older Linux
        kernels have a 2GB filesize limit by default. If you have such a
        kernel and a need for files larger than 2GB, get the Large File
        Support (LFS) patch for the ext2 file system. Other file systems
        such as ReiserFS and XFS do not have this 2GB limitation.
      </p><p>
        Before using MySQL in production, we advise you to test it on
        your intended platform.
      </p><a class="indexterm" name="idp51904384"></a><p>
        Other tips:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you have enough RAM, you could remove all swap devices.
            Some operating systems use a swap device in some contexts
            even if you have free memory.
          </p></li><li class="listitem"><p>
            Avoid external locking for
            <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables. Since MySQL 4.0,
            the default has been for external locking to be disabled on
            all systems. The
            <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> and
            <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a>
            options explicitly enable and disable external locking.
          </p><p>
            Note that disabling external locking does not affect MySQL's
            functionality as long as you run only one server. Just
            remember to take down the server (or lock and flush the
            relevant tables) before you run
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a>. On some systems it is
            mandatory to disable external locking because it does not
            work, anyway.
          </p><p>
            The only case in which you cannot disable external locking
            is when you run multiple MySQL <span class="emphasis"><em>servers</em></span>
            (not clients) on the same data, or if you run
            <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> to check (not repair) a table
            without telling the server to flush and lock the tables
            first. Note that using multiple MySQL servers to access the
            same data concurrently is generally <span class="emphasis"><em>not</em></span>
            recommended, except when using MySQL Cluster.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
              MySQL Cluster is currently not supported in MySQL
              5.6. Users wishing to upgrade a MySQL Cluster
              from MySQL 5.0 or 5.1 should instead migrate to MySQL
              Cluster NDB 7.0 or 7.1; these are based on MySQL 5.1 but
              contain the latest improvements and fixes for
              <a class="link" href="mysql-cluster.html" title="Chapter 17. MySQL Cluster NDB 7.3"><code class="literal">NDB</code></a>.
</p>
</div>
<p>
            The <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> and
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> statements use internal locking, so you can
            use them even if external locking is disabled.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="server-parameters"></a>8.11.2. Tuning Server Parameters</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp51920256"></a><a class="indexterm" name="idp51921744"></a><a class="indexterm" name="idp51923232"></a><a class="indexterm" name="idp51924720"></a><p>
        You can determine the default buffer sizes used by the
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server using this command:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --verbose --help</code></strong>
</pre><a class="indexterm" name="idp51928512"></a><a class="indexterm" name="idp51929584"></a><p>
        This command produces a list of all <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
        options and configurable system variables. The output includes
        the default variable values and looks something like this:
      </p><pre class="programlisting">abort-slave-event-count                                    0
allow-suspicious-udfs                                      FALSE
archive                                                    ON
auto-increment-increment                                   1
auto-increment-offset                                      1
autocommit                                                 TRUE
automatic-sp-privileges                                    TRUE
back-log                                                   80
basedir                                                    /home/jon/bin/mysql-5.6/
big-tables                                                 FALSE
bind-address                                               *
binlog-cache-size                                          32768
binlog-checksum                                            CRC32
binlog-direct-non-transactional-updates                    FALSE
binlog-format                                              STATEMENT
binlog-max-flush-queue-time                                0
binlog-order-commits                                       TRUE
binlog-row-event-max-size                                  8192
binlog-row-image                                           FULL
binlog-rows-query-log-events                               FALSE
binlog-stmt-cache-size                                     32768
blackhole                                                  ON
bulk-insert-buffer-size                                    8388608
character-set-client-handshake                             TRUE
character-set-filesystem                                   binary
character-set-server                                       latin1
character-sets-dir                                         /home/jon/bin/mysql-5.6/share/charsets/
chroot                                                     (No default value)
collation-server                                           latin1_swedish_ci
completion-type                                            NO_CHAIN
concurrent-insert                                          AUTO
connect-timeout                                            10
console                                                    FALSE
datadir                                                    (No default value)
date-format                                                %Y-%m-%d
datetime-format                                            %Y-%m-%d %H:%i:%s
default-storage-engine                                     InnoDB
default-time-zone                                          (No default value)
default-tmp-storage-engine                                 InnoDB
default-week-format                                        0
delay-key-write                                            ON
delayed-insert-limit                                       100
delayed-insert-timeout                                     300
delayed-queue-size                                         1000
des-key-file                                               (No default value)
disconnect-on-expired-password                             TRUE
disconnect-slave-event-count                               0
div-precision-increment                                    4
end-markers-in-json                                        FALSE
enforce-gtid-consistency                                   FALSE
eq-range-index-dive-limit                                  10
event-scheduler                                            OFF
expire-logs-days                                           0
explicit-defaults-for-timestamp                            FALSE
external-locking                                           FALSE
flush                                                      FALSE
flush-time                                                 0
ft-boolean-syntax                                          + -&gt;&lt;()~*:""&amp;|
ft-max-word-len                                            84
ft-min-word-len                                            4
ft-query-expansion-limit                                   20
ft-stopword-file                                           (No default value)
gdb                                                        FALSE
general-log                                                FALSE
general-log-file                                           /home/jon/bin/mysql-5.6/data/havskatt.log
group-concat-max-len                                       1024
gtid-mode                                                  OFF
help                                                       TRUE
host-cache-size                                            279
ignore-builtin-innodb                                      FALSE
init-connect                                               
init-file                                                  (No default value)
init-slave                                                 
innodb                                                     ON
innodb-adaptive-flushing                                   TRUE
innodb-adaptive-flushing-lwm                               10
innodb-adaptive-hash-index                                 TRUE
innodb-adaptive-max-sleep-delay                            150000
innodb-additional-mem-pool-size                            8388608
innodb-api-bk-commit-interval                              5
innodb-api-disable-rowlock                                 FALSE
innodb-api-enable-binlog                                   FALSE
innodb-api-enable-mdl                                      FALSE
innodb-api-trx-level                                       0
innodb-autoextend-increment                                64
innodb-autoinc-lock-mode                                   1
innodb-buffer-page                                         ON
innodb-buffer-page-lru                                     ON
innodb-buffer-pool-dump-at-shutdown                        FALSE
innodb-buffer-pool-dump-now                                FALSE
innodb-buffer-pool-filename                                ib_buffer_pool
innodb-buffer-pool-instances                               0
innodb-buffer-pool-load-abort                              FALSE
innodb-buffer-pool-load-at-startup                         FALSE
innodb-buffer-pool-load-now                                FALSE
innodb-buffer-pool-size                                    134217728
innodb-buffer-pool-stats                                   ON
innodb-change-buffer-max-size                              25
innodb-change-buffering                                    all
innodb-checksum-algorithm                                  innodb
innodb-checksums                                           TRUE
innodb-cmp                                                 ON
innodb-cmp-per-index                                       ON
innodb-cmp-per-index-enabled                               FALSE
innodb-cmp-per-index-reset                                 ON
innodb-cmp-reset                                           ON
innodb-cmpmem                                              ON
innodb-cmpmem-reset                                        ON
innodb-commit-concurrency                                  0
innodb-compression-failure-threshold-pct                   5
innodb-compression-level                                   6
innodb-compression-pad-pct-max                             50
innodb-concurrency-tickets                                 5000
innodb-data-file-path                                      (No default value)
innodb-data-home-dir                                       (No default value)
innodb-disable-sort-file-cache                             FALSE
innodb-doublewrite                                         TRUE
innodb-fast-shutdown                                       1
innodb-file-format                                         Antelope
innodb-file-format-check                                   TRUE
innodb-file-format-max                                     Antelope
innodb-file-io-threads                                     4
innodb-file-per-table                                      TRUE
innodb-flush-log-at-timeout                                1
innodb-flush-log-at-trx-commit                             1
innodb-flush-method                                        (No default value)
innodb-flush-neighbors                                     1
innodb-flushing-avg-loops                                  30
innodb-force-load-corrupted                                FALSE
innodb-force-recovery                                      0
innodb-ft-aux-table                                        (No default value)
innodb-ft-being-deleted                                    ON
innodb-ft-cache-size                                       8000000
innodb-ft-config                                           ON
innodb-ft-default-stopword                                 ON
innodb-ft-deleted                                          ON
innodb-ft-enable-diag-print                                FALSE
innodb-ft-enable-stopword                                  TRUE
innodb-ft-index-cache                                      ON
innodb-ft-index-table                                      ON
innodb-ft-inserted                                         ON
innodb-ft-max-token-size                                   84
innodb-ft-min-token-size                                   3
innodb-ft-num-word-optimize                                2000
innodb-ft-server-stopword-table                            (No default value)
innodb-ft-sort-pll-degree                                  2
innodb-ft-user-stopword-table                              (No default value)
innodb-io-capacity                                         200
innodb-io-capacity-max                                     18446744073709551615
innodb-large-prefix                                        FALSE
innodb-lock-wait-timeout                                   50
innodb-lock-waits                                          ON
innodb-locks                                               ON
innodb-locks-unsafe-for-binlog                             FALSE
innodb-log-buffer-size                                     8388608
innodb-log-compressed-pages                                TRUE
innodb-log-file-size                                       50331648
innodb-log-files-in-group                                  2
innodb-log-group-home-dir                                  (No default value)
innodb-lru-scan-depth                                      1024
innodb-max-dirty-pages-pct                                 75
innodb-max-dirty-pages-pct-lwm                             0
innodb-max-purge-lag                                       0
innodb-max-purge-lag-delay                                 0
innodb-metrics                                             ON
innodb-mirrored-log-groups                                 1
innodb-monitor-disable                                     (No default value)
innodb-monitor-enable                                      (No default value)
innodb-monitor-reset                                       (No default value)
innodb-monitor-reset-all                                   (No default value)
innodb-old-blocks-pct                                      37
innodb-old-blocks-time                                     1000
innodb-online-alter-log-max-size                           134217728
innodb-open-files                                          0
innodb-optimize-fulltext-only                              FALSE
innodb-page-size                                           16384
innodb-print-all-deadlocks                                 FALSE
innodb-purge-batch-size                                    300
innodb-purge-threads                                       1
innodb-random-read-ahead                                   FALSE
innodb-read-ahead-threshold                                56
innodb-read-io-threads                                     4
innodb-read-only                                           FALSE
innodb-replication-delay                                   0
innodb-rollback-on-timeout                                 FALSE
innodb-rollback-segments                                   128
innodb-sort-buffer-size                                    1048576
innodb-spin-wait-delay                                     6
innodb-stats-auto-recalc                                   TRUE
innodb-stats-method                                        nulls_equal
innodb-stats-on-metadata                                   FALSE
innodb-stats-persistent                                    TRUE
innodb-stats-persistent-sample-pages                       20
innodb-stats-sample-pages                                  8
innodb-stats-transient-sample-pages                        8
innodb-status-file                                         FALSE
innodb-strict-mode                                         FALSE
innodb-support-xa                                          TRUE
innodb-sync-array-size                                     1
innodb-sync-spin-loops                                     30
innodb-sys-columns                                         ON
innodb-sys-datafiles                                       ON
innodb-sys-fields                                          ON
innodb-sys-foreign                                         ON
innodb-sys-foreign-cols                                    ON
innodb-sys-indexes                                         ON
innodb-sys-tables                                          ON
innodb-sys-tablespaces                                     ON
innodb-sys-tablestats                                      ON
innodb-table-locks                                         TRUE
innodb-thread-concurrency                                  0
innodb-thread-sleep-delay                                  10000
innodb-trx                                                 ON
innodb-undo-directory                                      .
innodb-undo-logs                                           128
innodb-undo-tablespaces                                    0
innodb-use-native-aio                                      TRUE
innodb-use-sys-malloc                                      TRUE
innodb-write-io-threads                                    4
interactive-timeout                                        28800
join-buffer-size                                           262144
keep-files-on-create                                       FALSE
key-buffer-size                                            8388608
key-cache-age-threshold                                    300
key-cache-block-size                                       1024
key-cache-division-limit                                   100
language                                                   /home/jon/bin/mysql-5.6/share/
large-pages                                                FALSE
lc-messages                                                en_US
lc-messages-dir                                            /home/jon/bin/mysql-5.6/share/
lc-time-names                                              en_US
local-infile                                               TRUE
lock-wait-timeout                                          31536000
log-bin                                                    (No default value)
log-bin-index                                              (No default value)
log-bin-trust-function-creators                            FALSE
log-bin-use-v1-row-events                                  FALSE
log-error                                                  
log-isam                                                   myisam.log
log-output                                                 FILE
log-queries-not-using-indexes                              FALSE
log-raw                                                    FALSE
log-short-format                                           FALSE
log-slave-updates                                          FALSE
log-slow-admin-statements                                  FALSE
log-slow-slave-statements                                  FALSE
log-tc                                                     tc.log
log-tc-size                                                24576
log-throttle-queries-not-using-indexes                     0
log-warnings                                               1
long-query-time                                            10
low-priority-updates                                       FALSE
lower-case-table-names                                     0
master-info-file                                           master.info
master-info-repository                                     FILE
master-retry-count                                         86400
master-verify-checksum                                     FALSE
max-allowed-packet                                         4194304
max-binlog-cache-size                                      18446744073709547520
max-binlog-dump-events                                     0
max-binlog-size                                            1073741824
max-binlog-stmt-cache-size                                 18446744073709547520
max-connect-errors                                         100
max-connections                                            151
max-delayed-threads                                        20
max-error-count                                            64
max-heap-table-size                                        16777216
max-join-size                                              18446744073709551615
max-length-for-sort-data                                   1024
max-prepared-stmt-count                                    16382
max-relay-log-size                                         0
max-seeks-for-key                                          18446744073709551615
max-sort-length                                            1024
max-sp-recursion-depth                                     0
max-tmp-tables                                             32
max-user-connections                                       0
max-write-lock-count                                       18446744073709551615
memlock                                                    FALSE
metadata-locks-cache-size                                  1024
metadata-locks-hash-instances                              8
min-examined-row-limit                                     0
multi-range-count                                          256
myisam-block-size                                          1024
myisam-data-pointer-size                                   6
myisam-max-sort-file-size                                  9223372036853727232
myisam-mmap-size                                           18446744073709551615
myisam-recover-options                                     OFF
myisam-repair-threads                                      1
myisam-sort-buffer-size                                    8388608
myisam-stats-method                                        nulls_unequal
myisam-use-mmap                                            FALSE
net-buffer-length                                          16384
net-read-timeout                                           30
net-retry-count                                            10
net-write-timeout                                          60
new                                                        FALSE
old                                                        FALSE
old-alter-table                                            FALSE
old-passwords                                              0
old-style-user-limits                                      FALSE
open-files-limit                                           1024
optimizer-prune-level                                      1
optimizer-search-depth                                     62
optimizer-switch                                           index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,engine_condition_pushdown=on,index_condition_pushdown=on,mrr=on,mrr_cost_based=on,block_nested_loop=on,batched_key_access=off,materialization=on,semijoin=on,loosescan=on,firstmatch=on,subquery_materialization_cost_based=on,use_index_extensions=on
optimizer-trace                                            
optimizer-trace-features                                   greedy_search=on,range_optimizer=on,dynamic_range=on,repeated_subselect=on
optimizer-trace-limit                                      1
optimizer-trace-max-mem-size                               16384
optimizer-trace-offset                                     -1
partition                                                  ON
performance-schema                                         TRUE
performance-schema-accounts-size                           -1
performance-schema-consumer-events-stages-current          FALSE
performance-schema-consumer-events-stages-history          FALSE
performance-schema-consumer-events-stages-history-long     FALSE
performance-schema-consumer-events-statements-current      TRUE
performance-schema-consumer-events-statements-history      FALSE
performance-schema-consumer-events-statements-history-long FALSE
performance-schema-consumer-events-waits-current           FALSE
performance-schema-consumer-events-waits-history           FALSE
performance-schema-consumer-events-waits-history-long      FALSE
performance-schema-consumer-global-instrumentation         TRUE
performance-schema-consumer-statements-digest              TRUE
performance-schema-consumer-thread-instrumentation         TRUE
performance-schema-digests-size                            -1
performance-schema-events-stages-history-long-size         -1
performance-schema-events-stages-history-size              -1
performance-schema-events-statements-history-long-size     -1
performance-schema-events-statements-history-size          -1
performance-schema-events-waits-history-long-size          -1
performance-schema-events-waits-history-size               -1
performance-schema-hosts-size                              -1
performance-schema-instrument                              
performance-schema-max-cond-classes                        80
performance-schema-max-cond-instances                      -1
performance-schema-max-file-classes                        50
performance-schema-max-file-handles                        32768
performance-schema-max-file-instances                      -1
performance-schema-max-mutex-classes                       200
performance-schema-max-mutex-instances                     -1
performance-schema-max-rwlock-classes                      30
performance-schema-max-rwlock-instances                    -1
performance-schema-max-socket-classes                      10
performance-schema-max-socket-instances                    -1
performance-schema-max-stage-classes                       150
performance-schema-max-statement-classes                   167
performance-schema-max-table-handles                       -1
performance-schema-max-table-instances                     -1
performance-schema-max-thread-classes                      50
performance-schema-max-thread-instances                    -1
performance-schema-session-connect-attrs-size              -1
performance-schema-setup-actors-size                       100
performance-schema-setup-objects-size                      100
performance-schema-users-size                              -1
pid-file                                                   /home/jon/bin/mysql-5.6/data/havskatt.pid
plugin-dir                                                 /home/jon/bin/mysql-5.6/lib/plugin/
port                                                       3306
port-open-timeout                                          0
preload-buffer-size                                        32768
profiling-history-size                                     15
query-alloc-block-size                                     8192
query-cache-limit                                          1048576
query-cache-min-res-unit                                   4096
query-cache-size                                           1048576
query-cache-type                                           OFF
query-cache-wlock-invalidate                               FALSE
query-prealloc-size                                        8192
range-alloc-block-size                                     4096
read-buffer-size                                           131072
read-only                                                  FALSE
read-rnd-buffer-size                                       262144
relay-log                                                  (No default value)
relay-log-index                                            (No default value)
relay-log-info-file                                        relay-log.info
relay-log-info-repository                                  FILE
relay-log-purge                                            TRUE
relay-log-recovery                                         FALSE
relay-log-space-limit                                      0
replicate-same-server-id                                   FALSE
report-host                                                (No default value)
report-password                                            (No default value)
report-port                                                0
report-user                                                (No default value)
safe-user-create                                           FALSE
secure-auth                                                TRUE
secure-file-priv                                           (No default value)
server-id                                                  0
server-id-bits                                             32
sha256-password-private-key-path                           private_key.pem
sha256-password-public-key-path                            public_key.pem
show-slave-auth-info                                       FALSE
skip-grant-tables                                          FALSE
skip-name-resolve                                          FALSE
skip-networking                                            FALSE
skip-show-database                                         FALSE
skip-slave-start                                           FALSE
slave-allow-batching                                       FALSE
slave-checkpoint-group                                     512
slave-checkpoint-period                                    300
slave-compressed-protocol                                  FALSE
slave-exec-mode                                            STRICT
slave-load-tmpdir                                          /tmp
slave-max-allowed-packet                                   1073741824
slave-net-timeout                                          3600
slave-parallel-workers                                     0
slave-pending-jobs-size-max                                16777216
slave-rows-search-algorithms                               TABLE_SCAN,INDEX_SCAN
slave-skip-errors                                          (No default value)
slave-sql-verify-checksum                                  TRUE
slave-transaction-retries                                  10
slave-type-conversions                                     
slow-launch-time                                           2
slow-query-log                                             FALSE
slow-query-log-file                                        /home/jon/bin/mysql-5.6/data/havskatt-slow.log
socket                                                     /tmp/mysql.sock
sort-buffer-size                                           262144
sporadic-binlog-dump-fail                                  FALSE
sql-mode                                                   NO_ENGINE_SUBSTITUTION
ssl                                                        FALSE
ssl-ca                                                     (No default value)
ssl-capath                                                 (No default value)
ssl-cert                                                   (No default value)
ssl-cipher                                                 (No default value)
ssl-crl                                                    (No default value)
ssl-crlpath                                                (No default value)
ssl-key                                                    (No default value)
stored-program-cache                                       256
super-large-pages                                          FALSE
symbolic-links                                             TRUE
sync-binlog                                                0
sync-frm                                                   TRUE
sync-master-info                                           10000
sync-relay-log                                             10000
sync-relay-log-info                                        10000
sysdate-is-now                                             FALSE
table-definition-cache                                     615
table-open-cache                                           431
table-open-cache-instances                                 1
tc-heuristic-recover                                       COMMIT
temp-pool                                                  TRUE
thread-cache-size                                          9
thread-concurrency                                         10
thread-handling                                            one-thread-per-connection
thread-stack                                               262144
time-format                                                %H:%i:%s
timed-mutexes                                              FALSE
tmp-table-size                                             16777216
tmpdir                                                     /tmp
transaction-alloc-block-size                               8192
transaction-isolation                                      REPEATABLE-READ
transaction-prealloc-size                                  4096
transaction-read-only                                      FALSE
updatable-views-with-limit                                 YES
verbose                                                    TRUE
wait-timeout</pre><p>
        For a <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server that is currently
        running, you can see the current values of its system variables
        by connecting to it and issuing this statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES;</code></strong>
</pre><p>
        You can also see some statistical and status indicators for a
        running server by issuing this statement:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS;</code></strong>
</pre><p>
        System variable and status information also can be obtained
        using <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin variables</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin extended-status</code></strong>
</pre><p>
        For a full description of all system and status variables, see
        <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>, and
        <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
      </p><p>
        MySQL uses algorithms that are very scalable, so you can usually
        run with very little memory. However, normally you get better
        performance by giving MySQL more memory.
      </p><p>
        When tuning a MySQL server, the two most important variables to
        configure are <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
        and <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>. You
        should first feel confident that you have these set
        appropriately before trying to change any other variables.
      </p><p>
        The following examples indicate some typical variable values for
        different runtime configurations.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you have at least 256MB of memory and many tables and
            want maximum performance with a moderate number of clients,
            use something like this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=64M --table_open_cache=256 \</code></strong>
           <strong class="userinput"><code>--sort_buffer_size=4M --read_buffer_size=1M &amp;</code></strong>
</pre></li><li class="listitem"><p>
            If you have only 128MB of memory and only a few tables, but
            you still do a lot of sorting, you can use something like
            this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=16M --sort_buffer_size=1M</code></strong>
</pre><p>
            If there are very many simultaneous connections, swapping
            problems may occur unless <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has been
            configured to use very little memory for each connection.
            <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> performs better if you have enough
            memory for all connections.
          </p></li><li class="listitem"><p>
            With little memory and lots of connections, use something
            like this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=512K --sort_buffer_size=100K \</code></strong>
           <strong class="userinput"><code>--read_buffer_size=100K &amp;</code></strong>
</pre><p>
            Or even this:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld_safe --key_buffer_size=512K --sort_buffer_size=16K \</code></strong>
           <strong class="userinput"><code>--table_open_cache=32 --read_buffer_size=8K \</code></strong>
           <strong class="userinput"><code>--net_buffer_length=1K &amp;</code></strong>
</pre></li></ul>
</div>
<p>
        If you are performing <code class="literal">GROUP BY</code> or
        <code class="literal">ORDER BY</code> operations on tables that are much
        larger than your available memory, increase the value of
        <a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a> to speed
        up the reading of rows following sorting operations.
      </p><p>
        You can make use of the example option files included with your
        MySQL distribution; see
        <a class="xref" href="server-administration.html#server-configuration-defaults" title="5.1.2. Server Configuration Defaults">Section 5.1.2, “Server Configuration Defaults”</a>.
      </p><p>
        If you specify an option on the command line for
        <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> or <a class="link" href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a>, it
        remains in effect only for that invocation of the server. To use
        the option every time the server runs, put it in an option file.
      </p><p>
        To see the effects of a parameter change, do something like
        this:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --key_buffer_size=32M --verbose --help</code></strong>
</pre><p>
        The variable values are listed near the end of the output. Make
        sure that the <a class="link" href="server-administration.html#option_mysqld_verbose"><code class="option">--verbose</code></a> and
        <a class="link" href="server-administration.html#option_mysqld_help"><code class="option">--help</code></a> options are last.
        Otherwise, the effect of any options listed after them on the
        command line are not reflected in the output.
      </p><p>
        For information on tuning the <code class="literal">InnoDB</code> storage
        engine, see <a class="xref" href="storage-engines.html#innodb-tuning" title="14.2.4.1. InnoDB Performance Tuning Tips">Section 14.2.4.1, “<code class="literal">InnoDB</code> Performance Tuning Tips”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="disk-issues"></a>8.11.3. Optimizing Disk I/O</h3>

</div>

</div>

</div>

<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#symbolic-links">8.11.3.1. Using Symbolic Links</a></span></dt></dl>
</div>
<a class="indexterm" name="idp52029696"></a><a class="indexterm" name="idp52030768"></a><a class="indexterm" name="idp52032256"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Disk seeks are a huge performance bottleneck. This problem
            becomes more apparent when the amount of data starts to grow
            so large that effective caching becomes impossible. For
            large databases where you access data more or less randomly,
            you can be sure that you need at least one disk seek to read
            and a couple of disk seeks to write things. To minimize this
            problem, use disks with low seek times.
          </p></li><li class="listitem"><p>
            Increase the number of available disk spindles (and thereby
            reduce the seek overhead) by either symlinking files to
            different disks or striping the disks:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Using symbolic links
              </p><p>
                This means that, for <code class="literal">MyISAM</code> tables,
                you symlink the index file and data files from their
                usual location in the data directory to another disk
                (that may also be striped). This makes both the seek and
                read times better, assuming that the disk is not used
                for other purposes as well. See
                <a class="xref" href="optimization.html#symbolic-links" title="8.11.3.1. Using Symbolic Links">Section 8.11.3.1, “Using Symbolic Links”</a>.
              </p></li><li class="listitem"><p>
                <a class="indexterm" name="idp52039792"></a>

                Striping
              </p><p>
                Striping means that you have many disks and put the
                first block on the first disk, the second block on the
                second disk, and the <em class="replaceable"><code>N</code></em>-th
                block on the (<code class="literal"><em class="replaceable"><code>N</code></em> MOD
                <em class="replaceable"><code>number_of_disks</code></em></code>)
                disk, and so on. This means if your normal data size is
                less than the stripe size (or perfectly aligned), you
                get much better performance. Striping is very dependent
                on the operating system and the stripe size, so
                benchmark your application with different stripe sizes.
                See <a class="xref" href="optimization.html#custom-benchmarks" title="8.12.3. Using Your Own Benchmarks">Section 8.12.3, “Using Your Own Benchmarks”</a>.
              </p><p>
                The speed difference for striping is
                <span class="emphasis"><em>very</em></span> dependent on the parameters.
                Depending on how you set the striping parameters and
                number of disks, you may get differences measured in
                orders of magnitude. You have to choose to optimize for
                random or sequential access.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            For reliability, you may want to use RAID 0+1 (striping plus
            mirroring), but in this case, you need 2 ×
            <em class="replaceable"><code>N</code></em> drives to hold
            <em class="replaceable"><code>N</code></em> drives of data. This is
            probably the best option if you have the money for it.
            However, you may also have to invest in some
            volume-management software to handle it efficiently.
          </p></li><li class="listitem"><p>
            A good option is to vary the RAID level according to how
            critical a type of data is. For example, store
            semi-important data that can be regenerated on a RAID 0
            disk, but store really important data such as host
            information and logs on a RAID 0+1 or RAID
            <em class="replaceable"><code>N</code></em> disk. RAID
            <em class="replaceable"><code>N</code></em> can be a problem if you have
            many writes, due to the time required to update the parity
            bits.
          </p></li><li class="listitem"><p>
            On Linux, you can get much better performance by using
            <code class="literal">hdparm</code> to configure your disk's
            interface. (Up to 100% under load is not uncommon.) The
            following <code class="literal">hdparm</code> options should be quite
            good for MySQL, and probably for many other applications:
          </p><pre class="programlisting">hdparm -m 16 -d 1</pre><p>
            Note that performance and reliability when using this
            command depend on your hardware, so we strongly suggest that
            you test your system thoroughly after using
            <code class="literal">hdparm</code>. Please consult the
            <code class="literal">hdparm</code> manual page for more information.
            If <code class="literal">hdparm</code> is not used wisely, file system
            corruption may result, so back up everything before
            experimenting!
          </p></li><li class="listitem"><p>
            You can also set the parameters for the file system that the
            database uses:
          </p><p>
            If you do not need to know when files were last accessed
            (which is not really useful on a database server), you can
            mount your file systems with the <code class="option">-o noatime</code>
            option. That skips updates to the last access time in inodes
            on the file system, which avoids some disk seeks.
          </p><p>
            On many operating systems, you can set a file system to be
            updated asynchronously by mounting it with the <code class="option">-o
            async</code> option. If your computer is reasonably
            stable, this should give you better performance without
            sacrificing too much reliability. (This flag is on by
            default on Linux.)
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="symbolic-links"></a>8.11.3.1. Using Symbolic Links</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp52060848"></a><a class="indexterm" name="idp52061920"></a><p>
          You can move databases or tables from the database directory
          to other locations and replace them with symbolic links to the
          new locations. You might want to do this, for example, to move
          a database to a file system with more free space or increase
          the speed of your system by spreading your tables to different
          disks.
        </p><p>
          For <code class="literal">InnoDB</code> tables, use the <code class="literal">DATA
          DIRECTORY</code> clause on the <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a> statement instead of symbolic links, as
          explained in <a class="xref" href="server-administration.html#tablespace-placing" title="5.4.1.2. Specifying the Location of a Tablespace">Section 5.4.1.2, “Specifying the Location of a Tablespace”</a>. This new
          feature is a supported, cross-platform technique.
        </p><p>
          The recommended way to do this is to symlink entire database
          directories to a different disk. Symlink
          <code class="literal">MyISAM</code> tables only as a last resort.
        </p><p>
          To determine the location of your data directory, use this
          statement:
</p><pre class="programlisting">SHOW VARIABLES LIKE 'datadir';</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="symbolic-links-to-databases"></a>8.11.3.1.1. Using Symbolic Links for Databases on Unix</h5>
</div>
</div>
</div>
<a class="indexterm" name="idp52071040"></a><p>
            On Unix, the way to symlink a database is first to create a
            directory on some disk where you have free space and then to
            create a soft link to it from the MySQL data directory.
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mkdir /dr1/databases/test</code></strong>
shell&gt; <strong class="userinput"><code>ln -s /dr1/databases/test <em class="replaceable"><code>/path/to/datadir</code></em></code></strong>
</pre><p>
            MySQL does not support linking one directory to multiple
            databases. Replacing a database directory with a symbolic
            link works as long as you do not make a symbolic link
            between databases. Suppose that you have a database
            <code class="literal">db1</code> under the MySQL data directory, and
            then make a symlink <code class="literal">db2</code> that points to
            <code class="literal">db1</code>:
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em></code></strong>
shell&gt; <strong class="userinput"><code>ln -s db1 db2</code></strong>
</pre><p>
            The result is that, or any table <code class="literal">tbl_a</code> in
            <code class="literal">db1</code>, there also appears to be a table
            <code class="literal">tbl_a</code> in <code class="literal">db2</code>. If one
            client updates <code class="literal">db1.tbl_a</code> and another
            client updates <code class="literal">db2.tbl_a</code>, problems are
            likely to occur.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="symbolic-links-to-tables"></a>8.11.3.1.2. Using Symbolic Links for <code class="literal">MyISAM</code> Tables on Unix</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp52087376"></a><p>
            Symlinks are fully supported only for
            <code class="literal">MyISAM</code> tables. For files used by tables
            for other storage engines, you may get strange problems if
            you try to use symbolic links. For <code class="literal">InnoDB</code>
            tables, use the alternative technique explained in
            <a class="xref" href="server-administration.html#tablespace-placing" title="5.4.1.2. Specifying the Location of a Tablespace">Section 5.4.1.2, “Specifying the Location of a Tablespace”</a> instead.
          </p><p>
            Do not symlink tables on systems that do not have a fully
            operational <code class="literal">realpath()</code> call. (Linux and
            Solaris support <code class="literal">realpath()</code>). To determine
            whether your system supports symbolic links, check the value
            of the <a class="link" href="server-administration.html#sysvar_have_symlink"><code class="literal">have_symlink</code></a> system
            variable using this statement:
          </p><pre class="programlisting">SHOW VARIABLES LIKE 'have_symlink';</pre><p>
            The handling of symbolic links for <code class="literal">MyISAM</code>
            tables works as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                In the data directory, you always have the table format
                (<code class="filename">.frm</code>) file, the data
                (<code class="filename">.MYD</code>) file, and the index
                (<code class="filename">.MYI</code>) file. The data file and
                index file can be moved elsewhere and replaced in the
                data directory by symlinks. The format file cannot.
              </p></li><li class="listitem"><p>
                You can symlink the data file and the index file
                independently to different directories.
              </p></li><li class="listitem"><p>
                To instruct a running MySQL server to perform the
                symlinking, use the <code class="literal">DATA DIRECTORY</code>
                and <code class="literal">INDEX DIRECTORY</code> options to
                <a class="link" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>. See
                <a class="xref" href="sql-syntax.html#create-table" title="13.1.17. CREATE TABLE Syntax">Section 13.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>. Alternatively, if
                <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is not running, symlinking can
                be accomplished manually using <span class="command"><strong>ln -s</strong></span>
                from the command line.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
                  The path used with either or both of the <code class="literal">DATA
                  DIRECTORY</code> and <code class="literal">INDEX
                  DIRECTORY</code> options may not include the MySQL
                  <code class="literal">data</code> directory. (Bug #32167)
</p>
</div>
</li><li class="listitem"><p>
                <a class="link" href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span class="command"><strong>myisamchk</strong></span></a> does not replace a symlink
                with the data file or index file. It works directly on
                the file to which the symlink points. Any temporary
                files are created in the directory where the data file
                or index file is located. The same is true for the
                <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
                <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>, and
                <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> statements.
</p></li><li class="listitem">
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
                  When you drop a table that is using symlinks,
                  <span class="emphasis"><em>both the symlink and the file to which the
                  symlink points are dropped</em></span>. This is an
                  extremely good reason <span class="emphasis"><em>not</em></span> to run
                  <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as the system
                  <code class="literal">root</code> or permit system users to have
                  write access to MySQL database directories.
</p>
</div>
</li><li class="listitem"><p>
                If you rename a table with
                <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE
                ... RENAME</code></a> or <a class="link" href="sql-syntax.html#rename-table" title="13.1.32. RENAME TABLE Syntax"><code class="literal">RENAME
                TABLE</code></a> and you do not move the table to another
                database, the symlinks in the database directory are
                renamed to the new names and the data file and index
                file are renamed accordingly.
              </p></li><li class="listitem"><p>
                If you use
                <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE
                ... RENAME</code></a> or <a class="link" href="sql-syntax.html#rename-table" title="13.1.32. RENAME TABLE Syntax"><code class="literal">RENAME
                TABLE</code></a> to move a table to another database, the
                table is moved to the other database directory. If the
                table name changed, the symlinks in the new database
                directory are renamed to the new names and the data file
                and index file are renamed accordingly.
              </p></li><li class="listitem"><p>
                If you are not using symlinks, start
                <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
                <a class="link" href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
                option to ensure that no one can use
                <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> to drop or rename a file
                outside of the data directory.
</p></li></ul>
</div>
<p>
            These table symlink operations are not supported:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> ignores the
                <code class="literal">DATA DIRECTORY</code> and <code class="literal">INDEX
                DIRECTORY</code> table options.
              </p></li><li class="listitem"><p>
                As indicated previously, only the data and index files
                can be symbolic links. The <code class="filename">.frm</code>
                file must <span class="emphasis"><em>never</em></span> be a symbolic link.
                Attempting to do this (for example, to make one table
                name a synonym for another) produces incorrect results.
                Suppose that you have a database <code class="literal">db1</code>
                under the MySQL data directory, a table
                <code class="literal">tbl1</code> in this database, and in the
                <code class="literal">db1</code> directory you make a symlink
                <code class="literal">tbl2</code> that points to
                <code class="literal">tbl1</code>:
              </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em>/db1</code></strong>
shell&gt; <strong class="userinput"><code>ln -s tbl1.frm tbl2.frm</code></strong>
shell&gt; <strong class="userinput"><code>ln -s tbl1.MYD tbl2.MYD</code></strong>
shell&gt; <strong class="userinput"><code>ln -s tbl1.MYI tbl2.MYI</code></strong>
</pre><p>
                Problems result if one thread reads
                <code class="literal">db1.tbl1</code> and another thread updates
                <code class="literal">db1.tbl2</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    The query cache is <span class="quote">“<span class="quote">fooled</span>”</span> (it has no
                    way of knowing that <code class="literal">tbl1</code> has not
                    been updated, so it returns outdated results).
                  </p></li><li class="listitem"><p>
                    <code class="literal">ALTER</code> statements on
                    <code class="literal">tbl2</code> fail.
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="windows-symbolic-links"></a>8.11.3.1.3. Using Symbolic Links for Databases on Windows</h5>

</div>

</div>

</div>
<a class="indexterm" name="idp52148704"></a><a class="indexterm" name="idp52149776"></a><a class="indexterm" name="idp52150864"></a><p>
            On Windows, symbolic links can be used for database
            directories. This enables you to put a database directory at
            a different location (for example, on a different disk) by
            setting up a symbolic link to it. Use of database symlinks
            on Windows is similar to their use on Unix, although the
            procedure for setting up the link differs.
          </p><p>
            Suppose that you want to place the database directory for a
            database named <code class="literal">mydb</code> at
            <code class="filename">D:\data\mydb</code>. To do this, create a
            symbolic link in the MySQL data directory that points to
            <code class="filename">D:\data\mydb</code>. However, before creating
            the symbolic link, make sure that the
            <code class="filename">D:\data\mydb</code> directory exists by
            creating it if necessary. If you already have a database
            directory named <code class="filename">mydb</code> in the data
            directory, move it to <code class="filename">D:\data</code>.
            Otherwise, the symbolic link will be ineffective. To avoid
            problems, make sure that the server is not running when you
            move the database directory.
          </p><p>
            The procedure for creating the database symbolic link
            depends on your version of Windows.
          </p><p>
            Windows Vista, Windows Server 2008, or newer have native
            symbolic link support, so you can create a symlink using the
            <span class="command"><strong>mklink</strong></span> command. This command requires
            administrative privileges.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Change location into the data directory:
              </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>cd <em class="replaceable"><code>\path\to\datadir</code></em></code></strong>
</pre></li><li class="listitem"><p>
                In the data directory, create a symlink named
                <code class="filename">mydb</code> that points to the location of
                the database directory:
              </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>mklink /d mydb D:\data\mydb</code></strong>
</pre></li></ol>
</div>
<p>
            After this, all tables created in the database
            <code class="literal">mydb</code> are created in
            <code class="filename">D:\data\mydb</code>.
          </p><p>
            Alternatively, on any version of Windows supported by MySQL,
            you can create a symbolic link to a MySQL database by
            creating a <code class="filename">.sym</code> file in the data
            directory that contains the path to the destination
            directory. The file should be named
            <code class="filename"><em class="replaceable"><code>db_name</code></em>.sym</code>,
            where <em class="replaceable"><code>db_name</code></em> is the database
            name.
          </p><p>
            Support for database symbolic links on Windows using
            <code class="filename">.sym</code> files is enabled by default. If
            you do not need <code class="filename">.sym</code> file symbolic
            links, you can disable support for them by starting
            <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
            <a class="link" href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
            option. To determine whether your system supports
            <code class="filename">.sym</code> file symbolic links, check the
            value of the <a class="link" href="server-administration.html#sysvar_have_symlink"><code class="literal">have_symlink</code></a>
            system variable using this statement:
          </p><pre class="programlisting">SHOW VARIABLES LIKE 'have_symlink';</pre><p>
            To create a <code class="filename">.sym</code> file symlink, use this
            procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Change location into the data directory:
              </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>cd <em class="replaceable"><code>\path\to\datadir</code></em></code></strong>
</pre></li><li class="listitem"><p>
                In the data directory, create a text file named
                <code class="filename">mydb.sym</code> that contains this path
                name: <code class="literal">D:\data\mydb\</code>
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
                  The path name to the new database and tables should be
                  absolute. If you specify a relative path, the location
                  will be relative to the <code class="filename">mydb.sym</code>
                  file.
</p>
</div>
</li></ol>
</div>
<p>
            After this, all tables created in the database
            <code class="literal">mydb</code> are created in
            <code class="filename">D:\data\mydb</code>.
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
              Because support for <code class="filename">.sym</code> files is
              redundant with native symlink support available using
              <span class="command"><strong>mklink</strong></span>, use of
              <code class="filename">.sym</code> files is deprecated as of MySQL
              5.6.9 and support for them will be removed in a future
              MySQL release.
</p>
</div>
<p>
            The following limitations apply to the use of
            <code class="filename">.sym</code> files for database symbolic
            linking on Windows. These limitations do not apply for
            symlinks created using <span class="command"><strong>mklink</strong></span>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The symbolic link is not used if a directory with the
                same name as the database exists in the MySQL data
                directory.
              </p></li><li class="listitem"><p>
                The
                <a class="link" href="storage-engines.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a>
                option cannot be used.
              </p></li><li class="listitem"><p>
                If you run <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as a service, you
                cannot use a mapped drive to a remote server as the
                destination of the symbolic link. As a workaround, you
                can use the full path
                (<code class="filename">\\servername\path\</code>).
</p></li></ul>
</div>

</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-memory"></a>8.11.4. Optimizing Memory Use</h3>

</div>

</div>

</div>

<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#memory-use">8.11.4.1. How MySQL Uses Memory</a></span></dt><dt><span class="section"><a href="optimization.html#large-page-support">8.11.4.2. Enabling Large Page Support</a></span></dt></dl>
</div>
<a class="indexterm" name="idp52200576"></a><p></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="memory-use"></a>8.11.4.1. How MySQL Uses Memory</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp52203264"></a><p>
          The following list indicates some of the ways that the
          <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server uses memory. Where
          applicable, the name of the system variable relevant to the
          memory use is given:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              All threads share the <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>
              key buffer; its size is determined by the
              <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> variable.
              Other buffers used by the server are allocated as needed.
              See <a class="xref" href="optimization.html#server-parameters" title="8.11.2. Tuning Server Parameters">Section 8.11.2, “Tuning Server Parameters”</a>.
            </p></li><li class="listitem"><p>
              Each thread that is used to manage client connections uses
              some thread-specific space. The following list indicates
              these and which variables control their size:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  A stack (variable
                  <a class="link" href="server-administration.html#sysvar_thread_stack"><code class="literal">thread_stack</code></a>)
                </p></li><li class="listitem"><p>
                  A connection buffer (variable
                  <a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>)
                </p></li><li class="listitem"><p>
                  A result buffer (variable
                  <a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>)
</p></li></ul>
</div>
<p>
              The connection buffer and result buffer each begin with a
              size equal to
              <a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a> bytes,
              but are dynamically enlarged up to
              <a class="link" href="server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a> bytes
              as needed. The result buffer shrinks to
              <a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a> bytes
              after each SQL statement. While a statement is running, a
              copy of the current statement string is also allocated.
            </p></li><li class="listitem"><p>
              All threads share the same base memory.
            </p></li><li class="listitem"><p>
              When a thread is no longer needed, the memory allocated to
              it is released and returned to the system unless the
              thread goes back into the thread cache. In that case, the
              memory remains allocated.
            </p></li><li class="listitem"><p>
              The <a class="link" href="server-administration.html#sysvar_myisam_use_mmap"><code class="literal">myisam_use_mmap</code></a>
              system variable can be set to 1 to enable memory-mapping
              for all <code class="literal">MyISAM</code> tables.
            </p></li><li class="listitem"><p>
              Each request that performs a sequential scan of a table
              allocates a <em class="firstterm">read buffer</em> (variable
              <a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>).
            </p></li><li class="listitem"><p>
              When reading rows in an arbitrary sequence (for example,
              following a sort), a <em class="firstterm">random-read
              buffer</em> (variable
              <a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>) may
              be allocated to avoid disk seeks.
            </p></li><li class="listitem"><p>
              All joins are executed in a single pass, and most joins
              can be done without even using a temporary table. Most
              temporary tables are memory-based hash tables. Temporary
              tables with a large row length (calculated as the sum of
              all column lengths) or that contain
              <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns are stored on
              disk.
            </p><p>
              If an internal in-memory temporary table becomes too
              large, MySQL handles this automatically by changing the
              table from in-memory to on-disk format, to be handled by
              the <code class="literal">MyISAM</code> storage engine. You can
              increase the permissible temporary table size as described
              in <a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.3.3. How MySQL Uses Internal Temporary Tables">Section 8.4.3.3, “How MySQL Uses Internal Temporary Tables”</a>.
            </p></li><li class="listitem"><p>
              Most requests that perform a sort allocate a sort buffer
              and zero to two temporary files depending on the result
              set size. See <a class="xref" href="error-handling.html#temporary-files" title="C.5.4.4. Where MySQL Stores Temporary Files">Section C.5.4.4, “Where MySQL Stores Temporary Files”</a>.
            </p></li><li class="listitem"><p>
              Almost all parsing and calculating is done in thread-local
              and reusable memory pools. No memory overhead is needed
              for small items, so the normal slow memory allocation and
              freeing is avoided. Memory is allocated only for
              unexpectedly large strings.
            </p></li><li class="listitem"><p>
              For each <code class="literal">MyISAM</code> table that is opened,
              the index file is opened once; the data file is opened
              once for each concurrently running thread. For each
              concurrent thread, a table structure, column structures
              for each column, and a buffer of size <code class="literal">3 *
              <em class="replaceable"><code>N</code></em></code> are allocated
              (where <em class="replaceable"><code>N</code></em> is the maximum row
              length, not counting <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a>
              columns). A <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> column
              requires five to eight bytes plus the length of the
              <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> data. The
              <code class="literal">MyISAM</code> storage engine maintains one
              extra row buffer for internal use.
            </p></li><li class="listitem"><p>
              For each table having <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a>
              columns, a buffer is enlarged dynamically to read in
              larger <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> values. If you
              scan a table, a buffer as large as the largest
              <a class="link" href="data-types.html#blob" title="11.4.3. The BLOB and TEXT Types"><code class="literal">BLOB</code></a> value is allocated.
            </p></li><li class="listitem"><p>
              Handler structures for all in-use tables are saved in a
              cache and managed as a FIFO. The initial cache size is
              taken from the value of the
              <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> system
              variable. If a table has been used by two running threads
              at the same time, the cache contains two entries for the
              table. See <a class="xref" href="optimization.html#table-cache" title="8.4.3.1. How MySQL Opens and Closes Tables">Section 8.4.3.1, “How MySQL Opens and Closes Tables”</a>.
            </p></li><li class="listitem"><p>
              A <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> statement or <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
              flush-tables</strong></span></a> command closes all tables that are
              not in use at once and marks all in-use tables to be
              closed when the currently executing thread finishes. This
              effectively frees most in-use memory.
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> does not return until all tables have
              been closed.
            </p></li><li class="listitem"><p>
              The server caches information in memory as a result of
              <a class="link" href="sql-syntax.html#grant" title="13.7.1.4. GRANT Syntax"><code class="literal">GRANT</code></a>,
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2. CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
              <a class="link" href="sql-syntax.html#create-server" title="13.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a>, and
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3. INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statements.
              This memory is not released by the corresponding
              <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6. REVOKE Syntax"><code class="literal">REVOKE</code></a>,
              <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.3. DROP USER Syntax"><code class="literal">DROP USER</code></a>,
              <a class="link" href="sql-syntax.html#drop-server" title="13.1.27. DROP SERVER Syntax"><code class="literal">DROP SERVER</code></a>, and
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.3.4. UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>
              statements, so for a server that executes many instances
              of the statements that cause caching, there will be an
              increase in memory use. This cached memory can be freed
              with <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
              PRIVILEGES</code></a>.
</p></li></ul>
</div>
<p>
          <span class="command"><strong>ps</strong></span> and other system status programs may
          report that <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> uses a lot of memory.
          This may be caused by thread stacks on different memory
          addresses. For example, the Solaris version of
          <span class="command"><strong>ps</strong></span> counts the unused memory between stacks
          as used memory. To verify this, check available swap with
          <code class="literal">swap -s</code>. We test <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          with several memory-leakage detectors (both commercial and
          Open Source), so there should be no memory leaks.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="large-page-support"></a>8.11.4.2. Enabling Large Page Support</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp52265680"></a><p>
          Some hardware/operating system architectures support memory
          pages greater than the default (usually 4KB). The actual
          implementation of this support depends on the underlying
          hardware and operating system. Applications that perform a lot
          of memory accesses may obtain performance improvements by
          using large pages due to reduced Translation Lookaside Buffer
          (TLB) misses.
        </p><p>
          In MySQL, large pages can be used by InnoDB, to allocate
          memory for its buffer pool and additional memory pool.
        </p><p>
          Standard use of large pages in MySQL attempts to use the
          largest size supported, up to 4MB. Under Solaris, a
          <span class="quote">“<span class="quote">super large pages</span>”</span> feature enables uses of pages
          up to 256MB. This feature is available for recent SPARC
          platforms. It can be enabled or disabled by using the
          <a class="link" href="server-administration.html#option_mysqld_super-large-pages"><code class="option">--super-large-pages</code></a> or
          <a class="link" href="server-administration.html#option_mysqld_super-large-pages"><code class="option">--skip-super-large-pages</code></a>
          option.
        </p><p>
          MySQL also supports the Linux implementation of large page
          support (which is called HugeTLB in Linux).
        </p><p>
          Before large pages can be used on Linux, the kernel must be
          enabled to support them and it is necessary to configure the
          HugeTLB memory pool. For reference, the HugeTBL API is
          documented in the
          <code class="filename">Documentation/vm/hugetlbpage.txt</code> file of
          your Linux sources.
        </p><p>
          The kernel for some recent systems such as Red Hat Enterprise
          Linux appear to have the large pages feature enabled by
          default. To check whether this is true for your kernel, use
          the following command and look for output lines containing
          <span class="quote">“<span class="quote">huge</span>”</span>:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong>
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       4096 kB
</pre><p>
          The nonempty command output indicates that large page support
          is present, but the zero values indicate that no pages are
          configured for use.
        </p><p>
          If your kernel needs to be reconfigured to support large
          pages, consult the <code class="filename">hugetlbpage.txt</code> file
          for instructions.
        </p><p>
          Assuming that your Linux kernel has large page support
          enabled, configure it for use by MySQL using the following
          commands. Normally, you put these in an
          <code class="filename">rc</code> file or equivalent startup file that
          is executed during the system boot sequence, so that the
          commands execute each time the system starts. The commands
          should execute early in the boot sequence, before the MySQL
          server starts. Be sure to change the allocation numbers and
          the group number as appropriate for your system.
        </p><pre class="programlisting"># Set the number of pages to be used.
# Each page is normally 2MB, so a value of 20 = 40MB.
# This command actually allocates memory, so this much
# memory must be available.
echo 20 &gt; /proc/sys/vm/nr_hugepages

# Set the group number that is permitted to access this
# memory (102 in this case). The mysql user must be a
# member of this group.
echo 102 &gt; /proc/sys/vm/hugetlb_shm_group

# Increase the amount of shmem permitted per segment
# (12G in this case).
echo 1560281088 &gt; /proc/sys/kernel/shmmax

# Increase total amount of shared memory.  The value
# is the number of pages. At 4KB/page, 4194304 = 16GB.
echo 4194304 &gt; /proc/sys/kernel/shmall</pre><p>
          For MySQL usage, you normally want the value of
          <code class="literal">shmmax</code> to be close to the value of
          <code class="literal">shmall</code>.
        </p><p>
          To verify the large page configuration, check
          <code class="filename">/proc/meminfo</code> again as described
          previously. Now you should see some nonzero values:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong>
HugePages_Total:      20
HugePages_Free:       20
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       4096 kB
</pre><p>
          The final step to make use of the
          <code class="literal">hugetlb_shm_group</code> is to give the
          <code class="literal">mysql</code> user an <span class="quote">“<span class="quote">unlimited</span>”</span>
          value for the memlock limit. This can by done either by
          editing <code class="filename">/etc/security/limits.conf</code> or by
          adding the following command to your
          <a class="link" href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> script:
        </p><pre class="programlisting">ulimit -l unlimited</pre><p>
          Adding the <span class="command"><strong>ulimit</strong></span> command to
          <a class="link" href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> causes the
          <code class="literal">root</code> user to set the memlock limit to
          <code class="literal">unlimited</code> before switching to the
          <code class="literal">mysql</code> user. (This assumes that
          <a class="link" href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> is started by
          <code class="literal">root</code>.)
        </p><p>
          Large page support in MySQL is disabled by default. To enable
          it, start the server with the
          <a class="link" href="server-administration.html#option_mysqld_large-pages"><code class="option">--large-pages</code></a> option. For
          example, you can use the following lines in your server's
          <code class="filename">my.cnf</code> file:
        </p><pre class="programlisting">[mysqld]
large-pages</pre><p>
          With this option, <code class="literal">InnoDB</code> uses large pages
          automatically for its buffer pool and additional memory pool.
          If <code class="literal">InnoDB</code> cannot do this, it falls back to
          use of traditional memory and writes a warning to the error
          log: <span class="errortext">Warning: Using conventional memory
          pool</span>
        </p><p>
          To verify that large pages are being used, check
          <code class="literal">/proc/meminfo</code> again:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong>
HugePages_Total:      20
HugePages_Free:       20
HugePages_Rsvd:        2
HugePages_Surp:        0
Hugepagesize:       4096 kB
</pre>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="optimizing-network"></a>8.11.5. Optimizing Network Use</h3>

</div>

</div>

</div>

<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#connection-threads">8.11.5.1. How MySQL Uses Threads for Client Connections</a></span></dt><dt><span class="section"><a href="optimization.html#host-cache">8.11.5.2. DNS Lookup Optimization and the Host Cache</a></span></dt></dl>
</div>
<a class="indexterm" name="idp52305344"></a><p></p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="connection-threads"></a>8.11.5.1. How MySQL Uses Threads for Client Connections</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp52308064"></a><a class="indexterm" name="idp52309152"></a><a class="indexterm" name="idp52310224"></a><p>
          Connection manager threads handle client connection requests
          on the network interfaces that the server listens to. On all
          platforms, one manager thread handles TCP/IP connection
          requests. On Unix, this manager thread also handles Unix
          socket file connection requests. On Windows, a manager thread
          handles shared-memory connection requests, and another handles
          named-pipe connection requests. The server does not create
          threads to handle interfaces that it does not listen to. For
          example, a Windows server that does not have support for
          named-pipe connections enabled does not create a thread to
          handle them.
        </p><p>
          Connection manager threads associate each client connection
          with a thread dedicated to it that handles authentication and
          request processing for that connection. Manager threads create
          a new thread when necessary but try to avoid doing so by
          consulting the thread cache first to see whether it contains a
          thread that can be used for the connection. When a connection
          ends, its thread is returned to the thread cache if the cache
          is not full.
        </p><p>
          In this connection thread model, there are as many threads as
          there are clients currently connected, which has some
          disadvantages when server workload must scale to handle large
          numbers of connections. For example, thread creation and
          disposal becomes expensive. Also, each thread requires server
          and kernel resources, such as stack space. To accommodate a
          large number of simultaneous connections, the stack size per
          thread must be kept small, leading to a situation where it is
          either too small or the server consumes large amounts of
          memory. Exhaustion of other resources can occur as well, and
          scheduling overhead can become significant.
        </p><p>
          As of MySQL 5.6.10, commercial distributions of MySQL
          5.6 include a thread pool plugin that provides an
          alternative thread-handling model designed to reduce overhead
          and improve performance. It implements a thread pool that
          increases server performance by efficiently managing statement
          execution threads for large numbers of client connections. See
          <a class="xref" href="optimization.html#thread-pool-plugin" title="8.11.6. The Thread Pool Plugin">Section 8.11.6, “The Thread Pool Plugin”</a>.
        </p><p>
          To control and monitor how the server manages threads that
          handle client connections, several system and status variables
          are relevant. (See <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4. Server System Variables">Section 5.1.4, “Server System Variables”</a>,
          and <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.)
        </p><p>
          The thread cache has a size determined by the
          <a class="link" href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> system
          variable. The default value is 0 (no caching), which causes a
          thread to be set up for each new connection and disposed of
          when the connection terminates. Set
          <a class="link" href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> to
          <em class="replaceable"><code>N</code></em> to enable
          <em class="replaceable"><code>N</code></em> inactive connection threads to be
          cached. <a class="link" href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a> can
          be set at server startup or changed while the server runs. A
          connection thread becomes inactive when the client connection
          with which it was associated terminates.
        </p><p>
          To monitor the number of threads in the cache and how many
          threads have been created because a thread could not be taken
          from the cache, monitor the
          <a class="link" href="server-administration.html#statvar_Threads_cached"><code class="literal">Threads_cached</code></a> and
          <a class="link" href="server-administration.html#statvar_Threads_created"><code class="literal">Threads_created</code></a> status
          variables.
        </p><p>
          You can set <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
          at server startup or at runtime to control the maximum number
          of clients that can connect simultaneously.
        </p><p>
          When the thread stack is too small, this limits the complexity
          of the SQL statements which the server can handle, the
          recursion depth of stored procedures, and other
          memory-consuming actions. To set a stack size of
          <em class="replaceable"><code>N</code></em> bytes for each thread, start the
          server with
          <a class="link" href="server-administration.html#sysvar_thread_stack"><code class="option">--thread_stack=<em class="replaceable"><code>N</code></em></code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="host-cache"></a>8.11.5.2. DNS Lookup Optimization and the Host Cache</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp52328928"></a><a class="indexterm" name="idp52329968"></a><a class="indexterm" name="idp52331040"></a><p>
          The MySQL server maintains a host cache in memory that
          contains information about clients: IP address, host name, and
          error information. The server uses this cache for nonlocal TCP
          connections. It does not use the cache for TCP connections
          established using a loopback interface address
          (<code class="literal">127.0.0.1</code> or <code class="literal">::1</code>), or
          for connections established using a Unix socket file, named
          pipe, or shared memory.
        </p><p>
          For each new client connection, the server uses the client IP
          address to check whether the client host name is in the host
          cache. If not, the server attempts to resolve the host name.
          First, it resolves the IP address to a host name and resolves
          that host name back to an IP address. Then it compares the
          result to the original IP address to ensure that they are the
          same. The server stores information about the result of this
          operation in the host cache. If the cache is full, the least
          recently used entry is discarded.
        </p><p>
          The <a class="link" href="performance-schema.html#host-cache-table" title="21.9.10.1. The host_cache Table"><code class="literal">host_cache</code></a> Performance Schema
          table exposes the contents of the host cache so that it can be
          examined using <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
          statements. This may help you diagnose the causes of
          connection problems. See <a class="xref" href="performance-schema.html#host-cache-table" title="21.9.10.1. The host_cache Table">Section 21.9.10.1, “The <code class="literal">host_cache</code> Table”</a>.
        </p><p>
          The server handles entries in the host cache like this:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              When the first TCP client connection reaches the server
              from a given IP address, a new entry is created to record
              the client IP, host name, and client lookup validation
              flag. Initially, the host name is set to
              <code class="literal">NULL</code> and the flag is false. This entry
              is also used for subsequent client connections from the
              same originating IP.
            </p></li><li class="listitem"><p>
              If the validation flag for the client IP entry is false,
              the server attempts an IP-to-host name DNS resolution. If
              that is successful, the host name is updated with the
              resolved host name and the validation flag is set to true.
              If resolution is unsuccessful, the action taken depends on
              whether the error is permanent or transient. For permanent
              failures, the host name remains <code class="literal">NULL</code>
              and the validation flag is set to true. For transient
              failures, the host name and validation flag remain
              unchanged. (Another DNS resolution attempt occurs the next
              time a client connects from this IP.)
            </p></li><li class="listitem"><p>
              If an error occurs while processing an incoming client
              connection from a given IP address, the server updates the
              corresponding error counters in the entry for that IP. For
              a description of the errors recorded, see
              <a class="xref" href="performance-schema.html#host-cache-table" title="21.9.10.1. The host_cache Table">Section 21.9.10.1, “The <code class="literal">host_cache</code> Table”</a>.
</p></li></ol>
</div>
<p>
          The server performs host name resolution using the thread-safe
          <code class="function">gethostbyaddr_r()</code> and
          <code class="function">gethostbyname_r()</code> calls if the operating
          system supports them. Otherwise, the thread performing the
          lookup locks a mutex and calls
          <code class="function">gethostbyaddr()</code> and
          <code class="function">gethostbyname()</code> instead. In this case, no
          other thread can resolve host names that are not in the host
          cache until the thread holding the mutex lock releases it.
        </p><p>
          The server uses the host cache for several purposes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              By caching the results of IP-to-host name lookups, the
              server avoids doing a DNS lookup for each client
              connection. Instead, for a given host, it needs to perform
              a lookup only for the first connection from that host.
            </p></li><li class="listitem"><p>
              The cache contains information about errors that occur
              during the connection process. Some errors are considered
              <span class="quote">“<span class="quote">blocking.</span>”</span> If too many of these occur
              successively from a given host without a successful
              connection, the server blocks further connections from
              that host. The
              <a class="link" href="server-administration.html#sysvar_max_connect_errors"><code class="literal">max_connect_errors</code></a> system
              variable determines the number of permitted errors before
              blocking occurs. See <a class="xref" href="error-handling.html#blocked-host" title="C.5.2.6. Host 'host_name' is blocked">Section C.5.2.6, “<code class="literal">Host '<em class="replaceable"><code>host_name</code></em>' is
          blocked</code>”</a>.
</p></li></ul>
</div>
<p>
          To unblock blocked hosts, flush the host cache by issuing a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH HOSTS</code></a>
          statement or executing a <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          flush-hosts</strong></span></a> command.
        </p><p>
          It is possible for a blocked host to become unblocked even
          without <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
          HOSTS</code></a> if activity from other hosts has occurred
          since the last connection attempt from the blocked host. This
          can occur because the server discards the least recently used
          cache entry to make room for a new entry if the cache is full
          when a connection arrives from a client IP not in the cache.
          If the discarded entry is for a blocked host, that host
          becomes unblocked.
        </p><p>
          The host cache is enabled by default. To disable it, set the
          <a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a> system
          variable to 0, either at server startup or at runtime.
        </p><p>
          To disable DNS host name lookups, start the server with the
          <a class="link" href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a> option. In
          this case, the server uses only IP addresses and not host
          names to match connecting hosts to rows in the MySQL grant
          tables. Only accounts specified in those tables using IP
          addresses can be used.
        </p><p>
          If you have a very slow DNS and many hosts, you might be able
          to improve performance either by disabling DNS lookups with
          <a class="link" href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a> or by
          increasing the value of
          <a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a> to make the
          host cache larger.
        </p><p>
          To disallow TCP/IP connections entirely, start the server with
          the <a class="link" href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a> option.
        </p><p>
          Some connection errors are not associated with TCP
          connections, occur very early in the connection process (even
          before an IP address is known), or are not specific to any
          particular IP address (such as out-of-memory conditions). For
          information about these errors, check the
          <a class="link" href="server-administration.html#statvar_Connection_errors_xxx"><code class="literal">Connection_errors_<em class="replaceable"><code>xxx</code></em></code></a>
          status variables (see
          <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6. Server Status Variables">Section 5.1.6, “Server Status Variables”</a>).
</p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="thread-pool-plugin"></a>8.11.6. The Thread Pool Plugin</h3>

</div>

</div>

</div>

<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#thread-pool-installation">8.11.6.1. Thread Pool Components and Installation</a></span></dt><dt><span class="section"><a href="optimization.html#thread-pool-operation">8.11.6.2. Thread Pool Operation</a></span></dt><dt><span class="section"><a href="optimization.html#thread-pool-tuning">8.11.6.3. Thread Pool Tuning</a></span></dt></dl>
</div>
<a class="indexterm" name="idp52368864"></a><a class="indexterm" name="idp52369936"></a>
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p xmlns="">
          MySQL Thread Pool is a commercial extension. To learn more
          about commercial products (MySQL Enterprise Edition), see
          http://www.mysql.com/products/.
</p>
</div>
<p>
        As of MySQL 5.6.10, commercial distributions of MySQL
        5.6 include MySQL Thread Pool, implemented using a
        server plugin. The default thread-handling model in MySQL Server
        executes statements using one thread per client connection. As
        more clients connect to the server and execute statements,
        overall performance degrades. The thread pool plugin provides an
        alternative thread-handling model designed to reduce overhead
        and improve performance. The plugin implements a thread pool
        that increases server performance by efficiently managing
        statement execution threads for large numbers of client
        connections.
      </p><p>
        The thread pool addresses several problems of the one thread per
        connection model:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Too many thread stacks make CPU caches almost useless in
            highly parallel execution workloads. The thread pool
            promotes thread stack reuse to minimize the CPU cache
            footprint.
          </p></li><li class="listitem"><p>
            With too many threads executing in parallel, context
            switching overhead is high. This also presents a challenging
            task to the operating system scheduler. The thread pool
            controls the number of active threads to keep the
            parallelism within the MySQL server at a level that it can
            handle and that is appropriate for the server host on which
            MySQL is executing.
          </p></li><li class="listitem"><p>
            Too many transactions executing in parallel increases
            resource contention. In <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>,
            this increases the time spent holding central mutexes. The
            thread pool controls when transactions start to ensure that
            not too many execute in parallel.
</p></li></ul>
</div>
<p>
        The thread pool plugin is a commercial feature. It is not
        included in MySQL community distributions.
      </p><p>
        On Windows, the thread pool plugin requires Windows Vista or
        newer. On Linux, the plugin requires kernel 2.6.9 or newer.
</p>
<h4><a name="idp52379648"></a>
        Additional Resources
</h4>
<p>
        <a class="xref" href="faqs.html#faqs-thread-pool" title="B.14. MySQL 5.6 FAQ: MySQL Enterprise Scalability Thread Pool">Section B.14, “MySQL 5.6 FAQ: MySQL Enterprise Scalability Thread Pool”</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="thread-pool-installation"></a>8.11.6.1. Thread Pool Components and Installation</h4>
</div>
</div>
</div>
<p>
          The thread pool feature comprises these components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              A plugin library object file contains a plugin for the
              thread pool code and plugins for several
              <code class="literal">INFORMATION_SCHEMA</code> tables.
            </p><p>
              For a detailed description of how the thread pool works,
              see <a class="xref" href="optimization.html#thread-pool-operation" title="8.11.6.2. Thread Pool Operation">Section 8.11.6.2, “Thread Pool Operation”</a>.
            </p><p>
              The <code class="literal">INFORMATION_SCHEMA</code> tables are named
              <a class="link" href="information-schema.html#tp-thread-state-table" title="20.31.1. The INFORMATION_SCHEMA TP_THREAD_STATE Table"><code class="literal">TP_THREAD_STATE</code></a>,
              <a class="link" href="information-schema.html#tp-thread-group-state-table" title="20.31.2. The INFORMATION_SCHEMA TP_THREAD_GROUP_STATE Table"><code class="literal">TP_THREAD_GROUP_STATE</code></a>, and
              <a class="link" href="information-schema.html#tp-thread-group-stats-table" title="20.31.3. The INFORMATION_SCHEMA TP_THREAD_GROUP_STATS Table"><code class="literal">TP_THREAD_GROUP_STATS</code></a>. These
              tables provide information about thread pool operation.
              For more information, see
              <a class="xref" href="information-schema.html#thread-pool-i_s-tables" title="20.31. Thread Pool INFORMATION_SCHEMA Tables">Section 20.31, “Thread Pool <code class="literal">INFORMATION_SCHEMA</code> Tables”</a>.
            </p></li><li class="listitem"><p>
              Several system variables are related to the thread pool.
              The <a class="link" href="server-administration.html#sysvar_thread_handling"><code class="literal">thread_handling</code></a>
              system variable has a value of
              <code class="literal">loaded-dynamically</code> when the server
              successfully loads the thread pool plugin.
            </p><p>
              The other related variables are implemented by the thread
              pool plugin; they are not available unless it is enabled:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <a class="link" href="server-administration.html#sysvar_thread_pool_algorithm"><code class="literal">thread_pool_algorithm</code></a>:
                  The concurrency algorithm to use for scheduling.
                </p></li><li class="listitem"><p>
                  <a class="link" href="server-administration.html#sysvar_thread_pool_high_priority_connection"><code class="literal">thread_pool_high_priority_connection</code></a>:
                  How to schedule statement execution for a session.
                </p></li><li class="listitem"><p>
                  <a class="link" href="server-administration.html#sysvar_thread_pool_prio_kickup_timer"><code class="literal">thread_pool_prio_kickup_timer</code></a>:
                  How long before the thread pool moves a statement
                  awaiting execution from the low-priority queue to the
                  high-priority queue.
                </p></li><li class="listitem"><p>
                  <a class="link" href="server-administration.html#sysvar_thread_pool_max_unused_threads"><code class="literal">thread_pool_max_unused_threads</code></a>:
                  How many sleeping threads to permit.
                </p></li><li class="listitem"><p>
                  <a class="link" href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a>: The
                  number of thread groups in the thread pool. This is
                  the most important parameter controlling thread pool
                  performance.
                </p></li><li class="listitem"><p>
                  <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>:
                  The time before an executing statement is considered
                  to be stalled.
</p></li></ul>
</div>
<p>
              If any variable implemented by the plugin is set to an
              illegal value at startup, plugin initialization fails and
              the plugin does not load.
            </p><p>
              For information about setting thread pool parameters, see
              <a class="xref" href="optimization.html#thread-pool-tuning" title="8.11.6.3. Thread Pool Tuning">Section 8.11.6.3, “Thread Pool Tuning”</a>.
            </p></li><li class="listitem"><p>
              The Performance Schema exposes information about the
              thread pool and may be used to investigate operational
              performance. For more information, see
              <a class="xref" href="performance-schema.html" title="Chapter 21. MySQL Performance Schema">Chapter 21, <i>MySQL Performance Schema</i></a>.
</p></li></ul>
</div>
<p>
          To be usable by the server, the thread pool library object
          file must be located in the MySQL plugin directory (the
          directory named by the
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable).
          To enable thread pool capability, load the plugins to be used
          by starting the server with the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> option. For
          example, if you name just the plugin object file, the server
          loads all plugins that it contains (that is, the thread pool
          plugin and all the <code class="literal">INFORMATION_SCHEMA</code>
          tables). To do this, put these lines in your
          <code class="filename">my.cnf</code> file:
        </p><pre class="programlisting">[mysqld]
plugin-load=thread_pool.so</pre><p>
          If object files have a suffix different from
          <code class="filename">.so</code> on your system, substitute the
          correct suffix (for example, <code class="filename">.dll</code> on
          Windows).
        </p><p>
          If necessary, set the value of the
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable to
          tell the server the location of the plugin directory.
        </p><p>
          If desired, you can load individual plugins from the library
          file. To load the thread pool plugin but not the
          <code class="literal">INFORMATION_SCHEMA</code> tables, use an option
          like this:
        </p><pre class="programlisting">[mysqld]
plugin-load=thread_pool=thread_pool.so</pre><p>
          To load the thread pool plugin and only the
          <a class="link" href="information-schema.html#tp-thread-state-table" title="20.31.1. The INFORMATION_SCHEMA TP_THREAD_STATE Table"><code class="literal">TP_THREAD_STATE</code></a>
          <code class="literal">INFORMATION_SCHEMA</code> table, use an option
          like this:
        </p><pre class="programlisting">[mysqld]
plugin-load=thread_pool=thread_pool.so;TP_THREAD_STATE=thread_pool.so</pre><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="20.15. The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26. SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement. See <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2. Obtaining Server Plugin Information">Section 5.1.8.2, “Obtaining Server Plugin Information”</a>.
        </p><p>
          If the server loads the thread plugin successfully, it sets
          the <code class="literal">thread_handling</code> system variable to
          <code class="literal">dynamically-loaded</code>. If the plugin fails to
          load, the server writes a message to the error log.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="thread-pool-operation"></a>8.11.6.2. Thread Pool Operation</h4>

</div>

</div>

</div>
<p>
          The thread pool consists of a number of thread groups, each of
          which manages a set of client connections. As connections are
          established, the thread pool assigns them to thread groups in
          round-robin fashion.
        </p><p>
          The number of thread groups is configurable using the
          <a class="link" href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a> system
          variable. The default number of groups is 16. For guidelines
          on setting this variable, see
          <a class="xref" href="optimization.html#thread-pool-tuning" title="8.11.6.3. Thread Pool Tuning">Section 8.11.6.3, “Thread Pool Tuning”</a>.
        </p><p>
          The maximum number of threads per group is 4096 (or 4095 on
          some systems where one thread is used internally).
        </p><p>
          The thread pool separates connections and threads, so there is
          no fixed relationship between connections and the threads that
          execute statements received from those connections. This
          differs from the default thread-handling model that associates
          one thread with one connection such that the thread executes
          all statements from the connection.
        </p><p>
          The thread pool tries to ensure a maximum of one thread
          executing in each group at any time, but sometimes permits
          more threads to execute temporarily for best performance. The
          algorithm works in the following manner:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Each thread group has a listener thread that listens for
              incoming statements from the connections assigned to the
              group. When a statement arrives, the thread group either
              begins executing it immediately or queues it for later
              execution:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Immediate execution occurs if the statement is the
                  only one received and no statements are queued or
                  currently executing.
                </p></li><li class="listitem"><p>
                  Queuing occurs if the statement cannot begin executing
                  immediately.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              If immediate execution occurs, execution is performed by
              the listener thread. (This means that temporarily no
              thread in the group is listening.) If the statement
              finishes quickly, the executing thread returns to
              listening for statements. Otherwise, the thread pool
              considers the statement stalled and starts another thread
              as a listener thread (creating it if necessary). To ensure
              that no thread group becomes blocked by stalled
              statements, the thread pool has a background thread that
              regularly monitors thread group states.
            </p><p>
              By using the listening thread to execute a statement that
              can begin immediately, there is no need to create an
              additional thread if the statement finishes quickly. This
              ensures the most efficient execution possible in the case
              of a low number of concurrent threads.
            </p><p>
              When the thread pool plugin starts, it creates one thread
              per group (the listener thread), plus the background
              thread. Additional threads are created as necessary to
              execute statements.
            </p></li><li class="listitem"><p>
              The value of the
              <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>
              system variable determines the meaning of <span class="quote">“<span class="quote">finishes
              quickly</span>”</span> in the previous item. The default time
              before threads are considered stalled is 60ms but can be
              set to a maximum of 6s. This parameter is configurable to
              enable you to strike a balance appropriate for the server
              work load. Short wait values permit threads to start more
              quickly. Short values are also better for avoiding
              deadlock situations. Long wait values are useful for
              workloads that include long-running statements, to avoid
              starting too many new statements while the current ones
              execute.
            </p></li><li class="listitem"><p>
              The thread pool focuses on limiting the number of
              concurrent short-running statements. Before an executing
              statement reaches the stall time, it prevents other
              statements from beginning to execute. If the statement
              executes past the stall time, it is permitted to continue
              but no longer prevents other statements from starting. In
              this way, the thread pool tries to ensure that in each
              thread group there is never more than one short-running
              statement, although there might be multiple long-running
              statements. It is undesirable to let long-running
              statements prevent other statements from executing because
              there is no limit on the amount of waiting that might be
              necessary. For example, on a replication master, a thread
              that is sending binary log events to a slave effectively
              runs forever.
            </p></li><li class="listitem"><p>
              A statement becomes blocked if it encounters a disk I/O
              operation or a user level lock (row lock or table lock).
              The block would cause the thread group to become unused,
              so there are callbacks to the thread pool to ensure that
              the thread pool can immediately start a new thread in this
              group to execute another statement. When a blocked thread
              returns, the thread pool permits it to restart
              immediately.
            </p></li><li class="listitem"><p>
              There are two queues, a high-priority queue and a
              low-priority queue. The first statement in a transaction
              goes to the low-priority queue. Any following statements
              for the transaction go to the high-priority queue if the
              transaction is ongoing (statements for it have begun
              executing), or to the low-priority queue otherwise. Queue
              assignment can be affected by enabling the
              <a class="link" href="server-administration.html#sysvar_thread_pool_high_priority_connection"><code class="literal">thread_pool_high_priority_connection</code></a>
              system variable, which causes all queued statements for a
              session to go into the high-priority queue.
            </p><p>
              Statements for a nontransactional storage engine, or a
              transactional engine if
              <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> is enabled,
              are treated as low-priority statements because in this
              case each statement is a transaction. Thus, given a mix of
              statements for <code class="literal">InnoDB</code> and
              <code class="literal">MyISAM</code> tables, the thread pool
              prioritizes those for <code class="literal">InnoDB</code> over those
              for <code class="literal">MyISAM</code> unless
              <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> is enabled.
              With <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> enabled,
              all statements will be low priority.
            </p></li><li class="listitem"><p>
              When the thread group selects a queued statement for
              execution, it first looks in the high-priority queue, then
              in the low-priority queue. If a statement is found, it is
              removed from its queue and begins to execute.
            </p></li><li class="listitem"><p>
              If a statement stays in the low-priority queue too long,
              the thread pool moves to the high-priority queue. The
              value of the
              <a class="link" href="server-administration.html#sysvar_thread_pool_prio_kickup_timer"><code class="literal">thread_pool_prio_kickup_timer</code></a>
              system variable controls the time before movement. For
              each thread group, a maximum of one statement per 10ms or
              100 per second will be moved from the low-priority queue
              to the high-priority queue.
            </p></li><li class="listitem"><p>
              The thread pool reuses the most active threads to obtain a
              much better use of CPU caches. This is a small adjustment
              that has a great impact on performance.
            </p></li><li class="listitem"><p>
              While a thread executes a statement from a user
              connection, Performance Schema instrumentation accounts
              thread activity to the user connection. Otherwise,
              Performance Schema accounts activity to the thread pool.
</p></li></ul>
</div>
<p>
          Here are examples of conditions under which a thread group
          might have multiple threads started to execute statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              One thread begins executing a statement, but runs long
              enough to be considered stalled. The thread group permits
              another thread to begin executing another statement even
              through the first thread is still executing.
            </p></li><li class="listitem"><p>
              One thread begins executing a statement, then becomes
              blocked and reports this back to the thread pool. The
              thread group permits another thread to begin executing
              another statement.
            </p></li><li class="listitem"><p>
              One thread begins executing a statement, becomes blocked,
              but does not report back that it is blocked because the
              block does not occur in code that has been instrumented
              with thread pool callbacks. In this case, the thread
              appears to the thread group to be still running. If the
              block lasts long enough for the statement to be considered
              stalled, the group permits another thread to begin
              executing another statement.
</p></li></ul>
</div>
<p>
          The thread pool is designed to be scalable across an
          increasing number of connections. It is also designed to avoid
          deadlocks that can arise from limiting the number of actively
          executing statements. It is important that threads that do not
          report back to the thread pool do not prevent other statements
          from executing and thus cause the thread pool to become
          deadlocked. Examples of such statements follow:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Long-running statements. These would lead to all resources
              used by only a few statements and they could prevent all
              others from accessing the server.
            </p></li><li class="listitem"><p>
              Binary log dump threads that read the binary log and send
              it to slaves. This is a kind of long-running
              <span class="quote">“<span class="quote">statement</span>”</span> that runs for a very long time,
              and that should not prevent other statements from
              executing.
            </p></li><li class="listitem"><p>
              Statements blocked on a row lock, table lock, sleep, or
              any other blocking activity that has not been reported
              back to the thread pool by MySQL Server or a storage
              engine.
</p></li></ul>
</div>
<p>
          In each case, to prevent deadlock, the statement is moved to
          the stalled category when it does not complete quickly, so
          that the thread group can permit another statement to begin
          executing. With this design, when a thread executes or becomes
          blocked for an extended time, the thread pool moves the thread
          to the stalled category and for the rest of the statement's
          execution, it does not prevent other statements from
          executing.
        </p><p>
          The maximum number of threads that can occur is the sum of
          <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a> and
          <a class="link" href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a>. This can
          happen in a situation where all connections are in execution
          mode and an extra thread is created per group to listen for
          more statements. This is not necessarily a state that happens
          often, but it is theoretically possible.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="thread-pool-tuning"></a>8.11.6.3. Thread Pool Tuning</h4>

</div>

</div>

</div>
<p>
          This section provides guidelines on setting thread pool system
          variables for best performance, measured using a metric such
          as transactions per second.
        </p><p>
          <a class="link" href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a> is the most
          important parameter controlling thread pool performance. It
          can be set only at server startup. Our experience in testing
          the thread pool indicates the following:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the primary storage engine is
              <code class="literal">InnoDB</code>, the optimal
              <a class="link" href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a> setting
              is likely to be between 16 and 36, with the most common
              optimal values tending to be from 24 to 36. We have not
              seen any situation where the setting has been optimal
              beyond 36. There may be special cases where a value
              smaller than 16 is optimal.
            </p><p>
              For workloads such as DBT2 and Sysbench, the optimum for
              <a class="link" href="storage-engines.html#innodb-storage-engine" title="14.2. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> seems to be usually
              around 36. For very write-intensive workloads, the optimal
              setting can sometimes be lower.
            </p></li><li class="listitem"><p>
              If the primary storage engine is
              <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>, the
              <a class="link" href="server-administration.html#sysvar_thread_pool_size"><code class="literal">thread_pool_size</code></a> setting
              should be fairly low. We tend to get optimal performance
              for values from 4 to 8. Higher values tend to have a
              slightly negative but not dramatic impact on performance.
</p></li></ul>
</div>
<p>
          Another system variable,
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>, is
          important for handling of blocked and long-running statements.
          If all calls that block the MySQL Server are reported to the
          thread pool, it would always know when execution threads are
          blocked. However, this may not always be true. For example,
          blocks could occur in code that has not been instrumented with
          thread pool callbacks. For such cases, the thread pool must be
          able to identify threads that appear to be blocked. This is
          done by means of a timeout, the length of which can be tuned
          using the
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>
          system variable. This parameter ensures that the server does
          not become completely blocked. The value of
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a> has
          an upper limit of 6 seconds to prevent the risk of a
          deadlocked server.
        </p><p>
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a> also
          enables the thread pool to handle long-running statements. If
          a long-running statement was permitted to block a thread
          group, all other connections assigned to the group would be
          blocked and unable to start execution until the long-running
          statement completed. In the worst case, this could take hours
          or even days.
        </p><p>
          The value of
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>
          should be chosen such that statements that execute longer than
          its value are considered stalled. Stalled statements generate
          a lot of extra overhead since they involve extra context
          switches and in some cases even extra thread creations. On the
          other hand, setting the
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>
          parameter too high means that long-running statements will
          block a number of short-running statements for longer than
          necessary. Short wait values permit threads to start more
          quickly. Short values are also better for avoiding deadlock
          situations. Long wait values are useful for workloads that
          include long-running statements, to avoid starting too many
          new statements while the current ones execute.
        </p><p>
          Suppose a server executes a workload where 99.9% of the
          statements complete within 100ms even when the server is
          loaded, and the remaining statements take between 100ms and 2
          hours fairly evenly spread. In this case, it would make sense
          to set
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a> to 10
          (meaning 100ms). The default value of 60ms is okay for servers
          that primarily execute very simple statements.
        </p><p>
          The <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>
          parameter can be changed at runtime to enable you to strike a
          balance appropriate for the server work load. Assuming that
          the <code class="literal">TP_THREAD_GROUP_STATS</code> table is enabled,
          you can use the following query to determine the fraction of
          executed statements that stalled:
        </p><pre class="programlisting">SELECT SUM(STALLED_QUERIES_EXECUTED) / SUM(QUERIES_EXECUTED)
FROM information_schema.TP_THREAD_GROUP_STATS;</pre><p>
          This number should be as low as possible. To decrease the
          likelihood of statements stalling, increase the value of
          <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>.
        </p><p>
          When a statement arrives, what is the maximum time it can be
          delayed before it actually starts executing? Suppose that the
          following conditions apply:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              There are 200 statements queued in the low-priority queue.
            </p></li><li class="listitem"><p>
              There are 10 statements queued in the high-priority queue.
            </p></li><li class="listitem"><p>
              <a class="link" href="server-administration.html#sysvar_thread_pool_prio_kickup_timer"><code class="literal">thread_pool_prio_kickup_timer</code></a>
              is set to 10000 (10 seconds).
            </p></li><li class="listitem"><p>
              <a class="link" href="server-administration.html#sysvar_thread_pool_stall_limit"><code class="literal">thread_pool_stall_limit</code></a>
              is set to 100 (1 second).
</p></li></ul>
</div>
<p>
          In the worst case, the 10 high-priority statements represent
          10 transactions that continue executing for a long time. Thus,
          in the worst case, no statements will be moved to the
          high-priority queue because it will always already contain
          statements awaiting execution. After 10 seconds, the new
          statement is eligible to be moved to the high-priority queue.
          However, before it can be moved, all the statements before it
          must be moved as well. This could take another 2 seconds
          because a maximum of 100 statements per second are moved to
          the high-priority queue. Now when the statement reaches the
          high-priority queue, there could potentially be many
          long-running statements ahead of it. In the worst case, every
          one of those will become stalled and it will take 1 second for
          each statement before the next statement is retrieved from the
          high-priority queue. Thus, in this scenario, it will take 222
          seconds before the new statement starts executing.
        </p><p>
          This example shows a worst case for an application. How to
          handle it depends on the application. If the application has
          high requirements for the response time, it should most likely
          throttle users at a higher level itself. Otherwise, it can use
          the thread pool configuration parameters to set some kind of a
          maximum waiting time.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="optimize-benchmarking"></a>8.12. Measuring Performance (Benchmarking)</h2>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#select-benchmarking">8.12.1. Measuring the Speed of Expressions and Functions</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-benchmarks">8.12.2. The MySQL Benchmark Suite</a></span></dt><dt><span class="section"><a href="optimization.html#custom-benchmarks">8.12.3. Using Your Own Benchmarks</a></span></dt><dt><span class="section"><a href="optimization.html#monitoring-performance-schema">8.12.4. Measuring Performance with <code class="literal">performance_schema</code></a></span></dt><dt><span class="section"><a href="optimization.html#thread-information">8.12.5. Examining Thread Information</a></span></dt></dl>
</div>
<a class="indexterm" name="idp52505856"></a><p>
      To measure performance, consider the following factors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Whether you are measuring the speed of a single operation on a
          quiet system, or how a set of operations (a
          <span class="quote">“<span class="quote">workload</span>”</span>) works over a period of time. With
          simple tests, you usually test how changing one aspect (a
          configuration setting, the set of indexes on a table, the SQL
          clauses in a query) affects performance. Benchmarks are
          typically long-running and elaborate performance tests, where
          the results could dictate high-level choices such as hardware
          and storage configuration, or how soon to upgrade to a new
          MySQL version.
        </p></li><li class="listitem"><p>
          For benchmarking, sometimes you must simulate a heavy database
          workload to get an accurate picture.
        </p></li><li class="listitem"><p>
          Performance can vary depending on so many different factors
          that a difference of a few percentage points might not be a
          decisive victory. The results might shift the opposite way
          when you test in a different environment.
        </p></li><li class="listitem"><p>
          Certain MySQL features help or do not help performance
          depending on the workload. For completeness, always test
          performance with those features turned on and turned off. The
          two most important features to try with each workload are the
          <a class="link" href="optimization.html#query-cache" title="8.9.3. The MySQL Query Cache">MySQL query cache</a>, and the
          <a class="link" href="storage-engines.html#innodb-performance-adaptive_hash_index" title="14.2.4.2.14. Controlling Adaptive Hash Indexing">adaptive
          hash index</a> for <code class="literal">InnoDB</code> tables.
</p></li></ul>
</div>
<p>
      This section progresses from simple and direct measurement
      techniques that a single developer can do, to more complicated
      ones that require additional expertise to perform and interpret
      the results.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="select-benchmarking"></a>8.12.1. Measuring the Speed of Expressions and Functions</h3>
</div>
</div>
</div>
<p>
        To measure the speed of a specific MySQL expression or function,
        invoke the <a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a> function
        using the <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client program. Its syntax is
        <a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK(<em class="replaceable"><code>loop_count</code></em>,<em class="replaceable"><code>expression</code></em>)</code></a>.
        The return value is always zero, but <a class="link" href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
        prints a line displaying approximately how long the statement
        took to execute. For example:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT BENCHMARK(1000000,1+1);</code></strong>
+------------------------+
| BENCHMARK(1000000,1+1) |
+------------------------+
|                      0 |
+------------------------+
1 row in set (0.32 sec)
</pre><p>
        This result was obtained on a Pentium II 400MHz system. It shows
        that MySQL can execute 1,000,000 simple addition expressions in
        0.32 seconds on that system.
      </p><p>
        The built-in MySQL functions are typically highly optimized, but
        there may be some exceptions.
        <a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a> is an excellent tool
        for finding out if some function is a problem for your queries.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-benchmarks"></a>8.12.2. The MySQL Benchmark Suite</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp52526464"></a><a class="indexterm" name="idp52527536"></a><p>
        This benchmark suite is meant to tell any user what operations a
        given SQL implementation performs well or poorly. You can get a
        good idea for how the benchmarks work by looking at the code and
        results in the <code class="filename">sql-bench</code> directory in any
        MySQL source distribution.
      </p><p>
        Note that this benchmark is single-threaded, so it measures the
        minimum time for the operations performed. We plan to add
        multi-threaded tests to the benchmark suite in the future.
      </p><p>
        To use the benchmark suite, the following requirements must be
        satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The benchmark suite is provided with MySQL source
            distributions. You can either download a released
            distribution from <a class="ulink" href="http://dev.mysql.com/downloads/" target="_top">http://dev.mysql.com/downloads/</a>, or
            use the current development source tree. (See
            <a class="xref" href="installing.html#installing-development-tree" title="2.9.3. Installing MySQL Using a Development Source Tree">Section 2.9.3, “Installing MySQL Using a Development Source Tree”</a>.)
          </p></li><li class="listitem"><p>
            The benchmark scripts are written in Perl and use the Perl
            DBI module to access database servers, so DBI must be
            installed. You also need the server-specific DBD drivers for
            each of the servers you want to test. For example, to test
            MySQL, PostgreSQL, and DB2, you must have the
            <code class="literal">DBD::mysql</code>, <code class="literal">DBD::Pg</code>,
            and <code class="literal">DBD::DB2</code> modules installed. See
            <a class="xref" href="installing.html#perl-support" title="2.13. Perl Installation Notes">Section 2.13, “Perl Installation Notes”</a>.
</p></li></ul>
</div>
<p>
        After you obtain a MySQL source distribution, you can find the
        benchmark suite located in its <code class="filename">sql-bench</code>
        directory. To run the benchmark tests, build MySQL, and then
        change location into the <code class="filename">sql-bench</code>
        directory and execute the <code class="literal">run-all-tests</code>
        script:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd sql-bench</code></strong>
shell&gt; <strong class="userinput"><code>perl run-all-tests --server=<em class="replaceable"><code>server_name</code></em></code></strong>
</pre><p>
        <em class="replaceable"><code>server_name</code></em> should be the name of one
        of the supported servers. To get a list of all options and
        supported servers, invoke this command:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>perl run-all-tests --help</code></strong>
</pre><a class="indexterm" name="idp52545024"></a><p>
        The <span class="command"><strong>crash-me</strong></span> script also is located in the
        <code class="filename">sql-bench</code> directory.
        <span class="command"><strong>crash-me</strong></span> tries to determine what features a
        database system supports and what its capabilities and
        limitations are by actually running queries. For example, it
        determines:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            What data types are supported
          </p></li><li class="listitem"><p>
            How many indexes are supported
          </p></li><li class="listitem"><p>
            What functions are supported
          </p></li><li class="listitem"><p>
            How big a query can be
          </p></li><li class="listitem"><p>
            How big a <a class="link" href="data-types.html#char" title="11.4.1. The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column can
            be
</p></li></ul>
</div>
<p>
        For more information about benchmark results, visit
        http://www.mysql.com/why-mysql/benchmarks/.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="custom-benchmarks"></a>8.12.3. Using Your Own Benchmarks</h3>

</div>

</div>

</div>
<a class="indexterm" name="idp52555840"></a><a class="indexterm" name="idp52556912"></a><p>
        Benchmark your application and database to find out where the
        bottlenecks are. After fixing one bottleneck (or by replacing it
        with a <span class="quote">“<span class="quote">dummy</span>”</span> module), you can proceed to identify
        the next bottleneck. Even if the overall performance for your
        application currently is acceptable, you should at least make a
        plan for each bottleneck and decide how to solve it if someday
        you really need the extra performance.
      </p><p>
        For examples of portable benchmark programs, look at those in
        the MySQL benchmark suite. See
        <a class="xref" href="optimization.html#mysql-benchmarks" title="8.12.2. The MySQL Benchmark Suite">Section 8.12.2, “The MySQL Benchmark Suite”</a>. You can take any program
        from this suite and modify it for your own needs. By doing this,
        you can try different solutions to your problem and test which
        really is fastest for you.
      </p><p>
        Another free benchmark suite is the Open Source Database
        Benchmark, available at
        <a class="ulink" href="http://osdb.sourceforge.net/" target="_top">http://osdb.sourceforge.net/</a>.
      </p><p>
        It is very common for a problem to occur only when the system is
        very heavily loaded. We have had many customers who contact us
        when they have a (tested) system in production and have
        encountered load problems. In most cases, performance problems
        turn out to be due to issues of basic database design (for
        example, table scans are not good under high load) or problems
        with the operating system or libraries. Most of the time, these
        problems would be much easier to fix if the systems were not
        already in production.
      </p><p>
        To avoid problems like this, benchmark your whole application
        under the worst possible load:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="programs.html#mysqlslap" title="4.5.7. mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a> program can be helpful for
            simulating a high load produced by multiple clients issuing
            queries simultaneously. See <a class="xref" href="programs.html#mysqlslap" title="4.5.7. mysqlslap — Load Emulation Client">Section 4.5.7, “<span class="command"><strong>mysqlslap</strong></span> — Load Emulation Client”</a>.
          </p></li><li class="listitem"><p>
            You can also try benchmarking packages such as SysBench and
            DBT2, available at
            <a class="ulink" href="http://sourceforge.net/projects/sysbench/" target="_top">http://sourceforge.net/projects/sysbench/</a>,
            and <a class="ulink" href="http://osdldbt.sourceforge.net/#dbt2" target="_top">http://osdldbt.sourceforge.net/#dbt2</a>.
</p></li></ul>
</div>
<p>
        These programs or packages can bring a system to its knees, so
        be sure to use them only on your development systems.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="monitoring-performance-schema"></a>8.12.4. Measuring Performance with <code class="literal">performance_schema</code></h3>

</div>

</div>

</div>
<a class="indexterm" name="idp52570544"></a><p>
        You can query the tables in the
        <code class="literal">performance_schema</code> database to see real-time
        information about the performance characteristics of your server
        and the applications it is running. See
        <a class="xref" href="performance-schema.html" title="Chapter 21. MySQL Performance Schema">Chapter 21, <i>MySQL Performance Schema</i></a> for details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="thread-information"></a>8.12.5. Examining Thread Information</h3>

</div>

</div>

</div>
<div class="toc">
<dl><dt><span class="section"><a href="optimization.html#thread-commands">8.12.5.1. Thread Command Values</a></span></dt><dt><span class="section"><a href="optimization.html#general-thread-states">8.12.5.2. General Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#delayed-insert-thread-states">8.12.5.3. Delayed-Insert Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#query-cache-thread-states">8.12.5.4. Query Cache Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#master-thread-states">8.12.5.5. Replication Master Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#slave-io-thread-states">8.12.5.6. Replication Slave I/O Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#slave-sql-thread-states">8.12.5.7. Replication Slave SQL Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#slave-connection-thread-states">8.12.5.8. Replication Slave Connection Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-cluster-thread-states">8.12.5.9. MySQL Cluster Thread States</a></span></dt><dt><span class="section"><a href="optimization.html#event-scheduler-thread-states">8.12.5.10. Event Scheduler Thread States</a></span></dt></dl>
</div>
<a class="indexterm" name="idp52574992"></a><a class="indexterm" name="idp52576480"></a><a class="indexterm" name="idp52577968"></a><p>
        When you are attempting to ascertain what your MySQL server is
        doing, it can be helpful to examine the process list, which is
        the set of threads currently executing within the server.
        Process list information is available from these sources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">SHOW [FULL] PROCESSLIST</code> statement:
            <a class="xref" href="sql-syntax.html#show-processlist" title="13.7.5.30. SHOW PROCESSLIST Syntax">Section 13.7.5.30, “<code class="literal">SHOW PROCESSLIST</code> Syntax”</a>
          </p></li><li class="listitem"><p>
            The <a class="link" href="sql-syntax.html#show-profile" title="13.7.5.31. SHOW PROFILE Syntax"><code class="literal">SHOW PROFILE</code></a> statement:
            <a class="xref" href="sql-syntax.html#show-profiles" title="13.7.5.32. SHOW PROFILES Syntax">Section 13.7.5.32, “<code class="literal">SHOW PROFILES</code> Syntax”</a>
          </p></li><li class="listitem"><p>
            The <code class="literal">INFORMATION_SCHEMA</code>
            <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table:
            <a class="xref" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table">Section 20.16, “The <code class="literal">INFORMATION_SCHEMA PROCESSLIST</code> Table”</a>
          </p></li><li class="listitem"><p>
            The <a class="link" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin processlist</strong></span></a> command:
            <a class="xref" href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server">Section 4.5.2, “<span class="command"><strong>mysqladmin</strong></span> — Client for Administering a MySQL Server”</a>
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#threads-table" title="21.9.10.3. The threads Table"><code class="literal">performance_schema.threads</code></a>
            table:
            <a class="xref" href="performance-schema.html#performance-schema-miscellaneous-tables" title="21.9.10. Performance Schema Miscellaneous Tables">Section 21.9.10, “Performance Schema Miscellaneous Tables”</a>
</p></li></ul>
</div>
<p>
        Access to <a class="link" href="performance-schema.html#threads-table" title="21.9.10.3. The threads Table"><code class="literal">threads</code></a> does not require
        a mutex and has minimal impact on server performance.
        <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a> and
        <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a> have negative
        performance consequences because they require a mutex.
        <a class="link" href="performance-schema.html#threads-table" title="21.9.10.3. The threads Table"><code class="literal">threads</code></a> also shows information
        about background threads, which
        <a class="link" href="information-schema.html#processlist-table" title="20.16. The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a> and
        <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a> do not. This
        means that <a class="link" href="performance-schema.html#threads-table" title="21.9.10.3. The threads Table"><code class="literal">threads</code></a> can be used to
        monitor activity the other thread information sources cannot.
      </p><p>
        You can always view information about your own threads. To view
        information about threads being executed for other accounts, you
        must have the <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege.
      </p><p>
        Each process list entry contains several pieces of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Id</code> is the connection identifier for the
            client associated with the thread.
          </p></li><li class="listitem"><p>
            <code class="literal">User</code> and <code class="literal">Host</code> indicate
            the account associated with the thread.
          </p></li><li class="listitem"><p>
            <code class="literal">db</code> is the default database for the
            thread, or <code class="literal">NULL</code> if none is selected.
          </p></li><li class="listitem"><p>
            <code class="literal">Command</code> and <code class="literal">State</code>
            indicate what the thread is doing.
          </p><p>
            Most states correspond to very quick operations. If a thread
            stays in a given state for many seconds, there might be a
            problem that needs to be investigated.
          </p></li><li class="listitem"><p>
            <code class="literal">Time</code> indicates how long the thread has
            been in its current state. The thread's notion of the
            current time may be altered in some cases: The thread can
            change the time with
            <a class="link" href="sql-syntax.html#set-statement" title="13.7.4. SET Syntax"><code class="literal">SET TIMESTAMP
            = <em class="replaceable"><code>value</code></em></code></a>. For a thread
            running on a slave that is processing events from the
            master, the thread time is set to the time found in the
            events and thus reflects current time on the master and not
            the slave.
          </p></li><li class="listitem"><p>
            <code class="literal">Info</code> contains the text of the statement
            being executed by the thread, or <code class="literal">NULL</code> if
            it is not executing one. By default, this value contains
            only the first 100 characters of the statement. To see the
            complete statements, use
            <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW FULL
            PROCESSLIST</code></a>.
</p></li></ul>
</div>
<p>
        The following sections list the possible
        <code class="literal">Command</code> values, and <code class="literal">State</code>
        values grouped by category. The meaning for some of these values
        is self-evident. For others, additional description is provided.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="thread-commands"></a>8.12.5.1. Thread Command Values</h4>
</div>
</div>
</div>
<a class="indexterm" name="idp52618912"></a><p>
          A thread can have any of the following
          <code class="literal">Command</code> values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp52621936"></a>

              <a class="indexterm" name="idp52623424"></a>

              <code class="literal">Binlog Dump</code>
            </p><p>
              This is a thread on a master server for sending binary log
              contents to a slave server.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52626896"></a>

              <a class="indexterm" name="idp52628384"></a>

              <code class="literal">Change user</code>
            </p><p>
              The thread is executing a change-user operation.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52631808"></a>

              <a class="indexterm" name="idp52633296"></a>

              <code class="literal">Close stmt</code>
            </p><p>
              The thread is closing a prepared statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52636704"></a>

              <a class="indexterm" name="idp52638192"></a>

              <code class="literal">Connect</code>
            </p><p>
              A replication slave is connected to its master.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52641616"></a>

              <a class="indexterm" name="idp52643104"></a>

              <code class="literal">Connect Out</code>
            </p><p>
              A replication slave is connecting to its master.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52646528"></a>

              <a class="indexterm" name="idp52648016"></a>

              <code class="literal">Create DB</code>
            </p><p>
              The thread is executing a create-database operation.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52651440"></a>

              <a class="indexterm" name="idp52652928"></a>

              <code class="literal">Daemon</code>
            </p><p>
              This thread is internal to the server, not a thread that
              services a client connection.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52656400"></a>

              <a class="indexterm" name="idp52657888"></a>

              <code class="literal">Debug</code>
            </p><p>
              The thread is generating debugging information.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52661312"></a>

              <a class="indexterm" name="idp52662800"></a>

              <code class="literal">Delayed insert</code>
            </p><p>
              The thread is a delayed-insert handler.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52666208"></a>

              <a class="indexterm" name="idp52667696"></a>

              <code class="literal">Drop DB</code>
            </p><p>
              The thread is executing a drop-database operation.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52671120"></a>

              <a class="indexterm" name="idp52672608"></a>

              <code class="literal">Error</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52675552"></a>

              <a class="indexterm" name="idp52677040"></a>

              <code class="literal">Execute</code>
            </p><p>
              The thread is executing a prepared statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52680464"></a>

              <a class="indexterm" name="idp52681952"></a>

              <code class="literal">Fetch</code>
            </p><p>
              The thread is fetching the results from executing a
              prepared statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52685408"></a>

              <a class="indexterm" name="idp52686896"></a>

              <code class="literal">Field List</code>
            </p><p>
              The thread is retrieving information for table columns.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52690320"></a>

              <a class="indexterm" name="idp52691808"></a>

              <code class="literal">Init DB</code>
            </p><p>
              The thread is selecting a default database.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52695216"></a>

              <a class="indexterm" name="idp52696704"></a>

              <code class="literal">Kill</code>
            </p><p>
              The thread is killing another thread.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52700112"></a>

              <a class="indexterm" name="idp52701600"></a>

              <code class="literal">Long Data</code>
            </p><p>
              The thread is retrieving long data in the result of
              executing a prepared statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52705072"></a>

              <a class="indexterm" name="idp52706560"></a>

              <code class="literal">Ping</code>
            </p><p>
              The thread is handling a server-ping request.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52709984"></a>

              <a class="indexterm" name="idp52711472"></a>

              <code class="literal">Prepare</code>
            </p><p>
              The thread is preparing a prepared statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52714896"></a>

              <a class="indexterm" name="idp52716384"></a>

              <code class="literal">Processlist</code>
            </p><p>
              The thread is producing information about server threads.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52719808"></a>

              <a class="indexterm" name="idp52721296"></a>

              <code class="literal">Query</code>
            </p><p>
              The thread is executing a statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52724704"></a>

              <a class="indexterm" name="idp52726192"></a>

              <code class="literal">Quit</code>
            </p><p>
              The thread is terminating.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52729584"></a>

              <a class="indexterm" name="idp52731072"></a>

              <code class="literal">Refresh</code>
            </p><p>
              The thread is flushing table, logs, or caches, or
              resetting status variable or replication server
              information.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52734576"></a>

              <a class="indexterm" name="idp52736064"></a>

              <code class="literal">Register Slave</code>
            </p><p>
              The thread is registering a slave server.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52739472"></a>

              <a class="indexterm" name="idp52740960"></a>

              <code class="literal">Reset stmt</code>
            </p><p>
              The thread is resetting a prepared statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52744384"></a>

              <a class="indexterm" name="idp52745872"></a>

              <code class="literal">Set option</code>
            </p><p>
              The thread is setting or resetting a client
              statement-execution option.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52749328"></a>

              <a class="indexterm" name="idp52750816"></a>

              <code class="literal">Shutdown</code>
            </p><p>
              The thread is shutting down the server.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52754224"></a>

              <a class="indexterm" name="idp52755712"></a>

              <code class="literal">Sleep</code>
            </p><p>
              The thread is waiting for the client to send a new
              statement to it.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52759168"></a>

              <a class="indexterm" name="idp52760656"></a>

              <code class="literal">Statistics</code>
            </p><p>
              The thread is producing server-status information.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52764080"></a>

              <a class="indexterm" name="idp52765568"></a>

              <code class="literal">Table Dump</code>
            </p><p>
              The thread is sending table contents to a slave server.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52768992"></a>

              <a class="indexterm" name="idp52770480"></a>

              <code class="literal">Time</code>
            </p><p>
              Unused.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="general-thread-states"></a>8.12.5.2. General Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp52774544"></a><p>
          The following list describes thread <code class="literal">State</code>
          values that are associated with general query processing and
          not more specialized activities such as replication. Many of
          these are useful only for finding bugs in the server.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp52778160"></a>

              <a class="indexterm" name="idp52779648"></a>

              <code class="literal">After create</code>
            </p><p>
              This occurs when the thread creates a table (including
              internal temporary tables), at the end of the function
              that creates the table. This state is used even if the
              table could not be created due to some error.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52783280"></a>

              <a class="indexterm" name="idp52784768"></a>

              <code class="literal">altering table</code>
            </p><p>
              The server is in the process of executing an in-place
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52789040"></a>

              <a class="indexterm" name="idp52790528"></a>

              <code class="literal">Analyzing</code>
            </p><p>
              The thread is calculating a <code class="literal">MyISAM</code>
              table key distributions (for example, for
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>).
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52795536"></a>

              <a class="indexterm" name="idp52797024"></a>

              <code class="literal">checking permissions</code>
            </p><p>
              The thread is checking whether the server has the required
              privileges to execute the statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52800512"></a>

              <a class="indexterm" name="idp52802000"></a>

              <code class="literal">Checking table</code>
            </p><p>
              The thread is performing a table check operation.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52805424"></a>

              <a class="indexterm" name="idp52806912"></a>

              <code class="literal">cleaning up</code>
            </p><p>
              The thread has processed one command and is preparing to
              free memory and reset certain state variables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52810400"></a>

              <a class="indexterm" name="idp52811888"></a>

              <code class="literal">closing tables</code>
            </p><p>
              The thread is flushing the changed table data to disk and
              closing the used tables. This should be a fast operation.
              If not, verify that you do not have a full disk and that
              the disk is not in very heavy use.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52815504"></a>

              <a class="indexterm" name="idp52817024"></a>

              <code class="literal">committing alter table to storage
              engine</code>
            </p><p>
              The server has finished an in-place
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> and is
              committing the result.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52821392"></a>

              <a class="indexterm" name="idp52822896"></a>

              <code class="literal">converting HEAP to MyISAM</code>
            </p><p>
              The thread is converting an internal temporary table from
              a <code class="literal">MEMORY</code> table to an on-disk
              <code class="literal">MyISAM</code> table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52827824"></a>

              <a class="indexterm" name="idp52829312"></a>

              <code class="literal">copy to tmp table</code>
            </p><p>
              The thread is processing an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a> statement. This state occurs after the
              table with the new structure has been created but before
              rows are copied into it.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52833712"></a>

              <a class="indexterm" name="idp52835200"></a>

              <code class="literal">Copying to group table</code>
            </p><p>
              If a statement has different <code class="literal">ORDER BY</code>
              and <code class="literal">GROUP BY</code> criteria, the rows are
              sorted by group and copied to a temporary table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52840112"></a>

              <a class="indexterm" name="idp52841600"></a>

              <code class="literal">Copying to tmp table</code>
            </p><p>
              The server is copying to a temporary table in memory.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52845024"></a>

              <a class="indexterm" name="idp52846528"></a>

              <code class="literal">Copying to tmp table on disk</code>
            </p><p>
              The server is copying to a temporary table on disk. The
              temporary result set has become too large (see
              <a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.3.3. How MySQL Uses Internal Temporary Tables">Section 8.4.3.3, “How MySQL Uses Internal Temporary Tables”</a>).
              Consequently, the thread is changing the temporary table
              from in-memory to disk-based format to save memory.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52850768"></a>

              <a class="indexterm" name="idp52852256"></a>

              <code class="literal">Creating index</code>
            </p><p>
              The thread is processing <code class="literal">ALTER TABLE ... ENABLE
              KEYS</code> for a <code class="literal">MyISAM</code> table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52857120"></a>

              <a class="indexterm" name="idp52858608"></a>

              <code class="literal">Creating sort index</code>
            </p><p>
              The thread is processing a
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> that is resolved
              using an internal temporary table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52862928"></a>

              <a class="indexterm" name="idp52864416"></a>

              <code class="literal">creating table</code>
            </p><p>
              The thread is creating a table. This includes creation of
              temporary tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52867872"></a>

              <a class="indexterm" name="idp52869360"></a>

              <code class="literal">Creating tmp table</code>
            </p><p>
              The thread is creating a temporary table in memory or on
              disk. If the table is created in memory but later is
              converted to an on-disk table, the state during that
              operation will be <code class="literal">Copying to tmp table on
              disk</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52873696"></a>

              <a class="indexterm" name="idp52875200"></a>

              <code class="literal">deleting from main table</code>
            </p><p>
              The server is executing the first part of a multiple-table
              delete. It is deleting only from the first table, and
              saving columns and offsets to be used for deleting from
              the other (reference) tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52878848"></a>

              <a class="indexterm" name="idp52880352"></a>

              <code class="literal">deleting from reference tables</code>
            </p><p>
              The server is executing the second part of a
              multiple-table delete and deleting the matched rows from
              the other tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52883904"></a>

              <a class="indexterm" name="idp52885408"></a>

              <code class="literal">discard_or_import_tablespace</code>
            </p><p>
              The thread is processing an <code class="literal">ALTER TABLE ...
              DISCARD TABLESPACE</code> or <code class="literal">ALTER TABLE ...
              IMPORT TABLESPACE</code> statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52890352"></a>

              <a class="indexterm" name="idp52891808"></a>

              <code class="literal">end</code>
            </p><p>
              This occurs at the end but before the cleanup of
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a class="link" href="sql-syntax.html#create-view" title="13.1.20. CREATE VIEW Syntax"><code class="literal">CREATE VIEW</code></a>,
              <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
              <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, or
              <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52900272"></a>

              <a class="indexterm" name="idp52901760"></a>

              <code class="literal">executing</code>
            </p><p>
              The thread has begun executing a statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52905168"></a>

              <a class="indexterm" name="idp52906672"></a>

              <code class="literal">Execution of init_command</code>
            </p><p>
              The thread is executing statements in the value of the
              <code class="literal">init_command</code> system variable.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52910864"></a>

              <a class="indexterm" name="idp52912352"></a>

              <code class="literal">freeing items</code>
            </p><p>
              The thread has executed a command. Some freeing of items
              done during this state involves the query cache. This
              state is usually followed by <code class="literal">cleaning
              up</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52916608"></a>

              <a class="indexterm" name="idp52918096"></a>

              <code class="literal">Flushing tables</code>
            </p><p>
              The thread is executing
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> and is waiting for all threads to close
              their tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52922416"></a>

              <a class="indexterm" name="idp52923904"></a>

              <code class="literal">FULLTEXT initialization</code>
            </p><p>
              The server is preparing to perform a natural-language
              full-text search.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52927360"></a>

              <a class="indexterm" name="idp52928848"></a>

              <code class="literal">init</code>
            </p><p>
              This occurs before the initialization of
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
              <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, or
              <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements. Actions
              taken by the server in this state include flushing the
              binary log, the <code class="literal">InnoDB</code> log, and some
              query cache cleanup operations.
            </p><p>
              For the <code class="literal">end</code> state, the following
              operations could be happening:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Removing query cache entries after data in a table is
                  changed
                </p></li><li class="listitem"><p>
                  Writing an event to the binary log
                </p></li><li class="listitem"><p>
                  Freeing memory buffers, including for blobs
</p></li></ul>
</div>
</li><li class="listitem"><p>
              <a class="indexterm" name="idp52941552"></a>

              <a class="indexterm" name="idp52943040"></a>

              <code class="literal">Killed</code>
            </p><p>
              Someone has sent a <a class="link" href="sql-syntax.html#kill" title="13.7.6.4. KILL Syntax"><code class="literal">KILL</code></a>
              statement to the thread and it should abort next time it
              checks the kill flag. The flag is checked in each major
              loop in MySQL, but in some cases it might still take a
              short time for the thread to die. If the thread is locked
              by some other thread, the kill takes effect as soon as the
              other thread releases its lock.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52947664"></a>

              <a class="indexterm" name="idp52949152"></a>

              <code class="literal">logging slow query</code>
            </p><p>
              The thread is writing a statement to the slow-query log.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52952576"></a>

              <a class="indexterm" name="idp52954064"></a>

              <code class="literal">NULL</code>
            </p><p>
              This state is used for the <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW
              PROCESSLIST</code></a> state.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52958320"></a>

              <a class="indexterm" name="idp52959808"></a>

              <code class="literal">login</code>
            </p><p>
              The initial state for a connection thread until the client
              has been authenticated successfully.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52963296"></a>

              <a class="indexterm" name="idp52964784"></a>

              <code class="literal">manage keys</code>
            </p><p>
              The server is enabling or disabling a table index.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52968208"></a>

              <a class="indexterm" name="idp52969696"></a>

              <a class="indexterm" name="idp52971184"></a>

              <a class="indexterm" name="idp52972672"></a>

              <code class="literal">Opening tables</code>, <code class="literal">Opening
              table</code>
            </p><p>
              The thread is trying to open a table. This is should be
              very fast procedure, unless something prevents opening.
              For example, an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
              or a <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5. LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
              TABLE</code></a> statement can prevent opening a table
              until the statement is finished. It is also worth checking
              that your
              <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> value is
              large enough.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52979616"></a>

              <a class="indexterm" name="idp52981104"></a>

              <code class="literal">optimizing</code>
            </p><p>
              The server is performing initial optimizations for a
              query.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52984544"></a>

              <a class="indexterm" name="idp52986032"></a>

              <code class="literal">preparing</code>
            </p><p>
              This state occurs during query optimization.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52989456"></a>

              <a class="indexterm" name="idp52990960"></a>

              <code class="literal">preparing for alter table</code>
            </p><p>
              The server is preparing to execute an in-place
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp52995264"></a>

              <a class="indexterm" name="idp52996752"></a>

              <code class="literal">Purging old relay logs</code>
            </p><p>
              The thread is removing unneeded relay log files.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53000176"></a>

              <a class="indexterm" name="idp53001664"></a>

              <code class="literal">query end</code>
            </p><p>
              This state occurs after processing a query but before the
              <code class="literal">freeing items</code> state.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53005808"></a>

              <a class="indexterm" name="idp53007296"></a>

              <code class="literal">Reading from net</code>
            </p><p>
              The server is reading a packet from the network.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53010720"></a>

              <a class="indexterm" name="idp53012208"></a>

              <code class="literal">Removing duplicates</code>
            </p><p>
              The query was using
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT
              DISTINCT</code></a> in such a way that MySQL could not
              optimize away the distinct operation at an early stage.
              Because of this, MySQL requires an extra stage to remove
              all duplicated rows before sending the result to the
              client.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53016720"></a>

              <a class="indexterm" name="idp53018208"></a>

              <code class="literal">removing tmp table</code>
            </p><p>
              The thread is removing an internal temporary table after
              processing a <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>
              statement. This state is not used if no temporary table
              was created.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53022592"></a>

              <a class="indexterm" name="idp53024080"></a>

              <code class="literal">rename</code>
            </p><p>
              The thread is renaming a table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53027488"></a>

              <a class="indexterm" name="idp53028976"></a>

              <code class="literal">rename result table</code>
            </p><p>
              The thread is processing an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a> statement, has created the new table, and
              is renaming it to replace the original table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53033328"></a>

              <a class="indexterm" name="idp53034816"></a>

              <code class="literal">Reopen tables</code>
            </p><p>
              The thread got a lock for the table, but noticed after
              getting the lock that the underlying table structure
              changed. It has freed the lock, closed the table, and is
              trying to reopen it.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53038416"></a>

              <a class="indexterm" name="idp53039904"></a>

              <code class="literal">Repair by sorting</code>
            </p><p>
              The repair code is using a sort to create indexes.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53043328"></a>

              <a class="indexterm" name="idp53044816"></a>

              <code class="literal">Repair done</code>
            </p><p>
              The thread has completed a multi-threaded repair for a
              <code class="literal">MyISAM</code> table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53048960"></a>

              <a class="indexterm" name="idp53050448"></a>

              <code class="literal">Repair with keycache</code>
            </p><p>
              The repair code is using creating keys one by one through
              the key cache. This is much slower than <code class="literal">Repair by
              sorting</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53054656"></a>

              <a class="indexterm" name="idp53056144"></a>

              <code class="literal">Rolling back</code>
            </p><p>
              The thread is rolling back a transaction.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53059552"></a>

              <a class="indexterm" name="idp53061040"></a>

              <code class="literal">Saving state</code>
            </p><p>
              For <code class="literal">MyISAM</code> table operations such as
              repair or analysis, the thread is saving the new table
              state to the <code class="filename">.MYI</code> file header. State
              includes information such as number of rows, the
              <code class="literal">AUTO_INCREMENT</code> counter, and key
              distributions.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53066800"></a>

              <a class="indexterm" name="idp53068304"></a>

              <code class="literal">Searching rows for update</code>
            </p><p>
              The thread is doing a first phase to find all matching
              rows before updating them. This has to be done if the
              <a class="link" href="sql-syntax.html#update" title="13.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> is changing the
              index that is used to find the involved rows.
            </p></li><li class="listitem"><p>
              <code class="literal">Sending data</code>
            </p><p>
              The thread is reading and processing rows for a
              <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement, and
              sending data to the client. Because operations occurring
              during this this state tend to perform large amounts of
              disk access (reads), it is often the longest-running state
              over the lifetime of a given query.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53075824"></a>

              <a class="indexterm" name="idp53077312"></a>

              <code class="literal">setup</code>
            </p><p>
              The thread is beginning an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE</code></a> operation.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53081584"></a>

              <a class="indexterm" name="idp53083072"></a>

              <code class="literal">Sorting for group</code>
            </p><p>
              The thread is doing a sort to satisfy a <code class="literal">GROUP
              BY</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53087184"></a>

              <a class="indexterm" name="idp53088672"></a>

              <code class="literal">Sorting for order</code>
            </p><p>
              The thread is doing a sort to satisfy a <code class="literal">ORDER
              BY</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53092784"></a>

              <a class="indexterm" name="idp53094272"></a>

              <code class="literal">Sorting index</code>
            </p><p>
              The thread is sorting index pages for more efficient
              access during a <code class="literal">MyISAM</code> table
              optimization operation.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53098480"></a>

              <a class="indexterm" name="idp53099968"></a>

              <code class="literal">Sorting result</code>
            </p><p>
              For a <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement,
              this is similar to <code class="literal">Creating sort index</code>,
              but for nontemporary tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53104976"></a>

              <a class="indexterm" name="idp53106464"></a>

              <code class="literal">statistics</code>
            </p><p>
              The server is calculating statistics to develop a query
              execution plan. If a thread is in this state for a long
              time, the server is probably disk-bound performing other
              work.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53110048"></a>

              <a class="indexterm" name="idp53111120"></a>

              <a class="indexterm" name="idp53112608"></a>

              <a class="indexterm" name="idp53114096"></a>

              <code class="literal">System lock</code>
            </p><p>
              The thread is going to request or is waiting for an
              internal or external system lock for the table. If this
              state is being caused by requests for external locks and
              you are not using multiple <a class="link" href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
              servers that are accessing the same
              <a class="link" href="storage-engines.html#myisam-storage-engine" title="14.3. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables, you can
              disable external system locks with the
              <a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a>
              option. However, external locking is disabled by default,
              so it is likely that this option will have no effect. For
              <a class="link" href="sql-syntax.html#show-profile" title="13.7.5.31. SHOW PROFILE Syntax"><code class="literal">SHOW PROFILE</code></a>, this state
              means the thread is requesting the lock (not waiting for
              it).
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53121456"></a>

              <a class="indexterm" name="idp53122944"></a>

              <code class="literal">update</code>
            </p><p>
              The thread is getting ready to start updating the table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53126368"></a>

              <a class="indexterm" name="idp53127856"></a>

              <code class="literal">Updating</code>
            </p><p>
              The thread is searching for rows to update and is updating
              them.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53131312"></a>

              <a class="indexterm" name="idp53132800"></a>

              <code class="literal">updating main table</code>
            </p><p>
              The server is executing the first part of a multiple-table
              update. It is updating only the first table, and saving
              columns and offsets to be used for updating the other
              (reference) tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53136400"></a>

              <a class="indexterm" name="idp53137904"></a>

              <code class="literal">updating reference tables</code>
            </p><p>
              The server is executing the second part of a
              multiple-table update and updating the matched rows from
              the other tables.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53141456"></a>

              <a class="indexterm" name="idp53142944"></a>

              <code class="literal">User lock</code>
            </p><p>
              The thread is going to request or is waiting for an
              advisory lock requested with a
              <a class="link" href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a> call. For
              <a class="link" href="sql-syntax.html#show-profile" title="13.7.5.31. SHOW PROFILE Syntax"><code class="literal">SHOW PROFILE</code></a>, this state
              means the thread is requesting the lock (not waiting for
              it).
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53148224"></a>

              <a class="indexterm" name="idp53149712"></a>

              <code class="literal">User sleep</code>
            </p><p>
              The thread has invoked a
              <a class="link" href="functions.html#function_sleep"><code class="literal">SLEEP()</code></a> call.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53153952"></a>

              <a class="indexterm" name="idp53155440"></a>

              <code class="literal">Waiting for commit lock</code>
            </p><p>
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES WITH
              READ LOCK</code></a>) is waiting for a commit lock.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53159680"></a>

              <a class="indexterm" name="idp53161184"></a>

              <code class="literal">Waiting for global read lock</code>
            </p><p>
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES WITH
              READ LOCK</code></a>) is waiting for a global read lock.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53165456"></a>

              <a class="indexterm" name="idp53166944"></a>

              <a class="indexterm" name="idp53168432"></a>

              <a class="indexterm" name="idp53169920"></a>

              <code class="literal">Waiting for tables</code>, <code class="literal">Waiting
              for table flush</code>
            </p><p>
              The thread got a notification that the underlying
              structure for a table has changed and it needs to reopen
              the table to get the new structure. However, to reopen the
              table, it must wait until all other threads have closed
              the table in question.
            </p><p>
              This notification takes place if another thread has used
              <a class="link" href="sql-syntax.html#flush" title="13.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
              TABLES</code></a> or one of the following statements on the
              table in question: <code class="literal">FLUSH TABLES
              <em class="replaceable"><code>tbl_name</code></em></code>,
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
              <a class="link" href="sql-syntax.html#rename-table" title="13.1.32. RENAME TABLE Syntax"><code class="literal">RENAME TABLE</code></a>,
              <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>,
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, or
              <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53180976"></a>

              <a class="indexterm" name="idp53182480"></a>

              <a class="indexterm" name="idp53183984"></a>

              <a class="indexterm" name="idp53185488"></a>

              <a class="indexterm" name="idp53186992"></a>

              <a class="indexterm" name="idp53188496"></a>

              <a class="indexterm" name="idp53190016"></a>

              <a class="indexterm" name="idp53191536"></a>

              <a class="indexterm" name="idp53193056"></a>

              <a class="indexterm" name="idp53194576"></a>

              <a class="indexterm" name="idp53196080"></a>

              <a class="indexterm" name="idp53197584"></a>

              <a class="indexterm" name="idp53199088"></a>

              <a class="indexterm" name="idp53200592"></a>

              <a class="indexterm" name="idp53202096"></a>

              <code class="literal">Waiting for <em class="replaceable"><code>lock_type</code></em>
              lock</code>
            </p><p>
              The server is waiting to acquire a lock, where
              <em class="replaceable"><code>lock_type</code></em> indicates the type of
              lock:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">Waiting for event metadata lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for global read lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for schema metadata lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for stored function metadata
                  lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for stored procedure metadata
                  lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for table level lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for table metadata lock</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Waiting for trigger metadata lock</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
              <a class="indexterm" name="idp53218688"></a>

              <a class="indexterm" name="idp53220176"></a>

              <code class="literal">Waiting on cond</code>
            </p><p>
              A generic state in which the thread is waiting for a
              condition to become true. No specific state information is
              available.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53223696"></a>

              <a class="indexterm" name="idp53225184"></a>

              <code class="literal">Writing to net</code>
            </p><p>
              The server is writing a packet to the network.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="delayed-insert-thread-states"></a>8.12.5.3. Delayed-Insert Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53229328"></a><a class="indexterm" name="idp53230816"></a><p>
          These thread states are associated with processing for
          <code class="literal">DELAYED</code> inserts (see
          <a class="xref" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax">Section 13.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>). Some states are associated
          with connection threads that process
          <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statements from
          clients. Other states are associated with delayed-insert
          handler threads that insert the rows. There is a
          delayed-insert handler thread for each table for which
          <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statements are
          issued.
        </p><p>
          States associated with a connection thread that processes an
          <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statement from
          the client:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53238208"></a>

              <a class="indexterm" name="idp53239696"></a>

              <code class="literal">allocating local table</code>
            </p><p>
              The thread is preparing to feed rows to the delayed-insert
              handler thread.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53243152"></a>

              <a class="indexterm" name="idp53244656"></a>

              <code class="literal">Creating delayed handler</code>
            </p><p>
              The thread is creating a handler for
              <code class="literal">DELAYED</code> inserts.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53248816"></a>

              <a class="indexterm" name="idp53250304"></a>

              <code class="literal">got handler lock</code>
            </p><p>
              This occurs before the <code class="literal">allocating local
              table</code> state and after the <code class="literal">waiting for
              handler lock</code> state, when the connection thread
              gets access to the delayed-insert handler thread.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53255248"></a>

              <a class="indexterm" name="idp53256736"></a>

              <code class="literal">got old table</code>
            </p><p>
              This occurs after the <code class="literal">waiting for handler
              open</code> state. The delayed-insert handler thread
              has signaled that it has ended its initialization phase,
              which includes opening the table for delayed inserts.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53261024"></a>

              <a class="indexterm" name="idp53262512"></a>

              <code class="literal">storing row into queue</code>
            </p><p>
              The thread is adding a new row to the list of rows that
              the delayed-insert handler thread must insert.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53266000"></a>

              <a class="indexterm" name="idp53267488"></a>

              <code class="literal">waiting for delay_list</code>
            </p><p>
              This occurs during the initialization phase when the
              thread is trying to find the delayed-insert handler thread
              for the table, and before attempting to gain access to the
              list of delayed-insert threads.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53271104"></a>

              <a class="indexterm" name="idp53272608"></a>

              <code class="literal">waiting for handler insert</code>
            </p><p>
              An <a class="link" href="sql-syntax.html#insert-delayed" title="13.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> handler
              has processed all pending inserts and is waiting for new
              ones.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53276944"></a>

              <a class="indexterm" name="idp53278448"></a>

              <code class="literal">waiting for handler lock</code>
            </p><p>
              This occurs before the <code class="literal">allocating local
              table</code> state when the connection thread waits for
              access to the delayed-insert handler thread.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53282688"></a>

              <a class="indexterm" name="idp53284192"></a>

              <code class="literal">waiting for handler open</code>
            </p><p>
              This occurs after the <code class="literal">Creating delayed
              handler</code> state and before the <code class="literal">got old
              table</code> state. The delayed-insert handler thread
              has just been started, and the connection thread is
              waiting for it to initialize.
</p></li></ul>
</div>
<p>
          States associated with a delayed-insert handler thread that
          inserts the rows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53290112"></a>

              <a class="indexterm" name="idp53291600"></a>

              <code class="literal">insert</code>
            </p><p>
              The state that occurs just before inserting rows into the
              table.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53295056"></a>

              <a class="indexterm" name="idp53296544"></a>

              <code class="literal">reschedule</code>
            </p><p>
              After inserting a number of rows, the delayed-insert
              thread sleeps to let other threads do work.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53300032"></a>

              <a class="indexterm" name="idp53301520"></a>

              <code class="literal">upgrading lock</code>
            </p><p>
              A delayed-insert handler is trying to get a lock for the
              table to insert rows.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53304992"></a>

              <a class="indexterm" name="idp53306480"></a>

              <code class="literal">Waiting for INSERT</code>
            </p><p>
              A delayed-insert handler is waiting for a connection
              thread to add rows to the queue (see <code class="literal">storing row
              into queue</code>).
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="query-cache-thread-states"></a>8.12.5.4. Query Cache Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53311392"></a><a class="indexterm" name="idp53312880"></a><p>
          These thread states are associated with the query cache (see
          <a class="xref" href="optimization.html#query-cache" title="8.9.3. The MySQL Query Cache">Section 8.9.3, “The MySQL Query Cache”</a>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53316176"></a>

              <a class="indexterm" name="idp53317680"></a>

              <code class="literal">checking privileges on cached query</code>
            </p><p>
              The server is checking whether the user has privileges to
              access a cached query result.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53321184"></a>

              <a class="indexterm" name="idp53322688"></a>

              <code class="literal">checking query cache for query</code>
            </p><p>
              The server is checking whether the current query is
              present in the query cache.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53326192"></a>

              <a class="indexterm" name="idp53327696"></a>

              <code class="literal">invalidating query cache entries</code>
            </p><p>
              Query cache entries are being marked invalid because the
              underlying tables have changed.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53331200"></a>

              <a class="indexterm" name="idp53332704"></a>

              <code class="literal">sending cached result to client</code>
            </p><p>
              The server is taking the result of a query from the query
              cache and sending it to the client.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53336208"></a>

              <a class="indexterm" name="idp53337712"></a>

              <code class="literal">storing result in query cache</code>
            </p><p>
              The server is storing the result of a query in the query
              cache.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53341200"></a>

              <a class="indexterm" name="idp53342704"></a>

              <code class="literal">Waiting for query cache lock</code>
            </p><p>
              This state occurs while a session is waiting to take the
              query cache lock. This can happen for any statement that
              needs to perform some query cache operation, such as an
              <a class="link" href="sql-syntax.html#insert" title="13.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> or
              <a class="link" href="sql-syntax.html#delete" title="13.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> that invalidates the
              query cache, a <a class="link" href="sql-syntax.html#select" title="13.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> that
              looks for a cached entry,
              <a class="link" href="sql-syntax.html#reset" title="13.7.6.6. RESET Syntax"><code class="literal">RESET QUERY
              CACHE</code></a>, and so forth.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="master-thread-states"></a>8.12.5.5. Replication Master Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53350512"></a><a class="indexterm" name="idp53352000"></a><p>
          The following list shows the most common states you may see in
          the <code class="literal">State</code> column for the master's
          <code class="literal">Binlog Dump</code> thread. If you see no
          <code class="literal">Binlog Dump</code> threads on a master server,
          this means that replication is not running—that is, that
          no slaves are currently connected.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53357232"></a>

              <a class="indexterm" name="idp53358736"></a>

              <code class="literal">Sending binlog event to slave</code>
            </p><p>
              Binary logs consist of <span class="emphasis"><em>events</em></span>, where
              an event is usually an update plus some other information.
              The thread has read an event from the binary log and is
              now sending it to the slave.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53362784"></a>

              <a class="indexterm" name="idp53364304"></a>

              <code class="literal">Finished reading one binlog; switching to next
              binlog</code>
            </p><p>
              The thread has finished reading a binary log file and is
              opening the next one to send to the slave.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53367872"></a>

              <a class="indexterm" name="idp53369408"></a>

              <code class="literal">Master has sent all binlog to slave; waiting for
              binlog to be updated</code>
            </p><p>
              The thread has read all outstanding updates from the
              binary logs and sent them to the slave. The thread is now
              idle, waiting for new events to appear in the binary log
              resulting from new updates occurring on the master.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53373152"></a>

              <a class="indexterm" name="idp53374656"></a>

              <code class="literal">Waiting to finalize termination</code>
            </p><p>
              A very brief state that occurs as the thread is stopping.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="slave-io-thread-states"></a>8.12.5.6. Replication Slave I/O Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53378816"></a><a class="indexterm" name="idp53380304"></a><p>
          The following list shows the most common states you see in the
          <code class="literal">State</code> column for a slave server I/O thread.
          This state also appears in the
          <code class="literal">Slave_IO_State</code> column displayed by
          <a class="link" href="sql-syntax.html#show-slave-status" title="13.7.5.35. SHOW SLAVE STATUS Syntax"><code class="literal">SHOW SLAVE STATUS</code></a>, so you can
          get a good view of what is happening by using that statement.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53385504"></a>

              <a class="indexterm" name="idp53387008"></a>

              <code class="literal">Waiting for master update</code>
            </p><p>
              The initial state before <code class="literal">Connecting to
              master</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53391168"></a>

              <a class="indexterm" name="idp53392656"></a>

              <code class="literal">Connecting to master</code>
            </p><p>
              The thread is attempting to connect to the master.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53396080"></a>

              <a class="indexterm" name="idp53397568"></a>

              <code class="literal">Checking master version</code>
            </p><p>
              A state that occurs very briefly, after the connection to
              the master is established.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53401040"></a>

              <a class="indexterm" name="idp53402544"></a>

              <code class="literal">Registering slave on master</code>
            </p><p>
              A state that occurs very briefly after the connection to
              the master is established.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53406048"></a>

              <a class="indexterm" name="idp53407536"></a>

              <code class="literal">Requesting binlog dump</code>
            </p><p>
              A state that occurs very briefly, after the connection to
              the master is established. The thread sends to the master
              a request for the contents of its binary logs, starting
              from the requested binary log file name and position.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53411168"></a>

              <a class="indexterm" name="idp53412688"></a>

              <code class="literal">Waiting to reconnect after a failed binlog dump
              request</code>
            </p><p>
              If the binary log dump request failed (due to
              disconnection), the thread goes into this state while it
              sleeps, then tries to reconnect periodically. The interval
              between retries can be specified using the
              <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a> statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53417248"></a>

              <a class="indexterm" name="idp53418768"></a>

              <code class="literal">Reconnecting after a failed binlog dump
              request</code>
            </p><p>
              The thread is trying to reconnect to the master.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53422272"></a>

              <a class="indexterm" name="idp53423776"></a>

              <code class="literal">Waiting for master to send event</code>
            </p><p>
              The thread has connected to the master and is waiting for
              binary log events to arrive. This can last for a long time
              if the master is idle. If the wait lasts for
              <a class="link" href="replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a>
              seconds, a timeout occurs. At that point, the thread
              considers the connection to be broken and makes an attempt
              to reconnect.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53428400"></a>

              <a class="indexterm" name="idp53429904"></a>

              <code class="literal">Queueing master event to the relay log</code>
            </p><p>
              The thread has read an event and is copying it to the
              relay log so that the SQL thread can process it.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53433424"></a>

              <a class="indexterm" name="idp53434944"></a>

              <code class="literal">Waiting to reconnect after a failed master event
              read</code>
            </p><p>
              An error occurred while reading (due to disconnection).
              The thread is sleeping for the number of seconds set by
              the <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a>
              statement (default 60) before attempting to reconnect.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53439440"></a>

              <a class="indexterm" name="idp53440960"></a>

              <code class="literal">Reconnecting after a failed master event
              read</code>
            </p><p>
              The thread is trying to reconnect to the master. When
              connection is established again, the state becomes
              <code class="literal">Waiting for master to send event</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53445264"></a>

              <a class="indexterm" name="idp53446800"></a>

              <code class="literal">Waiting for the slave SQL thread to free enough
              relay log space</code>
            </p><p>
              You are using a nonzero
              <a class="link" href="server-administration.html#sysvar_relay_log_space_limit"><code class="literal">relay_log_space_limit</code></a>
              value, and the relay logs have grown large enough that
              their combined size exceeds this value. The I/O thread is
              waiting until the SQL thread frees enough space by
              processing relay log contents so that it can delete some
              relay log files.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53451472"></a>

              <a class="indexterm" name="idp53452976"></a>

              <code class="literal">Waiting for slave mutex on exit</code>
            </p><p>
              A state that occurs briefly as the thread is stopping.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="slave-sql-thread-states"></a>8.12.5.7. Replication Slave SQL Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53457136"></a><a class="indexterm" name="idp53458624"></a><p>
          The following list shows the most common states you may see in
          the <code class="literal">State</code> column for a slave server SQL
          thread:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53462144"></a>

              <a class="indexterm" name="idp53463648"></a>

              <code class="literal">Waiting for the next event in relay log</code>
            </p><p>
              The initial state before <code class="literal">Reading event from the
              relay log</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53467824"></a>

              <a class="indexterm" name="idp53469328"></a>

              <code class="literal">Reading event from the relay log</code>
            </p><p>
              The thread has read an event from the relay log so that
              the event can be processed.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53472832"></a>

              <a class="indexterm" name="idp53474320"></a>

              <code class="literal">Making temp file</code>
            </p><p>
              The thread is executing a
              <a class="link" href="sql-syntax.html#load-data" title="13.2.6. LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
              INFILE</code></a> statement and is creating a temporary
              file containing the data from which the slave will read
              rows.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53478704"></a>

              <a class="indexterm" name="idp53480272"></a>

              <code class="literal">Slave has read all relay log; waiting for the
              slave I/O thread to update it</code>
            </p><p>
              The thread has processed all events in the relay log
              files, and is now waiting for the I/O thread to write new
              events to the relay log.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53483968"></a>

              <a class="indexterm" name="idp53485472"></a>

              <code class="literal">Waiting for slave mutex on exit</code>
            </p><p>
              A very brief state that occurs as the thread is stopping.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53488928"></a>

              <a class="indexterm" name="idp53490464"></a>

              <code class="literal">Waiting until MASTER_DELAY seconds after master
              executed event</code>
            </p><p>
              The SQL thread has read an event but is waiting for the
              slave delay to lapse. This delay is set with the
              <code class="literal">MASTER_DELAY</code> option of
              <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a>.
</p></li></ul>
</div>
<p>
          The <code class="literal">State</code> column for the I/O thread may
          also show the text of a statement. This indicates that the
          thread has read an event from the relay log, extracted the
          statement from it, and is executing it.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="slave-connection-thread-states"></a>8.12.5.8. Replication Slave Connection Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53497728"></a><a class="indexterm" name="idp53499216"></a><p>
          These thread states occur on a replication slave but are
          associated with connection threads, not with the I/O or SQL
          threads.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53502896"></a>

              <a class="indexterm" name="idp53504384"></a>

              <code class="literal">Changing master</code>
            </p><p>
              The thread is processing a <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1. CHANGE MASTER TO Syntax"><code class="literal">CHANGE
              MASTER TO</code></a> statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53508656"></a>

              <a class="indexterm" name="idp53510144"></a>

              <code class="literal">Killing slave</code>
            </p><p>
              The thread is processing a <code class="literal">STOP SLAVE</code>
              statement.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53514272"></a>

              <a class="indexterm" name="idp53515776"></a>

              <code class="literal">Opening master dump table</code>
            </p><p>
              This state occurs after <code class="literal">Creating table from
              master dump</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53519936"></a>

              <a class="indexterm" name="idp53521440"></a>

              <code class="literal">Reading master dump table data</code>
            </p><p>
              This state occurs after <code class="literal">Opening master dump
              table</code>.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53525584"></a>

              <a class="indexterm" name="idp53527104"></a>

              <code class="literal">Rebuilding the index on master dump
              table</code>
            </p><p>
              This state occurs after <code class="literal">Reading master dump table
              data</code>.
</p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="mysql-cluster-thread-states"></a>8.12.5.9. MySQL Cluster Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53532016"></a><a class="indexterm" name="idp53533504"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53535760"></a>

              <a class="indexterm" name="idp53537264"></a>

              <code class="literal">Committing events to binlog</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53540240"></a>

              <a class="indexterm" name="idp53541744"></a>

              <code class="literal">Opening mysql.ndb_apply_status</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53544720"></a>

              <a class="indexterm" name="idp53546208"></a>

              <code class="literal">Processing events</code>
            </p><p>
              The thread is processing events for binary logging.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53549632"></a>

              <a class="indexterm" name="idp53551136"></a>

              <code class="literal">Processing events from schema table</code>
            </p><p>
              The thread is doing the work of schema replication.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53554592"></a>

              <a class="indexterm" name="idp53556080"></a>

              <code class="literal">Shutting down</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53559024"></a>

              <a class="indexterm" name="idp53560544"></a>

              <code class="literal">Syncing ndb table schema operation and
              binlog</code>
            </p><p>
              This is used to have a correct binary log of schema
              operations for NDB.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53564080"></a>

              <a class="indexterm" name="idp53565584"></a>

              <code class="literal">Waiting for event from ndbcluster</code>
            </p><p>
              The server is acting as an SQL node in a MySQL Cluster,
              and is connected to a cluster management node.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53569104"></a>

              <a class="indexterm" name="idp53570608"></a>

              <code class="literal">Waiting for first event from ndbcluster</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53573584"></a>

              <a class="indexterm" name="idp53575120"></a>

              <code class="literal">Waiting for ndbcluster binlog update to reach
              current position</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53578176"></a>

              <a class="indexterm" name="idp53579680"></a>

              <code class="literal">Waiting for ndbcluster to start</code>
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53582656"></a>

              <a class="indexterm" name="idp53584160"></a>

              <code class="literal">Waiting for schema epoch</code>
            </p><p>
              The thread is waiting for a schema epoch (that is, a
              global checkpoint).
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="event-scheduler-thread-states"></a>8.12.5.10. Event Scheduler Thread States</h4>

</div>

</div>

</div>
<a class="indexterm" name="idp53588368"></a><a class="indexterm" name="idp53589856"></a><p>
          These states occur for the Event Scheduler thread, threads
          that are created to execute scheduled events, or threads that
          terminate the scheduler.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="indexterm" name="idp53592704"></a>

              <a class="indexterm" name="idp53594192"></a>

              <code class="literal">Clearing</code>
            </p><p>
              The scheduler thread or a thread that was executing an
              event is terminating and is about to end.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53597680"></a>

              <a class="indexterm" name="idp53599168"></a>

              <code class="literal">Initialized</code>
            </p><p>
              The scheduler thread or a thread that will execute an
              event has been initialized.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53602640"></a>

              <a class="indexterm" name="idp53604144"></a>

              <code class="literal">Waiting for next activation</code>
            </p><p>
              The scheduler has a nonempty event queue but the next
              activation is in the future.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53607648"></a>

              <a class="indexterm" name="idp53609152"></a>

              <code class="literal">Waiting for scheduler to stop</code>
            </p><p>
              The thread issued <code class="literal">SET GLOBAL
              event_scheduler=OFF</code> and is waiting for the
              scheduler to stop.
            </p></li><li class="listitem"><p>
              <a class="indexterm" name="idp53613360"></a>

              <a class="indexterm" name="idp53614848"></a>

              <code class="literal">Waiting on empty queue</code>
            </p><p>
              The scheduler's event queue is empty and it is sleeping.
</p></li></ul>
</div>

</div>

</div>

</div>

</div>
<div class="copyright-footer">
    Copyright © 1997, 2013, Oracle and/or its affiliates. All
    rights reserved.
<a href="preface.html#legalnotice">Legal Notices</a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="backup-and-recovery.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="language-structure.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 7. Backup and Recovery</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 9. Language Structure</td>
</tr>
</table>
</div>
</body>
</html>
